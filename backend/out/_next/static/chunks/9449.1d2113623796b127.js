(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9449],{922:(e,o,t)=>{"use strict";t.d(o,{NE:()=>n,dC:()=>s,oc:()=>r});let s=()=>{Promise.all([t.e(3309),t.e(6327),t.e(1588)]).then(t.bind(t,91588)).then(e=>{let{pdfjs:o}=e;o.GlobalWorkerOptions.workerSrc="https://unpkg.com/pdfjs-dist@4.8.69/build/pdf.worker.min.mjs",console.log("PDF.js worker initialized with custom version")}).catch(e=>{console.error("Failed to initialize PDF worker:",e)})},r=!0,i=e=>e?e instanceof Blob||e instanceof File||"string"==typeof e?e:e instanceof ArrayBuffer||e instanceof Uint8Array?new Blob([e],{type:"application/pdf"}):(console.error("Unknown PDF source type:",e),null):null,n=function(e){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"document.pdf";if(!r)return{success:!1,error:"Cannot run on server"};try{let t=i(e);if(!t)return{success:!1,error:"Invalid PDF source"};if("string"==typeof t){let e=document.createElement("a");return e.href=t,e.download=o,e.target="_blank",e.style.display="none",document.body.appendChild(e),e.click(),document.body.removeChild(e),{success:!0}}if(t instanceof Blob||t instanceof File){let e=URL.createObjectURL(t),s=document.createElement("a");return s.href=e,s.download=o,s.style.display="none",document.body.appendChild(s),s.click(),document.body.removeChild(s),setTimeout(()=>URL.revokeObjectURL(e),100),{success:!0}}return{success:!1,error:"Unknown source type"}}catch(e){return console.error("Error creating downloadable PDF:",e),{success:!1,error:e.message||"Unknown error"}}};(()=>{let e=null;return async()=>e||(r?e="https://unpkg.com/pdfjs-dist@4.8.69/build/pdf.worker.min.mjs":null)})()},11228:(e,o,t)=>{"use strict";t.r(o),t.d(o,{default:()=>D});var s=t(95155),r=t(12115),i=t(29911),n=t(6874),a=t.n(n),c=t(35695),l=t(55028),d=t(15305),u=t(12515),h=t(17203);let g=async function(e){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"newest",t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4;try{if(!e)throw Error("Book ID is required");let i=localStorage.getItem("token"),n=localStorage.getItem("apiKey"),a=new URLSearchParams;o&&"my-reviews"!==o?a.append("sort",o):"my-reviews"===o&&a.append("sort","newest"),t&&a.append("rating",t),a.append("page",s.toString()),a.append("limit",r.toString());let c="".concat(h.Sn.BOOKS.REVIEWS(e)).concat(a.toString()?"?"+a.toString():""),l=await fetch(c,{method:"GET",headers:{"Content-Type":"application/json",...i&&{Authorization:"Bearer ".concat(i)},...n&&{"X-API-Key":n}}});if(!l.ok){let e=await l.json();throw Error(e.message||"Failed to fetch reviews")}return await l.json()}catch(e){throw console.error("Error fetching book reviews:",e),e}},p=async e=>{try{if(!e)throw Error("Book ID is required");let o=await fetch(h.Sn.BOOKS.RATING(e));if(!o.ok){let e=await o.json();throw Error(e.message||"Failed to fetch book rating")}return await o.json()}catch(e){throw console.error("Error fetching book rating:",e),e}},m=async function(e,o){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";try{if(!e)throw Error("Book ID is required");if(!o||o<1||o>5)throw Error("Rating must be between 1 and 5");if(t&&t.length>200)throw Error("Review text must be under 200 characters");let s=localStorage.getItem("token");if(!s)throw Error("You must be logged in to submit a review");let r=await fetch(h.Sn.BOOKS.REVIEWS(e),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(s)},body:JSON.stringify({rating:o,comment:t.trim()})});if(!r.ok){let e=await r.json();throw Error(e.message||"Failed to submit review")}return await r.json()}catch(e){throw console.error("Error submitting book review:",e),e}},b=async e=>{try{let o=localStorage.getItem("token");if(!o)throw Error("You must be logged in to delete a review");let t=await fetch("".concat(h.JR,"/reviews/").concat(e),{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(o)}});if(!t.ok){let e=await t.json();throw Error(e.message||"Failed to delete review")}return await t.json()}catch(e){throw console.error("Error deleting review:",e),e}};var v=t(56068),_=t(32695),w=t.n(_);function k(e){let{bookId:o}=e,[t,n]=(0,r.useState)([]),[a,c]=(0,r.useState)(0),[l,h]=(0,r.useState)(""),[_,k]=(0,r.useState)(0),[f,x]=(0,r.useState)(0),[j,y]=(0,r.useState)(0),[S,B]=(0,r.useState)(!0),[N,R]=(0,r.useState)(null),[I,P]=(0,r.useState)(null),[E,C]=(0,r.useState)(!1),[A,D]=(0,r.useState)(!1),[T,F]=(0,r.useState)(!1),[O,L]=(0,r.useState)(!1),[H,U]=(0,r.useState)(0),[z,Y]=(0,r.useState)(!1),[q,M]=(0,r.useState)(null),[K,G]=(0,r.useState)("newest"),[V,W]=(0,r.useState)(null),[J,$]=(0,r.useState)({}),[Z,X]=(0,r.useState)(1),[Q,ee]=(0,r.useState)({page:1,limit:4,totalReviews:0,totalPages:0,hasNextPage:!1,hasPrevPage:!1}),[eo,et]=(0,r.useState)(!1),[es,er]=(0,r.useState)(null),{user:ei}=(0,v.h)();(0,r.useEffect)(()=>{en()},[o,K,V,Z]);let en=async()=>{try{if(!o){R("Book ID is missing. Cannot load reviews."),B(!1);return}console.log("BookReview: Fetching data for bookId:",o),B(!0);let[e,t]=await Promise.all([g(o,K,V,Z,4),p(o)]),s=e.reviews||[];if("my-reviews"===K&&ei&&(s=s.filter(e=>ei.name&&e.userName===ei.name||ei.username&&e.userName===ei.username)),n(s),x(t.averageRating),y(t.reviewCount),$(t.ratingDistribution||{}),ei){let e=s.some(e=>ei.name&&e.userName===ei.name||ei.username&&e.userName===ei.username);if(et(e),e){let e=s.find(e=>ei.name&&e.userName===ei.name||ei.username&&e.userName===ei.username);er(e)}}e.pagination&&ee(e.pagination),R(null)}catch(e){R("Failed to load reviews. Please try again later."),console.error("Error loading review data:",e)}finally{B(!1)}},ea=e=>new Date(e).toLocaleDateString(void 0,{year:"numeric",month:"long",day:"numeric"}),ec=e=>{G(e),X(1)},el=e=>{V===e?W(null):W(e),X(1)},ed=e=>{e>=1&&e<=Q.totalPages&&X(e)},eu=async e=>{if(e.preventDefault(),!o)return void P("Book ID is missing. Cannot submit review.");if(0===a)return void P("Please select a rating");try{C(!0),P(null),console.log("Submitting review for bookId:",o),await m(o,a,l),X(1),en(),c(0),h(""),U(0),F(!0),setTimeout(()=>{F(!1)},3e3)}catch(e){P(e.message||"Failed to submit review. Please try again later.")}finally{C(!1)}},eh=e=>{M(e),Y(!0)},eg=()=>{M(null),Y(!1)},ep=async()=>{if(q)try{D(!0),console.log("Deleting review with ID:",q._id),await b(q._id),en(),L(!0),setTimeout(()=>{L(!1)},3e3)}catch(e){console.error("Error deleting review:",e),P(e.message||"Failed to delete review. Please try again later.")}finally{D(!1),Y(!1),M(null)}},em=e=>ei&&(ei.name&&e.userName===ei.name||ei.username&&e.userName===ei.username),eb=e=>Array.from({length:5},(e,o)=>o+1).map(o=>(0,s.jsx)("span",{className:w().displayStar,children:e>=o?(0,s.jsx)(i.gt3,{}):(0,s.jsx)(i.wei,{})},o));return S?(0,s.jsx)("div",{className:w().loading,children:"Loading reviews..."}):N?(0,s.jsx)("div",{className:w().error,children:N}):(0,s.jsxs)("div",{className:w().reviewContainer,children:[z&&q&&(0,s.jsx)("div",{className:w().confirmOverlay,children:(0,s.jsxs)("div",{className:w().confirmDialog,children:[(0,s.jsxs)("div",{className:w().confirmHeader,children:[(0,s.jsx)("h4",{children:"Delete Review"}),(0,s.jsx)("button",{onClick:eg,className:w().closeButton,"aria-label":"Close",children:(0,s.jsx)(i.QCr,{})})]}),(0,s.jsx)("p",{children:"Are you sure you want to delete your review? This action cannot be undone."}),(0,s.jsxs)("div",{className:w().confirmButtons,children:[(0,s.jsx)("button",{onClick:eg,className:w().cancelButton,disabled:A,children:"Cancel"}),(0,s.jsx)("button",{onClick:ep,className:w().deleteConfirmButton,disabled:A,children:A?"Deleting...":"Delete"})]})]})}),(0,s.jsx)("div",{className:w().reviewHeader,children:(0,s.jsxs)("div",{className:w().reviewSummary,children:[(0,s.jsxs)("h2",{children:[j," Reviews"]}),(0,s.jsxs)("div",{className:w().totalRating,children:[(0,s.jsxs)("div",{className:w().overallRating,children:[(0,s.jsx)("div",{className:w().ratingValue,children:f.toFixed(1)}),(0,s.jsx)("div",{className:w().ratingStars,children:eb(f)})]}),(0,s.jsx)("div",{className:w().totalBadge,children:(0,s.jsxs)("span",{children:[j," ratings"]})})]})]})}),(0,s.jsxs)("div",{className:w().reviewContent,children:[ei?eo?(0,s.jsxs)("div",{className:w().alreadyReviewed,children:[(0,s.jsx)("h3",{children:"Your Review"}),(0,s.jsxs)("div",{className:w().userReviewBox,children:[(0,s.jsxs)("div",{className:w().userReviewHeader,children:[(0,s.jsxs)("div",{className:w().userReviewRating,children:[eb((null==es?void 0:es.rating)||0),(0,s.jsxs)("span",{className:w().ratingText,children:[(null==es?void 0:es.rating)||0,"/5 stars"]})]}),(0,s.jsxs)("button",{onClick:()=>eh(es),className:w().deleteUserReviewButton,title:"Delete your review",children:[(0,s.jsx)(i.qbC,{})," Delete Review"]})]}),(null==es?void 0:es.comment)&&(0,s.jsxs)("div",{className:w().userReviewComment,children:['"',es.comment,'"']}),(0,s.jsxs)("div",{className:w().userReviewDate,children:["Reviewed on ",ea(null==es?void 0:es.createdAt)]})]})]}):(0,s.jsxs)("div",{className:w().reviewForm,children:[(0,s.jsx)("h3",{children:"Write a Review"}),T&&(0,s.jsxs)("div",{className:w().success,children:[(0,s.jsx)(i.A7C,{style:{marginRight:"8px"}}),"Your review has been submitted successfully!"]}),O&&(0,s.jsxs)("div",{className:w().success,children:[(0,s.jsx)(i.A7C,{style:{marginRight:"8px"}}),"Your review has been deleted successfully!"]}),I&&(0,s.jsxs)("div",{className:w().submitError,children:[(0,s.jsx)(i.BS8,{style:{marginRight:"8px"}}),I]}),(0,s.jsxs)("form",{onSubmit:eu,children:[(0,s.jsxs)("div",{className:w().ratingSelector,children:[(0,s.jsx)("label",{htmlFor:"rating-stars",children:"Your Rating:"}),(0,s.jsx)("div",{className:w().stars,id:"rating-stars",role:"group","aria-label":"Select a rating from 1 to 5 stars",children:Array.from({length:5},(e,o)=>o+1).map(e=>(0,s.jsx)("span",{className:w().ratingStar,onClick:()=>c(e),onMouseEnter:()=>k(e),onMouseLeave:()=>k(0),children:(_||a)>=e?(0,s.jsx)(i.gt3,{}):(0,s.jsx)(i.wei,{})},e))}),a>0&&(0,s.jsxs)("div",{className:w().selectedRating,children:["You selected: ",(0,s.jsxs)("strong",{children:[a," ",1===a?"star":"stars"]})]})]}),(0,s.jsxs)("div",{className:w().commentField,children:[(0,s.jsxs)("label",{htmlFor:"review-comment",children:["Your Review: ",(0,s.jsx)("span",{className:w().optional,children:"(optional, max 200 characters)"})]}),(0,s.jsx)("textarea",{id:"review-comment",value:l,onChange:e=>{let o=e.target.value;o.length<=200&&(h(o),U(o.length))},placeholder:"Share your thoughts about this book (optional)",rows:4,className:w().textarea,maxLength:200}),(0,s.jsxs)("div",{className:w().characterCount,children:[H,"/200 characters"]})]}),(0,s.jsx)("button",{type:"submit",className:w().submitButton,disabled:E||0===a,children:E?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:w().spinner}),"Submitting..."]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(i.Cer,{style:{marginRight:"8px"}}),"Submit Review"]})})]})]}):(0,s.jsxs)("div",{className:w().loginPrompt,children:[(0,s.jsx)(i.JhU,{style:{marginRight:"8px",fontSize:"1.2rem"}}),"Please log in to leave a review."]}),(0,s.jsxs)("div",{className:w().reviewsList,children:[(0,s.jsx)("div",{className:w().reviewsHeader,children:(0,s.jsxs)("h3",{children:["Reviews (",j,")"]})}),(0,s.jsx)("div",{className:w().filterSortContainer,children:(0,s.jsxs)("div",{className:w().ratingFilters,children:[(0,s.jsx)("div",{className:w().filtersHeader,children:(0,s.jsxs)("h3",{children:[(0,s.jsx)(u.npS,{style:{color:"#ef4444"}})," ",(0,s.jsx)("span",{children:"Filter & Sort Reviews"})]})}),(V||"newest"!==K)&&(0,s.jsxs)("div",{className:w().activeFilterIndicator,children:[V&&(0,s.jsxs)("div",{className:w().filterBadge,children:[(0,s.jsxs)("div",{className:w().filterBadgeContent,children:[(0,s.jsxs)("strong",{children:[V,"-star"]})," reviews only"]}),(0,s.jsx)("button",{className:w().clearFilterButton,onClick:()=>el(null),"aria-label":"Clear rating filter",title:"Clear rating filter",children:(0,s.jsx)(i.QCr,{})})]}),"newest"!==K&&(0,s.jsx)("div",{className:w().sortBadge,children:(0,s.jsxs)("span",{children:["Sorted by: ",(0,s.jsx)("strong",{children:"highest"===K?"Highest Rated":"lowest"===K?"Lowest Rated":"oldest"===K?"Oldest First":"my-reviews"===K?"My Reviews":"Newest First"})]})})]}),(0,s.jsxs)("div",{className:w().filterOptions,children:[(0,s.jsx)("div",{className:w().filterLabel,children:"Filter by Rating:"}),(0,s.jsxs)("div",{className:w().ratingFilterButtons,children:[(0,s.jsx)("button",{className:"".concat(w().ratingFilterButton," ").concat(null===V?w().activeFilter:""),onClick:()=>el(null),"aria-label":"Show all reviews",title:"Show all reviews",children:"All Ratings"}),[5,4,3,2,1].map(e=>(0,s.jsxs)("button",{className:"".concat(w().ratingFilterButton," ").concat(V===e?w().activeFilter:""),onClick:()=>el(e),"aria-label":"Show only ".concat(e," star reviews"),title:"Show only ".concat(e," star reviews"),children:[(0,s.jsxs)("span",{className:w().filterStars,children:[e," ",(0,s.jsx)(i.gt3,{className:w().filterStar})]}),J&&J[e]>0&&(0,s.jsxs)("span",{className:w().filterCount,children:["(",J[e],")"]})]},e))]})]}),(0,s.jsxs)("div",{className:w().sortOptions,children:[(0,s.jsx)("div",{className:w().filterLabel,children:"Sort Reviews By:"}),(0,s.jsxs)("div",{className:w().sortButtons,children:[(0,s.jsxs)("button",{className:"".concat(w().sortButton," ").concat("newest"===K?w().activeSort:""),onClick:()=>ec("newest"),"aria-label":"Sort by newest reviews first",title:"Sort by newest reviews first",children:[(0,s.jsx)(u.SEk,{})," Newest First"]}),(0,s.jsxs)("button",{className:"".concat(w().sortButton," ").concat("oldest"===K?w().activeSort:""),onClick:()=>ec("oldest"),"aria-label":"Sort by oldest reviews first",title:"Sort by oldest reviews first",children:[(0,s.jsx)(d.NXG,{})," Oldest First"]}),(0,s.jsxs)("button",{className:"".concat(w().sortButton," ").concat("highest"===K?w().activeSort:""),onClick:()=>ec("highest"),"aria-label":"Sort by highest rating first",title:"Sort by highest rating first",children:[(0,s.jsx)(d.sIf,{})," Highest Rated"]}),(0,s.jsxs)("button",{className:"".concat(w().sortButton," ").concat("lowest"===K?w().activeSort:""),onClick:()=>ec("lowest"),"aria-label":"Sort by lowest rating first",title:"Sort by lowest rating first",children:[(0,s.jsx)(d.NXG,{})," Lowest Rated"]}),ei&&(0,s.jsxs)("button",{className:"".concat(w().sortButton," ").concat("my-reviews"===K?w().activeSort:""),onClick:()=>ec("my-reviews"),"aria-label":"Show only my reviews",title:"Show only my reviews",children:[(0,s.jsx)(i.x$1,{})," My Reviews"]})]})]})]})}),0===t.length?(0,s.jsx)("div",{className:w().noReviews,children:V?"No ".concat(V,"-star reviews found. ").concat(j>0?"Try a different filter.":"This book has no reviews yet."):"my-reviews"===K?"You have not reviewed this book yet.":j>0?"No reviews match the current filters.":"Be the first to review this book!"}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:w().activeFilterIndicator,children:[(0,s.jsx)("div",{className:w().reviewCount,children:(0,s.jsx)("span",{children:"my-reviews"===K?"Showing your ".concat(t.length," ").concat(1===t.length?"review":"reviews"):(0,s.jsxs)(s.Fragment,{children:["Showing ",(0,s.jsx)("strong",{children:t.length})," of ",(0,s.jsx)("strong",{children:j})," reviews"]})})}),t.map(e=>(0,s.jsxs)("div",{className:w().reviewItem,children:[(0,s.jsxs)("div",{className:w().reviewHeader,children:[(0,s.jsxs)("div",{className:w().reviewerInfo,children:[e.userImage?(0,s.jsx)("img",{src:e.userImage,alt:e.userName,className:w().reviewerImage}):(0,s.jsx)("div",{className:w().reviewerPlaceholder,children:(0,s.jsx)(i.x$1,{})}),(0,s.jsx)("span",{className:w().reviewerName,children:e.userName})]}),(0,s.jsxs)("div",{className:w().reviewMetadata,children:[(0,s.jsxs)("div",{className:w().reviewDate,children:[(0,s.jsx)(i.bfZ,{}),(0,s.jsx)("span",{children:ea(e.createdAt)})]}),em(e)&&(0,s.jsx)("button",{onClick:()=>eh(e),className:w().deleteButton,disabled:A,title:"Delete your review",children:(0,s.jsx)(i.qbC,{})})]})]}),(0,s.jsx)("div",{className:w().reviewRating,children:eb(e.rating)}),e.comment&&(0,s.jsx)("div",{className:w().reviewText,children:e.comment})]},e._id))]}),Q.totalPages<=1?null:(0,s.jsxs)("div",{className:w().pagination,children:[(0,s.jsx)("button",{className:"".concat(w().pageButton," ").concat(Q.hasPrevPage?"":w().disabled),onClick:()=>ed(Z-1),disabled:!Q.hasPrevPage,"aria-label":"Previous page",children:(0,s.jsx)(i._Jj,{})}),(0,s.jsxs)("div",{className:w().pageInfo,children:["Page ",Q.page," of ",Q.totalPages]}),(0,s.jsx)("button",{className:"".concat(w().pageButton," ").concat(Q.hasNextPage?"":w().disabled),onClick:()=>ed(Z+1),disabled:!Q.hasNextPage,"aria-label":"Next page",children:(0,s.jsx)(i.X6T,{})})]})]})]})]})]})}var f=t(71759),x=t.n(f),j=t(922),y=t(53116);t(46264);var S=t(38543);function B(e){if(!e||"object"!=typeof e)return e;let o={...e};return o._id&&"object"==typeof o._id&&o._id.$oid&&(o._id=o._id.$oid),"isPremium"in o&&(o.isPremium=!0===o.isPremium||"true"===o.isPremium||1===o.isPremium||"true"===String(o.isPremium).toLowerCase()),"price"in o&&(o.price&&"object"==typeof o.price?o.price.$numberLong?o.price=Number(o.price.$numberLong):o.price.$numberInt&&(o.price=Number(o.price.$numberInt)):o.price=Number(o.price||0)),["createdAt","updatedAt","lastSignInDate","lastCoinReward"].forEach(e=>{o[e]&&("object"==typeof o[e]&&o[e].$date?"object"==typeof o[e].$date&&o[e].$date.$numberLong?o[e]=new Date(Number(o[e].$date.$numberLong)):o[e]=new Date(o[e].$date):"string"==typeof o[e]&&(o[e]=new Date(o[e])))}),["views","downloads","averageRating","pageSize","fileSizeMB","coins"].forEach(e=>{e in o&&("object"==typeof o[e]?o[e].$numberInt?o[e]=Number(o[e].$numberInt):o[e].$numberLong&&(o[e]=Number(o[e].$numberLong)):o[e]=Number(o[e]||0))}),"userHasAccess"in o&&(o.userHasAccess=!0===o.userHasAccess||"true"===o.userHasAccess||1===o.userHasAccess||"true"===String(o.userHasAccess).toLowerCase()),o}t(72047);var N=t(51879),R=t(78876),I=t(87358);let P=(0,l.default)(()=>Promise.all([t.e(5129),t.e(510)]).then(t.bind(t,510)),{loadableGenerated:{webpack:()=>[510]},ssr:!1,loading:()=>(0,s.jsxs)("div",{className:x().loadingContainer,children:[(0,s.jsx)("div",{className:x().loadingSpinner}),(0,s.jsx)("p",{children:"Loading PDF viewer..."})]})}),E={},C=function(e){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3e5,t=Date.now(),s=E[e]||0;return t-s<o?(console.log("Skipping ".concat(e," API call, last call was ").concat((t-s)/1e3,"s ago (min interval: ").concat(o/1e3,"s)")),!1):(E[e]=t,!0)},A=e=>{if(!e)return null;try{let o="string"==typeof e?JSON.parse(e):e,t=B(o);return console.log("Normalized book data:",{title:t.title,author:t.author,id:t._id,isPremium:t.isPremium,price:t.price}),t}catch(o){return console.error("Error parsing MongoDB book data:",o),console.error("Original data:",e),null}};function D(e){let{id:o}=e,[n,l]=(0,r.useState)(null),[d,u]=(0,r.useState)(!0),[g,p]=(0,r.useState)(null),[m,b]=(0,r.useState)(!1),[_,w]=(0,r.useState)(!1),[f,E]=(0,r.useState)(null),[D,T]=(0,r.useState)(!1),[F,O]=(0,r.useState)(!1),[L,H]=(0,r.useState)(!1),[U,z]=(0,r.useState)(!1),[Y,q]=(0,r.useState)(null),[M,K]=(0,r.useState)(null),G=(0,c.useRouter)(),{user:V,isLoggedIn:W,getToken:J,getApiKey:$,updateUserCoins:Z}=(0,v.h)(),X=(0,r.useRef)(!1),Q=(0,r.useRef)(!1),ee=(0,r.useRef)(0),eo=(0,r.useRef)(null);(0,r.useEffect)(()=>{if(o&&"string"==typeof o&&o.includes("$oid")){console.log("Detected MongoDB extended JSON format in ID, attempting to parse");try{let e=A(o);if(e&&e._id){console.log("Successfully parsed book data from ID parameter:",e.title),l(e),u(!1);return}}catch(e){console.error("Error parsing book data from ID:",e)}}},[o]);let et=(0,r.useCallback)(async()=>{if(!o){console.error("Cannot fetch book: ID is missing"),p("Cannot fetch book details: ID is missing"),u(!1);return}if(n&&!d)return void console.log("Book already loaded from parameter data, skipping fetch");if(Q.current)return void console.log("Already fetching book data, skipping duplicate request");try{if(console.log("Fetching book with ID: ".concat(o)),u(!0),Q.current=!0,"string"==typeof o&&(o.includes("$oid")||o.includes("$numberInt")||o.includes("$date"))){console.log("Potential MongoDB document detected in ID parameter");try{let e=JSON.parse(o);if(e&&e._id){let o=B(e);console.log("Successfully parsed book data:"),console.log("- Title:",o.title),console.log("- Author:",o.author),console.log("- ID:",o._id),l(o),u(!1),Q.current=!1;return}}catch(e){console.log("Not a valid JSON document, proceeding with normal fetch")}}let e=o.replace(/['"{}]/g,""),t=h.Sn.BOOKS.DETAILS(e);console.log("Fetching from API endpoint: ".concat(t));let s={};if(W){let e=await J();e&&(s.Authorization="Bearer ".concat(e));let o=await $();o&&(s["X-API-Key"]=o)}let r=await fetch(t,{headers:s});if(!r.ok){let o="API Error ".concat(r.status," (").concat(r.statusText,")");console.error(o);let t="";try{t=(await r.json()).message||""}catch(e){t=await r.text()}404===r.status?p("Book not found (ID: ".concat(e,")")):p("Error loading book: ".concat(o,". ").concat(t)),u(!1),Q.current=!1;return}let i=await r.json();K(JSON.stringify(i,null,2)),console.log("API Response:",i);let n=B(i);console.log("Normalized book data:",{title:n.title,author:n.author,isPremium:n.isPremium,price:n.price}),l(n),p(null)}catch(e){console.error("Error fetching book:",e),p("Failed to load book details: ".concat(e.message))}finally{u(!1),Q.current=!1}},[o,W,J,$,n,d]);(0,r.useEffect)(()=>{et()},[et]),(0,r.useEffect)(()=>{{new URLSearchParams(window.location.search).has("debug")&&(O(!0),console.log("DEBUG MODE ENABLED VIA URL"));let e=[],o=[17,16,80,17,16,80],t=t=>{e.push(t.keyCode),e.length>o.length&&e.shift(),e.join("")===o.join("")&&(O(e=>!e),console.log("DEBUG MODE TOGGLED VIA KEY SEQUENCE"),e=[])};return window.addEventListener("keydown",t),()=>{window.removeEventListener("keydown",t)}}},[]);let es=!!n&&(!0===n.isPremium||"true"===n.isPremium||1===n.isPremium||"true"===String(n.isPremium).toLowerCase()||n.price&&Number(n.price)>0),er=!!n&&(!0===n.userHasAccess||"true"===n.userHasAccess||1===n.userHasAccess||"true"===String(n.userHasAccess).toLowerCase()),ei=er||D,en=!es||D;V&&n&&(V.coins,n.price);let ea=n?n.price?Number(n.price):25*!!es:0,ec=(0,r.useCallback)(async()=>{if(!o)return void console.log("Cannot check purchase status: Book ID is missing");if(!es)return void console.log("Skipping purchase check for non-premium book");if(!W)return void console.log("Skipping purchase check - user not logged in");if(D)return void console.log("User already has access through subscription, skipping purchase check");if(Q.current)return void console.log("Already fetching data, skipping duplicate purchase check");if(C("checkPurchase_"+o,3e5)){try{let e=localStorage.getItem("purchaseCheckData_"+o);if(e){let o=JSON.parse(e),t=new Date(o.timestamp),s=new Date,r=new Date(s.getTime()-3e5);if(t>r&&(console.log("Using cached purchase data from",t),o.hasPurchased)){console.log("Cached data indicates user has purchased this book"),l(e=>({...e,userHasAccess:!0}));return}}}catch(e){console.error("Error checking cached purchase data:",e)}console.log("Checking purchase status for book ID: ".concat(o));try{if(Q.current=!0,n&&!0===n.userHasAccess){console.log("Book already marked as purchased in local state"),l(e=>({...e,userHasAccess:!0}));return}console.log("Calling API to verify purchase status...");let e=await (0,y.PZ)(o);try{localStorage.setItem("purchaseCheckData_"+o,JSON.stringify({hasPurchased:(null==e?void 0:e.success)&&(null==e?void 0:e.hasPurchased)===!0,timestamp:new Date().toISOString()}))}catch(e){console.error("Error caching purchase data:",e)}if(console.log("Purchase check API response:",e),e&&e.success){let o=e.hasPurchased;console.log("API confirms user ".concat(o?"has":"has not"," purchased this book")),l(e=>({...e,userHasAccess:o})),o&&l(e=>({...e,userHasAccess:!0}))}else console.warn("Purchase check API returned success:false or invalid response")}catch(e){console.error("Error checking book purchase status:",e);try{let e=localStorage.getItem("userInfo");if(e){let t=JSON.parse(e);if(t.purchasedBooks&&Array.isArray(t.purchasedBooks)){let e=t.purchasedBooks.includes(o);console.log("Fallback: Local storage indicates user ".concat(e?"has":"has not"," purchased this book")),e&&l(e=>({...e,userHasAccess:!0}))}}}catch(e){console.error("Error checking local storage for purchase status:",e)}}finally{Q.current=!1}}},[W,o,es,n,D,l]),el=(0,r.useCallback)(async()=>{if(!W)return console.log("Skipping subscription check - user not logged in"),T(!1),!1;try{if(console.log("Checking subscription status for premium book access"),H(!0),Q.current)return console.log("Already fetching data, skipping duplicate subscription check"),D;if(!C("checkSubscription",6e4))return D;markApiCallTime("checkSubscription"),Q.current=!0;let{getCurrentSubscription:e}=await Promise.resolve().then(t.bind(t,46264)),s=await e();console.log("Subscription check response:",s);let r=!!(s&&s.success&&s.active);return T(r),r?(console.log("User has active subscription with access to premium books"),l(e=>({...e,userHasAccess:!0})),localStorage.setItem("subscription_".concat(o),JSON.stringify({hasSubscription:!0,timestamp:new Date().getTime()}))):(console.log("User does not have an active subscription with premium access"),er||l(e=>({...e,userHasAccess:!1})),localStorage.setItem("subscription_".concat(o),JSON.stringify({hasSubscription:!1,timestamp:new Date().getTime()}))),r}catch(e){return console.error("Error checking subscription status:",e),T(!1),!1}finally{H(!1),Q.current=!1}},[W,o,er]),ed=(0,r.useCallback)(async e=>{if(!e)return console.error("No API key provided for subscription check"),!1;try{if(console.log("Checking subscription status using API key"),H(!0),Q.current)return console.log("Already fetching data, skipping duplicate API key subscription check"),D;Q.current=!0;let{checkSubscriptionWithApiKey:o}=await Promise.resolve().then(t.bind(t,46264)),s=await o(e);if(console.log("API key subscription check response:",s),s&&s.success&&s.active)return console.log("API key has access to premium content through active subscription"),T(!0),l(e=>({...e,userHasAccess:!0})),!0;return console.log("API key does not have an active subscription with premium access"),!1}catch(e){return console.error("Error checking subscription status with API key:",e),!1}finally{H(!1),Q.current=!1}},[o]);(0,r.useEffect)(()=>{if(W&&es&&!U){if(er)return void console.log("User already has access through purchase, not setting up subscription checker");console.log("Starting subscription checker...");let e=!1;try{let o=localStorage.getItem("subscriptionCheckData");if(o){let t=JSON.parse(o),s=new Date(t.timestamp),r=new Date,i=new Date(r.getTime()-3e5);s>i&&(console.log("Using cached subscription data for initial check"),e=!0,t.hasSubscription&&(T(!0),l(e=>({...e,userHasAccess:!0}))))}}catch(e){console.error("Error checking cached subscription data:",e)}e||el(),z(!0)}return()=>{eo.current&&(console.log("Clearing subscription checker..."),clearInterval(eo.current),eo.current=null,z(!1))}},[W,es,el,U,er]),(0,r.useEffect)(()=>{W&&o&&es&&ec()},[W,o,es,ec]),(0,r.useEffect)(()=>{W&&!X.current&&(console.log("User just logged in - checking subscription status"),el()),X.current=W},[W,el]),(0,r.useEffect)(()=>{W&&el()},[W,el]);let eu=async()=>{if(!n||!o)return void console.error("Cannot download: Book data or ID is missing");if(es){let e=new URLSearchParams(window.location.search).get("apiKey"),o=!1;if((D||ei)&&(o=!0,console.log("User has subscription or has purchased the book, allowing download")),!o&&e)try{await ed(e)&&(o=!0,console.log("API key has valid subscription, allowing download"))}catch(e){console.error("Error verifying subscription with API key:",e)}if(!o)if(W){q("You need an active subscription to download this premium book."),S.oR.error("Subscription required to download premium books",{position:"top-center",autoClose:3e3});return}else{q("You need to log in and subscribe to download this premium book."),G.push("/login");return}}try{b(!0),console.log("Downloading book with ID:",o);let e={"Content-Type":"application/json"},t=new URLSearchParams(window.location.search).get("apiKey");if(n.isPremium)if(t)e["X-API-Key"]=t,console.log("Using API key from URL parameter for download");else{let o=J(),t=$();o&&(e.Authorization="Bearer ".concat(o),console.log("Using auth token for PDF download")),t&&(e["X-API-Key"]=t,console.log("Using stored API key for download"))}try{await fetch(h.Sn.BOOKS.DOWNLOAD(o),{method:"POST",headers:e})}catch(e){console.warn("Failed to record download count, but continuing download:",e)}let s="".concat(n.title.replace(/[^a-zA-Z0-9]/g,"_"),".pdf");try{console.log("Fetching PDF content via backend proxy for book: ".concat(n.title));let t="".concat(h.Sn.BOOKS.PDF_CONTENT(o),"?download=true&counted=true"),r=await fetch(t,{headers:e});if(!r.ok){if(401===r.status||403===r.status){let e;try{e=await r.json()}catch(o){e={message:"Authentication error",isPremium:es,requiresSubscription:!0}}if(console.error("Error response from server:",e),e.isPremium&&e.requiresSubscription)throw q(e.message||"You need an active subscription to download this premium book."),S.oR.error("Subscription required for download",{position:"top-center",autoClose:3e3}),W||setTimeout(()=>G.push("/login"),1500),Error("Premium content requires subscription for downloads");if(e.isPremium)throw q(e.message||"This is premium content. Please log in to access it."),Error("Premium content requires authentication")}throw Error("Failed to fetch PDF: ".concat(r.status," ").concat(r.statusText))}let i=await r.blob(),a=(0,j.NE)(i,s);if(!a.success)throw Error(a.error||"Download failed");console.log("PDF downloaded as: ".concat(s)),S.oR.success("Download successful!",{position:"top-center",autoClose:2e3})}catch(e){if(console.warn("Direct download failed, using fallback:",e),S.oR.info("Trying alternative download method...",{position:"top-center",autoClose:2e3}),e.message.includes("subscription"))return;try{let e="".concat(h.Sn.BOOKS.PDF(o),"?download=true&counted=true");window.open(e,"_blank")}catch(e){console.error("Fallback download also failed:",e),S.oR.error("Download failed. Please try again later.",{position:"top-center",autoClose:3e3})}}l(e=>({...e,downloads:(e.downloads||0)+1}))}catch(e){console.error("Error downloading book:",e),e.message.includes("subscription")||e.message.includes("Premium content")||S.oR.error("Download failed. Please try again later.",{position:"top-center",autoClose:3e3})}finally{b(!1)}},eh=(0,r.useCallback)(async()=>{if(!W||!V)return void console.log("Cannot refresh coins: User not logged in");let e=Date.now(),o=e-ee.current;if(o<5e3)return void console.log("Skipping coin refresh - last refresh was ".concat(o,"ms ago (< 5000ms)"));ee.current=e,console.log("Refreshing user coin balance...");try{let{getUserCoins:e}=await Promise.resolve().then(t.bind(t,53116)),o=await e();o&&"number"==typeof o.coins&&(console.log("Updating user coins from ".concat(V.coins," to ").concat(o.coins)),Z(o.coins))}catch(e){console.error("Error refreshing coin balance:",e)}},[W,V,Z]);return((0,r.useEffect)(()=>{W&&es&&(console.log("Component mounted or premium status changed - refreshing coin balance"),eh())},[W,es,eh]),(0,r.useEffect)(()=>{if(!o){console.error("BookPageClient: Book ID is missing or undefined"),p("Book ID is missing. Please go back and try again."),u(!1);return}let e=!0;!1===d&&(e=W&&!X.current||!n,W&&!X.current&&(console.log("User just logged in - refreshing coin balance"),eh())),X.current=W,e&&setTimeout(()=>et(),50)},[o,W,V,eh]),(0,r.useEffect)(()=>()=>{f&&"string"==typeof f&&f.startsWith("blob:")&&(URL.revokeObjectURL(f),console.log("Cleaned up blob URL:",f))},[f]),(0,r.useEffect)(()=>{if(W&&es){console.log("Component mounted - checking cached data and auth state");try{let e=localStorage.getItem("subscriptionCheckData");if(e)try{let o=JSON.parse(e),t=new Date(o.timestamp),s=new Date,r=new Date(s.getTime()-6e4);t>r&&o.hasSubscription?(console.log("Using fresh cached subscription data on initial mount"),T(!0),l(e=>({...e,userHasAccess:!0}))):console.log("Cached subscription data is not fresh enough or inactive")}catch(e){console.error("Error parsing cached subscription data:",e)}let t=localStorage.getItem("purchaseCheckData_"+o);if(t)try{JSON.parse(t).hasPurchased&&(console.log("Using cached purchase data on initial mount"),l(e=>({...e,userHasAccess:!0})))}catch(e){console.error("Error parsing cached purchase data:",e)}}catch(e){console.error("Error checking cached data on mount:",e)}setTimeout(()=>{el()},300)}},[W,es,o,el]),d)?(0,s.jsxs)("div",{className:x().loadingContainer,children:[(0,s.jsx)("div",{className:x().loadingSpinner}),(0,s.jsx)("p",{children:"Loading book details..."})]}):g?(0,s.jsxs)("div",{className:x().errorContainer,children:[(0,s.jsx)("h2",{children:"Error Loading Book"}),(0,s.jsx)("p",{children:g}),(0,s.jsxs)("div",{className:x().buttonRow,children:[(0,s.jsxs)("button",{onClick:()=>G.back(),className:x().backButton,children:[(0,s.jsx)(i.QVr,{className:x().buttonIcon})," Go Back"]}),(0,s.jsx)("button",{onClick:()=>{p(null),u(!0),et()},className:x().retryButton,children:"Try Again"})]}),F&&(0,s.jsxs)("div",{className:x().debugPanel,children:[(0,s.jsx)("h3",{children:"Debug Information"}),(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{children:"Book ID:"})," ",o]}),(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{children:"API URL:"})," ","https://ebookaura.onrender.com/api"]}),(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{children:"Static Export:"})," ",I.env.STATIC_EXPORT||"not set"]}),M&&(0,s.jsxs)("details",{children:[(0,s.jsx)("summary",{children:"Raw API Response"}),(0,s.jsx)("pre",{style:{maxHeight:"200px",overflow:"auto",background:"#f8f9fa",padding:"10px",borderRadius:"4px",fontSize:"12px"},children:M})]})]})]}):n?(0,s.jsxs)("div",{className:x().bookContainer,children:[(0,s.jsx)(N.A,{}),(0,s.jsxs)("div",{className:x().header,children:[(0,s.jsxs)(a(),{href:"/search",className:x().backButton,children:[(0,s.jsx)(i.QVr,{})," Back to Search"]}),(0,s.jsx)("button",{onClick:()=>O(!0),style:{display:"none",marginLeft:"10px",padding:"8px 15px",background:"#5b89ff",color:"white",border:"none",borderRadius:"4px",cursor:"pointer"},className:x().debugButton,children:es?"✓ Premium Book":"Debug Premium"})]}),(0,s.jsxs)("div",{className:x().bookDetailContainer,children:[(0,s.jsxs)("div",{className:x().bookInformation,children:[(0,s.jsxs)("div",{className:x().bookCover,children:[n.coverImage?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("img",{src:n.coverImage,alt:n.title}),(es||(null==n?void 0:n.price)>0)&&(0,s.jsx)("div",{className:x().premiumOverlay,children:(0,s.jsx)(i.JhU,{className:x().lockIcon})})]}):(0,s.jsxs)("div",{className:x().placeholderCover,children:[(0,s.jsx)(i.vd0,{}),(es||(null==n?void 0:n.price)>0)&&(0,s.jsx)(i.JhU,{className:x().lockIconPlaceholder})]}),(es||(null==n?void 0:n.price)>0)&&(0,s.jsxs)("div",{className:x().premiumBadge,children:[(0,s.jsx)(i.Hu1,{className:x().crownIcon})," Premium"]})]}),(0,s.jsxs)("div",{className:x().bookInfo,children:[(0,s.jsx)("h1",{className:x().title,children:n.title}),(0,s.jsxs)("p",{className:x().author,children:["by ",n.author]}),(0,s.jsxs)("div",{className:x().categoryInfo,children:[(0,s.jsx)("p",{className:x().category,children:n.category}),(es||(null==n?void 0:n.price)>0)&&(0,s.jsxs)("span",{className:x().premiumTag,children:[(0,s.jsx)(i.Hu1,{className:x().premiumIcon})," Premium"]})]}),(0,s.jsxs)("div",{className:x().stats,children:[(0,s.jsxs)("span",{className:x().stat,children:[(0,s.jsx)(i.Ny1,{})," ",n.views," views"]}),(0,s.jsxs)("span",{className:x().stat,children:[(0,s.jsx)(i.WCW,{})," ",n.downloads," downloads"]}),n.averageRating>0&&(0,s.jsxs)("span",{className:x().stat,children:[(0,s.jsx)(i.gt3,{})," ",n.averageRating.toFixed(1)]}),n.pageSize>0&&(0,s.jsxs)("span",{className:x().stat,children:[(0,s.jsx)(i.t69,{})," ",n.pageSize," pages"]}),n.fileSizeMB>0&&(0,s.jsxs)("span",{className:x().stat,children:[(0,s.jsx)(i.t69,{})," ",n.fileSizeMB," MB"]})]}),(0,s.jsxs)("div",{className:x().description,children:[(0,s.jsx)("h2",{children:"Description"}),(0,s.jsx)("p",{children:n.description})]}),(0,s.jsxs)("div",{className:x().tags,children:[(0,s.jsx)("h2",{children:"Tags"}),(0,s.jsxs)("div",{className:x().tagList,children:[n.tags&&n.tags.map((e,o)=>(0,s.jsx)("span",{className:x().tag,children:e},o)),(!n.tags||0===n.tags.length)&&(0,s.jsx)("span",{className:x().noTags,children:"No tags"})]})]}),(es||(null==n?void 0:n.price)>0)&&(0,s.jsxs)("div",{className:x().premiumPurchaseContainer,children:[F&&(0,s.jsxs)("div",{style:{display:F?"block":"none",marginTop:"20px",padding:"15px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:"5px",fontSize:"0.85rem"},children:[(0,s.jsx)("h3",{children:"Book Status Debug Information"}),(0,s.jsxs)("ul",{style:{listStyleType:"none",padding:0},children:[(0,s.jsxs)("li",{children:[(0,s.jsx)("strong",{children:"Book ID:"})," ",o]}),(0,s.jsxs)("li",{children:[(0,s.jsx)("strong",{children:"Title:"})," ",null==n?void 0:n.title]}),(0,s.jsxs)("li",{children:[(0,s.jsx)("strong",{children:"Raw isPremium:"})," ",String(null==n?void 0:n.isPremium)]}),(0,s.jsxs)("li",{children:[(0,s.jsx)("strong",{children:"Raw price:"})," ",String(null==n?void 0:n.price)]}),(0,s.jsxs)("li",{children:[(0,s.jsx)("strong",{children:"isPremium type:"})," ",typeof(null==n?void 0:n.isPremium)]}),(0,s.jsxs)("li",{children:[(0,s.jsx)("strong",{children:"price type:"})," ",typeof(null==n?void 0:n.price)]}),(0,s.jsxs)("li",{children:[(0,s.jsx)("strong",{children:"Computed isPremiumBook:"})," ",String(es)]}),(0,s.jsxs)("li",{children:[(0,s.jsx)("strong",{children:"Premium Status:"})," ",es?"Premium Book":"Free Book"]}),(0,s.jsxs)("li",{children:[(0,s.jsx)("strong",{children:"Has Subscription:"})," ",D?"Yes":"No"]}),(0,s.jsxs)("li",{children:[(0,s.jsx)("strong",{children:"Is Logged In:"})," ",W?"Yes":"No"]})]}),(0,s.jsxs)("div",{style:{marginTop:"15px",display:"flex",gap:"10px"},children:[(0,s.jsx)("button",{onClick:()=>O(!1),style:{background:"#dc3545",color:"white",border:"none",padding:"5px 10px",borderRadius:"4px",cursor:"pointer"},children:"Hide Debug Info"}),(0,s.jsx)("button",{onClick:()=>{et()},style:{background:"#28a745",color:"white",border:"none",padding:"5px 10px",borderRadius:"4px",cursor:"pointer"},children:"Refresh Book Data"})]})]}),!F&&(0,s.jsx)("button",{onClick:()=>O(!0),style:{display:"none",background:"#007bff",color:"white",border:"none",padding:"5px 10px",borderRadius:"4px",cursor:"pointer",fontSize:"0.75rem",marginBottom:"10px"},children:"Show Debug Info"}),(0,s.jsxs)("div",{className:x().premiumLabel,children:[(0,s.jsx)(i.Hu1,{className:x().crownIcon})," Premium Book"]}),W&&D&&(0,s.jsxs)("div",{className:x().subscriptionAccess,children:[(0,s.jsx)(i.A7C,{className:x().checkIcon}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:x().accessTitle,children:"Premium Access"}),(0,s.jsx)("div",{className:x().accessText,children:"You have access to this book through your active subscription."})]})]}),console.log("hasSubscription",D),W&&!D&&(0,s.jsxs)("div",{className:x().subscriptionRequired,children:[(0,s.jsxs)("div",{className:x().subscriptionMessage,children:[(0,s.jsx)(i.Hu1,{className:x().crownIcon}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:x().subscriptionTitle,children:"Subscription Required"}),(0,s.jsx)("div",{className:x().subscriptionText,children:"This premium book is only available to subscribers. Subscribe to access all premium books."})]})]}),(0,s.jsxs)(a(),{href:"/plans",className:x().subscribeButton,children:[(0,s.jsx)(i.Hu1,{className:x().buttonCrownIcon}),"Subscribe Now"]})]}),!W&&(0,s.jsxs)("div",{className:x().loginRequired,children:[(0,s.jsx)("div",{className:x().loginMessage,children:"This premium book requires a subscription. Please log in to access with your subscription or to subscribe."}),(0,s.jsxs)("div",{className:x().loginButtons,children:[(0,s.jsxs)(a(),{href:"/login",className:x().loginButton,children:[(0,s.jsx)(i.x$1,{className:x().userIcon})," Log In"]}),(0,s.jsxs)(a(),{href:"/signup",className:x().signupButton,children:[(0,s.jsx)(i.NPy,{className:x().userPlusIcon})," Sign Up"]})]})]})]}),(0,s.jsx)("div",{className:x().actions,children:(0,s.jsxs)("button",{onClick:()=>{window.open("https://www.profitableratecpm.com/tv0ps1rfet?key=a753be44cf1e6c5a853397fa67fe886c","_blank"),setTimeout(()=>{eu()},1e3)},className:"".concat(x().downloadButton," ").concat(en?"":x().disabledButton),disabled:m||!en,children:[(0,s.jsx)(i.WCW,{})," ",m?"Downloading...":"Download PDF"]})})]})]}),(0,s.jsx)(R.A,{}),(0,s.jsx)(k,{bookId:o})]}),_&&f&&(0,s.jsx)(P,{pdfUrl:f,onClose:()=>{f&&"string"==typeof f&&f.startsWith("blob:")&&URL.revokeObjectURL(f),w(!1),E(null),console.log("PDF viewer closed and resources cleaned up")},title:n.title,allowDownload:!0,onDownload:eu}),W&&F&&(0,s.jsxs)("div",{className:x().debugSection,style:{margin:"10px 0",padding:"10px",background:"#f8f9fa",borderRadius:"4px"},children:[(0,s.jsx)("strong",{children:"Debug Info:"}),(0,s.jsxs)("div",{children:["Premium Book: ",es?"Yes":"No"]}),(0,s.jsxs)("div",{children:["Price: ",ea," coins"]}),(0,s.jsxs)("div",{children:["User Purchased: ",ei?"Yes":"No"]}),(0,s.jsxs)("div",{children:["Has Subscription: ",D?"Yes":"No"]}),(0,s.jsxs)("div",{children:["Has Access: ",ei?"Yes":"No"]})]}),W&&es&&D&&(0,s.jsxs)("div",{className:"".concat(x().subscriptionNotice," ").concat(x().accessNotice),style:{margin:"10px 0",padding:"15px",background:"#e9f7ff",borderRadius:"8px",border:"1px solid #4c9aff",display:"flex",alignItems:"center",gap:"10px",boxShadow:"0 2px 4px rgba(0,0,0,0.05)",fontWeight:"500"},children:[(0,s.jsx)(i.Hu1,{style:{color:"#ffd700",fontSize:"24px"}}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{style:{fontWeight:"bold",marginBottom:"4px"},children:"Premium Access"}),(0,s.jsx)("span",{children:"You have access to this book through your active subscription. Enjoy reading!"})]})]}),F&&(0,s.jsxs)("div",{style:{position:"fixed",bottom:"10px",right:"10px",background:"rgba(0,0,0,0.7)",color:"white",padding:"8px 12px",borderRadius:"4px",fontSize:"12px",zIndex:9999,maxWidth:"300px"},children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("strong",{children:"API Status:"})," ",Q.current?"\uD83D\uDD04 Fetching...":"✅ Idle"]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("strong",{children:"Book Premium:"})," ",es?"✅ Yes":"❌ No"]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("strong",{children:"Access:"})," ",ei?"✅ Yes":"❌ No"]}),ei&&(0,s.jsxs)("div",{children:[(0,s.jsx)("strong",{children:"Access Type:"})," ",D?"\uD83D\uDD11 Subscription":"\uD83D\uDCB0 Purchased"]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("strong",{children:"Subscription Check:"})," ",L?"\uD83D\uDD04 Active":"⏹️ Inactive"]})]}),es&&!D&&(0,s.jsxs)("div",{className:x().subscriptionNotice,style:{margin:"10px 0",padding:"15px",background:"#fff6e6",borderRadius:"8px",border:"1px solid #ffe0b2",display:"flex",alignItems:"center",gap:"10px",boxShadow:"0 2px 4px rgba(0,0,0,0.05)",fontWeight:"500"},children:[(0,s.jsx)(i.WCW,{style:{color:"#e65100",fontSize:"24px"}}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{style:{fontWeight:"bold",marginBottom:"4px"},children:"Download Requires Subscription"}),(0,s.jsxs)("span",{children:["You can view this premium PDF, but you need an active subscription to download it. ",!W&&"Please log in and subscribe to download.",W&&(0,s.jsx)(a(),{href:"/plans",style:{color:"#0070f3",fontWeight:"bold",marginLeft:"6px"},children:"Subscribe Now"})]})]})]}),F?(0,s.jsx)("div",{style:{position:"fixed",bottom:"10px",right:"10px",zIndex:1e3,backgroundColor:"#f8f9fa",padding:"5px 10px",borderRadius:"4px",boxShadow:"0 2px 4px rgba(0,0,0,0.1)",fontSize:"12px"},children:(0,s.jsxs)("details",{children:[(0,s.jsx)("summary",{style:{cursor:"pointer",fontWeight:"bold"},children:"Book Data Debug"}),(0,s.jsxs)("div",{style:{maxWidth:"400px",maxHeight:"500px",overflowX:"auto",overflowY:"auto"},children:[(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{children:"Title:"})," ",(null==n?void 0:n.title)||"N/A"]}),(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{children:"Author:"})," ",(null==n?void 0:n.author)||"N/A"]}),(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{children:"ID:"})," ",(null==n?void 0:n._id)||"N/A"]}),(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{children:"Is Premium:"})," ",String(es)]}),(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{children:"Price:"})," ",(null==n?void 0:n.price)||0," coins"]}),(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{children:"Cover Image:"})," ",(null==n?void 0:n.coverImage)?"Yes":"No"]}),(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{children:"PDF URL:"})," ",(null==n?void 0:n.pdfUrl)?"Yes":"No"]}),(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{children:"Has Access:"})," ",String(ei)]}),(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{children:"Has Subscription:"})," ",String(D)]}),(0,s.jsxs)("div",{style:{marginTop:"10px"},children:[(0,s.jsx)("button",{onClick:()=>{console.log("Full book data:",n),alert("Book data logged to console")},style:{padding:"5px 10px",background:"#007bff",color:"white",border:"none",borderRadius:"4px",cursor:"pointer",fontSize:"12px",marginRight:"5px"},children:"Log Book Data"}),(0,s.jsx)("button",{onClick:()=>{u(!0),et()},style:{padding:"5px 10px",background:"#28a745",color:"white",border:"none",borderRadius:"4px",cursor:"pointer",fontSize:"12px"},children:"Refresh Data"})]})]})]})}):null]}):(0,s.jsxs)("div",{className:x().errorContainer,children:[(0,s.jsx)("h2",{children:"Book Not Found"}),(0,s.jsx)("p",{children:"The requested book information could not be loaded."}),(0,s.jsxs)("div",{className:x().buttonRow,children:[(0,s.jsxs)("button",{onClick:()=>G.back(),className:x().backButton,children:[(0,s.jsx)(i.QVr,{className:x().buttonIcon})," Go Back"]}),(0,s.jsx)("button",{onClick:()=>{u(!0),et()},className:x().retryButton,children:"Try Again"})]}),o&&"string"==typeof o&&(o.includes("$oid")||o.includes("_id"))&&(0,s.jsxs)("div",{className:x().debugPanel,children:[(0,s.jsx)("h3",{children:"Direct Document Data"}),(0,s.jsx)("p",{children:"It appears you're trying to view a book by passing the entire MongoDB document."}),(0,s.jsx)("p",{children:"Try visiting a URL with just the book ID instead."}),(0,s.jsxs)("div",{style:{marginTop:"20px"},children:[(0,s.jsx)("h4",{children:"Try to parse and display book:"}),(0,s.jsx)("button",{onClick:()=>{try{let e=A(o);e?(l(e),p(null)):p("Failed to parse book data from the provided document")}catch(e){p("Error parsing document: ".concat(e.message))}},className:x().actionButton,children:"Parse Document Data"})]})]})]})}},17203:(e,o,t)=>{"use strict";t.d(o,{JR:()=>s,Sn:()=>r}),t(72047);let s="https://ebookaura.onrender.com/api",r={AUTH:{LOGIN:"".concat(s,"/auth/login"),REGISTER:"".concat(s,"/auth/register"),ME:"".concat(s,"/auth/me"),FORGOT_PASSWORD:"".concat(s,"/auth/forgot-password"),RESET_PASSWORD:e=>"".concat(s,"/auth/reset-password/").concat(e),VERIFY_EMAIL:"".concat(s,"/auth/verify-email")},BOOKS:{ALL:"".concat(s,"/books"),CATEGORIES:"".concat(s,"/books/categories"),TAGS:"".concat(s,"/books/tags"),DETAILS:e=>"".concat(s,"/books/").concat(e),PDF:e=>"".concat(s,"/books/pdf/").concat(e),PDF_CONTENT:e=>"".concat(s,"/books/pdf/").concat(e),DOWNLOAD:e=>"".concat(s,"/books/").concat(e,"/download"),REVIEWS:e=>"".concat(s,"/books/").concat(e,"/reviews"),RATING:e=>"".concat(s,"/books/").concat(e,"/rating"),ADD_REVIEW:e=>"".concat(s,"/books/").concat(e,"/reviews")},UPLOAD:{FILE:"".concat(s,"/upload"),PDF:"".concat(s,"/upload/pdf"),DELETE_FILE:e=>"".concat(s,"/upload/").concat(e),DELETE_BOOK:e=>"".concat(s,"/upload/book/").concat(e)},USER:{PROFILE:"".concat(s,"/users/profile"),UPDATE_PROFILE:"".concat(s,"/users/profile"),UPDATE_IMAGE:"".concat(s,"/users/profile/image"),BOOKMARKS:"".concat(s,"/users/bookmarks")},SUBSCRIPTIONS:{CURRENT:"".concat(s,"/subscriptions/current"),CHECK:"".concat(s,"/subscriptions/check"),CHECK_API:"".concat(s,"/subscriptions/check-api"),ACTIVATE:"".concat(s,"/subscriptions/activate"),DEACTIVATE:"".concat(s,"/subscriptions/deactivate")},API_KEYS:{GENERATE:"".concat(s,"/api-keys/generate"),CURRENT:"".concat(s,"/api-keys/current"),REVOKE:"".concat(s,"/api-keys/revoke"),VERIFY:"".concat(s,"/api-keys/verify")}}},32695:e=>{e.exports={reviewContainer:"BookReview_reviewContainer__PXZXE",reviewHeader:"BookReview_reviewHeader__exUT_",reviewSummary:"BookReview_reviewSummary__m9pQe",totalRating:"BookReview_totalRating__pWZXj",overallRating:"BookReview_overallRating__ZqhqM",ratingValue:"BookReview_ratingValue__Ek1q_",ratingStars:"BookReview_ratingStars__TajM3",totalBadge:"BookReview_totalBadge__XRXmr",filterSortContainer:"BookReview_filterSortContainer__VbWZM",ratingFilters:"BookReview_ratingFilters__2sfGt",highlightFilters:"BookReview_highlightFilters__e7dxy",filtersHeader:"BookReview_filtersHeader__Bj9bO",pulseHeader:"BookReview_pulseHeader__10fad",activeFilterIndicator:"BookReview_activeFilterIndicator__0KGTt",filterBadge:"BookReview_filterBadge___lSTT",pulseBorder:"BookReview_pulseBorder__WH3PL",sortBadge:"BookReview_sortBadge__CS43D",fadeIn:"BookReview_fadeIn__ejiO2",clearFilterButton:"BookReview_clearFilterButton__DFeGj",filterOptions:"BookReview_filterOptions__Lr7_r",filterLabel:"BookReview_filterLabel__BUgIR",ratingFilterButtons:"BookReview_ratingFilterButtons__SNy3w",ratingFilterButton:"BookReview_ratingFilterButton__zBp4l",activeFilter:"BookReview_activeFilter__7fooV",filterStar:"BookReview_filterStar__D4fwS",sortOptions:"BookReview_sortOptions__isXrS",sortButtons:"BookReview_sortButtons__m0mZx",sortButton:"BookReview_sortButton__48q83",activeSort:"BookReview_activeSort__vJjfY",pulseDot:"BookReview_pulseDot__dlqnC",reviewContent:"BookReview_reviewContent__cNFFI",averageRating:"BookReview_averageRating__GLivu",ratingNumber:"BookReview_ratingNumber__2uD8e",reviewCount:"BookReview_reviewCount__gFeSv",displayStar:"BookReview_displayStar__Fz3J4",reviewForm:"BookReview_reviewForm__KzYxy",success:"BookReview_success__phiTs",submitError:"BookReview_submitError__GK4zL",ratingSelector:"BookReview_ratingSelector__Y8L9Q",stars:"BookReview_stars__vHpqj",ratingStar:"BookReview_ratingStar__7YZu8",commentField:"BookReview_commentField__HbZ9h",optional:"BookReview_optional__5fC_J",textarea:"BookReview_textarea__uqAZb",characterCount:"BookReview_characterCount__avyYp",submitButton:"BookReview_submitButton__uifGG",loginPrompt:"BookReview_loginPrompt__nl1B6",reviewsList:"BookReview_reviewsList__36HJ_",reviewsHeader:"BookReview_reviewsHeader__VE_c3",noReviews:"BookReview_noReviews__EL0Br",reviewItem:"BookReview_reviewItem__wF7Ok",reviewerInfo:"BookReview_reviewerInfo__yDoe0",reviewerImage:"BookReview_reviewerImage__T3neO",reviewerPlaceholder:"BookReview_reviewerPlaceholder__VLVSv",reviewerName:"BookReview_reviewerName___r0hh",reviewDate:"BookReview_reviewDate__fxaMW",reviewMetadata:"BookReview_reviewMetadata__cvN1d",deleteButton:"BookReview_deleteButton__sF4DA",reviewRating:"BookReview_reviewRating__TTay3",reviewText:"BookReview_reviewText__OjgJ1",confirmOverlay:"BookReview_confirmOverlay__3SoDg",confirmDialog:"BookReview_confirmDialog__rHKbe",slideUp:"BookReview_slideUp__26h3O",confirmHeader:"BookReview_confirmHeader__9ZJSd",closeButton:"BookReview_closeButton__ABCqQ",confirmButtons:"BookReview_confirmButtons__fnWlf",cancelButton:"BookReview_cancelButton__FmPbe",deleteConfirmButton:"BookReview_deleteConfirmButton__bWD9h",loading:"BookReview_loading__xP9sm",error:"BookReview_error__dxxxC",pulse:"BookReview_pulse__kJ1qE",filterButtons:"BookReview_filterButtons__HLVmO",filterStars:"BookReview_filterStars__VTPC6",filterCount:"BookReview_filterCount__bXmzR",filterBadgeContent:"BookReview_filterBadgeContent__IES9e",clearFilterBadge:"BookReview_clearFilterBadge__Kxty7",spinner:"BookReview_spinner__T90VY",spin:"BookReview_spin___BTC6",selectedRating:"BookReview_selectedRating__1uk3e",sortSelect:"BookReview_sortSelect__tzzV_",pagination:"BookReview_pagination__e2wwO",pageButton:"BookReview_pageButton__vOxgM",disabled:"BookReview_disabled__fnx_G",pageInfo:"BookReview_pageInfo__YqhK4",alreadyReviewed:"BookReview_alreadyReviewed__chKxo",userReviewBox:"BookReview_userReviewBox__RSQZF",userReviewHeader:"BookReview_userReviewHeader__fX13K",userReviewRating:"BookReview_userReviewRating__391lE",ratingText:"BookReview_ratingText__GR4Xk",deleteUserReviewButton:"BookReview_deleteUserReviewButton__kZBBT",userReviewComment:"BookReview_userReviewComment__O91VY",userReviewDate:"BookReview_userReviewDate__kM04j",slideDown:"BookReview_slideDown__twYYN"}},46264:(e,o,t)=>{"use strict";t.d(o,{D8:()=>c,_h:()=>a,checkSubscriptionWithApiKey:()=>d,getCurrentSubscription:()=>n,nV:()=>l,wQ:()=>i});var s=t(72047);t(17203);let r={PLANS:36e5,HISTORY:6e5},i=async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];try{let o="subscription_plans",{shouldMakeCall:t,cachedData:i}=(0,s.UB)(o,r.PLANS,e);if(!t&&i)return i;let n=await (0,s.dw)("/subscriptions/plans");if(n){let e=n.plans||n.data||[],t={...n,plans:e};return(0,s.yt)(o,t),t}return n}catch(e){throw console.error("Error fetching subscription plans:",e),e}},n=async()=>{try{let e=localStorage.getItem("token");if(!e)return console.log("No authentication token found for subscription check"),{success:!1,hasSubscription:!1,message:"Not authenticated"};console.log("Checking current subscription status from server...");let o=await fetch("".concat("https://ebookaura.onrender.com/api","/subscriptions/current"),{method:"GET",headers:{Authorization:"Bearer ".concat(e)}});console.log("Subscription status API response status: ".concat(o.status));let t=await o.json();if(console.log("Subscription status API response:",t),o.ok){void 0===t.hasSubscription&&void 0!==t.active?t.hasSubscription=t.active:void 0===t.active&&void 0!==t.hasSubscription&&(t.active=t.hasSubscription);try{localStorage.setItem("subscriptionStatus",JSON.stringify({hasSubscription:t.hasSubscription,active:t.hasSubscription,planType:t.planType,expiresAt:t.expiresAt,timestamp:new Date().toISOString()})),console.log("Subscription status cached successfully")}catch(e){console.warn("Failed to cache subscription status:",e)}return t.success&&t.hasSubscription?console.log("User has an active subscription (".concat(t.planType||"unknown"," plan), expires: ").concat(t.expiresAt||"unknown")):console.log("User does not have an active subscription"),t}throw console.error("Subscription check failed with error:",t.message),Error(t.message||"Failed to check subscription status")}catch(e){console.error("Error checking subscription status:",e);try{let e=localStorage.getItem("subscriptionStatus");if(e){let o=JSON.parse(e),t=new Date(o.timestamp),s=new Date;if(s-t<3e5)return console.log("Using cached subscription status from",new Date(o.timestamp).toLocaleTimeString()),console.log("Cached subscription value:",o.hasSubscription?"Active":"Inactive"),{success:!0,hasSubscription:o.hasSubscription,active:o.hasSubscription,planType:o.planType,expiresAt:o.expiresAt,fromCache:!0};console.log("Cached subscription data is too old:",Math.round((s-t)/6e4),"minutes old")}else console.log("No cached subscription data found")}catch(e){console.error("Error reading cached subscription status:",e)}return{success:!1,hasSubscription:!1,active:!1,error:e.message||"Failed to check subscription status"}}},a=async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];try{let o=localStorage.getItem("token");if(!o)throw Error("Authentication required");let t="subscription_history",{shouldMakeCall:i,cachedData:n}=(0,s.UB)(t,r.HISTORY,e);if(!i&&n)return n;let a=await (0,s.dw)("/subscriptions/history",{headers:{Authorization:"Bearer ".concat(o)}});return(0,s.yt)(t,a),a}catch(e){throw console.error("Error fetching subscription history:",e),e}},c=async e=>{try{let o=localStorage.getItem("token");if(!o)throw Error("Authentication required");if(console.log("Purchasing subscription with data:",e),!e.planId)throw Error("Plan ID is required");e.paymentMethod||(e.paymentMethod="coins");let t=await fetch("".concat("https://ebookaura.onrender.com/api","/subscriptions"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(o)},body:JSON.stringify(e)});console.log("Subscription purchase API response status: ".concat(t.status));let s=await t.json();if(console.log("Subscription purchase API response:",s),!t.ok)throw Error(s.message||"Failed to purchase subscription");try{localStorage.removeItem("subscriptionStatus"),console.log("Cleared subscription cache after purchase")}catch(e){console.warn("Failed to clear subscription cache:",e)}return s}catch(e){throw console.error("Error purchasing subscription:",e),e}},l=async(e,o)=>{try{let t=localStorage.getItem("token");if(!t)throw Error("Authentication required");let r=await (0,s.TA)("/subscriptions/".concat(e),o,{headers:{Authorization:"Bearer ".concat(t)}});return(0,s.yt)("current_subscription",null),(0,s.yt)("subscription_history",null),r}catch(e){throw console.error("Error updating subscription:",e),e}},d=async e=>{try{if(!e)throw console.error("checkSubscriptionWithApiKey called without an API key"),Error("API key is required");console.log("Checking subscription status with API key: ".concat(e.substring(0,5),"..."));let o=await fetch("".concat("https://ebookaura.onrender.com/api","/subscriptions/check-api"),{method:"GET",headers:{"X-API-Key":e}});console.log("Subscription check API response status: ".concat(o.status));let t=await o.json();if(console.log("Subscription check API response:",t),o.ok)return void 0===t.hasSubscription&&void 0!==t.active&&(t.hasSubscription=t.active),t.success&&t.hasSubscription?console.log("API key has valid subscription - granting access"):console.log("API key does not have an active subscription"),t;throw console.error("Subscription check failed with error:",t.message),Error(t.message||"Failed to check subscription status")}catch(e){return console.error("Error checking subscription with API key:",e),{success:!1,hasSubscription:!1,active:!1,error:e.message||"Failed to check subscription status"}}}},51879:(e,o,t)=>{"use strict";t.d(o,{A:()=>i});var s=t(95155),r=t(12115);let i=()=>((0,r.useEffect)(()=>{let e=document.createElement("script");e.type="text/javascript",e.src="https://highperformanceformat.com/7e8ec1de91b1d000fc448ad0674d6d34/invoke.js";let o=document.createElement("script");o.type="text/javascript",o.innerHTML="\n      atOptions = {\n        'key' : '7e8ec1de91b1d000fc448ad0674d6d34',\n        'format' : 'iframe',\n        'height' : 90,\n        'width' : 728,\n        'params' : {}\n      };\n    ";let t=document.getElementById("ad-container");t.appendChild(o),t.appendChild(e)},[]),(0,s.jsx)("div",{id:"ad-container",style:{textAlign:"center",margin:"20px 0"}}))},52596:(e,o,t)=>{"use strict";t.d(o,{A:()=>s});let s=function(){for(var e,o,t=0,s="",r=arguments.length;t<r;t++)(e=arguments[t])&&(o=function e(o){var t,s,r="";if("string"==typeof o||"number"==typeof o)r+=o;else if("object"==typeof o)if(Array.isArray(o)){var i=o.length;for(t=0;t<i;t++)o[t]&&(s=e(o[t]))&&(r&&(r+=" "),r+=s)}else for(s in o)o[s]&&(r&&(r+=" "),r+=s);return r}(e))&&(s&&(s+=" "),s+=o);return s}},53116:(e,o,t)=>{"use strict";t.d(o,{$P:()=>i,PZ:()=>d,Yv:()=>l,getUserCoins:()=>r,lD:()=>n,wA:()=>c,z$:()=>a});var s=t(72047);let r=async()=>{try{let e=localStorage.getItem("token");if(!e)throw Error("Authentication required");return await fetch("".concat("https://ebookaura.onrender.com/api","/coins"),{method:"GET",headers:{Authorization:"Bearer ".concat(e)}}).then(e=>{if(!e.ok)throw Error("Failed to get coin balance");return e.json()})}catch(e){throw console.error("Error getting user coins:",e),e}},i=async e=>{try{let o=localStorage.getItem("token");if(!o)throw Error("Authentication required");return await fetch("".concat("https://ebookaura.onrender.com/api","/coins/update-session"),{method:"POST",headers:{Authorization:"Bearer ".concat(o),"Content-Type":"application/json"},body:JSON.stringify({sessionDuration:e})}).then(e=>{if(!e.ok)throw Error("Failed to update session time");return e.json()})}catch(e){throw console.error("Error updating session time:",e),e}},n=async()=>{try{let e=localStorage.getItem("token");if(!e)throw Error("Authentication required");return await fetch("".concat("https://ebookaura.onrender.com/api","/coins/session-status"),{method:"GET",headers:{Authorization:"Bearer ".concat(e)}}).then(e=>{if(!e.ok)throw Error("Failed to get session status");return e.json()})}catch(e){throw console.error("Error getting session status:",e),e}},a=async()=>{try{let e=localStorage.getItem("token");if(!e)throw Error("Authentication required");return await fetch("".concat("https://ebookaura.onrender.com/api","/coins/activity-reward"),{method:"POST",headers:{Authorization:"Bearer ".concat(e)}}).then(e=>e.ok?e.json():e.json().then(e=>{throw Error(e.message||"Failed to claim activity reward")}))}catch(e){throw console.error("Error claiming activity reward coins:",e),e}},c=async()=>{try{let e=localStorage.getItem("token");if(!e)throw Error("Authentication required");return await fetch("".concat("https://ebookaura.onrender.com/api","/coins/daily"),{method:"POST",headers:{Authorization:"Bearer ".concat(e)}}).then(e=>e.ok?e.json():e.json().then(e=>{throw Error(e.message||"Failed to claim daily coins")}))}catch(e){throw console.error("Error claiming daily coins:",e),e}},l=async()=>{try{let e=localStorage.getItem("token");if(!e)throw Error("Authentication required");return await fetch("".concat("https://ebookaura.onrender.com/api","/coins/daily-status"),{method:"GET",headers:{Authorization:"Bearer ".concat(e)}}).then(e=>{if(!e.ok)throw Error("Failed to check daily coins status");return e.json()})}catch(e){throw console.error("Error checking daily coins status:",e),e}},d=async e=>{try{let o=localStorage.getItem("token");if(!o)throw Error("Authentication required");return await (0,s.dw)("/users/check-purchase/".concat(e),{headers:{Authorization:"Bearer ".concat(o)}})}catch(e){throw console.error("Error checking book purchase:",e),e}}},71759:e=>{e.exports={container:"book_container__t7HpC",bookContainer:"book_bookContainer__LlohC",errorContainer:"book_errorContainer__YaCbj",debugPanel:"book_debugPanel__oka9O",buttonRow:"book_buttonRow__KAPP4",retryButton:"book_retryButton___vBiw",actionButton:"book_actionButton__41ZPr",buttonIcon:"book_buttonIcon__H5VkG",header:"book_header__KPynt",backButton:"book_backButton__vDnG6",bookDetailContainer:"book_bookDetailContainer__v_R0K",bookInformation:"book_bookInformation__StZ6g",bookCover:"book_bookCover__wj7vL",premiumOverlay:"book_premiumOverlay__U1vfK",lockIcon:"book_lockIcon__F6QwL",lockIconPlaceholder:"book_lockIconPlaceholder__moAc7",premiumBadge:"book_premiumBadge__MoqZw",crownIcon:"book_crownIcon__tVYMH",categoryInfo:"book_categoryInfo__Bu7tP",premiumTag:"book_premiumTag__EMpPl",premiumIcon:"book_premiumIcon__3M5jJ",premiumMessage:"book_premiumMessage__XV4N8",lockIconMessage:"book_lockIconMessage__46A1_",loginLink:"book_loginLink__vAMwB",disabledButton:"book_disabledButton__TW6dJ",placeholderCover:"book_placeholderCover__5P_sO",title:"book_title__xHEy4",author:"book_author__FsqOe",category:"book_category__zzF9H",stats:"book_stats__wU7Ul",stat:"book_stat__mAw2q",description:"book_description__T_l8Y",tags:"book_tags__gKDwb",tagList:"book_tagList__Gixb3",tag:"book_tag__Kk0Gj",noTags:"book_noTags__Qq9um",actions:"book_actions__zgoNS",viewButton:"book_viewButton__yhdR4",downloadButton:"book_downloadButton__xSZiq",openUrlButton:"book_openUrlButton__rZVel",loading:"book_loading__jGrZj",error:"book_error__olOYE",buttonGroup:"book_buttonGroup__1dUE_",loadingContainer:"book_loadingContainer__IEHKf",loadingSpinner:"book_loadingSpinner__PQ2dU",spin:"book_spin__v3jCK",actionButtons:"book_actionButtons__4FEwM",searchButton:"book_searchButton__YOZRF",errorDetails:"book_errorDetails__zCEXA",premiumPurchaseContainer:"book_premiumPurchaseContainer__nB9yX",premiumPrice:"book_premiumPrice__wmzKZ",coinIcon:"book_coinIcon__5w8cr",priceValue:"book_priceValue__xy2Zn",purchaseButton:"book_purchaseButton__HQhwt",purchaseError:"book_purchaseError___ubRi",purchaseSuccess:"book_purchaseSuccess__ekger",insufficientCoins:"book_insufficientCoins__gGYYV",getCoinsLink:"book_getCoinsLink__nvlTT",confirmationOverlay:"book_confirmationOverlay__Yc4oV",confirmationDialog:"book_confirmationDialog__Qnw0H",fadeIn:"book_fadeIn__B4bvh",confirmationButtons:"book_confirmationButtons__C0Pf2",cancelButton:"book_cancelButton__pmZIc",confirmButton:"book_confirmButton__51wVy",subscriptionAccess:"book_subscriptionAccess__Nklgl",checkIcon:"book_checkIcon__E60cw",accessTitle:"book_accessTitle__IKMB9",accessText:"book_accessText__zkInu",subscriptionRequired:"book_subscriptionRequired__excAU",subscriptionMessage:"book_subscriptionMessage__N2Ss_",subscriptionTitle:"book_subscriptionTitle__NtnNf",subscriptionText:"book_subscriptionText__N_v__",subscribeButton:"book_subscribeButton__0HqOY",buttonCrownIcon:"book_buttonCrownIcon__A_8bS",loginRequired:"book_loginRequired__xdOuk",loginMessage:"book_loginMessage__wVBO8",loginButtons:"book_loginButtons__obmAL",loginButton:"book_loginButton__NF5h2",signupButton:"book_signupButton__kSD2R",userIcon:"book_userIcon__xrNmi",userPlusIcon:"book_userPlusIcon__3GqrI"}},78876:(e,o,t)=>{"use strict";t.d(o,{A:()=>i});var s=t(95155),r=t(12115);let i=()=>((0,r.useEffect)(()=>{var e;let o=document.createElement("script");return o.src="//pl27076734.profitableratecpm.com/a00aaa104725ffd413788e8c32c2dd16/invoke.js",o.async=!0,o.setAttribute("data-cfasync","false"),null==(e=document.getElementById("container-a00aaa104725ffd413788e8c32c2dd16"))||e.appendChild(o),()=>{let e=document.getElementById("container-a00aaa104725ffd413788e8c32c2dd16");e&&(e.innerHTML="")}},[]),(0,s.jsx)("div",{id:"container-a00aaa104725ffd413788e8c32c2dd16",style:{textAlign:"center",margin:"20px auto"}}))}}]);