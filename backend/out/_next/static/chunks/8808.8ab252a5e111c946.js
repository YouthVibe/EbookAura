(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8808],{922:(e,o,t)=>{"use strict";t.d(o,{NE:()=>i,dC:()=>r,oc:()=>a});let r=()=>{Promise.all([t.e(3309),t.e(6327),t.e(1588)]).then(t.bind(t,1588)).then(e=>{let{pdfjs:o}=e;o.GlobalWorkerOptions.workerSrc="https://unpkg.com/pdfjs-dist@4.8.69/build/pdf.worker.min.mjs",console.log("PDF.js worker initialized with custom version")}).catch(e=>{console.error("Failed to initialize PDF worker:",e)})},a=!0,n=e=>e?e instanceof Blob||e instanceof File||"string"==typeof e?e:e instanceof ArrayBuffer||e instanceof Uint8Array?new Blob([e],{type:"application/pdf"}):(console.error("Unknown PDF source type:",e),null):null,i=function(e){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"document.pdf";if(!a)return{success:!1,error:"Cannot run on server"};try{let t=n(e);if(!t)return{success:!1,error:"Invalid PDF source"};if("string"==typeof t){let e=document.createElement("a");return e.href=t,e.download=o,e.target="_blank",e.style.display="none",document.body.appendChild(e),e.click(),document.body.removeChild(e),{success:!0}}if(t instanceof Blob||t instanceof File){let e=URL.createObjectURL(t),r=document.createElement("a");return r.href=e,r.download=o,r.style.display="none",document.body.appendChild(r),r.click(),document.body.removeChild(r),setTimeout(()=>URL.revokeObjectURL(e),100),{success:!0}}return{success:!1,error:"Unknown source type"}}catch(e){return console.error("Error creating downloadable PDF:",e),{success:!1,error:e.message||"Unknown error"}}};(()=>{let e=null;return async()=>e||(a?e="https://unpkg.com/pdfjs-dist@4.8.69/build/pdf.worker.min.mjs":null)})()},1759:e=>{e.exports={container:"book_container__t7HpC",backButton:"book_backButton__vDnG6",bookDetailContainer:"book_bookDetailContainer__v_R0K",bookInformation:"book_bookInformation__StZ6g",bookCover:"book_bookCover__wj7vL",placeholderCover:"book_placeholderCover__5P_sO",title:"book_title__xHEy4",author:"book_author__FsqOe",category:"book_category__zzF9H",stats:"book_stats__wU7Ul",stat:"book_stat__mAw2q",description:"book_description__T_l8Y",tags:"book_tags__gKDwb",tagList:"book_tagList__Gixb3",tag:"book_tag__Kk0Gj",noTags:"book_noTags__Qq9um",actions:"book_actions__zgoNS",viewButton:"book_viewButton__yhdR4",downloadButton:"book_downloadButton__xSZiq",loading:"book_loading__jGrZj",error:"book_error__olOYE",buttonGroup:"book_buttonGroup__1dUE_",loadingContainer:"book_loadingContainer__IEHKf",loadingSpinner:"book_loadingSpinner__PQ2dU",spin:"book_spin__v3jCK"}},2047:(e,o,t)=>{"use strict";async function r(e){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{let t=e.startsWith("http")?e:"".concat("https://ebookaura.onrender.com/api").concat(e);console.log("API Request: ".concat(o.method||"GET"," ").concat(t)),o.headers||(o.headers={}),!o.body||o.headers["Content-Type"]||o.body instanceof FormData||(o.headers["Content-Type"]="application/json");{let e=localStorage.getItem("token"),t=localStorage.getItem("apiKey");e&&t&&(o.headers.Authorization="Bearer ".concat(e),o.headers["X-API-Key"]=t)}let r=await fetch(t,o),a=r.headers.get("content-type");if(!r.ok){if(console.error("API Error (".concat(r.status,"): ").concat(r.statusText)),a&&a.includes("application/json")){let e=await r.json();throw Error(e.message||"API request failed with status ".concat(r.status))}{let e=await r.text();console.error("Non-JSON error response:",e.substring(0,150)+"...");let o="API request failed with status ".concat(r.status);if(e.includes("<title>")&&e.includes("</title>")){let t=e.match(/<title>(.*?)<\/title>/i);t&&t[1]&&(o="Server Error: ".concat(t[1]))}throw Error(o)}}if(a&&a.includes("application/json"))return await r.json();{console.warn("Response is not JSON. Content-Type:",a);let e=await r.text();try{return JSON.parse(e)}catch(e){throw console.error("Failed to parse response as JSON:",e),Error("API response was not valid JSON")}}}catch(e){throw console.error("API request error:",e),e}}async function a(e){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return r(e,{method:"GET",...o})}async function n(e,o){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return r(e,{method:"POST",body:o instanceof FormData?o:JSON.stringify(o),...t})}async function i(e,o){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return r(e,{method:"PUT",body:JSON.stringify(o),...t})}async function s(e){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return r(e,{method:"DELETE",...o})}t.d(o,{Xj:()=>n,_5:()=>s,dw:()=>a,q1:()=>i})},2695:e=>{e.exports={reviewContainer:"BookReview_reviewContainer__PXZXE",reviewHeader:"BookReview_reviewHeader__exUT_",reviewSummary:"BookReview_reviewSummary__m9pQe",averageRating:"BookReview_averageRating__GLivu",ratingNumber:"BookReview_ratingNumber__2uD8e",ratingStars:"BookReview_ratingStars__TajM3",reviewCount:"BookReview_reviewCount__gFeSv",displayStar:"BookReview_displayStar__Fz3J4",reviewForm:"BookReview_reviewForm__KzYxy",success:"BookReview_success__phiTs",submitError:"BookReview_submitError__GK4zL",ratingSelector:"BookReview_ratingSelector__Y8L9Q",stars:"BookReview_stars__vHpqj",ratingStar:"BookReview_ratingStar__7YZu8",commentField:"BookReview_commentField__HbZ9h",optional:"BookReview_optional__5fC_J",textarea:"BookReview_textarea__uqAZb",characterCount:"BookReview_characterCount__avyYp",submitButton:"BookReview_submitButton__uifGG",loginPrompt:"BookReview_loginPrompt__nl1B6",reviewsList:"BookReview_reviewsList__36HJ_",noReviews:"BookReview_noReviews__EL0Br",reviewItem:"BookReview_reviewItem__wF7Ok",reviewerInfo:"BookReview_reviewerInfo__yDoe0",reviewerImage:"BookReview_reviewerImage__T3neO",reviewerPlaceholder:"BookReview_reviewerPlaceholder__VLVSv",reviewerName:"BookReview_reviewerName___r0hh",reviewDate:"BookReview_reviewDate__fxaMW",reviewMetadata:"BookReview_reviewMetadata__cvN1d",deleteButton:"BookReview_deleteButton__sF4DA",reviewRating:"BookReview_reviewRating__TTay3",reviewText:"BookReview_reviewText__OjgJ1",confirmOverlay:"BookReview_confirmOverlay__3SoDg",fadeIn:"BookReview_fadeIn__ejiO2",confirmDialog:"BookReview_confirmDialog__rHKbe",slideUp:"BookReview_slideUp__26h3O",confirmHeader:"BookReview_confirmHeader__9ZJSd",closeButton:"BookReview_closeButton__ABCqQ",confirmButtons:"BookReview_confirmButtons__fnWlf",cancelButton:"BookReview_cancelButton__FmPbe",deleteConfirmButton:"BookReview_deleteConfirmButton__bWD9h",loading:"BookReview_loading__xP9sm",error:"BookReview_error__dxxxC"}},4436:(e,o,t)=>{"use strict";t.d(o,{k5:()=>d});var r=t(2115),a={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},n=r.createContext&&r.createContext(a),i=["attr","size","title"];function s(){return(s=Object.assign?Object.assign.bind():function(e){for(var o=1;o<arguments.length;o++){var t=arguments[o];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e}).apply(this,arguments)}function l(e,o){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);o&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),t.push.apply(t,r)}return t}function c(e){for(var o=1;o<arguments.length;o++){var t=null!=arguments[o]?arguments[o]:{};o%2?l(Object(t),!0).forEach(function(o){var r,a,n;r=e,a=o,n=t[o],(a=function(e){var o=function(e,o){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,o||"default");if("object"!=typeof r)return r;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===o?String:Number)(e)}(e,"string");return"symbol"==typeof o?o:o+""}(a))in r?Object.defineProperty(r,a,{value:n,enumerable:!0,configurable:!0,writable:!0}):r[a]=n}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):l(Object(t)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(t,o))})}return e}function d(e){return o=>r.createElement(u,s({attr:c({},e.attr)},o),function e(o){return o&&o.map((o,t)=>r.createElement(o.tag,c({key:t},o.attr),e(o.child)))}(e.child))}function u(e){var o=o=>{var t,{attr:a,size:n,title:l}=e,d=function(e,o){if(null==e)return{};var t,r,a=function(e,o){if(null==e)return{};var t={};for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){if(o.indexOf(r)>=0)continue;t[r]=e[r]}return t}(e,o);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);for(r=0;r<n.length;r++)t=n[r],!(o.indexOf(t)>=0)&&Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}(e,i),u=n||o.size||"1em";return o.className&&(t=o.className),e.className&&(t=(t?t+" ":"")+e.className),r.createElement("svg",s({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},o.attr,a,d,{className:t,style:c(c({color:e.color||o.color},o.style),e.style),height:u,width:u,xmlns:"http://www.w3.org/2000/svg"}),l&&r.createElement("title",null,l),e.children)};return void 0!==n?r.createElement(n.Consumer,null,e=>o(e)):o(a)}},4677:(e,o,t)=>{"use strict";t.r(o),t.d(o,{default:()=>y});var r=t(5155),a=t(2115),n=t(9911),i=t(6874),s=t.n(i),l=t(5695),c=t(5028),d=t(7203);let u=async e=>{try{if(!e)throw Error("Book ID is required");let o=localStorage.getItem("token"),t=localStorage.getItem("apiKey"),r=await fetch(d.Sn.BOOKS.REVIEWS(e),{method:"GET",headers:{"Content-Type":"application/json",...o&&{Authorization:"Bearer ".concat(o)},...t&&{"X-API-Key":t}}});if(!r.ok){let e=await r.json();throw Error(e.message||"Failed to fetch reviews")}return await r.json()}catch(e){throw console.error("Error fetching book reviews:",e),e}},h=async e=>{try{if(!e)throw Error("Book ID is required");let o=await fetch(d.Sn.BOOKS.RATING(e));if(!o.ok){let e=await o.json();throw Error(e.message||"Failed to fetch book rating")}return await o.json()}catch(e){throw console.error("Error fetching book rating:",e),e}},v=async function(e,o){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";try{if(!e)throw Error("Book ID is required");if(!o||o<1||o>5)throw Error("Rating must be between 1 and 5");if(t&&t.length>200)throw Error("Review text must be under 200 characters");let r=localStorage.getItem("token"),a=localStorage.getItem("apiKey");if(!r||!a)throw Error("You must be logged in to submit a review");let n=await fetch(d.Sn.BOOKS.REVIEWS(e),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(r),"X-API-Key":a},body:JSON.stringify({rating:o,comment:t.trim()})});if(!n.ok){let e=await n.json();throw Error(e.message||"Failed to submit review")}return await n.json()}catch(e){throw console.error("Error submitting book review:",e),e}},m=async e=>{try{let o=localStorage.getItem("token"),t=localStorage.getItem("apiKey");if(!o||!t)throw Error("You must be logged in to delete a review");let r=await fetch("".concat(d.JR,"/reviews/").concat(e),{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(o),"X-API-Key":t}});if(!r.ok){let e=await r.json();throw Error(e.message||"Failed to delete review")}return await r.json()}catch(e){throw console.error("Error deleting review:",e),e}};var g=t(6068),w=t(2695),f=t.n(w);function _(e){let{bookId:o}=e,[t,i]=(0,a.useState)([]),[s,l]=(0,a.useState)(0),[c,d]=(0,a.useState)(""),[w,_]=(0,a.useState)(0),[b,p]=(0,a.useState)(0),[k,j]=(0,a.useState)(0),[y,x]=(0,a.useState)(!0),[S,N]=(0,a.useState)(null),[B,E]=(0,a.useState)(null),[O,R]=(0,a.useState)(!1),[I,D]=(0,a.useState)(!1),[P,C]=(0,a.useState)(!1),[F,T]=(0,a.useState)(!1),[A,L]=(0,a.useState)(0),[K,U]=(0,a.useState)(!1),[G,z]=(0,a.useState)(null),{user:W}=(0,g.h)();(0,a.useEffect)(()=>{(async()=>{try{if(!o){N("Book ID is missing. Cannot load reviews."),x(!1);return}console.log("BookReview: Fetching data for bookId:",o),x(!0);let[e,t]=await Promise.all([u(o),h(o)]);i(e),p(t.averageRating),j(t.reviewCount),N(null)}catch(e){N("Failed to load reviews. Please try again later."),console.error("Error loading review data:",e)}finally{x(!1)}})()},[o]);let J=e=>new Date(e).toLocaleDateString(void 0,{year:"numeric",month:"long",day:"numeric"}),q=async e=>{if(e.preventDefault(),!o)return void E("Book ID is missing. Cannot submit review.");if(0===s)return void E("Please select a rating");try{R(!0),E(null),console.log("Submitting review for bookId:",o);let e=await v(o,s,c);i([e,...t]);let r=b*k+s,a=k+1;p(r/a),j(a),l(0),d(""),L(0),C(!0),setTimeout(()=>{C(!1)},3e3)}catch(e){E(e.message||"Failed to submit review. Please try again later.")}finally{R(!1)}},H=e=>{z(e),U(!0)},M=()=>{z(null),U(!1)},Y=async()=>{if(G)try{if(D(!0),console.log("Deleting review with ID:",G._id),await m(G._id),i(t.filter(e=>e._id!==G._id)),k>1){let e=b*k-G.rating,o=k-1;p(e/o),j(o)}else p(0),j(0);T(!0),setTimeout(()=>{T(!1)},3e3)}catch(e){console.error("Error deleting review:",e),E(e.message||"Failed to delete review. Please try again later.")}finally{D(!1),U(!1),z(null)}},V=e=>W&&(W.name&&e.userName===W.name||W.username&&e.userName===W.username),Z=e=>Array.from({length:5},(e,o)=>o+1).map(o=>(0,r.jsx)("span",{className:f().displayStar,children:e>=o?(0,r.jsx)(n.gt3,{}):(0,r.jsx)(n.wei,{})},o));return y?(0,r.jsx)("div",{className:f().loading,children:"Loading reviews..."}):S?(0,r.jsx)("div",{className:f().error,children:S}):(0,r.jsxs)("div",{className:f().reviewContainer,children:[K&&G&&(0,r.jsx)("div",{className:f().confirmOverlay,children:(0,r.jsxs)("div",{className:f().confirmDialog,children:[(0,r.jsxs)("div",{className:f().confirmHeader,children:[(0,r.jsx)("h4",{children:"Delete Review"}),(0,r.jsx)("button",{onClick:M,className:f().closeButton,"aria-label":"Close",children:(0,r.jsx)(n.QCr,{})})]}),(0,r.jsx)("p",{children:"Are you sure you want to delete your review? This action cannot be undone."}),(0,r.jsxs)("div",{className:f().confirmButtons,children:[(0,r.jsx)("button",{onClick:M,className:f().cancelButton,disabled:I,children:"Cancel"}),(0,r.jsx)("button",{onClick:Y,className:f().deleteConfirmButton,disabled:I,children:I?"Deleting...":"Delete"})]})]})}),(0,r.jsx)("h2",{className:f().reviewHeader,children:"Customer Reviews"}),(0,r.jsx)("div",{className:f().reviewSummary,children:(0,r.jsxs)("div",{className:f().averageRating,children:[(0,r.jsx)("span",{className:f().ratingNumber,children:b.toFixed(1)}),(0,r.jsx)("div",{className:f().ratingStars,children:Z(b)}),(0,r.jsxs)("span",{className:f().reviewCount,children:["Based on ",k," ",1===k?"review":"reviews"]})]})}),W?(0,r.jsxs)("div",{className:f().reviewForm,children:[(0,r.jsx)("h3",{children:"Write a Review"}),P&&(0,r.jsx)("div",{className:f().success,children:"Your review has been submitted successfully!"}),F&&(0,r.jsx)("div",{className:f().success,children:"Your review has been deleted successfully!"}),B&&(0,r.jsx)("div",{className:f().submitError,children:B}),(0,r.jsxs)("form",{onSubmit:q,children:[(0,r.jsxs)("div",{className:f().ratingSelector,children:[(0,r.jsx)("label",{children:"Your Rating:"}),(0,r.jsx)("div",{className:f().stars,children:Array.from({length:5},(e,o)=>o+1).map(e=>(0,r.jsx)("span",{className:f().ratingStar,onClick:()=>l(e),onMouseEnter:()=>_(e),onMouseLeave:()=>_(0),children:(w||s)>=e?(0,r.jsx)(n.gt3,{}):(0,r.jsx)(n.wei,{})},e))})]}),(0,r.jsxs)("div",{className:f().commentField,children:[(0,r.jsxs)("label",{children:["Your Review: ",(0,r.jsx)("span",{className:f().optional,children:"(optional, max 200 characters)"})]}),(0,r.jsx)("textarea",{value:c,onChange:e=>{let o=e.target.value;o.length<=200&&(d(o),L(o.length))},placeholder:"Share your thoughts about this book (optional)",rows:4,className:f().textarea}),(0,r.jsxs)("div",{className:f().characterCount,children:[A,"/200 characters"]})]}),(0,r.jsx)("button",{type:"submit",className:f().submitButton,disabled:O,children:O?"Submitting...":"Submit Review"})]})]}):(0,r.jsx)("div",{className:f().loginPrompt,children:"Please log in to leave a review."}),(0,r.jsxs)("div",{className:f().reviewsList,children:[(0,r.jsx)("h3",{children:"Recent Reviews"}),0===t.length?(0,r.jsx)("div",{className:f().noReviews,children:"Be the first to review this book!"}):t.map(e=>(0,r.jsxs)("div",{className:f().reviewItem,children:[(0,r.jsxs)("div",{className:f().reviewHeader,children:[(0,r.jsxs)("div",{className:f().reviewerInfo,children:[e.userImage?(0,r.jsx)("img",{src:e.userImage,alt:e.userName,className:f().reviewerImage}):(0,r.jsx)("div",{className:f().reviewerPlaceholder,children:(0,r.jsx)(n.x$1,{})}),(0,r.jsx)("span",{className:f().reviewerName,children:e.userName})]}),(0,r.jsxs)("div",{className:f().reviewMetadata,children:[(0,r.jsxs)("div",{className:f().reviewDate,children:[(0,r.jsx)(n.bfZ,{}),(0,r.jsx)("span",{children:J(e.createdAt)})]}),V(e)&&(0,r.jsx)("button",{onClick:()=>H(e),className:f().deleteButton,disabled:I,title:"Delete your review",children:(0,r.jsx)(n.qbC,{})})]})]}),(0,r.jsx)("div",{className:f().reviewRating,children:Z(e.rating)}),e.comment&&(0,r.jsx)("div",{className:f().reviewText,children:e.comment})]},e._id))]})]})}var b=t(1759),p=t.n(b),k=t(922);let j=(0,c.default)(()=>Promise.all([t.e(5129),t.e(510)]).then(t.bind(t,510)),{loadableGenerated:{webpack:()=>[510]},ssr:!1,loading:()=>(0,r.jsxs)("div",{className:p().loadingContainer,children:[(0,r.jsx)("div",{className:p().loadingSpinner}),(0,r.jsx)("p",{children:"Loading PDF viewer..."})]})});function y(e){let{id:o}=e,[t,i]=(0,a.useState)(null),[c,u]=(0,a.useState)(!0),[h,v]=(0,a.useState)(null),[m,g]=(0,a.useState)(!1),[w,f]=(0,a.useState)(!1),[b,y]=(0,a.useState)(!1),[x,S]=(0,a.useState)(null);(0,l.useRouter)(),(0,a.useEffect)(()=>{if(!o){console.error("BookPageClient: Book ID is missing or undefined"),v("Book ID is missing. Please go back and try again."),u(!1);return}console.log("BookPageClient: Initializing with book ID:",o),N(o)},[o]),(0,a.useEffect)(()=>()=>{x&&"string"==typeof x&&x.startsWith("blob:")&&URL.revokeObjectURL(x)},[x]);let N=async e=>{try{console.log("BookPageClient: Fetching details for book ID:",e),u(!0);let o=await fetch(d.Sn.BOOKS.DETAILS(e),{cache:"no-store",next:{revalidate:60}});if(!o.ok)throw console.error("Book fetch failed with status: ".concat(o.status)),Error(404===o.status?"Book not found. It may have been removed or the ID is incorrect.":"Failed to load book (".concat(o.status,")"));let t=await o.json();if(console.log("Book data received:",t),!t||"object"!=typeof t)throw Error("Invalid book data received from server");i(t),v(null)}catch(e){console.error("Error in fetchBookDetails:",e),v(e.message||"Error loading book details. Please try again later.")}finally{u(!1)}},B=async()=>{if(!t||!o)return void console.error("Cannot view PDF: Book data or ID is missing");try{f(!0),console.log("Fetching PDF content for viewing, book ID:",o);let e="".concat(d.Sn.BOOKS.PDF_CONTENT(o),"?counted=true"),t=await fetch(e);if(!t.ok)throw Error("Failed to fetch PDF: ".concat(t.status," ").concat(t.statusText));let r=await t.blob();S(r),y(!0)}catch(e){console.error("Error fetching PDF for viewing:",e);try{if(t.pdfUrl){let e=t.pdfUrl.endsWith(".pdf")?t.pdfUrl:"".concat(t.pdfUrl,".pdf");console.log("Fallback: Using direct PDF URL: ".concat(e)),S(e),y(!0)}else throw Error("No PDF URL available for viewing")}catch(e){console.error("Fallback also failed:",e),alert("Failed to load PDF for viewing. Please try downloading instead.")}}finally{f(!1)}},E=async()=>{try{await fetch(d.Sn.BOOKS.VIEW(o),{method:"POST"}).catch(e=>console.warn("Failed to record view:",e))}catch(e){console.warn("Failed to record view, but continuing to show PDF:",e)}B()},O=async()=>{if(!t||!o)return void console.error("Cannot download: Book data or ID is missing");try{g(!0),console.log("Downloading book with ID:",o),await fetch(d.Sn.BOOKS.DOWNLOAD(o),{method:"POST"});let e="".concat(t.title.replace(/[^a-zA-Z0-9]/g,"_"),".pdf");try{console.log("Fetching PDF content via backend proxy for book: ".concat(t.title));let r="".concat(d.Sn.BOOKS.PDF_CONTENT(o),"?download=true&counted=true"),a=await fetch(r);if(!a.ok)throw Error("Failed to fetch PDF: ".concat(a.status," ").concat(a.statusText));let n=await a.blob(),i=(0,k.NE)(n,e);if(!i.success)throw Error(i.error||"Download failed");console.log("PDF downloaded as: ".concat(e))}catch(t){console.warn("Direct download failed, using fallback:",t);let e="".concat(d.Sn.BOOKS.PDF(o),"?download=true&counted=true");window.open(e,"_blank")}i(e=>({...e,downloads:e.downloads+1}))}catch(e){console.error("Error downloading book:",e)}finally{g(!1)}};return c?(0,r.jsxs)("div",{className:p().loadingContainer,children:[(0,r.jsx)("div",{className:p().loadingSpinner}),(0,r.jsx)("p",{children:"Loading book details..."})]}):h?(0,r.jsxs)("div",{className:p().error,children:[(0,r.jsx)("h2",{children:"Error"}),(0,r.jsx)("p",{children:h}),(0,r.jsxs)(s(),{href:"/search",className:p().backButton,children:[(0,r.jsx)(n.QVr,{})," Back to Search"]})]}):t?(0,r.jsxs)("div",{className:p().container,children:[(0,r.jsxs)(s(),{href:"/search",className:p().backButton,children:[(0,r.jsx)(n.QVr,{})," Back to Search"]}),(0,r.jsxs)("div",{className:p().bookDetailContainer,children:[(0,r.jsxs)("div",{className:p().bookInformation,children:[(0,r.jsx)("div",{className:p().bookCover,children:t.coverImage?(0,r.jsx)("img",{src:t.coverImage,alt:t.title}):(0,r.jsx)("div",{className:p().placeholderCover,children:(0,r.jsx)(n.vd0,{})})}),(0,r.jsxs)("div",{className:p().bookInfo,children:[(0,r.jsx)("h1",{className:p().title,children:t.title}),(0,r.jsxs)("p",{className:p().author,children:["by ",t.author]}),(0,r.jsx)("p",{className:p().category,children:t.category}),(0,r.jsxs)("div",{className:p().stats,children:[(0,r.jsxs)("span",{className:p().stat,children:[(0,r.jsx)(n.Ny1,{})," ",t.views," views"]}),(0,r.jsxs)("span",{className:p().stat,children:[(0,r.jsx)(n.WCW,{})," ",t.downloads," downloads"]}),t.averageRating>0&&(0,r.jsxs)("span",{className:p().stat,children:[(0,r.jsx)(n.gt3,{})," ",t.averageRating.toFixed(1)]}),t.pageSize>0&&(0,r.jsxs)("span",{className:p().stat,children:[(0,r.jsx)(n.t69,{})," ",t.pageSize," pages"]}),t.fileSizeMB>0&&(0,r.jsxs)("span",{className:p().stat,children:[(0,r.jsx)(n.t69,{})," ",t.fileSizeMB," MB"]})]}),(0,r.jsxs)("div",{className:p().description,children:[(0,r.jsx)("h2",{children:"Description"}),(0,r.jsx)("p",{children:t.description})]}),(0,r.jsxs)("div",{className:p().tags,children:[(0,r.jsx)("h2",{children:"Tags"}),(0,r.jsxs)("div",{className:p().tagList,children:[t.tags&&t.tags.map((e,o)=>(0,r.jsx)("span",{className:p().tag,children:e},o)),(!t.tags||0===t.tags.length)&&(0,r.jsx)("span",{className:p().noTags,children:"No tags"})]})]}),(0,r.jsxs)("div",{className:p().actions,children:[(0,r.jsxs)("button",{onClick:E,className:p().viewButton,disabled:w,children:[(0,r.jsx)(n.t69,{})," ",w?"Opening...":"View PDF"]}),(0,r.jsxs)("button",{onClick:O,className:p().downloadButton,disabled:m,children:[(0,r.jsx)(n.WCW,{})," ",m?"Downloading...":"Download PDF"]})]})]})]}),(0,r.jsx)(_,{bookId:o})]}),b&&x&&(0,r.jsx)(j,{pdfUrl:x,onClose:()=>{y(!1),S(null)},title:t.title,allowDownload:!0,onDownload:O})]}):(0,r.jsxs)("div",{className:p().error,children:[(0,r.jsx)("h2",{children:"Book Not Found"}),(0,r.jsx)("p",{children:"We couldn't find the book you're looking for."}),(0,r.jsxs)(s(),{href:"/search",className:p().backButton,children:[(0,r.jsx)(n.QVr,{})," Back to Search"]})]})}},6068:(e,o,t)=>{"use strict";t.d(o,{AuthProvider:()=>c,h:()=>d});var r=t(5155),a=t(2115),n=t(5695),i=t(2047);let s=(0,a.createContext)(),l=()=>"ak_"+Array.from(crypto.getRandomValues(new Uint8Array(24))).map(e=>e.toString(16).padStart(2,"0")).join(""),c=e=>{let{children:o}=e,[t,c]=(0,a.useState)(null),[d,u]=(0,a.useState)(!0),[h,v]=(0,a.useState)(!1),m=(0,n.useRouter)();(0,a.useEffect)(()=>{v(!0);let e=localStorage.getItem("userInfo"),o=localStorage.getItem("token");if(localStorage.getItem("apiKey"),e&&o)try{c(JSON.parse(e)),(async()=>{try{await (0,i.dw)("/auth/check",{headers:{Authorization:"Bearer ".concat(o)}})}catch(e){console.error("Token validation failed:",e),w()}})()}catch(e){console.error("Failed to parse user info:",e),localStorage.removeItem("userInfo"),localStorage.removeItem("token"),localStorage.removeItem("apiKey")}u(!1)},[]);let g=e=>{if(console.log("Processing login data"),!e)return void console.error("No user data received for login");try{if(!e.token)return void console.error("No token in login data");let{token:o,...t}=e;console.log("Setting user data:",t),c(t);{localStorage.setItem("userInfo",JSON.stringify(t)),localStorage.setItem("token",o);let e=localStorage.getItem("apiKey");e||(console.log("Generating new API key"),e=l(),localStorage.setItem("apiKey",e)),console.log("Authentication data stored in localStorage")}}catch(e){console.error("Error processing login:",e)}},w=()=>{c(null),localStorage.removeItem("userInfo"),localStorage.removeItem("token"),m.push("/login")},f=()=>localStorage.getItem("token"),_=()=>localStorage.getItem("apiKey");return h?(0,r.jsx)(s.Provider,{value:{user:t,loading:d,login:g,logout:w,getToken:f,getApiKey:_},children:o}):(0,r.jsx)(s.Provider,{value:{user:null,loading:!0,login:g,logout:w,getToken:f,getApiKey:_},children:o})},d=()=>{let e=(0,a.useContext)(s);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},7203:(e,o,t)=>{"use strict";t.d(o,{JR:()=>r,Sn:()=>a}),t(2047);let r="https://ebookaura.onrender.com/api",a={AUTH:{LOGIN:"".concat(r,"/auth/login"),REGISTER:"".concat(r,"/auth/register"),ME:"".concat(r,"/auth/me"),FORGOT_PASSWORD:"".concat(r,"/auth/forgot-password"),RESET_PASSWORD:e=>"".concat(r,"/auth/reset-password/").concat(e),VERIFY_EMAIL:"".concat(r,"/auth/verify-email")},BOOKS:{ALL:"".concat(r,"/books"),CATEGORIES:"".concat(r,"/books/categories"),TAGS:"".concat(r,"/books/tags"),DETAILS:e=>"".concat(r,"/books/").concat(e),PDF:e=>"".concat(r,"/books/").concat(e,"/pdf"),PDF_CONTENT:e=>"".concat(r,"/books/").concat(e,"/pdf-content"),DOWNLOAD:e=>"".concat(r,"/books/").concat(e,"/download"),REVIEWS:e=>"".concat(r,"/books/").concat(e,"/reviews"),RATING:e=>"".concat(r,"/books/").concat(e,"/rating")},UPLOAD:{FILE:"".concat(r,"/upload"),PDF:"".concat(r,"/upload/pdf"),DELETE_FILE:e=>"".concat(r,"/upload/").concat(e),DELETE_BOOK:e=>"".concat(r,"/upload/book/").concat(e)},USER:{PROFILE:"".concat(r,"/users/profile"),UPDATE_PROFILE:"".concat(r,"/users/profile"),UPDATE_IMAGE:"".concat(r,"/users/profile/image")}}}}]);