(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8808],{922:(e,t,o)=>{"use strict";o.d(t,{NE:()=>s,dC:()=>r,oc:()=>a});let r=()=>{Promise.all([o.e(3309),o.e(6327),o.e(1588)]).then(o.bind(o,91588)).then(e=>{let{pdfjs:t}=e;t.GlobalWorkerOptions.workerSrc="https://unpkg.com/pdfjs-dist@4.8.69/build/pdf.worker.min.mjs",console.log("PDF.js worker initialized with custom version")}).catch(e=>{console.error("Failed to initialize PDF worker:",e)})},a=!0,i=e=>e?e instanceof Blob||e instanceof File||"string"==typeof e?e:e instanceof ArrayBuffer||e instanceof Uint8Array?new Blob([e],{type:"application/pdf"}):(console.error("Unknown PDF source type:",e),null):null,s=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"document.pdf";if(!a)return{success:!1,error:"Cannot run on server"};try{let o=i(e);if(!o)return{success:!1,error:"Invalid PDF source"};if("string"==typeof o){let e=document.createElement("a");return e.href=o,e.download=t,e.target="_blank",e.style.display="none",document.body.appendChild(e),e.click(),document.body.removeChild(e),{success:!0}}if(o instanceof Blob||o instanceof File){let e=URL.createObjectURL(o),r=document.createElement("a");return r.href=e,r.download=t,r.style.display="none",document.body.appendChild(r),r.click(),document.body.removeChild(r),setTimeout(()=>URL.revokeObjectURL(e),100),{success:!0}}return{success:!1,error:"Unknown source type"}}catch(e){return console.error("Error creating downloadable PDF:",e),{success:!1,error:e.message||"Unknown error"}}};(()=>{let e=null;return async()=>e||(a?e="https://unpkg.com/pdfjs-dist@4.8.69/build/pdf.worker.min.mjs":null)})()},17203:(e,t,o)=>{"use strict";o.d(t,{JR:()=>r,Sn:()=>a}),o(72047);let r="https://ebookaura.onrender.com/api",a={AUTH:{LOGIN:"".concat(r,"/auth/login"),REGISTER:"".concat(r,"/auth/register"),ME:"".concat(r,"/auth/me"),FORGOT_PASSWORD:"".concat(r,"/auth/forgot-password"),RESET_PASSWORD:e=>"".concat(r,"/auth/reset-password/").concat(e),VERIFY_EMAIL:"".concat(r,"/auth/verify-email")},BOOKS:{ALL:"".concat(r,"/books"),CATEGORIES:"".concat(r,"/books/categories"),TAGS:"".concat(r,"/books/tags"),DETAILS:e=>"".concat(r,"/books/").concat(e),PDF:e=>"".concat(r,"/books/").concat(e,"/pdf"),PDF_CONTENT:e=>"".concat(r,"/books/").concat(e,"/pdf-content"),DOWNLOAD:e=>"".concat(r,"/books/").concat(e,"/download"),REVIEWS:e=>"".concat(r,"/books/").concat(e,"/reviews"),RATING:e=>"".concat(r,"/books/").concat(e,"/rating"),ADD_REVIEW:e=>"".concat(r,"/books/").concat(e,"/reviews")},UPLOAD:{FILE:"".concat(r,"/upload"),PDF:"".concat(r,"/upload/pdf"),DELETE_FILE:e=>"".concat(r,"/upload/").concat(e),DELETE_BOOK:e=>"".concat(r,"/upload/book/").concat(e)},USER:{PROFILE:"".concat(r,"/users/profile"),UPDATE_PROFILE:"".concat(r,"/users/profile"),UPDATE_IMAGE:"".concat(r,"/users/profile/image"),BOOKMARKS:"".concat(r,"/users/bookmarks")}}},32695:e=>{e.exports={reviewContainer:"BookReview_reviewContainer__PXZXE",reviewHeader:"BookReview_reviewHeader__exUT_",reviewSummary:"BookReview_reviewSummary__m9pQe",totalRating:"BookReview_totalRating__pWZXj",overallRating:"BookReview_overallRating__ZqhqM",ratingValue:"BookReview_ratingValue__Ek1q_",ratingStars:"BookReview_ratingStars__TajM3",totalBadge:"BookReview_totalBadge__XRXmr",filterSortContainer:"BookReview_filterSortContainer__VbWZM",ratingFilters:"BookReview_ratingFilters__2sfGt",highlightFilters:"BookReview_highlightFilters__e7dxy",filtersHeader:"BookReview_filtersHeader__Bj9bO",pulseHeader:"BookReview_pulseHeader__10fad",activeFilterIndicator:"BookReview_activeFilterIndicator__0KGTt",filterBadge:"BookReview_filterBadge___lSTT",pulseBorder:"BookReview_pulseBorder__WH3PL",sortBadge:"BookReview_sortBadge__CS43D",fadeIn:"BookReview_fadeIn__ejiO2",clearFilterButton:"BookReview_clearFilterButton__DFeGj",filterOptions:"BookReview_filterOptions__Lr7_r",filterLabel:"BookReview_filterLabel__BUgIR",ratingFilterButtons:"BookReview_ratingFilterButtons__SNy3w",ratingFilterButton:"BookReview_ratingFilterButton__zBp4l",activeFilter:"BookReview_activeFilter__7fooV",filterStar:"BookReview_filterStar__D4fwS",sortOptions:"BookReview_sortOptions__isXrS",sortButtons:"BookReview_sortButtons__m0mZx",sortButton:"BookReview_sortButton__48q83",activeSort:"BookReview_activeSort__vJjfY",pulseDot:"BookReview_pulseDot__dlqnC",reviewContent:"BookReview_reviewContent__cNFFI",averageRating:"BookReview_averageRating__GLivu",ratingNumber:"BookReview_ratingNumber__2uD8e",reviewCount:"BookReview_reviewCount__gFeSv",displayStar:"BookReview_displayStar__Fz3J4",reviewForm:"BookReview_reviewForm__KzYxy",success:"BookReview_success__phiTs",submitError:"BookReview_submitError__GK4zL",ratingSelector:"BookReview_ratingSelector__Y8L9Q",stars:"BookReview_stars__vHpqj",ratingStar:"BookReview_ratingStar__7YZu8",commentField:"BookReview_commentField__HbZ9h",optional:"BookReview_optional__5fC_J",textarea:"BookReview_textarea__uqAZb",characterCount:"BookReview_characterCount__avyYp",submitButton:"BookReview_submitButton__uifGG",loginPrompt:"BookReview_loginPrompt__nl1B6",reviewsList:"BookReview_reviewsList__36HJ_",reviewsHeader:"BookReview_reviewsHeader__VE_c3",noReviews:"BookReview_noReviews__EL0Br",reviewItem:"BookReview_reviewItem__wF7Ok",reviewerInfo:"BookReview_reviewerInfo__yDoe0",reviewerImage:"BookReview_reviewerImage__T3neO",reviewerPlaceholder:"BookReview_reviewerPlaceholder__VLVSv",reviewerName:"BookReview_reviewerName___r0hh",reviewDate:"BookReview_reviewDate__fxaMW",reviewMetadata:"BookReview_reviewMetadata__cvN1d",deleteButton:"BookReview_deleteButton__sF4DA",reviewRating:"BookReview_reviewRating__TTay3",reviewText:"BookReview_reviewText__OjgJ1",confirmOverlay:"BookReview_confirmOverlay__3SoDg",confirmDialog:"BookReview_confirmDialog__rHKbe",slideUp:"BookReview_slideUp__26h3O",confirmHeader:"BookReview_confirmHeader__9ZJSd",closeButton:"BookReview_closeButton__ABCqQ",confirmButtons:"BookReview_confirmButtons__fnWlf",cancelButton:"BookReview_cancelButton__FmPbe",deleteConfirmButton:"BookReview_deleteConfirmButton__bWD9h",loading:"BookReview_loading__xP9sm",error:"BookReview_error__dxxxC",pulse:"BookReview_pulse__kJ1qE",filterButtons:"BookReview_filterButtons__HLVmO",filterStars:"BookReview_filterStars__VTPC6",filterCount:"BookReview_filterCount__bXmzR",filterBadgeContent:"BookReview_filterBadgeContent__IES9e",clearFilterBadge:"BookReview_clearFilterBadge__Kxty7",spinner:"BookReview_spinner__T90VY",spin:"BookReview_spin___BTC6",selectedRating:"BookReview_selectedRating__1uk3e",sortSelect:"BookReview_sortSelect__tzzV_",pagination:"BookReview_pagination__e2wwO",pageButton:"BookReview_pageButton__vOxgM",disabled:"BookReview_disabled__fnx_G",pageInfo:"BookReview_pageInfo__YqhK4",slideDown:"BookReview_slideDown__twYYN"}},54677:(e,t,o)=>{"use strict";o.r(t),o.d(t,{default:()=>y});var r=o(95155),a=o(12115),i=o(29911),s=o(6874),n=o.n(s),l=o(35695),c=o(55028),d=o(15305),u=o(12515),m=o(17203);let h=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"newest",o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4;try{if(!e)throw Error("Book ID is required");let i=localStorage.getItem("token"),s=localStorage.getItem("apiKey"),n=new URLSearchParams;t&&"my-reviews"!==t?n.append("sort",t):"my-reviews"===t&&n.append("sort","newest"),o&&n.append("rating",o),n.append("page",r.toString()),n.append("limit",a.toString());let l="".concat(m.Sn.BOOKS.REVIEWS(e)).concat(n.toString()?"?"+n.toString():""),c=await fetch(l,{method:"GET",headers:{"Content-Type":"application/json",...i&&{Authorization:"Bearer ".concat(i)},...s&&{"X-API-Key":s}}});if(!c.ok){let e=await c.json();throw Error(e.message||"Failed to fetch reviews")}return await c.json()}catch(e){throw console.error("Error fetching book reviews:",e),e}},v=async e=>{try{if(!e)throw Error("Book ID is required");let t=await fetch(m.Sn.BOOKS.RATING(e));if(!t.ok){let e=await t.json();throw Error(e.message||"Failed to fetch book rating")}return await t.json()}catch(e){throw console.error("Error fetching book rating:",e),e}},g=async function(e,t){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";try{if(!e)throw Error("Book ID is required");if(!t||t<1||t>5)throw Error("Rating must be between 1 and 5");if(o&&o.length>200)throw Error("Review text must be under 200 characters");let r=localStorage.getItem("token");if(!r)throw Error("You must be logged in to submit a review");let a=await fetch(m.Sn.BOOKS.REVIEWS(e),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(r)},body:JSON.stringify({rating:t,comment:o.trim()})});if(!a.ok){let e=await a.json();throw Error(e.message||"Failed to submit review")}return await a.json()}catch(e){throw console.error("Error submitting book review:",e),e}},w=async e=>{try{let t=localStorage.getItem("token");if(!t)throw Error("You must be logged in to delete a review");let o=await fetch("".concat(m.JR,"/reviews/").concat(e),{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t)}});if(!o.ok){let e=await o.json();throw Error(e.message||"Failed to delete review")}return await o.json()}catch(e){throw console.error("Error deleting review:",e),e}};var _=o(56068),p=o(32695),f=o.n(p);function k(e){let{bookId:t}=e,[o,s]=(0,a.useState)([]),[n,l]=(0,a.useState)(0),[c,m]=(0,a.useState)(""),[p,k]=(0,a.useState)(0),[b,j]=(0,a.useState)(0),[x,B]=(0,a.useState)(0),[y,S]=(0,a.useState)(!0),[N,R]=(0,a.useState)(null),[P,E]=(0,a.useState)(null),[I,O]=(0,a.useState)(!1),[F,C]=(0,a.useState)(!1),[D,T]=(0,a.useState)(!1),[L,A]=(0,a.useState)(!1),[U,K]=(0,a.useState)(0),[G,z]=(0,a.useState)(!1),[H,M]=(0,a.useState)(null),[J,W]=(0,a.useState)("newest"),[q,V]=(0,a.useState)(null),[Y,X]=(0,a.useState)({}),[Z,Q]=(0,a.useState)(1),[$,ee]=(0,a.useState)({page:1,limit:4,totalReviews:0,totalPages:0,hasNextPage:!1,hasPrevPage:!1}),{user:et}=(0,_.h)();(0,a.useEffect)(()=>{eo()},[t,J,q,Z]);let eo=async()=>{try{if(!t){R("Book ID is missing. Cannot load reviews."),S(!1);return}console.log("BookReview: Fetching data for bookId:",t),S(!0);let[e,o]=await Promise.all([h(t,J,q,Z,4),v(t)]),r=e.reviews||[];"my-reviews"===J&&et&&(r=r.filter(e=>et.name&&e.userName===et.name||et.username&&e.userName===et.username)),s(r),j(o.averageRating),B(o.reviewCount),X(o.ratingDistribution||{}),e.pagination&&ee(e.pagination),R(null)}catch(e){R("Failed to load reviews. Please try again later."),console.error("Error loading review data:",e)}finally{S(!1)}},er=e=>new Date(e).toLocaleDateString(void 0,{year:"numeric",month:"long",day:"numeric"}),ea=e=>{W(e),Q(1)},ei=e=>{q===e?V(null):V(e),Q(1)},es=e=>{e>=1&&e<=$.totalPages&&Q(e)},en=async e=>{if(e.preventDefault(),!t)return void E("Book ID is missing. Cannot submit review.");if(0===n)return void E("Please select a rating");try{O(!0),E(null),console.log("Submitting review for bookId:",t),await g(t,n,c),Q(1),eo(),l(0),m(""),K(0),T(!0),setTimeout(()=>{T(!1)},3e3)}catch(e){E(e.message||"Failed to submit review. Please try again later.")}finally{O(!1)}},el=e=>{M(e),z(!0)},ec=()=>{M(null),z(!1)},ed=async()=>{if(H)try{C(!0),console.log("Deleting review with ID:",H._id),await w(H._id),eo(),A(!0),setTimeout(()=>{A(!1)},3e3)}catch(e){console.error("Error deleting review:",e),E(e.message||"Failed to delete review. Please try again later.")}finally{C(!1),z(!1),M(null)}},eu=e=>et&&(et.name&&e.userName===et.name||et.username&&e.userName===et.username),em=e=>Array.from({length:5},(e,t)=>t+1).map(t=>(0,r.jsx)("span",{className:f().displayStar,children:e>=t?(0,r.jsx)(i.gt3,{}):(0,r.jsx)(i.wei,{})},t));return y?(0,r.jsx)("div",{className:f().loading,children:"Loading reviews..."}):N?(0,r.jsx)("div",{className:f().error,children:N}):(0,r.jsxs)("div",{className:f().reviewContainer,children:[G&&H&&(0,r.jsx)("div",{className:f().confirmOverlay,children:(0,r.jsxs)("div",{className:f().confirmDialog,children:[(0,r.jsxs)("div",{className:f().confirmHeader,children:[(0,r.jsx)("h4",{children:"Delete Review"}),(0,r.jsx)("button",{onClick:ec,className:f().closeButton,"aria-label":"Close",children:(0,r.jsx)(i.QCr,{})})]}),(0,r.jsx)("p",{children:"Are you sure you want to delete your review? This action cannot be undone."}),(0,r.jsxs)("div",{className:f().confirmButtons,children:[(0,r.jsx)("button",{onClick:ec,className:f().cancelButton,disabled:F,children:"Cancel"}),(0,r.jsx)("button",{onClick:ed,className:f().deleteConfirmButton,disabled:F,children:F?"Deleting...":"Delete"})]})]})}),(0,r.jsx)("div",{className:f().reviewHeader,children:(0,r.jsxs)("div",{className:f().reviewSummary,children:[(0,r.jsxs)("h2",{children:[x," Reviews"]}),(0,r.jsxs)("div",{className:f().totalRating,children:[(0,r.jsxs)("div",{className:f().overallRating,children:[(0,r.jsx)("div",{className:f().ratingValue,children:b.toFixed(1)}),(0,r.jsx)("div",{className:f().ratingStars,children:em(b)})]}),(0,r.jsx)("div",{className:f().totalBadge,children:(0,r.jsxs)("span",{children:[x," ratings"]})})]})]})}),(0,r.jsxs)("div",{className:f().reviewContent,children:[et?(0,r.jsxs)("div",{className:f().reviewForm,children:[(0,r.jsx)("h3",{children:"Write a Review"}),D&&(0,r.jsxs)("div",{className:f().success,children:[(0,r.jsx)(i.A7C,{style:{marginRight:"8px"}}),"Your review has been submitted successfully!"]}),L&&(0,r.jsxs)("div",{className:f().success,children:[(0,r.jsx)(i.A7C,{style:{marginRight:"8px"}}),"Your review has been deleted successfully!"]}),P&&(0,r.jsxs)("div",{className:f().submitError,children:[(0,r.jsx)(i.BS8,{style:{marginRight:"8px"}}),P]}),(0,r.jsxs)("form",{onSubmit:en,children:[(0,r.jsxs)("div",{className:f().ratingSelector,children:[(0,r.jsx)("label",{htmlFor:"rating-stars",children:"Your Rating:"}),(0,r.jsx)("div",{className:f().stars,id:"rating-stars",role:"group","aria-label":"Select a rating from 1 to 5 stars",children:Array.from({length:5},(e,t)=>t+1).map(e=>(0,r.jsx)("span",{className:f().ratingStar,onClick:()=>l(e),onMouseEnter:()=>k(e),onMouseLeave:()=>k(0),children:(p||n)>=e?(0,r.jsx)(i.gt3,{}):(0,r.jsx)(i.wei,{})},e))}),n>0&&(0,r.jsxs)("div",{className:f().selectedRating,children:["You selected: ",(0,r.jsxs)("strong",{children:[n," ",1===n?"star":"stars"]})]})]}),(0,r.jsxs)("div",{className:f().commentField,children:[(0,r.jsxs)("label",{htmlFor:"review-comment",children:["Your Review: ",(0,r.jsx)("span",{className:f().optional,children:"(optional, max 200 characters)"})]}),(0,r.jsx)("textarea",{id:"review-comment",value:c,onChange:e=>{let t=e.target.value;t.length<=200&&(m(t),K(t.length))},placeholder:"Share your thoughts about this book (optional)",rows:4,className:f().textarea,maxLength:200}),(0,r.jsxs)("div",{className:f().characterCount,children:[U,"/200 characters"]})]}),(0,r.jsx)("button",{type:"submit",className:f().submitButton,disabled:I||0===n,children:I?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:f().spinner}),"Submitting..."]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(i.Cer,{style:{marginRight:"8px"}}),"Submit Review"]})})]})]}):(0,r.jsxs)("div",{className:f().loginPrompt,children:[(0,r.jsx)(i.JhU,{style:{marginRight:"8px",fontSize:"1.2rem"}}),"Please log in to leave a review."]}),(0,r.jsxs)("div",{className:f().reviewsList,children:[(0,r.jsx)("div",{className:f().reviewsHeader,children:(0,r.jsxs)("h3",{children:["Reviews (",x,")"]})}),(0,r.jsx)("div",{className:f().filterSortContainer,children:(0,r.jsxs)("div",{className:f().ratingFilters,children:[(0,r.jsx)("div",{className:f().filtersHeader,children:(0,r.jsxs)("h3",{children:[(0,r.jsx)(u.npS,{style:{color:"#ef4444"}})," ",(0,r.jsx)("span",{children:"Filter & Sort Reviews"})]})}),(q||"newest"!==J)&&(0,r.jsxs)("div",{className:f().activeFilterIndicator,children:[q&&(0,r.jsxs)("div",{className:f().filterBadge,children:[(0,r.jsxs)("div",{className:f().filterBadgeContent,children:[(0,r.jsxs)("strong",{children:[q,"-star"]})," reviews only"]}),(0,r.jsx)("button",{className:f().clearFilterButton,onClick:()=>ei(null),"aria-label":"Clear rating filter",title:"Clear rating filter",children:(0,r.jsx)(i.QCr,{})})]}),"newest"!==J&&(0,r.jsx)("div",{className:f().sortBadge,children:(0,r.jsxs)("span",{children:["Sorted by: ",(0,r.jsx)("strong",{children:"highest"===J?"Highest Rated":"lowest"===J?"Lowest Rated":"oldest"===J?"Oldest First":"my-reviews"===J?"My Reviews":"Newest First"})]})})]}),(0,r.jsxs)("div",{className:f().filterOptions,children:[(0,r.jsx)("div",{className:f().filterLabel,children:"Filter by Rating:"}),(0,r.jsxs)("div",{className:f().ratingFilterButtons,children:[(0,r.jsx)("button",{className:"".concat(f().ratingFilterButton," ").concat(null===q?f().activeFilter:""),onClick:()=>ei(null),"aria-label":"Show all reviews",title:"Show all reviews",children:"All Ratings"}),[5,4,3,2,1].map(e=>(0,r.jsxs)("button",{className:"".concat(f().ratingFilterButton," ").concat(q===e?f().activeFilter:""),onClick:()=>ei(e),"aria-label":"Show only ".concat(e," star reviews"),title:"Show only ".concat(e," star reviews"),children:[(0,r.jsxs)("span",{className:f().filterStars,children:[e," ",(0,r.jsx)(i.gt3,{className:f().filterStar})]}),Y&&Y[e]>0&&(0,r.jsxs)("span",{className:f().filterCount,children:["(",Y[e],")"]})]},e))]})]}),(0,r.jsxs)("div",{className:f().sortOptions,children:[(0,r.jsx)("div",{className:f().filterLabel,children:"Sort Reviews By:"}),(0,r.jsxs)("div",{className:f().sortButtons,children:[(0,r.jsxs)("button",{className:"".concat(f().sortButton," ").concat("newest"===J?f().activeSort:""),onClick:()=>ea("newest"),"aria-label":"Sort by newest reviews first",title:"Sort by newest reviews first",children:[(0,r.jsx)(u.SEk,{})," Newest First"]}),(0,r.jsxs)("button",{className:"".concat(f().sortButton," ").concat("oldest"===J?f().activeSort:""),onClick:()=>ea("oldest"),"aria-label":"Sort by oldest reviews first",title:"Sort by oldest reviews first",children:[(0,r.jsx)(d.NXG,{})," Oldest First"]}),(0,r.jsxs)("button",{className:"".concat(f().sortButton," ").concat("highest"===J?f().activeSort:""),onClick:()=>ea("highest"),"aria-label":"Sort by highest rating first",title:"Sort by highest rating first",children:[(0,r.jsx)(d.sIf,{})," Highest Rated"]}),(0,r.jsxs)("button",{className:"".concat(f().sortButton," ").concat("lowest"===J?f().activeSort:""),onClick:()=>ea("lowest"),"aria-label":"Sort by lowest rating first",title:"Sort by lowest rating first",children:[(0,r.jsx)(d.NXG,{})," Lowest Rated"]}),et&&(0,r.jsxs)("button",{className:"".concat(f().sortButton," ").concat("my-reviews"===J?f().activeSort:""),onClick:()=>ea("my-reviews"),"aria-label":"Show only my reviews",title:"Show only my reviews",children:[(0,r.jsx)(i.x$1,{})," My Reviews"]})]})]})]})}),0===o.length?(0,r.jsx)("div",{className:f().noReviews,children:q?"No ".concat(q,"-star reviews found. ").concat(x>0?"Try a different filter.":"This book has no reviews yet."):"my-reviews"===J?"You have not reviewed this book yet.":x>0?"No reviews match the current filters.":"Be the first to review this book!"}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:f().activeFilterIndicator,children:[(0,r.jsx)("div",{className:f().reviewCount,children:(0,r.jsx)("span",{children:"my-reviews"===J?"Showing your ".concat(o.length," ").concat(1===o.length?"review":"reviews"):(0,r.jsxs)(r.Fragment,{children:["Showing ",(0,r.jsx)("strong",{children:o.length})," of ",(0,r.jsx)("strong",{children:x})," reviews"]})})}),o.map(e=>(0,r.jsxs)("div",{className:f().reviewItem,children:[(0,r.jsxs)("div",{className:f().reviewHeader,children:[(0,r.jsxs)("div",{className:f().reviewerInfo,children:[e.userImage?(0,r.jsx)("img",{src:e.userImage,alt:e.userName,className:f().reviewerImage}):(0,r.jsx)("div",{className:f().reviewerPlaceholder,children:(0,r.jsx)(i.x$1,{})}),(0,r.jsx)("span",{className:f().reviewerName,children:e.userName})]}),(0,r.jsxs)("div",{className:f().reviewMetadata,children:[(0,r.jsxs)("div",{className:f().reviewDate,children:[(0,r.jsx)(i.bfZ,{}),(0,r.jsx)("span",{children:er(e.createdAt)})]}),eu(e)&&(0,r.jsx)("button",{onClick:()=>el(e),className:f().deleteButton,disabled:F,title:"Delete your review",children:(0,r.jsx)(i.qbC,{})})]})]}),(0,r.jsx)("div",{className:f().reviewRating,children:em(e.rating)}),e.comment&&(0,r.jsx)("div",{className:f().reviewText,children:e.comment})]},e._id))]}),$.totalPages<=1?null:(0,r.jsxs)("div",{className:f().pagination,children:[(0,r.jsx)("button",{className:"".concat(f().pageButton," ").concat($.hasPrevPage?"":f().disabled),onClick:()=>es(Z-1),disabled:!$.hasPrevPage,"aria-label":"Previous page",children:(0,r.jsx)(i._Jj,{})}),(0,r.jsxs)("div",{className:f().pageInfo,children:["Page ",$.page," of ",$.totalPages]}),(0,r.jsx)("button",{className:"".concat(f().pageButton," ").concat($.hasNextPage?"":f().disabled),onClick:()=>es(Z+1),disabled:!$.hasNextPage,"aria-label":"Next page",children:(0,r.jsx)(i.X6T,{})})]})]})]})]})]})}var b=o(71759),j=o.n(b),x=o(922);let B=(0,c.default)(()=>Promise.all([o.e(5129),o.e(510)]).then(o.bind(o,510)),{loadableGenerated:{webpack:()=>[510]},ssr:!1,loading:()=>(0,r.jsxs)("div",{className:j().loadingContainer,children:[(0,r.jsx)("div",{className:j().loadingSpinner}),(0,r.jsx)("p",{children:"Loading PDF viewer..."})]})});function y(e){let{id:t}=e,[o,s]=(0,a.useState)(null),[c,d]=(0,a.useState)(!0),[u,h]=(0,a.useState)(null),[v,g]=(0,a.useState)(!1),[w,p]=(0,a.useState)(!1),[f,b]=(0,a.useState)(!1),[y,S]=(0,a.useState)(null),[N,R]=(0,a.useState)(!1),[P,E]=(0,a.useState)(null),I=(0,l.useRouter)(),{isLoggedIn:O,getToken:F,getApiKey:C}=(0,_.h)();(0,a.useEffect)(()=>{if(!t){console.error("BookPageClient: Book ID is missing or undefined"),h("Book ID is missing. Please go back and try again."),d(!1);return}console.log("BookPageClient: Initializing with book ID:",t),D(t)},[t]),(0,a.useEffect)(()=>()=>{y&&"string"==typeof y&&y.startsWith("blob:")&&URL.revokeObjectURL(y)},[y]);let D=async e=>{d(!0),h(null);try{let t="https://ebookaura.onrender.com/api";console.log("Fetching book details from: ".concat(t,"/books/").concat(e));let o=await fetch("".concat(t,"/books/").concat(e),{method:"GET",headers:{"Content-Type":"application/json"}});if(!o.ok)if(404===o.status)throw Error("Book not found. It may have been removed or the ID is invalid.");else throw Error("Error fetching book details: ".concat(o.status));let r=await o.json();if(!r)throw Error("No book data returned from the server");s(r);let a=JSON.parse(localStorage.getItem("viewedBooks")||"[]");a.includes(e)||(a.push(e),localStorage.setItem("viewedBooks",JSON.stringify(a)),fetch("".concat(t,"/books/").concat(e,"/view"),{method:"POST",headers:{"Content-Type":"application/json"}}).catch(e=>console.error("Error tracking view:",e)))}catch(e){console.error("Error fetching book details:",e),h(e.message||"Failed to load book details. Please try again.")}finally{d(!1)}},T=async()=>{if(!o||!t)return void console.error("Cannot view PDF: Book data or ID is missing");try{p(!0),console.log("Fetching PDF content for viewing, book ID:",t);let e={"Content-Type":"application/json"};if(o.isPremium){let t=F(),o=C();t&&(e.Authorization="Bearer ".concat(t)),o&&(e["X-API-Key"]=o)}let r="".concat(m.Sn.BOOKS.PDF_CONTENT(t),"?counted=true"),a=await fetch(r,{headers:e});if(!a.ok){if(401===a.status&&(await a.json()).isPremium)throw E("This is premium content. Please log in to access it."),Error("Premium content requires authentication");throw Error("Failed to fetch PDF: ".concat(a.status," ").concat(a.statusText))}let i=await a.blob();S(i),b(!0)}catch(e){if(console.error("Error fetching PDF for viewing:",e),P)return void(O?alert("You do not have access to this premium content."):(alert("This is premium content. Please log in to access it."),I.push("/login")));try{if(o.pdfUrl){let e=o.pdfUrl.endsWith(".pdf")?o.pdfUrl:"".concat(o.pdfUrl,".pdf");console.log("Fallback: Using direct PDF URL: ".concat(e)),S(e),b(!0)}else throw Error("No PDF URL available for viewing")}catch(e){console.error("Fallback also failed:",e),alert("Failed to load PDF for viewing. Please try downloading instead.")}}finally{p(!1)}},L=async()=>{if(o.isPremium&&!O){E("This is premium content. Please log in to access it."),I.push("/login");return}T()},A=async()=>{if(!o||!t)return void console.error("Cannot download: Book data or ID is missing");if(o.isPremium&&!O){E("This is premium content. Please log in to access it."),I.push("/login");return}try{g(!0),console.log("Downloading book with ID:",t);let e={"Content-Type":"application/json"};if(o.isPremium){let t=F(),o=C();t&&(e.Authorization="Bearer ".concat(t)),o&&(e["X-API-Key"]=o)}try{await fetch(m.Sn.BOOKS.DOWNLOAD(t),{method:"POST",headers:e})}catch(e){console.warn("Failed to record download count, but continuing download:",e)}let r="".concat(o.title.replace(/[^a-zA-Z0-9]/g,"_"),".pdf");try{console.log("Fetching PDF content via backend proxy for book: ".concat(o.title));let a="".concat(m.Sn.BOOKS.PDF_CONTENT(t),"?download=true&counted=true"),i=await fetch(a,{headers:e});if(!i.ok){if(401===i.status&&(await i.json()).isPremium)throw E("This is premium content. Please log in to access it."),Error("Premium content requires authentication");throw Error("Failed to fetch PDF: ".concat(i.status," ").concat(i.statusText))}let s=await i.blob(),n=(0,x.NE)(s,r);if(!n.success)throw Error(n.error||"Download failed");console.log("PDF downloaded as: ".concat(r))}catch(o){console.warn("Direct download failed, using fallback:",o);let e="".concat(m.Sn.BOOKS.PDF(t),"?download=true&counted=true");window.open(e,"_blank")}s(e=>({...e,downloads:(e.downloads||0)+1}))}catch(e){console.error("Error downloading book:",e)}finally{g(!1)}};return c?(0,r.jsxs)("div",{className:j().loadingContainer,children:[(0,r.jsx)("div",{className:j().loadingSpinner}),(0,r.jsx)("p",{children:"Loading book details..."})]}):u?(0,r.jsxs)("div",{className:j().error,children:[(0,r.jsx)("h2",{children:"Error"}),(0,r.jsx)("p",{children:u}),(0,r.jsxs)(n(),{href:"/search",className:j().backButton,children:[(0,r.jsx)(i.QVr,{})," Back to Search"]})]}):o?(0,r.jsxs)("div",{className:j().container,children:[(0,r.jsxs)(n(),{href:"/search",className:j().backButton,children:[(0,r.jsx)(i.QVr,{})," Back to Search"]}),(0,r.jsxs)("div",{className:j().bookDetailContainer,children:[(0,r.jsxs)("div",{className:j().bookInformation,children:[(0,r.jsxs)("div",{className:j().bookCover,children:[o.coverImage?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("img",{src:o.coverImage,alt:o.title}),o.isPremium&&(0,r.jsx)("div",{className:j().premiumOverlay,children:(0,r.jsx)(i.JhU,{className:j().lockIcon})})]}):(0,r.jsxs)("div",{className:j().placeholderCover,children:[(0,r.jsx)(i.vd0,{}),o.isPremium&&(0,r.jsx)(i.JhU,{className:j().lockIconPlaceholder})]}),o.isPremium&&(0,r.jsxs)("div",{className:j().premiumBadge,children:[(0,r.jsx)(i.Hu1,{className:j().crownIcon})," Premium"]})]}),(0,r.jsxs)("div",{className:j().bookInfo,children:[(0,r.jsx)("h1",{className:j().title,children:o.title}),(0,r.jsxs)("p",{className:j().author,children:["by ",o.author]}),(0,r.jsxs)("div",{className:j().categoryInfo,children:[(0,r.jsx)("p",{className:j().category,children:o.category}),o.isPremium&&(0,r.jsxs)("span",{className:j().premiumTag,children:[(0,r.jsx)(i.Hu1,{className:j().premiumIcon})," Premium"]})]}),(0,r.jsxs)("div",{className:j().stats,children:[(0,r.jsxs)("span",{className:j().stat,children:[(0,r.jsx)(i.Ny1,{})," ",o.views," views"]}),(0,r.jsxs)("span",{className:j().stat,children:[(0,r.jsx)(i.WCW,{})," ",o.downloads," downloads"]}),o.averageRating>0&&(0,r.jsxs)("span",{className:j().stat,children:[(0,r.jsx)(i.gt3,{})," ",o.averageRating.toFixed(1)]}),o.pageSize>0&&(0,r.jsxs)("span",{className:j().stat,children:[(0,r.jsx)(i.t69,{})," ",o.pageSize," pages"]}),o.fileSizeMB>0&&(0,r.jsxs)("span",{className:j().stat,children:[(0,r.jsx)(i.t69,{})," ",o.fileSizeMB," MB"]})]}),(0,r.jsxs)("div",{className:j().description,children:[(0,r.jsx)("h2",{children:"Description"}),(0,r.jsx)("p",{children:o.description})]}),(0,r.jsxs)("div",{className:j().tags,children:[(0,r.jsx)("h2",{children:"Tags"}),(0,r.jsxs)("div",{className:j().tagList,children:[o.tags&&o.tags.map((e,t)=>(0,r.jsx)("span",{className:j().tag,children:e},t)),(!o.tags||0===o.tags.length)&&(0,r.jsx)("span",{className:j().noTags,children:"No tags"})]})]}),(0,r.jsxs)("div",{className:j().actions,children:[o.isPremium&&!O&&(0,r.jsxs)("div",{className:j().premiumMessage,children:[(0,r.jsx)(i.JhU,{className:j().lockIconMessage}),(0,r.jsxs)("p",{children:["This is premium content. ",(0,r.jsx)(n(),{href:"/login",className:j().loginLink,children:"Log in"})," to access."]})]}),o.isCustomUrl?(0,r.jsxs)("button",{onClick:()=>{if(!o)return void console.error("Cannot open custom URL: Book data is missing");try{R(!0);let e=o.customURLPDF||o.pdfUrl;console.log("Opening custom URL PDF:",e);try{fetch(m.Sn.BOOKS.DOWNLOAD(t),{method:"POST"}).then(()=>{s(e=>({...e,downloads:(e.downloads||0)+1})),window.open(e,"_blank")}).catch(t=>{console.warn("Failed to record download count for custom URL:",t),window.open(e,"_blank")}).finally(()=>{R(!1)})}catch(t){console.error("Error opening custom URL:",t),window.open(e,"_blank"),R(!1)}}catch(e){console.error("Error opening custom URL:",e),alert("Failed to open the PDF. Please try again or contact support if the problem persists."),R(!1)}},className:"".concat(j().openUrlButton," ").concat(o.isPremium&&!O?j().disabledButton:""),disabled:N||o.isPremium&&!O,children:[(0,r.jsx)(i.t69,{})," ",N?"Opening...":"Open PDF"]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("button",{onClick:L,className:"".concat(j().viewButton," ").concat(o.isPremium&&!O?j().disabledButton:""),disabled:w||o.isPremium&&!O,children:[(0,r.jsx)(i.t69,{})," ",w?"Opening...":"View PDF"]}),(0,r.jsxs)("button",{onClick:A,className:"".concat(j().downloadButton," ").concat(o.isPremium&&!O?j().disabledButton:""),disabled:v||o.isPremium&&!O,children:[(0,r.jsx)(i.WCW,{})," ",v?"Downloading...":"Download PDF"]})]})]})]})]}),(0,r.jsx)(k,{bookId:t})]}),f&&y&&(0,r.jsx)(B,{pdfUrl:y,onClose:()=>{b(!1),S(null)},title:o.title,allowDownload:!0,onDownload:A})]}):(0,r.jsxs)("div",{className:j().error,children:[(0,r.jsx)("h2",{children:"Book Not Found"}),(0,r.jsx)("p",{children:"We couldn't find the book you're looking for."}),(0,r.jsxs)(n(),{href:"/search",className:j().backButton,children:[(0,r.jsx)(i.QVr,{})," Back to Search"]})]})}},56068:(e,t,o)=>{"use strict";o.d(t,{AuthProvider:()=>c,h:()=>d});var r=o(95155),a=o(12115),i=o(35695),s=o(72047);let n=(0,a.createContext)(),l=()=>"ak_"+Array.from(crypto.getRandomValues(new Uint8Array(24))).map(e=>e.toString(16).padStart(2,"0")).join(""),c=e=>{let{children:t}=e,[o,c]=(0,a.useState)(null),[d,u]=(0,a.useState)(!0),[m,h]=(0,a.useState)(!1),v=(0,i.useRouter)();(0,a.useEffect)(()=>{h(!0);let e=localStorage.getItem("userInfo"),t=localStorage.getItem("token");if(localStorage.getItem("apiKey"),e&&t)try{c(JSON.parse(e)),(async()=>{try{await (0,s.dw)("/auth/check",{headers:{Authorization:"Bearer ".concat(t)}})}catch(e){console.error("Token validation failed:",e),w()}})()}catch(e){console.error("Failed to parse user info:",e),localStorage.removeItem("userInfo"),localStorage.removeItem("token"),localStorage.removeItem("apiKey")}u(!1)},[]);let g=e=>{if(console.log("Processing login data"),!e)return void console.error("No user data received for login");try{if(!e.token)return void console.error("No token in login data");let{token:t,...o}=e;console.log("Setting user data:",o),c(o);{localStorage.setItem("userInfo",JSON.stringify(o)),localStorage.setItem("token",t);let e=localStorage.getItem("apiKey");e||(console.log("Generating new API key"),e=l(),localStorage.setItem("apiKey",e)),console.log("Authentication data stored in localStorage")}}catch(e){console.error("Error processing login:",e)}},w=()=>{c(null),localStorage.removeItem("userInfo"),localStorage.removeItem("token"),v.push("/login")},_=()=>localStorage.getItem("token"),p=()=>localStorage.getItem("apiKey");return m?(0,r.jsx)(n.Provider,{value:{user:o,loading:d,login:g,logout:w,getToken:_,getApiKey:p},children:t}):(0,r.jsx)(n.Provider,{value:{user:null,loading:!0,login:g,logout:w,getToken:_,getApiKey:p},children:t})},d=()=>{let e=(0,a.useContext)(n);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},71759:e=>{e.exports={container:"book_container__t7HpC",backButton:"book_backButton__vDnG6",bookDetailContainer:"book_bookDetailContainer__v_R0K",bookInformation:"book_bookInformation__StZ6g",bookCover:"book_bookCover__wj7vL",premiumOverlay:"book_premiumOverlay__U1vfK",lockIcon:"book_lockIcon__F6QwL",lockIconPlaceholder:"book_lockIconPlaceholder__moAc7",premiumBadge:"book_premiumBadge__MoqZw",crownIcon:"book_crownIcon__tVYMH",categoryInfo:"book_categoryInfo__Bu7tP",premiumTag:"book_premiumTag__EMpPl",premiumIcon:"book_premiumIcon__3M5jJ",premiumMessage:"book_premiumMessage__XV4N8",lockIconMessage:"book_lockIconMessage__46A1_",loginLink:"book_loginLink__vAMwB",disabledButton:"book_disabledButton__TW6dJ",placeholderCover:"book_placeholderCover__5P_sO",title:"book_title__xHEy4",author:"book_author__FsqOe",category:"book_category__zzF9H",stats:"book_stats__wU7Ul",stat:"book_stat__mAw2q",description:"book_description__T_l8Y",tags:"book_tags__gKDwb",tagList:"book_tagList__Gixb3",tag:"book_tag__Kk0Gj",noTags:"book_noTags__Qq9um",actions:"book_actions__zgoNS",viewButton:"book_viewButton__yhdR4",downloadButton:"book_downloadButton__xSZiq",openUrlButton:"book_openUrlButton__rZVel",loading:"book_loading__jGrZj",error:"book_error__olOYE",buttonGroup:"book_buttonGroup__1dUE_",loadingContainer:"book_loadingContainer__IEHKf",loadingSpinner:"book_loadingSpinner__PQ2dU",spin:"book_spin__v3jCK",actionButtons:"book_actionButtons__4FEwM",searchButton:"book_searchButton__YOZRF",errorDetails:"book_errorDetails__zCEXA"}},72047:(e,t,o)=>{"use strict";async function r(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{let o=e.startsWith("http")?e:"".concat("https://ebookaura.onrender.com/api").concat(e);if(console.log("API Request: ".concat(t.method||"GET"," ").concat(o)),t.headers||(t.headers={}),!t.body||t.headers["Content-Type"]||t.body instanceof FormData||(t.headers["Content-Type"]="application/json"),!(e.startsWith("/books")&&("GET"===t.method||!t.method)&&!e.includes("/reviews")&&!e.includes("/bookmarks"))){let e=localStorage.getItem("token"),o=localStorage.getItem("apiKey");e&&!t.headers.Authorization&&(t.headers.Authorization="Bearer ".concat(e)),o&&!t.headers["X-API-Key"]&&(t.headers["X-API-Key"]=o)}let r=await fetch(o,t),a=r.headers.get("content-type");if(!r.ok){if(console.error("API Error (".concat(r.status,"): ").concat(r.statusText)),a&&a.includes("application/json")){let e=await r.json();throw Error(e.message||"API request failed with status ".concat(r.status))}{let e=await r.text();console.error("Non-JSON error response:",e.substring(0,150)+"...");let t="API request failed with status ".concat(r.status);if(e.includes("<title>")&&e.includes("</title>")){let o=e.match(/<title>(.*?)<\/title>/i);o&&o[1]&&(t="Server Error: ".concat(o[1]))}throw Error(t)}}if(a&&a.includes("application/json"))return await r.json();{console.warn("Response is not JSON. Content-Type:",a);let e=await r.text();try{return JSON.parse(e)}catch(e){throw console.error("Failed to parse response as JSON:",e),Error("API response was not valid JSON")}}}catch(e){throw console.error("API request error:",e),e}}async function a(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return r(e,{method:"GET",...t})}async function i(e,t){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return r(e,{method:"POST",body:t instanceof FormData?t:JSON.stringify(t),...o})}async function s(e,t){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return r(e,{method:"PUT",body:JSON.stringify(t),...o})}async function n(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return r(e,{method:"DELETE",...t})}o.d(t,{Xj:()=>i,_5:()=>n,dw:()=>a,q1:()=>s})},74436:(e,t,o)=>{"use strict";o.d(t,{k5:()=>d});var r=o(12115),a={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},i=r.createContext&&r.createContext(a),s=["attr","size","title"];function n(){return(n=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var r in o)Object.prototype.hasOwnProperty.call(o,r)&&(e[r]=o[r])}return e}).apply(this,arguments)}function l(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),o.push.apply(o,r)}return o}function c(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?l(Object(o),!0).forEach(function(t){var r,a,i;r=e,a=t,i=o[t],(a=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var o=e[Symbol.toPrimitive];if(void 0!==o){var r=o.call(e,t||"default");if("object"!=typeof r)return r;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(a))in r?Object.defineProperty(r,a,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[a]=i}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):l(Object(o)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))})}return e}function d(e){return t=>r.createElement(u,n({attr:c({},e.attr)},t),function e(t){return t&&t.map((t,o)=>r.createElement(t.tag,c({key:o},t.attr),e(t.child)))}(e.child))}function u(e){var t=t=>{var o,{attr:a,size:i,title:l}=e,d=function(e,t){if(null==e)return{};var o,r,a=function(e,t){if(null==e)return{};var o={};for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){if(t.indexOf(r)>=0)continue;o[r]=e[r]}return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)o=i[r],!(t.indexOf(o)>=0)&&Object.prototype.propertyIsEnumerable.call(e,o)&&(a[o]=e[o])}return a}(e,s),u=i||t.size||"1em";return t.className&&(o=t.className),e.className&&(o=(o?o+" ":"")+e.className),r.createElement("svg",n({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},t.attr,a,d,{className:o,style:c(c({color:e.color||t.color},t.style),e.style),height:u,width:u,xmlns:"http://www.w3.org/2000/svg"}),l&&r.createElement("title",null,l),e.children)};return void 0!==i?r.createElement(i.Consumer,null,e=>t(e)):t(a)}}}]);