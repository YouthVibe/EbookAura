(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4677],{922:(e,o,t)=>{"use strict";t.d(o,{NE:()=>i,dC:()=>s,oc:()=>a});let s=()=>{Promise.all([t.e(3309),t.e(6327),t.e(1588)]).then(t.bind(t,91588)).then(e=>{let{pdfjs:o}=e;o.GlobalWorkerOptions.workerSrc="https://unpkg.com/pdfjs-dist@4.8.69/build/pdf.worker.min.mjs",console.log("PDF.js worker initialized with custom version")}).catch(e=>{console.error("Failed to initialize PDF worker:",e)})},a=!0,r=e=>e?e instanceof Blob||e instanceof File||"string"==typeof e?e:e instanceof ArrayBuffer||e instanceof Uint8Array?new Blob([e],{type:"application/pdf"}):(console.error("Unknown PDF source type:",e),null):null,i=function(e){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"document.pdf";if(!a)return{success:!1,error:"Cannot run on server"};try{let t=r(e);if(!t)return{success:!1,error:"Invalid PDF source"};if("string"==typeof t){let e=document.createElement("a");return e.href=t,e.download=o,e.target="_blank",e.style.display="none",document.body.appendChild(e),e.click(),document.body.removeChild(e),{success:!0}}if(t instanceof Blob||t instanceof File){let e=URL.createObjectURL(t),s=document.createElement("a");return s.href=e,s.download=o,s.style.display="none",document.body.appendChild(s),s.click(),document.body.removeChild(s),setTimeout(()=>URL.revokeObjectURL(e),100),{success:!0}}return{success:!1,error:"Unknown source type"}}catch(e){return console.error("Error creating downloadable PDF:",e),{success:!1,error:e.message||"Unknown error"}}};(()=>{let e=null;return async()=>e||(a?e="https://unpkg.com/pdfjs-dist@4.8.69/build/pdf.worker.min.mjs":null)})()},17203:(e,o,t)=>{"use strict";t.d(o,{JR:()=>s,Sn:()=>a}),t(72047);let s="https://ebookaura.onrender.com/api",a={AUTH:{LOGIN:"".concat(s,"/auth/login"),REGISTER:"".concat(s,"/auth/register"),ME:"".concat(s,"/auth/me"),FORGOT_PASSWORD:"".concat(s,"/auth/forgot-password"),RESET_PASSWORD:e=>"".concat(s,"/auth/reset-password/").concat(e),VERIFY_EMAIL:"".concat(s,"/auth/verify-email")},BOOKS:{ALL:"".concat(s,"/books"),CATEGORIES:"".concat(s,"/books/categories"),TAGS:"".concat(s,"/books/tags"),DETAILS:e=>"".concat(s,"/books/").concat(e),PDF:e=>"".concat(s,"/books/").concat(e,"/pdf"),PDF_CONTENT:e=>"".concat(s,"/books/").concat(e,"/pdf-content"),DOWNLOAD:e=>"".concat(s,"/books/").concat(e,"/download"),REVIEWS:e=>"".concat(s,"/books/").concat(e,"/reviews"),RATING:e=>"".concat(s,"/books/").concat(e,"/rating"),ADD_REVIEW:e=>"".concat(s,"/books/").concat(e,"/reviews")},UPLOAD:{FILE:"".concat(s,"/upload"),PDF:"".concat(s,"/upload/pdf"),DELETE_FILE:e=>"".concat(s,"/upload/").concat(e),DELETE_BOOK:e=>"".concat(s,"/upload/book/").concat(e)},USER:{PROFILE:"".concat(s,"/users/profile"),UPDATE_PROFILE:"".concat(s,"/users/profile"),UPDATE_IMAGE:"".concat(s,"/users/profile/image"),BOOKMARKS:"".concat(s,"/users/bookmarks")}}},32695:e=>{e.exports={reviewContainer:"BookReview_reviewContainer__PXZXE",reviewHeader:"BookReview_reviewHeader__exUT_",reviewSummary:"BookReview_reviewSummary__m9pQe",totalRating:"BookReview_totalRating__pWZXj",overallRating:"BookReview_overallRating__ZqhqM",ratingValue:"BookReview_ratingValue__Ek1q_",ratingStars:"BookReview_ratingStars__TajM3",totalBadge:"BookReview_totalBadge__XRXmr",filterSortContainer:"BookReview_filterSortContainer__VbWZM",ratingFilters:"BookReview_ratingFilters__2sfGt",highlightFilters:"BookReview_highlightFilters__e7dxy",filtersHeader:"BookReview_filtersHeader__Bj9bO",pulseHeader:"BookReview_pulseHeader__10fad",activeFilterIndicator:"BookReview_activeFilterIndicator__0KGTt",filterBadge:"BookReview_filterBadge___lSTT",pulseBorder:"BookReview_pulseBorder__WH3PL",sortBadge:"BookReview_sortBadge__CS43D",fadeIn:"BookReview_fadeIn__ejiO2",clearFilterButton:"BookReview_clearFilterButton__DFeGj",filterOptions:"BookReview_filterOptions__Lr7_r",filterLabel:"BookReview_filterLabel__BUgIR",ratingFilterButtons:"BookReview_ratingFilterButtons__SNy3w",ratingFilterButton:"BookReview_ratingFilterButton__zBp4l",activeFilter:"BookReview_activeFilter__7fooV",filterStar:"BookReview_filterStar__D4fwS",sortOptions:"BookReview_sortOptions__isXrS",sortButtons:"BookReview_sortButtons__m0mZx",sortButton:"BookReview_sortButton__48q83",activeSort:"BookReview_activeSort__vJjfY",pulseDot:"BookReview_pulseDot__dlqnC",reviewContent:"BookReview_reviewContent__cNFFI",averageRating:"BookReview_averageRating__GLivu",ratingNumber:"BookReview_ratingNumber__2uD8e",reviewCount:"BookReview_reviewCount__gFeSv",displayStar:"BookReview_displayStar__Fz3J4",reviewForm:"BookReview_reviewForm__KzYxy",success:"BookReview_success__phiTs",submitError:"BookReview_submitError__GK4zL",ratingSelector:"BookReview_ratingSelector__Y8L9Q",stars:"BookReview_stars__vHpqj",ratingStar:"BookReview_ratingStar__7YZu8",commentField:"BookReview_commentField__HbZ9h",optional:"BookReview_optional__5fC_J",textarea:"BookReview_textarea__uqAZb",characterCount:"BookReview_characterCount__avyYp",submitButton:"BookReview_submitButton__uifGG",loginPrompt:"BookReview_loginPrompt__nl1B6",reviewsList:"BookReview_reviewsList__36HJ_",reviewsHeader:"BookReview_reviewsHeader__VE_c3",noReviews:"BookReview_noReviews__EL0Br",reviewItem:"BookReview_reviewItem__wF7Ok",reviewerInfo:"BookReview_reviewerInfo__yDoe0",reviewerImage:"BookReview_reviewerImage__T3neO",reviewerPlaceholder:"BookReview_reviewerPlaceholder__VLVSv",reviewerName:"BookReview_reviewerName___r0hh",reviewDate:"BookReview_reviewDate__fxaMW",reviewMetadata:"BookReview_reviewMetadata__cvN1d",deleteButton:"BookReview_deleteButton__sF4DA",reviewRating:"BookReview_reviewRating__TTay3",reviewText:"BookReview_reviewText__OjgJ1",confirmOverlay:"BookReview_confirmOverlay__3SoDg",confirmDialog:"BookReview_confirmDialog__rHKbe",slideUp:"BookReview_slideUp__26h3O",confirmHeader:"BookReview_confirmHeader__9ZJSd",closeButton:"BookReview_closeButton__ABCqQ",confirmButtons:"BookReview_confirmButtons__fnWlf",cancelButton:"BookReview_cancelButton__FmPbe",deleteConfirmButton:"BookReview_deleteConfirmButton__bWD9h",loading:"BookReview_loading__xP9sm",error:"BookReview_error__dxxxC",pulse:"BookReview_pulse__kJ1qE",filterButtons:"BookReview_filterButtons__HLVmO",filterStars:"BookReview_filterStars__VTPC6",filterCount:"BookReview_filterCount__bXmzR",filterBadgeContent:"BookReview_filterBadgeContent__IES9e",clearFilterBadge:"BookReview_clearFilterBadge__Kxty7",spinner:"BookReview_spinner__T90VY",spin:"BookReview_spin___BTC6",selectedRating:"BookReview_selectedRating__1uk3e",sortSelect:"BookReview_sortSelect__tzzV_",pagination:"BookReview_pagination__e2wwO",pageButton:"BookReview_pageButton__vOxgM",disabled:"BookReview_disabled__fnx_G",pageInfo:"BookReview_pageInfo__YqhK4",alreadyReviewed:"BookReview_alreadyReviewed__chKxo",userReviewBox:"BookReview_userReviewBox__RSQZF",userReviewHeader:"BookReview_userReviewHeader__fX13K",userReviewRating:"BookReview_userReviewRating__391lE",ratingText:"BookReview_ratingText__GR4Xk",deleteUserReviewButton:"BookReview_deleteUserReviewButton__kZBBT",userReviewComment:"BookReview_userReviewComment__O91VY",userReviewDate:"BookReview_userReviewDate__kM04j",slideDown:"BookReview_slideDown__twYYN"}},53116:(e,o,t)=>{"use strict";t.d(o,{A0:()=>a,PZ:()=>c,jv:()=>i,vW:()=>n,wA:()=>r});var s=t(72047);let a=async()=>{try{let e=localStorage.getItem("token");if(!e)throw Error("Authentication required");return await (0,s.dw)("/coins",{headers:{Authorization:"Bearer ".concat(e)}})}catch(e){throw console.error("Error fetching coins:",e),e}},r=async()=>{try{let e=localStorage.getItem("token");if(!e)throw Error("Authentication required");return await (0,s.Xj)("/coins/daily",{},{headers:{Authorization:"Bearer ".concat(e)}})}catch(e){throw console.error("Error claiming daily coins:",e),e}},i=async()=>{try{let e=localStorage.getItem("token");if(!e)throw Error("Authentication required");return await (0,s.Xj)("/coins/ad-reward",{},{headers:{Authorization:"Bearer ".concat(e)}})}catch(e){throw console.error("Error claiming ad reward coins:",e),e}},n=async e=>{try{let o=localStorage.getItem("token");if(!o)throw Error("Authentication required");return await (0,s.Xj)("/coins/purchase/".concat(e),{},{headers:{Authorization:"Bearer ".concat(o)}})}catch(e){throw console.error("Error purchasing book:",e),e}},c=async e=>{try{let o=localStorage.getItem("token");if(!o)throw Error("Authentication required");return await (0,s.dw)("/users/check-purchase/".concat(e),{headers:{Authorization:"Bearer ".concat(o)}})}catch(e){throw console.error("Error checking book purchase:",e),e}}},54677:(e,o,t)=>{"use strict";t.r(o),t.d(o,{default:()=>y});var s=t(95155),a=t(12115),r=t(29911),i=t(6874),n=t.n(i),c=t(35695),l=t(55028),d=t(15305),u=t(12515),h=t(17203);let m=async function(e){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"newest",t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4;try{if(!e)throw Error("Book ID is required");let r=localStorage.getItem("token"),i=localStorage.getItem("apiKey"),n=new URLSearchParams;o&&"my-reviews"!==o?n.append("sort",o):"my-reviews"===o&&n.append("sort","newest"),t&&n.append("rating",t),n.append("page",s.toString()),n.append("limit",a.toString());let c="".concat(h.Sn.BOOKS.REVIEWS(e)).concat(n.toString()?"?"+n.toString():""),l=await fetch(c,{method:"GET",headers:{"Content-Type":"application/json",...r&&{Authorization:"Bearer ".concat(r)},...i&&{"X-API-Key":i}}});if(!l.ok){let e=await l.json();throw Error(e.message||"Failed to fetch reviews")}return await l.json()}catch(e){throw console.error("Error fetching book reviews:",e),e}},_=async e=>{try{if(!e)throw Error("Book ID is required");let o=await fetch(h.Sn.BOOKS.RATING(e));if(!o.ok){let e=await o.json();throw Error(e.message||"Failed to fetch book rating")}return await o.json()}catch(e){throw console.error("Error fetching book rating:",e),e}},v=async function(e,o){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";try{if(!e)throw Error("Book ID is required");if(!o||o<1||o>5)throw Error("Rating must be between 1 and 5");if(t&&t.length>200)throw Error("Review text must be under 200 characters");let s=localStorage.getItem("token");if(!s)throw Error("You must be logged in to submit a review");let a=await fetch(h.Sn.BOOKS.REVIEWS(e),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(s)},body:JSON.stringify({rating:o,comment:t.trim()})});if(!a.ok){let e=await a.json();throw Error(e.message||"Failed to submit review")}return await a.json()}catch(e){throw console.error("Error submitting book review:",e),e}},w=async e=>{try{let o=localStorage.getItem("token");if(!o)throw Error("You must be logged in to delete a review");let t=await fetch("".concat(h.JR,"/reviews/").concat(e),{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(o)}});if(!t.ok){let e=await t.json();throw Error(e.message||"Failed to delete review")}return await t.json()}catch(e){throw console.error("Error deleting review:",e),e}};var g=t(56068),k=t(32695),p=t.n(k);function f(e){let{bookId:o}=e,[t,i]=(0,a.useState)([]),[n,c]=(0,a.useState)(0),[l,h]=(0,a.useState)(""),[k,f]=(0,a.useState)(0),[b,x]=(0,a.useState)(0),[j,B]=(0,a.useState)(0),[R,N]=(0,a.useState)(!0),[y,S]=(0,a.useState)(null),[C,E]=(0,a.useState)(null),[P,F]=(0,a.useState)(!1),[I,D]=(0,a.useState)(!1),[O,T]=(0,a.useState)(!1),[L,A]=(0,a.useState)(!1),[U,H]=(0,a.useState)(0),[G,Y]=(0,a.useState)(!1),[V,z]=(0,a.useState)(null),[K,M]=(0,a.useState)("newest"),[q,W]=(0,a.useState)(null),[Z,X]=(0,a.useState)({}),[J,Q]=(0,a.useState)(1),[$,ee]=(0,a.useState)({page:1,limit:4,totalReviews:0,totalPages:0,hasNextPage:!1,hasPrevPage:!1}),[eo,et]=(0,a.useState)(!1),[es,ea]=(0,a.useState)(null),{user:er}=(0,g.h)();(0,a.useEffect)(()=>{ei()},[o,K,q,J]);let ei=async()=>{try{if(!o){S("Book ID is missing. Cannot load reviews."),N(!1);return}console.log("BookReview: Fetching data for bookId:",o),N(!0);let[e,t]=await Promise.all([m(o,K,q,J,4),_(o)]),s=e.reviews||[];if("my-reviews"===K&&er&&(s=s.filter(e=>er.name&&e.userName===er.name||er.username&&e.userName===er.username)),i(s),x(t.averageRating),B(t.reviewCount),X(t.ratingDistribution||{}),er){let e=s.some(e=>er.name&&e.userName===er.name||er.username&&e.userName===er.username);if(et(e),e){let e=s.find(e=>er.name&&e.userName===er.name||er.username&&e.userName===er.username);ea(e)}}e.pagination&&ee(e.pagination),S(null)}catch(e){S("Failed to load reviews. Please try again later."),console.error("Error loading review data:",e)}finally{N(!1)}},en=e=>new Date(e).toLocaleDateString(void 0,{year:"numeric",month:"long",day:"numeric"}),ec=e=>{M(e),Q(1)},el=e=>{q===e?W(null):W(e),Q(1)},ed=e=>{e>=1&&e<=$.totalPages&&Q(e)},eu=async e=>{if(e.preventDefault(),!o)return void E("Book ID is missing. Cannot submit review.");if(0===n)return void E("Please select a rating");try{F(!0),E(null),console.log("Submitting review for bookId:",o),await v(o,n,l),Q(1),ei(),c(0),h(""),H(0),T(!0),setTimeout(()=>{T(!1)},3e3)}catch(e){E(e.message||"Failed to submit review. Please try again later.")}finally{F(!1)}},eh=e=>{z(e),Y(!0)},em=()=>{z(null),Y(!1)},e_=async()=>{if(V)try{D(!0),console.log("Deleting review with ID:",V._id),await w(V._id),ei(),A(!0),setTimeout(()=>{A(!1)},3e3)}catch(e){console.error("Error deleting review:",e),E(e.message||"Failed to delete review. Please try again later.")}finally{D(!1),Y(!1),z(null)}},ev=e=>er&&(er.name&&e.userName===er.name||er.username&&e.userName===er.username),ew=e=>Array.from({length:5},(e,o)=>o+1).map(o=>(0,s.jsx)("span",{className:p().displayStar,children:e>=o?(0,s.jsx)(r.gt3,{}):(0,s.jsx)(r.wei,{})},o));return R?(0,s.jsx)("div",{className:p().loading,children:"Loading reviews..."}):y?(0,s.jsx)("div",{className:p().error,children:y}):(0,s.jsxs)("div",{className:p().reviewContainer,children:[G&&V&&(0,s.jsx)("div",{className:p().confirmOverlay,children:(0,s.jsxs)("div",{className:p().confirmDialog,children:[(0,s.jsxs)("div",{className:p().confirmHeader,children:[(0,s.jsx)("h4",{children:"Delete Review"}),(0,s.jsx)("button",{onClick:em,className:p().closeButton,"aria-label":"Close",children:(0,s.jsx)(r.QCr,{})})]}),(0,s.jsx)("p",{children:"Are you sure you want to delete your review? This action cannot be undone."}),(0,s.jsxs)("div",{className:p().confirmButtons,children:[(0,s.jsx)("button",{onClick:em,className:p().cancelButton,disabled:I,children:"Cancel"}),(0,s.jsx)("button",{onClick:e_,className:p().deleteConfirmButton,disabled:I,children:I?"Deleting...":"Delete"})]})]})}),(0,s.jsx)("div",{className:p().reviewHeader,children:(0,s.jsxs)("div",{className:p().reviewSummary,children:[(0,s.jsxs)("h2",{children:[j," Reviews"]}),(0,s.jsxs)("div",{className:p().totalRating,children:[(0,s.jsxs)("div",{className:p().overallRating,children:[(0,s.jsx)("div",{className:p().ratingValue,children:b.toFixed(1)}),(0,s.jsx)("div",{className:p().ratingStars,children:ew(b)})]}),(0,s.jsx)("div",{className:p().totalBadge,children:(0,s.jsxs)("span",{children:[j," ratings"]})})]})]})}),(0,s.jsxs)("div",{className:p().reviewContent,children:[er?eo?(0,s.jsxs)("div",{className:p().alreadyReviewed,children:[(0,s.jsx)("h3",{children:"Your Review"}),(0,s.jsxs)("div",{className:p().userReviewBox,children:[(0,s.jsxs)("div",{className:p().userReviewHeader,children:[(0,s.jsxs)("div",{className:p().userReviewRating,children:[ew((null==es?void 0:es.rating)||0),(0,s.jsxs)("span",{className:p().ratingText,children:[(null==es?void 0:es.rating)||0,"/5 stars"]})]}),(0,s.jsxs)("button",{onClick:()=>eh(es),className:p().deleteUserReviewButton,title:"Delete your review",children:[(0,s.jsx)(r.qbC,{})," Delete Review"]})]}),(null==es?void 0:es.comment)&&(0,s.jsxs)("div",{className:p().userReviewComment,children:['"',es.comment,'"']}),(0,s.jsxs)("div",{className:p().userReviewDate,children:["Reviewed on ",en(null==es?void 0:es.createdAt)]})]})]}):(0,s.jsxs)("div",{className:p().reviewForm,children:[(0,s.jsx)("h3",{children:"Write a Review"}),O&&(0,s.jsxs)("div",{className:p().success,children:[(0,s.jsx)(r.A7C,{style:{marginRight:"8px"}}),"Your review has been submitted successfully!"]}),L&&(0,s.jsxs)("div",{className:p().success,children:[(0,s.jsx)(r.A7C,{style:{marginRight:"8px"}}),"Your review has been deleted successfully!"]}),C&&(0,s.jsxs)("div",{className:p().submitError,children:[(0,s.jsx)(r.BS8,{style:{marginRight:"8px"}}),C]}),(0,s.jsxs)("form",{onSubmit:eu,children:[(0,s.jsxs)("div",{className:p().ratingSelector,children:[(0,s.jsx)("label",{htmlFor:"rating-stars",children:"Your Rating:"}),(0,s.jsx)("div",{className:p().stars,id:"rating-stars",role:"group","aria-label":"Select a rating from 1 to 5 stars",children:Array.from({length:5},(e,o)=>o+1).map(e=>(0,s.jsx)("span",{className:p().ratingStar,onClick:()=>c(e),onMouseEnter:()=>f(e),onMouseLeave:()=>f(0),children:(k||n)>=e?(0,s.jsx)(r.gt3,{}):(0,s.jsx)(r.wei,{})},e))}),n>0&&(0,s.jsxs)("div",{className:p().selectedRating,children:["You selected: ",(0,s.jsxs)("strong",{children:[n," ",1===n?"star":"stars"]})]})]}),(0,s.jsxs)("div",{className:p().commentField,children:[(0,s.jsxs)("label",{htmlFor:"review-comment",children:["Your Review: ",(0,s.jsx)("span",{className:p().optional,children:"(optional, max 200 characters)"})]}),(0,s.jsx)("textarea",{id:"review-comment",value:l,onChange:e=>{let o=e.target.value;o.length<=200&&(h(o),H(o.length))},placeholder:"Share your thoughts about this book (optional)",rows:4,className:p().textarea,maxLength:200}),(0,s.jsxs)("div",{className:p().characterCount,children:[U,"/200 characters"]})]}),(0,s.jsx)("button",{type:"submit",className:p().submitButton,disabled:P||0===n,children:P?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:p().spinner}),"Submitting..."]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(r.Cer,{style:{marginRight:"8px"}}),"Submit Review"]})})]})]}):(0,s.jsxs)("div",{className:p().loginPrompt,children:[(0,s.jsx)(r.JhU,{style:{marginRight:"8px",fontSize:"1.2rem"}}),"Please log in to leave a review."]}),(0,s.jsxs)("div",{className:p().reviewsList,children:[(0,s.jsx)("div",{className:p().reviewsHeader,children:(0,s.jsxs)("h3",{children:["Reviews (",j,")"]})}),(0,s.jsx)("div",{className:p().filterSortContainer,children:(0,s.jsxs)("div",{className:p().ratingFilters,children:[(0,s.jsx)("div",{className:p().filtersHeader,children:(0,s.jsxs)("h3",{children:[(0,s.jsx)(u.npS,{style:{color:"#ef4444"}})," ",(0,s.jsx)("span",{children:"Filter & Sort Reviews"})]})}),(q||"newest"!==K)&&(0,s.jsxs)("div",{className:p().activeFilterIndicator,children:[q&&(0,s.jsxs)("div",{className:p().filterBadge,children:[(0,s.jsxs)("div",{className:p().filterBadgeContent,children:[(0,s.jsxs)("strong",{children:[q,"-star"]})," reviews only"]}),(0,s.jsx)("button",{className:p().clearFilterButton,onClick:()=>el(null),"aria-label":"Clear rating filter",title:"Clear rating filter",children:(0,s.jsx)(r.QCr,{})})]}),"newest"!==K&&(0,s.jsx)("div",{className:p().sortBadge,children:(0,s.jsxs)("span",{children:["Sorted by: ",(0,s.jsx)("strong",{children:"highest"===K?"Highest Rated":"lowest"===K?"Lowest Rated":"oldest"===K?"Oldest First":"my-reviews"===K?"My Reviews":"Newest First"})]})})]}),(0,s.jsxs)("div",{className:p().filterOptions,children:[(0,s.jsx)("div",{className:p().filterLabel,children:"Filter by Rating:"}),(0,s.jsxs)("div",{className:p().ratingFilterButtons,children:[(0,s.jsx)("button",{className:"".concat(p().ratingFilterButton," ").concat(null===q?p().activeFilter:""),onClick:()=>el(null),"aria-label":"Show all reviews",title:"Show all reviews",children:"All Ratings"}),[5,4,3,2,1].map(e=>(0,s.jsxs)("button",{className:"".concat(p().ratingFilterButton," ").concat(q===e?p().activeFilter:""),onClick:()=>el(e),"aria-label":"Show only ".concat(e," star reviews"),title:"Show only ".concat(e," star reviews"),children:[(0,s.jsxs)("span",{className:p().filterStars,children:[e," ",(0,s.jsx)(r.gt3,{className:p().filterStar})]}),Z&&Z[e]>0&&(0,s.jsxs)("span",{className:p().filterCount,children:["(",Z[e],")"]})]},e))]})]}),(0,s.jsxs)("div",{className:p().sortOptions,children:[(0,s.jsx)("div",{className:p().filterLabel,children:"Sort Reviews By:"}),(0,s.jsxs)("div",{className:p().sortButtons,children:[(0,s.jsxs)("button",{className:"".concat(p().sortButton," ").concat("newest"===K?p().activeSort:""),onClick:()=>ec("newest"),"aria-label":"Sort by newest reviews first",title:"Sort by newest reviews first",children:[(0,s.jsx)(u.SEk,{})," Newest First"]}),(0,s.jsxs)("button",{className:"".concat(p().sortButton," ").concat("oldest"===K?p().activeSort:""),onClick:()=>ec("oldest"),"aria-label":"Sort by oldest reviews first",title:"Sort by oldest reviews first",children:[(0,s.jsx)(d.NXG,{})," Oldest First"]}),(0,s.jsxs)("button",{className:"".concat(p().sortButton," ").concat("highest"===K?p().activeSort:""),onClick:()=>ec("highest"),"aria-label":"Sort by highest rating first",title:"Sort by highest rating first",children:[(0,s.jsx)(d.sIf,{})," Highest Rated"]}),(0,s.jsxs)("button",{className:"".concat(p().sortButton," ").concat("lowest"===K?p().activeSort:""),onClick:()=>ec("lowest"),"aria-label":"Sort by lowest rating first",title:"Sort by lowest rating first",children:[(0,s.jsx)(d.NXG,{})," Lowest Rated"]}),er&&(0,s.jsxs)("button",{className:"".concat(p().sortButton," ").concat("my-reviews"===K?p().activeSort:""),onClick:()=>ec("my-reviews"),"aria-label":"Show only my reviews",title:"Show only my reviews",children:[(0,s.jsx)(r.x$1,{})," My Reviews"]})]})]})]})}),0===t.length?(0,s.jsx)("div",{className:p().noReviews,children:q?"No ".concat(q,"-star reviews found. ").concat(j>0?"Try a different filter.":"This book has no reviews yet."):"my-reviews"===K?"You have not reviewed this book yet.":j>0?"No reviews match the current filters.":"Be the first to review this book!"}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:p().activeFilterIndicator,children:[(0,s.jsx)("div",{className:p().reviewCount,children:(0,s.jsx)("span",{children:"my-reviews"===K?"Showing your ".concat(t.length," ").concat(1===t.length?"review":"reviews"):(0,s.jsxs)(s.Fragment,{children:["Showing ",(0,s.jsx)("strong",{children:t.length})," of ",(0,s.jsx)("strong",{children:j})," reviews"]})})}),t.map(e=>(0,s.jsxs)("div",{className:p().reviewItem,children:[(0,s.jsxs)("div",{className:p().reviewHeader,children:[(0,s.jsxs)("div",{className:p().reviewerInfo,children:[e.userImage?(0,s.jsx)("img",{src:e.userImage,alt:e.userName,className:p().reviewerImage}):(0,s.jsx)("div",{className:p().reviewerPlaceholder,children:(0,s.jsx)(r.x$1,{})}),(0,s.jsx)("span",{className:p().reviewerName,children:e.userName})]}),(0,s.jsxs)("div",{className:p().reviewMetadata,children:[(0,s.jsxs)("div",{className:p().reviewDate,children:[(0,s.jsx)(r.bfZ,{}),(0,s.jsx)("span",{children:en(e.createdAt)})]}),ev(e)&&(0,s.jsx)("button",{onClick:()=>eh(e),className:p().deleteButton,disabled:I,title:"Delete your review",children:(0,s.jsx)(r.qbC,{})})]})]}),(0,s.jsx)("div",{className:p().reviewRating,children:ew(e.rating)}),e.comment&&(0,s.jsx)("div",{className:p().reviewText,children:e.comment})]},e._id))]}),$.totalPages<=1?null:(0,s.jsxs)("div",{className:p().pagination,children:[(0,s.jsx)("button",{className:"".concat(p().pageButton," ").concat($.hasPrevPage?"":p().disabled),onClick:()=>ed(J-1),disabled:!$.hasPrevPage,"aria-label":"Previous page",children:(0,s.jsx)(r._Jj,{})}),(0,s.jsxs)("div",{className:p().pageInfo,children:["Page ",$.page," of ",$.totalPages]}),(0,s.jsx)("button",{className:"".concat(p().pageButton," ").concat($.hasNextPage?"":p().disabled),onClick:()=>ed(J+1),disabled:!$.hasNextPage,"aria-label":"Next page",children:(0,s.jsx)(r.X6T,{})})]})]})]})]})]})}var b=t(71759),x=t.n(b),j=t(922),B=t(53116),R=t(38543);let N=(0,l.default)(()=>Promise.all([t.e(5129),t.e(510)]).then(t.bind(t,510)),{loadableGenerated:{webpack:()=>[510]},ssr:!1,loading:()=>(0,s.jsxs)("div",{className:x().loadingContainer,children:[(0,s.jsx)("div",{className:x().loadingSpinner}),(0,s.jsx)("p",{children:"Loading PDF viewer..."})]})});function y(e){let{id:o}=e,[t,i]=(0,a.useState)(null),[l,d]=(0,a.useState)(!0),[u,m]=(0,a.useState)(null),[_,v]=(0,a.useState)(!1),[w,k]=(0,a.useState)(!1),[p,b]=(0,a.useState)(!1),[y,S]=(0,a.useState)(null),[C,E]=(0,a.useState)(!1),[P,F]=(0,a.useState)(null),[I,D]=(0,a.useState)(!1),[O,T]=(0,a.useState)(!1),[L,A]=(0,a.useState)(null),[U,H]=(0,a.useState)(!1),G=(0,c.useRouter)(),{user:Y,isLoggedIn:V,getToken:z,getApiKey:K,updateUserCoins:M}=(0,g.h)(),q=null==t?void 0:t.isPremium,W=null==t?void 0:t.userHasAccess,Z=!!Y&&!!t&&Y.coins>=t.price,X=(0,a.useCallback)(async()=>{if(V&&o&&q)try{let e=await (0,B.PZ)(o);e&&e.success&&(i(o=>({...o,userHasAccess:e.hasPurchased})),e.hasPurchased&&T(!0))}catch(e){console.error("Error checking book purchase status:",e)}},[V,o,q,T,i]);(0,a.useEffect)(()=>{V&&o&&q&&X()},[V,o,q,X]),(0,a.useEffect)(()=>{if(!o){console.error("BookPageClient: Book ID is missing or undefined"),m("Book ID is missing. Please go back and try again."),d(!1);return}J(o)},[o]),(0,a.useEffect)(()=>{o&&(Y||V)&&J(o)},[Y,V,o]),(0,a.useEffect)(()=>()=>{y&&"string"==typeof y&&y.startsWith("blob:")&&URL.revokeObjectURL(y)},[y]);let J=async e=>{d(!0),m(null);try{let o="https://ebookaura.onrender.com/api",t=localStorage.getItem("token"),s={"Content-Type":"application/json"},a=z();!a&&t&&(a=t),a&&(s.Authorization="Bearer ".concat(a));let r=await fetch("".concat(o,"/books/").concat(e),{method:"GET",headers:s});if(!r.ok)if(404===r.status)throw Error("Book not found. It may have been removed or the ID is invalid.");else throw Error("Error fetching book details: ".concat(r.status));let n=await r.json();if(!n)throw Error("No book data returned from the server");i(n),n.isPremium&&n.userHasAccess&&(T(!0),A(null));let c=JSON.parse(localStorage.getItem("viewedBooks")||"[]");c.includes(e)||(c.push(e),localStorage.setItem("viewedBooks",JSON.stringify(c)),fetch("".concat(o,"/books/").concat(e,"/view"),{method:"POST",headers:{"Content-Type":"application/json"}}).catch(e=>console.error("Error tracking view:",e)))}catch(e){console.error("Error fetching book details:",e),m(e.message||"Failed to load book details. Please try again.")}finally{d(!1)}},Q=async()=>{if(!t||!o)return void console.error("Cannot view PDF: Book data or ID is missing");try{k(!0),console.log("Fetching PDF content for viewing, book ID:",o);let e={"Content-Type":"application/json"};if(t.isPremium){let o=z(),t=K();o&&(e.Authorization="Bearer ".concat(o)),t&&(e["X-API-Key"]=t)}let s="".concat(h.Sn.BOOKS.PDF_CONTENT(o),"?counted=true"),a=await fetch(s,{headers:e});if(!a.ok){if(401===a.status&&(await a.json()).isPremium)throw F("This is premium content. Please log in to access it."),Error("Premium content requires authentication");throw Error("Failed to fetch PDF: ".concat(a.status," ").concat(a.statusText))}let r=await a.blob();S(r),b(!0)}catch(e){if(console.error("Error fetching PDF for viewing:",e),P)return void(V?alert("You do not have access to this premium content."):(alert("This is premium content. Please log in to access it."),G.push("/login")));try{if(t.pdfUrl){let e=t.pdfUrl.endsWith(".pdf")?t.pdfUrl:"".concat(t.pdfUrl,".pdf");console.log("Fallback: Using direct PDF URL: ".concat(e)),S(e),b(!0)}else throw Error("No PDF URL available for viewing")}catch(e){console.error("Fallback also failed:",e),alert("Failed to load PDF for viewing. Please try downloading instead.")}}finally{k(!1)}},$=async()=>{if(t.isPremium&&!V){F("This is premium content. Please log in to access it."),G.push("/login");return}Q()},ee=async()=>{if(!t||!o)return void console.error("Cannot download: Book data or ID is missing");if(t.isPremium&&!V){F("This is premium content. Please log in to access it."),G.push("/login");return}try{v(!0),console.log("Downloading book with ID:",o);let e={"Content-Type":"application/json"};if(t.isPremium){let o=z(),t=K();o&&(e.Authorization="Bearer ".concat(o)),t&&(e["X-API-Key"]=t)}try{await fetch(h.Sn.BOOKS.DOWNLOAD(o),{method:"POST",headers:e})}catch(e){console.warn("Failed to record download count, but continuing download:",e)}let s="".concat(t.title.replace(/[^a-zA-Z0-9]/g,"_"),".pdf");try{console.log("Fetching PDF content via backend proxy for book: ".concat(t.title));let a="".concat(h.Sn.BOOKS.PDF_CONTENT(o),"?download=true&counted=true"),r=await fetch(a,{headers:e});if(!r.ok){if(401===r.status&&(await r.json()).isPremium)throw F("This is premium content. Please log in to access it."),Error("Premium content requires authentication");throw Error("Failed to fetch PDF: ".concat(r.status," ").concat(r.statusText))}let i=await r.blob(),n=(0,j.NE)(i,s);if(!n.success)throw Error(n.error||"Download failed");console.log("PDF downloaded as: ".concat(s))}catch(t){console.warn("Direct download failed, using fallback:",t);let e="".concat(h.Sn.BOOKS.PDF(o),"?download=true&counted=true");window.open(e,"_blank")}i(e=>({...e,downloads:(e.downloads||0)+1}))}catch(e){console.error("Error downloading book:",e)}finally{v(!1)}},eo=async()=>{try{D(!0),A(null),H(!1);let e=await (0,B.vW)(o);e&&"number"==typeof e.coins&&(M(e.coins),await X(),T(!0),R.oR.success("Book purchased successfully!"))}catch(o){console.error("Error purchasing book:",o);let e="Failed to purchase book. Please try again.";o.response&&o.response.data&&o.response.data.message?e=o.response.data.message:o.message&&(e=o.message),A(e),R.oR.error(e)}finally{D(!1)}};return l?(0,s.jsxs)("div",{className:x().loadingContainer,children:[(0,s.jsx)("div",{className:x().loadingSpinner}),(0,s.jsx)("p",{children:"Loading book details..."})]}):u?(0,s.jsxs)("div",{className:x().error,children:[(0,s.jsx)("h2",{children:"Error"}),(0,s.jsx)("p",{children:u}),(0,s.jsxs)(n(),{href:"/search",className:x().backButton,children:[(0,s.jsx)(r.QVr,{})," Back to Search"]})]}):t?(0,s.jsxs)("div",{className:x().container,children:[(0,s.jsxs)(n(),{href:"/search",className:x().backButton,children:[(0,s.jsx)(r.QVr,{})," Back to Search"]}),(0,s.jsxs)("div",{className:x().bookDetailContainer,children:[(0,s.jsxs)("div",{className:x().bookInformation,children:[(0,s.jsxs)("div",{className:x().bookCover,children:[t.coverImage?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("img",{src:t.coverImage,alt:t.title}),q&&(0,s.jsx)("div",{className:x().premiumOverlay,children:(0,s.jsx)(r.JhU,{className:x().lockIcon})})]}):(0,s.jsxs)("div",{className:x().placeholderCover,children:[(0,s.jsx)(r.vd0,{}),q&&(0,s.jsx)(r.JhU,{className:x().lockIconPlaceholder})]}),q&&(0,s.jsxs)("div",{className:x().premiumBadge,children:[(0,s.jsx)(r.Hu1,{className:x().crownIcon})," Premium"]})]}),(0,s.jsxs)("div",{className:x().bookInfo,children:[(0,s.jsx)("h1",{className:x().title,children:t.title}),(0,s.jsxs)("p",{className:x().author,children:["by ",t.author]}),(0,s.jsxs)("div",{className:x().categoryInfo,children:[(0,s.jsx)("p",{className:x().category,children:t.category}),q&&(0,s.jsxs)("span",{className:x().premiumTag,children:[(0,s.jsx)(r.Hu1,{className:x().premiumIcon})," Premium"]})]}),(0,s.jsxs)("div",{className:x().stats,children:[(0,s.jsxs)("span",{className:x().stat,children:[(0,s.jsx)(r.Ny1,{})," ",t.views," views"]}),(0,s.jsxs)("span",{className:x().stat,children:[(0,s.jsx)(r.WCW,{})," ",t.downloads," downloads"]}),t.averageRating>0&&(0,s.jsxs)("span",{className:x().stat,children:[(0,s.jsx)(r.gt3,{})," ",t.averageRating.toFixed(1)]}),t.pageSize>0&&(0,s.jsxs)("span",{className:x().stat,children:[(0,s.jsx)(r.t69,{})," ",t.pageSize," pages"]}),t.fileSizeMB>0&&(0,s.jsxs)("span",{className:x().stat,children:[(0,s.jsx)(r.t69,{})," ",t.fileSizeMB," MB"]})]}),(0,s.jsxs)("div",{className:x().description,children:[(0,s.jsx)("h2",{children:"Description"}),(0,s.jsx)("p",{children:t.description})]}),(0,s.jsxs)("div",{className:x().tags,children:[(0,s.jsx)("h2",{children:"Tags"}),(0,s.jsxs)("div",{className:x().tagList,children:[t.tags&&t.tags.map((e,o)=>(0,s.jsx)("span",{className:x().tag,children:e},o)),(!t.tags||0===t.tags.length)&&(0,s.jsx)("span",{className:x().noTags,children:"No tags"})]})]}),q&&(0,s.jsxs)("div",{className:x().premiumPurchaseContainer,children:[!1,(0,s.jsxs)("div",{className:x().premiumInfo,children:[(0,s.jsxs)("div",{className:x().premiumPrice,children:[(0,s.jsx)(r.cEG,{className:x().coinIcon}),(0,s.jsx)("span",{className:x().priceValue,children:t.price})," coins"]}),V&&(0,s.jsxs)("div",{className:x().userCoins,children:[(0,s.jsx)("span",{children:"Your balance: "}),(0,s.jsx)(r.cEG,{className:x().coinIcon}),(0,s.jsx)("span",{className:x().coinValue,children:(null==Y?void 0:Y.coins)||0})," coins"]})]}),V&&!W&&!O&&(0,s.jsxs)(s.Fragment,{children:[L&&(0,s.jsx)("div",{className:x().purchaseError,children:L}),(0,s.jsx)("button",{onClick:()=>{if(!t||!o)return void console.error("Cannot purchase: Book data or ID is missing");if(!V){F("You need to be logged in to purchase this book"),G.push("/login");return}return W||O?void R.oR.info("You already own this book"):Z?void H(!0):void A("You need ".concat(t.price-Y.coins," more coins to purchase this book"))},className:"".concat(x().purchaseButton," ").concat(Z?"":x().disabledPurchase),disabled:I||!Z,children:I?"Processing...":(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(r.cEG,{className:x().buttonCoinIcon}),"Purchase with Coins"]})}),!Z&&(0,s.jsxs)("div",{className:x().insufficientCoins,children:["You need ",(0,s.jsx)("strong",{children:t.price-Y.coins})," more coins to purchase this book.",(0,s.jsxs)(n(),{href:"/coins",className:x().getCoinsLink,children:[(0,s.jsx)(r.cEG,{className:x().coinIcon})," Get more coins"]})]})]}),(W||O)&&(0,s.jsxs)("div",{className:x().purchaseSuccess,children:[(0,s.jsx)(r.CMH,{})," You own this book! You can now access the full content."]}),!V&&(0,s.jsxs)("div",{className:x().purchaseLogin,children:[(0,s.jsxs)(n(),{href:"/login",className:x().loginLink,children:[(0,s.jsx)(r.x$1,{className:x().userIcon})," Log in"]}),"to purchase this premium book.",!1]})]}),(0,s.jsx)("div",{className:x().actions,children:t.isCustomUrl?(0,s.jsxs)("button",{onClick:()=>{if(!t)return void console.error("Cannot open custom URL: Book data is missing");try{E(!0);let e=t.customURLPDF||t.pdfUrl;console.log("Opening custom URL PDF:",e);try{fetch(h.Sn.BOOKS.DOWNLOAD(o),{method:"POST"}).then(()=>{i(e=>({...e,downloads:(e.downloads||0)+1})),window.open(e,"_blank")}).catch(o=>{console.warn("Failed to record download count for custom URL:",o),window.open(e,"_blank")}).finally(()=>{E(!1)})}catch(o){console.error("Error opening custom URL:",o),window.open(e,"_blank"),E(!1)}}catch(e){console.error("Error opening custom URL:",e),alert("Failed to open the PDF. Please try again or contact support if the problem persists."),E(!1)}},className:"".concat(x().openUrlButton," ").concat(!q||W||O?"":x().disabledButton),disabled:C||q&&!W&&!O,children:[(0,s.jsx)(r.t69,{})," ",C?"Opening...":"Open PDF"]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("button",{onClick:$,className:"".concat(x().viewButton," ").concat(!q||W||O?"":x().disabledButton),disabled:w||q&&!W&&!O,children:[(0,s.jsx)(r.t69,{})," ",w?"Opening...":"View PDF"]}),(0,s.jsxs)("button",{onClick:ee,className:"".concat(x().downloadButton," ").concat(!q||W||O?"":x().disabledButton),disabled:_||q&&!W&&!O,children:[(0,s.jsx)(r.WCW,{})," ",_?"Downloading...":"Download PDF"]})]})})]})]}),(0,s.jsx)(f,{bookId:o})]}),U&&(0,s.jsx)("div",{className:x().confirmationOverlay,children:(0,s.jsxs)("div",{className:x().confirmationDialog,children:[(0,s.jsx)("h3",{children:"Confirm Purchase"}),(0,s.jsxs)("p",{children:['Are you sure you want to purchase "',t.title,'" for ',t.price," coins?"]}),(0,s.jsxs)("div",{className:x().confirmationButtons,children:[(0,s.jsx)("button",{onClick:()=>{H(!1)},className:x().cancelButton,children:"Cancel"}),(0,s.jsx)("button",{onClick:eo,className:x().confirmButton,children:"Confirm Purchase"})]})]})}),p&&y&&(0,s.jsx)(N,{pdfUrl:y,onClose:()=>{b(!1),S(null)},title:t.title,allowDownload:!0,onDownload:ee})]}):(0,s.jsxs)("div",{className:x().error,children:[(0,s.jsx)("h2",{children:"Book Not Found"}),(0,s.jsx)("p",{children:"We couldn't find the book you're looking for."}),(0,s.jsxs)(n(),{href:"/search",className:x().backButton,children:[(0,s.jsx)(r.QVr,{})," Back to Search"]})]})}},71759:e=>{e.exports={container:"book_container__t7HpC",backButton:"book_backButton__vDnG6",bookDetailContainer:"book_bookDetailContainer__v_R0K",bookInformation:"book_bookInformation__StZ6g",bookCover:"book_bookCover__wj7vL",premiumOverlay:"book_premiumOverlay__U1vfK",lockIcon:"book_lockIcon__F6QwL",lockIconPlaceholder:"book_lockIconPlaceholder__moAc7",premiumBadge:"book_premiumBadge__MoqZw",crownIcon:"book_crownIcon__tVYMH",categoryInfo:"book_categoryInfo__Bu7tP",premiumTag:"book_premiumTag__EMpPl",premiumIcon:"book_premiumIcon__3M5jJ",premiumMessage:"book_premiumMessage__XV4N8",lockIconMessage:"book_lockIconMessage__46A1_",loginLink:"book_loginLink__vAMwB",disabledButton:"book_disabledButton__TW6dJ",placeholderCover:"book_placeholderCover__5P_sO",title:"book_title__xHEy4",author:"book_author__FsqOe",category:"book_category__zzF9H",stats:"book_stats__wU7Ul",stat:"book_stat__mAw2q",description:"book_description__T_l8Y",tags:"book_tags__gKDwb",tagList:"book_tagList__Gixb3",tag:"book_tag__Kk0Gj",noTags:"book_noTags__Qq9um",actions:"book_actions__zgoNS",viewButton:"book_viewButton__yhdR4",downloadButton:"book_downloadButton__xSZiq",openUrlButton:"book_openUrlButton__rZVel",loading:"book_loading__jGrZj",error:"book_error__olOYE",buttonGroup:"book_buttonGroup__1dUE_",loadingContainer:"book_loadingContainer__IEHKf",loadingSpinner:"book_loadingSpinner__PQ2dU",spin:"book_spin__v3jCK",actionButtons:"book_actionButtons__4FEwM",searchButton:"book_searchButton__YOZRF",errorDetails:"book_errorDetails__zCEXA",premiumPurchaseContainer:"book_premiumPurchaseContainer__nB9yX",premiumPrice:"book_premiumPrice__wmzKZ",coinIcon:"book_coinIcon__5w8cr",priceValue:"book_priceValue__xy2Zn",purchaseButton:"book_purchaseButton__HQhwt",purchaseError:"book_purchaseError___ubRi",purchaseSuccess:"book_purchaseSuccess__ekger",insufficientCoins:"book_insufficientCoins__gGYYV",getCoinsLink:"book_getCoinsLink__nvlTT",confirmationOverlay:"book_confirmationOverlay__Yc4oV",confirmationDialog:"book_confirmationDialog__Qnw0H",fadeIn:"book_fadeIn__B4bvh",confirmationButtons:"book_confirmationButtons__C0Pf2",cancelButton:"book_cancelButton__pmZIc",confirmButton:"book_confirmButton__51wVy"}}}]);