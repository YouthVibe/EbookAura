(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7793],{53716:e=>{e.exports={container:"profile_container__CYebx",profileContainer:"profile_profileContainer__4OeWo",header:"profile_header___W3PQ",headerTitle:"profile_headerTitle__WkqHY",headerSubtitle:"profile_headerSubtitle__JOkrx",backLink:"profile_backLink__3pML1",backIcon:"profile_backIcon___GAPa",profileContent:"profile_profileContent__eyz94",avatarSection:"profile_avatarSection__fZnTm",avatar:"profile_avatar__f2UDF",editAvatarButton:"profile_editAvatarButton__OGJpb",editIcon:"profile_editIcon__7Ufqs",infoSection:"profile_infoSection__P_hRi",infoHeader:"profile_infoHeader__ACTom",infoTitle:"profile_infoTitle__hsoqk",editButton:"profile_editButton__oGUfC",infoGrid:"profile_infoGrid__PmkTz",infoItem:"profile_infoItem__FgGdu",infoLabel:"profile_infoLabel__6oEHc",infoValue:"profile_infoValue__RSQP1",bioSection:"profile_bioSection__s4LcX",bioHeader:"profile_bioHeader__9bOZJ",bioTitle:"profile_bioTitle__bTV9Y",bioContent:"profile_bioContent__M_7_O",noBioMessage:"profile_noBioMessage__2bFjw",loading:"profile_loading__P1qhx",loadingAnimation:"profile_loadingAnimation__MyJOS",spin:"profile_spin__B8_d_",errorMessage:"profile_errorMessage__3vub5",shake:"profile_shake__KgFvi",actionButtons:"profile_actionButtons__rDFEg",logoutButton:"profile_logoutButton__Vjcxn",editProfileButton:"profile_editProfileButton__dgAm8",uploadForm:"profile_uploadForm__WDk1V",fadeIn:"profile_fadeIn__vOW1W",formGroup:"profile_formGroup__umLr_",formRow:"profile_formRow__swpY5",textInput:"profile_textInput__XYias",numberInput:"profile_numberInput__5GsXd",textArea:"profile_textArea__UcFai",categoryInput:"profile_categoryInput__c0odF",tagInput:"profile_tagInput__S_aRB",charCount:"profile_charCount__UOhZi",fileInputContainer:"profile_fileInputContainer__QdFRD",fileInput:"profile_fileInput__X2Y3n",fileInputLabel:"profile_fileInputLabel__E_sOg",uploadIcon:"profile_uploadIcon__XYwxx",fileName:"profile_fileName__KU6lp",uploadButton:"profile_uploadButton__Qsq70",successMessage:"profile_successMessage__q9API",slideDown:"profile_slideDown__xNbZ4",tagInputContainer:"profile_tagInputContainer__YsqsA",selectedTags:"profile_selectedTags__iagaH",tag:"profile_tag__hGgEH",removeTag:"profile_removeTag__sheY8",tagInputWrapper:"profile_tagInputWrapper__7v04N",addTagButton:"profile_addTagButton__yisKO",tagSuggestions:"profile_tagSuggestions__IMG8P",tagSuggestion:"profile_tagSuggestion__ImHcn",categoryInputContainer:"profile_categoryInputContainer__qmXMK",selectedCategory:"profile_selectedCategory__wQRhV",removeCategory:"profile_removeCategory__7aYKa",categoryInputWrapper:"profile_categoryInputWrapper__wCYTS",addCategoryButton:"profile_addCategoryButton__DSAU2",categorySuggestions:"profile_categorySuggestions__ZmhOe",categorySuggestion:"profile_categorySuggestion__BK7q_",spinner:"profile_spinner__0gF1W",adminButton:"profile_adminButton__KhZ97",buttonIcon:"profile_buttonIcon__CHlaF",closeErrorButton:"profile_closeErrorButton__AWv_8",closeSuccessButton:"profile_closeSuccessButton__gl9ox",notificationAlert:"profile_notificationAlert__jWune",fadeInDown:"profile_fadeInDown__i3Fng",progressContainer:"profile_progressContainer__07yVO",completed:"profile_completed__FjM8x",statusText:"profile_statusText__6Zsux",tagLimitInfo:"profile_tagLimitInfo__iVqvG",tagCount:"profile_tagCount__j4tJm",fileRequirements:"profile_fileRequirements__fzpa8",error:"profile_error__423wL",success:"profile_success__XRSVu",charCountWarning:"profile_charCountWarning__3m8ec",fileSize:"profile_fileSize__RInI1",charCountError:"profile_charCountError__riiQL",pdfInputSection:"profile_pdfInputSection__PymR3",pdfInputTabs:"profile_pdfInputTabs__ggHZP",pdfInputTab:"profile_pdfInputTab__y7tDy",activeTab:"profile_activeTab__1AMUy",tabIcon:"profile_tabIcon__gnaRN",urlInputContainer:"profile_urlInputContainer__QXGyY",urlInputLabel:"profile_urlInputLabel__33236",urlIcon:"profile_urlIcon__dctPX",urlInput:"profile_urlInput__9_dB7",urlInputHelp:"profile_urlInputHelp__5ofU6",urlExamples:"profile_urlExamples__jCIpR",urlExampleTitle:"profile_urlExampleTitle__Do5d5",urlExampleList:"profile_urlExampleList__p0XwI"}},56068:(e,o,t)=>{"use strict";t.d(o,{AuthProvider:()=>s,h:()=>p});var r=t(95155),i=t(12115),n=t(35695),a=t(72047);let l=(0,i.createContext)(),_=()=>"ak_"+Array.from(crypto.getRandomValues(new Uint8Array(24))).map(e=>e.toString(16).padStart(2,"0")).join(""),s=e=>{let{children:o}=e,[t,s]=(0,i.useState)(null),[p,c]=(0,i.useState)(!0),[u,f]=(0,i.useState)(!1),g=(0,n.useRouter)(),d=(0,i.useRef)(!1),m=(0,i.useRef)(!1);(0,i.useEffect)(()=>{f(!0),(async()=>{try{let e=localStorage.getItem("userInfo"),o=localStorage.getItem("token");if(localStorage.getItem("apiKey"),e&&o)try{if(s(JSON.parse(e)),!d.current&&!m.current){d.current=!0;try{await (0,a.dw)("/auth/check",{headers:{Authorization:"Bearer ".concat(o)}}),m.current=!0}catch(e){if(console.error("Token validation failed:",e),"localhost"!==window.location.hostname)try{console.log("Retrying token validation..."),await new Promise(e=>setTimeout(e,1e3)),await (0,a.dw)("/auth/check",{headers:{Authorization:"Bearer ".concat(o)}}),m.current=!0}catch(e){console.error("Token validation retry failed:",e),h()}else h()}finally{d.current=!1}}}catch(e){console.error("Failed to parse user info:",e),localStorage.removeItem("userInfo"),localStorage.removeItem("token"),localStorage.removeItem("apiKey")}}finally{c(!1)}})()},[]);let I=e=>{if(console.log("Processing login data"),!e)return void console.error("No user data received for login");try{if(!e.token)return void console.error("No token in login data");let{token:o,...t}=e;console.log("Setting user data:",t),s(t);{localStorage.setItem("userInfo",JSON.stringify(t)),localStorage.setItem("token",o);let e=localStorage.getItem("apiKey");e||(console.log("Generating new API key"),e=_(),localStorage.setItem("apiKey",e)),console.log("Authentication data stored in localStorage")}}catch(e){console.error("Error processing login:",e)}},h=()=>{s(null),localStorage.removeItem("userInfo"),localStorage.removeItem("token"),g.push("/login")},y=()=>localStorage.getItem("token"),S=()=>localStorage.getItem("apiKey"),b=e=>{if(t){let o={...t,coins:e};s(o),localStorage.setItem("userInfo",JSON.stringify(o))}};return u?(0,r.jsx)(l.Provider,{value:{user:t,isLoggedIn:!!t,loading:p,login:I,logout:h,getToken:y,getApiKey:S,updateUserCoins:b},children:o}):(0,r.jsx)(l.Provider,{value:{user:null,isLoggedIn:!1,loading:!0,login:I,logout:h,getToken:y,getApiKey:S,updateUserCoins:b},children:o})},p=()=>{let e=(0,i.useContext)(l);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},72047:(e,o,t)=>{"use strict";async function r(e){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{let t=e.startsWith("http")?e:"".concat("http://localhost:5000/api").concat(e);console.log("API Request: ".concat(o.method||"GET"," ").concat(t)),o.headers||(o.headers={}),!o.body||o.headers["Content-Type"]||o.body instanceof FormData||(o.headers["Content-Type"]="application/json");let r=e.startsWith("/books")&&("GET"===o.method||!o.method)&&!e.includes("/reviews")&&!e.includes("/bookmarks"),i=e.match(/^\/books\/[a-z0-9]+$/i);{let e=localStorage.getItem("token"),t=localStorage.getItem("apiKey");e&&(!r||i)&&!o.headers.Authorization&&(o.headers.Authorization="Bearer ".concat(e)),t&&!o.headers["X-API-Key"]&&(o.headers["X-API-Key"]=t)}let n=await fetch(t,o),a=n.headers.get("content-type");if(!n.ok){if(console.error("API Error (".concat(n.status,"): ").concat(n.statusText)),a&&a.includes("application/json")){let e=await n.json();throw Error(e.message||"API request failed with status ".concat(n.status))}{let e=await n.text();console.error("Non-JSON error response:",e.substring(0,150)+"...");let o="API request failed with status ".concat(n.status);if(e.includes("<title>")&&e.includes("</title>")){let t=e.match(/<title>(.*?)<\/title>/i);t&&t[1]&&(o="Server Error: ".concat(t[1]))}throw Error(o)}}if(e.match(/^\/books\/[a-z0-9]+$/i)&&a&&a.includes("application/json"))try{let e=await n.json();return e&&"object"==typeof e&&(console.log("Raw premium data from API:",{isPremium:e.isPremium,isPremiumType:typeof e.isPremium,price:e.price,priceType:typeof e.price}),e.price&&"object"==typeof e.price&&e.price.$numberLong&&(e.price=Number(e.price.$numberLong),console.log("Extracted $numberLong price:",e.price)),"isPremium"in e&&(e.isPremium=!0===e.isPremium||"true"===e.isPremium||1===e.isPremium||"true"===String(e.isPremium).toLowerCase()),"price"in e&&(e.price=Number(e.price||0)),!e.isPremium&&e.price>0&&(e.isPremium=!0,console.log("API Utils: Setting isPremium=true based on price > 0")),console.log("API Utils - Processed book details:",{title:e.title,isPremium:e.isPremium,price:e.price})),e}catch(e){throw console.error("Error parsing book details:",e),e}if(a&&a.includes("application/json"))return await n.json();{console.warn("Response is not JSON. Content-Type:",a);let e=await n.text();try{return JSON.parse(e)}catch(e){throw console.error("Failed to parse response as JSON:",e),Error("API response was not valid JSON")}}}catch(e){throw console.error("API request error:",e),e}}async function i(e){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return r(e,{method:"GET",...o})}async function n(e,o){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return r(e,{method:"POST",body:o instanceof FormData?o:JSON.stringify(o),...t})}async function a(e,o){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return r(e,{method:"PUT",body:JSON.stringify(o),...t})}async function l(e){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return r(e,{method:"DELETE",...o})}async function _(e,o){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return r(e,{method:"PATCH",body:JSON.stringify(o),...t})}t.d(o,{TA:()=>_,Xj:()=>n,_5:()=>l,dw:()=>i,q1:()=>a})}}]);