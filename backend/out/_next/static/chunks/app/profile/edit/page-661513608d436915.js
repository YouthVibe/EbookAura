(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4029],{43804:(e,t,a)=>{Promise.resolve().then(a.bind(a,68857))},56068:(e,t,a)=>{"use strict";a.d(t,{AuthProvider:()=>c,h:()=>d});var r=a(95155),o=a(12115),n=a(35695),s=a(72047);let l=(0,o.createContext)(),i=()=>"ak_"+Array.from(crypto.getRandomValues(new Uint8Array(24))).map(e=>e.toString(16).padStart(2,"0")).join(""),c=e=>{let{children:t}=e,[a,c]=(0,o.useState)(null),[d,u]=(0,o.useState)(!0),[h,m]=(0,o.useState)(!1),f=(0,n.useRouter)();(0,o.useEffect)(()=>{m(!0);let e=localStorage.getItem("userInfo"),t=localStorage.getItem("token");if(localStorage.getItem("apiKey"),e&&t)try{c(JSON.parse(e)),(async()=>{try{await (0,s.dw)("/auth/check",{headers:{Authorization:"Bearer ".concat(t)}})}catch(e){console.error("Token validation failed:",e),p()}})()}catch(e){console.error("Failed to parse user info:",e),localStorage.removeItem("userInfo"),localStorage.removeItem("token"),localStorage.removeItem("apiKey")}u(!1)},[]);let g=e=>{if(console.log("Processing login data"),!e)return void console.error("No user data received for login");try{if(!e.token)return void console.error("No token in login data");let{token:t,...a}=e;console.log("Setting user data:",a),c(a);{localStorage.setItem("userInfo",JSON.stringify(a)),localStorage.setItem("token",t);let e=localStorage.getItem("apiKey");e||(console.log("Generating new API key"),e=i(),localStorage.setItem("apiKey",e)),console.log("Authentication data stored in localStorage")}}catch(e){console.error("Error processing login:",e)}},p=()=>{c(null),localStorage.removeItem("userInfo"),localStorage.removeItem("token"),f.push("/login")},_=()=>localStorage.getItem("token"),N=()=>localStorage.getItem("apiKey");return h?(0,r.jsx)(l.Provider,{value:{user:a,loading:d,login:g,logout:p,getToken:_,getApiKey:N},children:t}):(0,r.jsx)(l.Provider,{value:{user:null,loading:!0,login:g,logout:p,getToken:_,getApiKey:N},children:t})},d=()=>{let e=(0,o.useContext)(l);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},61260:e=>{e.exports={container:"edit_container__tHEsa",formContainer:"edit_formContainer__nUXlN",header:"edit_header__KC1Q4",headerTitle:"edit_headerTitle__3JXz4",headerSubtitle:"edit_headerSubtitle__4L4rw",backLink:"edit_backLink__JBaTR",backIcon:"edit_backIcon__qesfS",form:"edit_form__4ZZSn",formGroup:"edit_formGroup__ruRrO",label:"edit_label__Wai4g",input:"edit_input__IG8lx",textarea:"edit_textarea__tXI0N",helpText:"edit_helpText__yWgMm",buttonContainer:"edit_buttonContainer__u8Yyy",cancelButton:"edit_cancelButton__hmr0k",saveButton:"edit_saveButton__CtYMW",saveIcon:"edit_saveIcon__BKQUB",loading:"edit_loading__4mwlh",loadingAnimation:"edit_loadingAnimation__Y1Uh2",spin:"edit_spin__tKFAb",errorMessage:"edit_errorMessage__Ul8be",successMessage:"edit_successMessage__Jo6Pk"}},68857:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>m});var r=a(95155),o=a(72047),n=a(12115),s=a(35695),l=a(6874),i=a.n(l);a(66766);var c=a(29911),d=a(56068),u=a(61260),h=a.n(u);function m(){let{user:e,login:t,getToken:a}=(0,d.h)(),l=(0,s.useRouter)(),[u,m]=(0,n.useState)(!0),[f,g]=(0,n.useState)(!1),[p,_]=(0,n.useState)(""),[N,v]=(0,n.useState)(""),[y,b]=(0,n.useState)({name:"",fullName:"",bio:""});(0,n.useEffect)(()=>{if(!e&&!u)return void l.push("/login");e&&x()},[e,l]);let x=async()=>{m(!0),_("");try{let e=a();if(!e)throw Error("No authentication token found");let t=await (0,o.dw)("/users/profile",{headers:{Authorization:"Bearer ".concat(e)}});b({name:t.name||"",fullName:t.fullName||"",bio:t.bio||""})}catch(e){console.error("Error fetching profile data:",e),_(e.message||"An error occurred while fetching your profile")}finally{m(!1)}},S=e=>{let{name:t,value:a}=e.target;b(e=>({...e,[t]:a}))},j=async r=>{r.preventDefault(),g(!0),_(""),v("");try{let r=a();if(!r)throw Error("No authentication token found");let n=await (0,o.q1)("/users/profile",y,{headers:{Authorization:"Bearer ".concat(r)}});t({...e,name:n.name,fullName:n.fullName}),v("Profile updated successfully!"),setTimeout(()=>{l.push("/profile")},1500)}catch(e){console.error("Error updating profile:",e),_(e.message||"An error occurred while updating your profile")}finally{g(!1)}};return u?(0,r.jsx)("div",{className:h().container,children:(0,r.jsx)("div",{className:h().formContainer,children:(0,r.jsx)("div",{className:h().loading,children:(0,r.jsx)("div",{className:h().loadingAnimation})})})}):e?(0,r.jsx)("div",{className:h().container,children:(0,r.jsxs)("div",{className:h().formContainer,children:[(0,r.jsxs)("div",{className:h().header,children:[(0,r.jsxs)(i(),{href:"/profile",className:h().backLink,children:[(0,r.jsx)(c.QVr,{className:h().backIcon}),"Back to Profile"]}),(0,r.jsx)("h1",{className:h().headerTitle,children:"Edit Profile"}),(0,r.jsx)("p",{className:h().headerSubtitle,children:"Update your personal information"})]}),p&&(0,r.jsx)("div",{className:h().errorMessage,children:p}),N&&(0,r.jsx)("div",{className:h().successMessage,children:N}),(0,r.jsxs)("form",{onSubmit:j,className:h().form,children:[(0,r.jsxs)("div",{className:h().formGroup,children:[(0,r.jsx)("label",{htmlFor:"name",className:h().label,children:"Username"}),(0,r.jsx)("input",{type:"text",id:"name",name:"name",value:y.name,onChange:S,className:h().input,placeholder:"Enter username",required:!0,minLength:3}),(0,r.jsx)("p",{className:h().helpText,children:"Username must be at least 3 characters."})]}),(0,r.jsxs)("div",{className:h().formGroup,children:[(0,r.jsx)("label",{htmlFor:"fullName",className:h().label,children:"Full Name"}),(0,r.jsx)("input",{type:"text",id:"fullName",name:"fullName",value:y.fullName,onChange:S,className:h().input,placeholder:"Enter your full name",required:!0})]}),(0,r.jsxs)("div",{className:h().formGroup,children:[(0,r.jsx)("label",{htmlFor:"bio",className:h().label,children:"Bio"}),(0,r.jsx)("textarea",{id:"bio",name:"bio",value:y.bio,onChange:S,className:h().textarea,placeholder:"Write something about yourself",rows:5}),(0,r.jsx)("p",{className:h().helpText,children:"Tell us a bit about yourself, your interests, and your reading preferences."})]}),(0,r.jsxs)("div",{className:h().buttonContainer,children:[(0,r.jsx)(i(),{href:"/profile",className:h().cancelButton,children:"Cancel"}),(0,r.jsx)("button",{type:"submit",className:h().saveButton,disabled:f,children:f?"Saving...":(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(c.dIn,{className:h().saveIcon}),"Save Changes"]})})]})]})]})}):null}},72047:(e,t,a)=>{"use strict";async function r(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{let a=e.startsWith("http")?e:"".concat("https://ebookaura.onrender.com/api").concat(e);if(console.log("API Request: ".concat(t.method||"GET"," ").concat(a)),t.headers||(t.headers={}),!t.body||t.headers["Content-Type"]||t.body instanceof FormData||(t.headers["Content-Type"]="application/json"),!(e.startsWith("/books")&&("GET"===t.method||!t.method)&&!e.includes("/reviews")&&!e.includes("/bookmarks"))){let e=localStorage.getItem("token"),a=localStorage.getItem("apiKey");e&&!t.headers.Authorization&&(t.headers.Authorization="Bearer ".concat(e)),a&&!t.headers["X-API-Key"]&&(t.headers["X-API-Key"]=a)}let r=await fetch(a,t),o=r.headers.get("content-type");if(!r.ok){if(console.error("API Error (".concat(r.status,"): ").concat(r.statusText)),o&&o.includes("application/json")){let e=await r.json();throw Error(e.message||"API request failed with status ".concat(r.status))}{let e=await r.text();console.error("Non-JSON error response:",e.substring(0,150)+"...");let t="API request failed with status ".concat(r.status);if(e.includes("<title>")&&e.includes("</title>")){let a=e.match(/<title>(.*?)<\/title>/i);a&&a[1]&&(t="Server Error: ".concat(a[1]))}throw Error(t)}}if(o&&o.includes("application/json"))return await r.json();{console.warn("Response is not JSON. Content-Type:",o);let e=await r.text();try{return JSON.parse(e)}catch(e){throw console.error("Failed to parse response as JSON:",e),Error("API response was not valid JSON")}}}catch(e){throw console.error("API request error:",e),e}}async function o(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return r(e,{method:"GET",...t})}async function n(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return r(e,{method:"POST",body:t instanceof FormData?t:JSON.stringify(t),...a})}async function s(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return r(e,{method:"PUT",body:JSON.stringify(t),...a})}async function l(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return r(e,{method:"DELETE",...t})}a.d(t,{Xj:()=>n,_5:()=>l,dw:()=>o,q1:()=>s})}},e=>{var t=t=>e(e.s=t);e.O(0,[199,6711,6874,7733,8441,1684,7358],()=>t(43804)),_N_E=e.O()}]);