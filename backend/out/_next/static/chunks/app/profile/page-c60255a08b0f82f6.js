(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[636],{2047:(e,o,t)=>{"use strict";async function a(e){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{let t="".concat("https://ebookaura.onrender.com/api").concat(e);console.log("API Request: ".concat(o.method||"GET"," ").concat(t)),o.headers||(o.headers={}),!o.body||o.headers["Content-Type"]||o.body instanceof FormData||(o.headers["Content-Type"]="application/json");{let e=localStorage.getItem("token"),t=localStorage.getItem("apiKey");e&&t&&(o.headers.Authorization="Bearer ".concat(e),o.headers["X-API-Key"]=t)}let a=await fetch(t,o),r=a.headers.get("content-type");if(!a.ok){if(console.error("API Error (".concat(a.status,"): ").concat(a.statusText)),r&&r.includes("application/json")){let e=await a.json();throw Error(e.message||"API request failed with status ".concat(a.status))}{let e=await a.text();console.error("Non-JSON error response:",e.substring(0,150)+"...");let o="API request failed with status ".concat(a.status);if(e.includes("<title>")&&e.includes("</title>")){let t=e.match(/<title>(.*?)<\/title>/i);t&&t[1]&&(o="Server Error: ".concat(t[1]))}throw Error(o)}}if(r&&r.includes("application/json"))return await a.json();{console.warn("Response is not JSON. Content-Type:",r);let e=await a.text();try{return JSON.parse(e)}catch(e){throw console.error("Failed to parse response as JSON:",e),Error("API response was not valid JSON")}}}catch(e){throw console.error("API request error:",e),e}}async function r(e){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return a(e,{method:"GET",...o})}async function i(e,o){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return a(e,{method:"POST",body:o instanceof FormData?o:JSON.stringify(o),...t})}async function n(e,o){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return a(e,{method:"PUT",body:JSON.stringify(o),...t})}async function l(e){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return a(e,{method:"DELETE",...o})}t.d(o,{Xj:()=>i,_5:()=>l,dw:()=>r,q1:()=>n})},6068:(e,o,t)=>{"use strict";t.d(o,{AuthProvider:()=>c,h:()=>d});var a=t(5155),r=t(2115),i=t(5695),n=t(2047);let l=(0,r.createContext)(),s=()=>"ak_"+Array.from(crypto.getRandomValues(new Uint8Array(24))).map(e=>e.toString(16).padStart(2,"0")).join(""),c=e=>{let{children:o}=e,[t,c]=(0,r.useState)(null),[d,_]=(0,r.useState)(!0),[f,p]=(0,r.useState)(!1),u=(0,i.useRouter)();(0,r.useEffect)(()=>{p(!0);let e=localStorage.getItem("userInfo"),o=localStorage.getItem("token");if(localStorage.getItem("apiKey"),e&&o)try{c(JSON.parse(e)),(async()=>{try{await (0,n.dw)("/auth/check",{headers:{Authorization:"Bearer ".concat(o)}})}catch(e){console.error("Token validation failed:",e),h()}})()}catch(e){console.error("Failed to parse user info:",e),localStorage.removeItem("userInfo"),localStorage.removeItem("token"),localStorage.removeItem("apiKey")}_(!1)},[]);let g=e=>{if(console.log("Processing login data"),!e)return void console.error("No user data received for login");try{if(!e.token)return void console.error("No token in login data");let{token:o,...t}=e;console.log("Setting user data:",t),c(t);{localStorage.setItem("userInfo",JSON.stringify(t)),localStorage.setItem("token",o);let e=localStorage.getItem("apiKey");e||(console.log("Generating new API key"),e=s(),localStorage.setItem("apiKey",e)),console.log("Authentication data stored in localStorage")}}catch(e){console.error("Error processing login:",e)}},h=()=>{c(null),localStorage.removeItem("userInfo"),localStorage.removeItem("token"),u.push("/login")},m=()=>localStorage.getItem("token"),x=()=>localStorage.getItem("apiKey");return f?(0,a.jsx)(l.Provider,{value:{user:t,loading:d,login:g,logout:h,getToken:m,getApiKey:x},children:o}):(0,a.jsx)(l.Provider,{value:{user:null,loading:!0,login:g,logout:h,getToken:m,getApiKey:x},children:o})},d=()=>{let e=(0,r.useContext)(l);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},7687:e=>{e.exports={container:"profile_container__CYebx",profileContainer:"profile_profileContainer__4OeWo",header:"profile_header___W3PQ",headerTitle:"profile_headerTitle__WkqHY",headerSubtitle:"profile_headerSubtitle__JOkrx",backLink:"profile_backLink__3pML1",backIcon:"profile_backIcon___GAPa",profileContent:"profile_profileContent__eyz94",avatarSection:"profile_avatarSection__fZnTm",avatar:"profile_avatar__f2UDF",editAvatarButton:"profile_editAvatarButton__OGJpb",editIcon:"profile_editIcon__7Ufqs",infoSection:"profile_infoSection__P_hRi",infoHeader:"profile_infoHeader__ACTom",infoTitle:"profile_infoTitle__hsoqk",editButton:"profile_editButton__oGUfC",infoGrid:"profile_infoGrid__PmkTz",infoItem:"profile_infoItem__FgGdu",infoLabel:"profile_infoLabel__6oEHc",infoValue:"profile_infoValue__RSQP1",bioSection:"profile_bioSection__s4LcX",bioHeader:"profile_bioHeader__9bOZJ",bioTitle:"profile_bioTitle__bTV9Y",bioContent:"profile_bioContent__M_7_O",noBioMessage:"profile_noBioMessage__2bFjw",loading:"profile_loading__P1qhx",loadingAnimation:"profile_loadingAnimation__MyJOS",spin:"profile_spin__B8_d_",errorMessage:"profile_errorMessage__3vub5",shake:"profile_shake__KgFvi",actionButtons:"profile_actionButtons__rDFEg",logoutButton:"profile_logoutButton__Vjcxn",editProfileButton:"profile_editProfileButton__dgAm8",uploadForm:"profile_uploadForm__WDk1V",fadeIn:"profile_fadeIn__vOW1W",formGroup:"profile_formGroup__umLr_",formRow:"profile_formRow__swpY5",textInput:"profile_textInput__XYias",numberInput:"profile_numberInput__5GsXd",textArea:"profile_textArea__UcFai",categoryInput:"profile_categoryInput__c0odF",tagInput:"profile_tagInput__S_aRB",charCount:"profile_charCount__UOhZi",fileInputContainer:"profile_fileInputContainer__QdFRD",fileInput:"profile_fileInput__X2Y3n",fileInputLabel:"profile_fileInputLabel__E_sOg",uploadIcon:"profile_uploadIcon__XYwxx",fileName:"profile_fileName__KU6lp",uploadButton:"profile_uploadButton__Qsq70",successMessage:"profile_successMessage__q9API",slideDown:"profile_slideDown__xNbZ4",tagInputContainer:"profile_tagInputContainer__YsqsA",selectedTags:"profile_selectedTags__iagaH",tag:"profile_tag__hGgEH",removeTag:"profile_removeTag__sheY8",tagInputWrapper:"profile_tagInputWrapper__7v04N",addTagButton:"profile_addTagButton__yisKO",tagSuggestions:"profile_tagSuggestions__IMG8P",tagSuggestion:"profile_tagSuggestion__ImHcn",categoryInputContainer:"profile_categoryInputContainer__qmXMK",selectedCategory:"profile_selectedCategory__wQRhV",removeCategory:"profile_removeCategory__7aYKa",categoryInputWrapper:"profile_categoryInputWrapper__wCYTS",addCategoryButton:"profile_addCategoryButton__DSAU2",categorySuggestions:"profile_categorySuggestions__ZmhOe",categorySuggestion:"profile_categorySuggestion__BK7q_",spinner:"profile_spinner__0gF1W"}},8250:(e,o,t)=>{Promise.resolve().then(t.bind(t,9822))},9822:(e,o,t)=>{"use strict";t.r(o),t.d(o,{default:()=>u});var a=t(5155),r=t(2047),i=t(2115),n=t(5695),l=t(6874),s=t.n(l),c=t(6766),d=t(9911),_=t(6068),f=t(7687),p=t.n(f);function u(){let{user:e,logout:o,getToken:t}=(0,_.h)(),l=(0,n.useRouter)(),[f,u]=(0,i.useState)(null),[g,h]=(0,i.useState)(!0),[m,x]=(0,i.useState)("");(0,i.useEffect)(()=>{if(!e&&!g)return void l.push("/login");e&&I()},[e,l]);let I=async()=>{h(!0),x("");try{let e=t();if(!e)throw Error("No authentication token found");let o=await (0,r.dw)("/users/profile",{headers:{Authorization:"Bearer ".concat(e)}});u(o)}catch(e){console.error("Error fetching profile data:",e),x(e.message||"An error occurred while fetching your profile")}finally{h(!1)}};return g?(0,a.jsx)("div",{className:p().container,children:(0,a.jsx)("div",{className:p().profileContainer,children:(0,a.jsx)("div",{className:p().loading,children:(0,a.jsx)("div",{className:p().loadingAnimation})})})}):e?(0,a.jsx)("div",{className:p().container,style:{marginTop:"20px"},children:(0,a.jsxs)("div",{className:p().profileContainer,children:[(0,a.jsxs)("div",{className:p().header,children:[(0,a.jsxs)(s(),{href:"/",className:p().backLink,children:[(0,a.jsx)(d.QVr,{className:p().backIcon}),"Back to Home"]}),(0,a.jsx)("h1",{className:p().headerTitle,style:{marginTop:"40px"},children:"My Profile"}),(0,a.jsx)("p",{className:p().headerSubtitle,style:{marginTop:"10px"},children:"Manage your account information"})]}),m&&(0,a.jsx)("div",{className:p().errorMessage,children:m}),f&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:p().avatarSection,children:[(0,a.jsx)(c.default,{src:f.profileImage||"/logo.svg",alt:"Profile",width:120,height:120,className:p().avatar,style:{objectFit:"cover",marginTop:"10px"}}),(0,a.jsxs)(s(),{href:"/profile/upload-image",className:p().editAvatarButton,children:[(0,a.jsx)(d.p5B,{className:p().editIcon}),"Change Photo"]})]}),(0,a.jsxs)("div",{className:p().profileContent,children:[(0,a.jsxs)("div",{className:p().infoSection,children:[(0,a.jsxs)("div",{className:p().infoHeader,children:[(0,a.jsx)("h2",{className:p().infoTitle,children:"Personal Information"}),(0,a.jsxs)(s(),{href:"/profile/edit",className:p().editButton,children:[(0,a.jsx)(d.uO9,{className:p().editIcon}),"Edit"]})]}),(0,a.jsxs)("div",{className:p().infoGrid,children:[(0,a.jsxs)("div",{className:p().infoItem,children:[(0,a.jsx)("p",{className:p().infoLabel,children:"Username"}),(0,a.jsx)("p",{className:p().infoValue,children:f.name})]}),(0,a.jsxs)("div",{className:p().infoItem,children:[(0,a.jsx)("p",{className:p().infoLabel,children:"Full Name"}),(0,a.jsx)("p",{className:p().infoValue,children:f.fullName})]}),(0,a.jsxs)("div",{className:p().infoItem,children:[(0,a.jsx)("p",{className:p().infoLabel,children:"Email"}),(0,a.jsx)("p",{className:p().infoValue,children:f.email})]}),(0,a.jsxs)("div",{className:p().infoItem,children:[(0,a.jsx)("p",{className:p().infoLabel,children:"Account Created"}),(0,a.jsx)("p",{className:p().infoValue,children:new Date(f.createdAt).toLocaleDateString()})]}),(0,a.jsxs)("div",{className:p().infoItem,children:[(0,a.jsx)("p",{className:p().infoLabel,children:"Email Verified"}),(0,a.jsx)("p",{className:p().infoValue,children:f.isEmailVerified?"Yes":"No"})]})]})]}),(0,a.jsxs)("div",{className:p().bioSection,children:[(0,a.jsxs)("div",{className:p().bioHeader,children:[(0,a.jsx)("h2",{className:p().bioTitle,children:"About Me"}),(0,a.jsxs)(s(),{href:"/profile/edit",className:p().editButton,children:[(0,a.jsx)(d.uO9,{className:p().editIcon}),"Edit"]})]}),f.bio?(0,a.jsx)("p",{className:p().bioContent,children:f.bio}):(0,a.jsx)("p",{className:p().noBioMessage,children:"No bio information added yet."})]}),(0,a.jsxs)("div",{className:p().actionButtons,children:[(0,a.jsx)("button",{onClick:()=>{o()},className:p().logoutButton,children:"Log Out"}),(0,a.jsx)(s(),{href:"/profile/edit",className:p().editProfileButton,children:"Edit Profile"}),(0,a.jsxs)(s(),{href:"/settings",className:p().editProfileButton,children:[(0,a.jsx)(d.Pcn,{className:p().buttonIcon}),"Settings"]}),e&&e.isAdmin||f&&f.isAdmin?(0,a.jsx)(s(),{href:"/profile/upload-pdf",className:p().editProfileButton,children:"Upload PDF"}):null]})]})]})]})}):null}}},e=>{var o=o=>e(e.s=o);e.O(0,[119,711,874,733,441,684,358],()=>o(8250)),_N_E=e.O()}]);