(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6636],{29822:(e,o,t)=>{"use strict";t.r(o),t.d(o,{default:()=>u});var r=t(95155),i=t(72047),a=t(12115),n=t(35695),l=t(6874),s=t.n(l),c=t(66766),_=t(29911),d=t(56068),f=t(53716),p=t.n(f);function u(){let{user:e,logout:o,getToken:t}=(0,d.h)(),l=(0,n.useRouter)(),[f,u]=(0,a.useState)(null),[g,h]=(0,a.useState)(!0),[m,I]=(0,a.useState)("");(0,a.useEffect)(()=>{if(!e&&!g)return void l.push("/login");e&&x()},[e,l]);let x=async()=>{h(!0),I("");try{let e=t();if(!e)throw Error("No authentication token found");let o=await (0,i.dw)("/users/profile",{headers:{Authorization:"Bearer ".concat(e)}});u(o)}catch(e){console.error("Error fetching profile data:",e),I(e.message||"An error occurred while fetching your profile")}finally{h(!1)}};return g?(0,r.jsx)("div",{className:p().container,children:(0,r.jsx)("div",{className:p().profileContainer,children:(0,r.jsx)("div",{className:p().loading,children:(0,r.jsx)("div",{className:p().loadingAnimation})})})}):e?(0,r.jsx)("div",{className:p().container,style:{marginTop:"20px"},children:(0,r.jsxs)("div",{className:p().profileContainer,children:[(0,r.jsxs)("div",{className:p().header,children:[(0,r.jsxs)(s(),{href:"/",className:p().backLink,children:[(0,r.jsx)(_.QVr,{className:p().backIcon}),"Back to Home"]}),(0,r.jsx)("h1",{className:p().headerTitle,style:{marginTop:"40px"},children:"My Profile"}),(0,r.jsx)("p",{className:p().headerSubtitle,style:{marginTop:"10px"},children:"Manage your account information"})]}),m&&(0,r.jsx)("div",{className:p().errorMessage,children:m}),f&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:p().avatarSection,children:[(0,r.jsx)(c.default,{src:f.profileImage||"/logo.svg",alt:"Profile",width:120,height:120,className:p().avatar,style:{objectFit:"cover",marginTop:"10px"}}),(0,r.jsxs)(s(),{href:"/profile/upload-image",className:p().editAvatarButton,children:[(0,r.jsx)(_.p5B,{className:p().editIcon}),"Change Photo"]})]}),(0,r.jsxs)("div",{className:p().profileContent,children:[(0,r.jsxs)("div",{className:p().infoSection,children:[(0,r.jsxs)("div",{className:p().infoHeader,children:[(0,r.jsx)("h2",{className:p().infoTitle,children:"Personal Information"}),(0,r.jsxs)(s(),{href:"/profile/edit",className:p().editButton,children:[(0,r.jsx)(_.uO9,{className:p().editIcon}),"Edit"]})]}),(0,r.jsxs)("div",{className:p().infoGrid,children:[(0,r.jsxs)("div",{className:p().infoItem,children:[(0,r.jsx)("p",{className:p().infoLabel,children:"Username"}),(0,r.jsx)("p",{className:p().infoValue,children:f.name})]}),(0,r.jsxs)("div",{className:p().infoItem,children:[(0,r.jsx)("p",{className:p().infoLabel,children:"Full Name"}),(0,r.jsx)("p",{className:p().infoValue,children:f.fullName||"Not provided"})]}),(0,r.jsxs)("div",{className:p().infoItem,children:[(0,r.jsx)("p",{className:p().infoLabel,children:"Email"}),(0,r.jsx)("p",{className:p().infoValue,style:{wordBreak:"break-word"},children:f.email})]}),(0,r.jsxs)("div",{className:p().infoItem,children:[(0,r.jsx)("p",{className:p().infoLabel,children:"Account Created"}),(0,r.jsx)("p",{className:p().infoValue,children:new Date(f.createdAt).toLocaleDateString()})]}),(0,r.jsxs)("div",{className:p().infoItem,children:[(0,r.jsx)("p",{className:p().infoLabel,children:"Email Verified"}),(0,r.jsx)("p",{className:p().infoValue,children:f.isEmailVerified?"Yes":"No"})]}),(e&&e.isAdmin||f&&f.isAdmin)&&(0,r.jsxs)("div",{className:p().infoItem,children:[(0,r.jsx)("p",{className:p().infoLabel,children:"Admin Status"}),(0,r.jsx)("p",{className:p().infoValue,style:{color:"#e63946",fontWeight:"bold"},children:"Administrator"})]})]})]}),(0,r.jsxs)("div",{className:p().bioSection,children:[(0,r.jsxs)("div",{className:p().bioHeader,children:[(0,r.jsx)("h2",{className:p().bioTitle,children:"About Me"}),(0,r.jsxs)(s(),{href:"/profile/edit",className:p().editButton,children:[(0,r.jsx)(_.uO9,{className:p().editIcon}),"Edit"]})]}),f.bio?(0,r.jsx)("p",{className:p().bioContent,children:f.bio}):(0,r.jsx)("p",{className:p().noBioMessage,children:"No bio information added yet."})]}),(0,r.jsxs)("div",{className:p().actionButtons,children:[e&&e.isAdmin||f&&f.isAdmin?(0,r.jsxs)(s(),{href:"/profile/upload-pdf",className:"".concat(p().editProfileButton," ").concat(p().adminButton),style:{backgroundColor:"#e63946",color:"white",fontWeight:"bold",display:"flex",alignItems:"center",justifyContent:"center",gap:"0.5rem"},children:[(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",viewBox:"0 0 16 16",children:(0,r.jsx)("path",{d:"M8 2a5.53 5.53 0 0 0-3.594 1.342c-.766.66-1.321 1.52-1.464 2.383C1.266 6.095 0 7.555 0 9.318 0 11.366 1.708 13 3.781 13h8.906C14.502 13 16 11.57 16 9.773c0-1.636-1.242-2.969-2.834-3.194C12.923 3.999 10.69 2 8 2zm2.354 5.146a.5.5 0 0 1-.708.708L8.5 6.707V10.5a.5.5 0 0 1-1 0V6.707L6.354 7.854a.5.5 0 1 1-.708-.708l2-2a.5.5 0 0 1 .708 0l2 2z"})}),"Upload PDF"]}):null,(0,r.jsx)(s(),{href:"/profile/edit",className:p().editProfileButton,children:"Edit Profile"}),(0,r.jsxs)(s(),{href:"/profile/api-keys",className:p().editProfileButton,style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"0.5rem"},children:[(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",viewBox:"0 0 16 16",children:(0,r.jsx)("path",{d:"M3.5 11.5a3.5 3.5 0 1 1 3.163-5H14L15.5 8 14 9.5l-1-1-1 1-1-1-1 1-1-1-1 1H6.663a3.5 3.5 0 0 1-3.163 2zM2.5 9a1 1 0 1 0 0-2 1 1 0 0 0 0 2z"})}),"API Keys"]}),(0,r.jsxs)(s(),{href:"/settings",className:p().editProfileButton,children:[(0,r.jsx)(_.Pcn,{className:p().buttonIcon}),"Settings"]}),(0,r.jsx)("button",{onClick:()=>{o()},className:p().logoutButton,children:"Log Out"})]})]})]})]})}):null}},48250:(e,o,t)=>{Promise.resolve().then(t.bind(t,29822))},53716:e=>{e.exports={container:"profile_container__CYebx",profileContainer:"profile_profileContainer__4OeWo",header:"profile_header___W3PQ",headerTitle:"profile_headerTitle__WkqHY",headerSubtitle:"profile_headerSubtitle__JOkrx",backLink:"profile_backLink__3pML1",backIcon:"profile_backIcon___GAPa",profileContent:"profile_profileContent__eyz94",avatarSection:"profile_avatarSection__fZnTm",avatar:"profile_avatar__f2UDF",editAvatarButton:"profile_editAvatarButton__OGJpb",editIcon:"profile_editIcon__7Ufqs",infoSection:"profile_infoSection__P_hRi",infoHeader:"profile_infoHeader__ACTom",infoTitle:"profile_infoTitle__hsoqk",editButton:"profile_editButton__oGUfC",infoGrid:"profile_infoGrid__PmkTz",infoItem:"profile_infoItem__FgGdu",infoLabel:"profile_infoLabel__6oEHc",infoValue:"profile_infoValue__RSQP1",bioSection:"profile_bioSection__s4LcX",bioHeader:"profile_bioHeader__9bOZJ",bioTitle:"profile_bioTitle__bTV9Y",bioContent:"profile_bioContent__M_7_O",noBioMessage:"profile_noBioMessage__2bFjw",loading:"profile_loading__P1qhx",loadingAnimation:"profile_loadingAnimation__MyJOS",spin:"profile_spin__B8_d_",errorMessage:"profile_errorMessage__3vub5",shake:"profile_shake__KgFvi",actionButtons:"profile_actionButtons__rDFEg",logoutButton:"profile_logoutButton__Vjcxn",editProfileButton:"profile_editProfileButton__dgAm8",uploadForm:"profile_uploadForm__WDk1V",fadeIn:"profile_fadeIn__vOW1W",formGroup:"profile_formGroup__umLr_",formRow:"profile_formRow__swpY5",textInput:"profile_textInput__XYias",numberInput:"profile_numberInput__5GsXd",textArea:"profile_textArea__UcFai",categoryInput:"profile_categoryInput__c0odF",tagInput:"profile_tagInput__S_aRB",charCount:"profile_charCount__UOhZi",fileInputContainer:"profile_fileInputContainer__QdFRD",fileInput:"profile_fileInput__X2Y3n",fileInputLabel:"profile_fileInputLabel__E_sOg",uploadIcon:"profile_uploadIcon__XYwxx",fileName:"profile_fileName__KU6lp",uploadButton:"profile_uploadButton__Qsq70",successMessage:"profile_successMessage__q9API",slideDown:"profile_slideDown__xNbZ4",tagInputContainer:"profile_tagInputContainer__YsqsA",selectedTags:"profile_selectedTags__iagaH",tag:"profile_tag__hGgEH",removeTag:"profile_removeTag__sheY8",tagInputWrapper:"profile_tagInputWrapper__7v04N",addTagButton:"profile_addTagButton__yisKO",tagSuggestions:"profile_tagSuggestions__IMG8P",tagSuggestion:"profile_tagSuggestion__ImHcn",categoryInputContainer:"profile_categoryInputContainer__qmXMK",selectedCategory:"profile_selectedCategory__wQRhV",removeCategory:"profile_removeCategory__7aYKa",categoryInputWrapper:"profile_categoryInputWrapper__wCYTS",addCategoryButton:"profile_addCategoryButton__DSAU2",categorySuggestions:"profile_categorySuggestions__ZmhOe",categorySuggestion:"profile_categorySuggestion__BK7q_",spinner:"profile_spinner__0gF1W",adminButton:"profile_adminButton__KhZ97",buttonIcon:"profile_buttonIcon__CHlaF",closeErrorButton:"profile_closeErrorButton__AWv_8",closeSuccessButton:"profile_closeSuccessButton__gl9ox",notificationAlert:"profile_notificationAlert__jWune",fadeInDown:"profile_fadeInDown__i3Fng",progressContainer:"profile_progressContainer__07yVO",completed:"profile_completed__FjM8x",statusText:"profile_statusText__6Zsux",tagLimitInfo:"profile_tagLimitInfo__iVqvG",tagCount:"profile_tagCount__j4tJm",fileRequirements:"profile_fileRequirements__fzpa8",error:"profile_error__423wL",success:"profile_success__XRSVu",charCountWarning:"profile_charCountWarning__3m8ec",fileSize:"profile_fileSize__RInI1",charCountError:"profile_charCountError__riiQL",pdfInputSection:"profile_pdfInputSection__PymR3",pdfInputTabs:"profile_pdfInputTabs__ggHZP",pdfInputTab:"profile_pdfInputTab__y7tDy",activeTab:"profile_activeTab__1AMUy",tabIcon:"profile_tabIcon__gnaRN",urlInputContainer:"profile_urlInputContainer__QXGyY",urlInputLabel:"profile_urlInputLabel__33236",urlIcon:"profile_urlIcon__dctPX",urlInput:"profile_urlInput__9_dB7",urlInputHelp:"profile_urlInputHelp__5ofU6",urlExamples:"profile_urlExamples__jCIpR",urlExampleTitle:"profile_urlExampleTitle__Do5d5",urlExampleList:"profile_urlExampleList__p0XwI"}},56068:(e,o,t)=>{"use strict";t.d(o,{AuthProvider:()=>c,h:()=>_});var r=t(95155),i=t(12115),a=t(35695),n=t(72047);let l=(0,i.createContext)(),s=()=>"ak_"+Array.from(crypto.getRandomValues(new Uint8Array(24))).map(e=>e.toString(16).padStart(2,"0")).join(""),c=e=>{let{children:o}=e,[t,c]=(0,i.useState)(null),[_,d]=(0,i.useState)(!0),[f,p]=(0,i.useState)(!1),u=(0,a.useRouter)(),g=(0,i.useRef)(!1),h=(0,i.useRef)(!1);(0,i.useEffect)(()=>{p(!0),(async()=>{try{let e=localStorage.getItem("userInfo"),o=localStorage.getItem("token");if(localStorage.getItem("apiKey"),e&&o)try{if(c(JSON.parse(e)),!g.current&&!h.current){g.current=!0;try{await (0,n.dw)("/auth/check",{headers:{Authorization:"Bearer ".concat(o)}}),h.current=!0}catch(e){if(console.error("Token validation failed:",e),"localhost"!==window.location.hostname)try{console.log("Retrying token validation..."),await new Promise(e=>setTimeout(e,1e3)),await (0,n.dw)("/auth/check",{headers:{Authorization:"Bearer ".concat(o)}}),h.current=!0}catch(e){console.error("Token validation retry failed:",e),I()}else I()}finally{g.current=!1}}}catch(e){console.error("Failed to parse user info:",e),localStorage.removeItem("userInfo"),localStorage.removeItem("token"),localStorage.removeItem("apiKey")}}finally{d(!1)}})()},[]);let m=e=>{if(console.log("Processing login data"),!e)return void console.error("No user data received for login");try{if(!e.token)return void console.error("No token in login data");let{token:o,...t}=e;console.log("Setting user data:",t),c(t);{localStorage.setItem("userInfo",JSON.stringify(t)),localStorage.setItem("token",o);let e=localStorage.getItem("apiKey");e||(console.log("Generating new API key"),e=s(),localStorage.setItem("apiKey",e)),console.log("Authentication data stored in localStorage")}}catch(e){console.error("Error processing login:",e)}},I=()=>{c(null),localStorage.removeItem("userInfo"),localStorage.removeItem("token"),u.push("/login")},x=()=>localStorage.getItem("token"),y=()=>localStorage.getItem("apiKey"),v=e=>{if(t){let o={...t,coins:e};c(o),localStorage.setItem("userInfo",JSON.stringify(o))}};return f?(0,r.jsx)(l.Provider,{value:{user:t,isLoggedIn:!!t,loading:_,login:m,logout:I,getToken:x,getApiKey:y,updateUserCoins:v},children:o}):(0,r.jsx)(l.Provider,{value:{user:null,isLoggedIn:!1,loading:!0,login:m,logout:I,getToken:x,getApiKey:y,updateUserCoins:v},children:o})},_=()=>{let e=(0,i.useContext)(l);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},72047:(e,o,t)=>{"use strict";async function r(e){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{let t=e.startsWith("http")?e:"".concat("https://ebookaura.onrender.com/api").concat(e);console.log("API Request: ".concat(o.method||"GET"," ").concat(t)),o.headers||(o.headers={}),!o.body||o.headers["Content-Type"]||o.body instanceof FormData||(o.headers["Content-Type"]="application/json");let r=e.startsWith("/books")&&("GET"===o.method||!o.method)&&!e.includes("/reviews")&&!e.includes("/bookmarks"),i=e.match(/^\/books\/[a-z0-9]+$/i);{let e=localStorage.getItem("token"),t=localStorage.getItem("apiKey");e&&(!r||i)&&!o.headers.Authorization&&(o.headers.Authorization="Bearer ".concat(e)),t&&!o.headers["X-API-Key"]&&(o.headers["X-API-Key"]=t)}let a=await fetch(t,o),n=a.headers.get("content-type");if(!a.ok){if(console.error("API Error (".concat(a.status,"): ").concat(a.statusText)),n&&n.includes("application/json")){let e=await a.json();throw Error(e.message||"API request failed with status ".concat(a.status))}{let e=await a.text();console.error("Non-JSON error response:",e.substring(0,150)+"...");let o="API request failed with status ".concat(a.status);if(e.includes("<title>")&&e.includes("</title>")){let t=e.match(/<title>(.*?)<\/title>/i);t&&t[1]&&(o="Server Error: ".concat(t[1]))}throw Error(o)}}if(n&&n.includes("application/json"))return await a.json();{console.warn("Response is not JSON. Content-Type:",n);let e=await a.text();try{return JSON.parse(e)}catch(e){throw console.error("Failed to parse response as JSON:",e),Error("API response was not valid JSON")}}}catch(e){throw console.error("API request error:",e),e}}async function i(e){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return r(e,{method:"GET",...o})}async function a(e,o){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return r(e,{method:"POST",body:o instanceof FormData?o:JSON.stringify(o),...t})}async function n(e,o){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return r(e,{method:"PUT",body:JSON.stringify(o),...t})}async function l(e){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return r(e,{method:"DELETE",...o})}t.d(o,{Xj:()=>a,_5:()=>l,dw:()=>i,q1:()=>n})}},e=>{var o=o=>e(e.s=o);e.O(0,[3909,6711,6874,7733,8441,1684,7358],()=>o(48250)),_N_E=e.O()}]);