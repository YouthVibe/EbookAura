(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8340],{678:e=>{e.exports={searchContainer:"SearchInput_searchContainer___sjMJ",searchIcon:"SearchInput_searchIcon__VZTMd",searchInput:"SearchInput_searchInput__ctvX9",clearButton:"SearchInput_clearButton__Qhd8D"}},2798:(e,r,o)=>{"use strict";o.r(r),o.d(r,{default:()=>d});var a=o(95155),t=o(12115),s=o(29911),n=o(6874),c=o.n(n),i=o(35695),l=o(8476),u=o.n(l),k=o(56068),h=o(72047),m=o(54544);function d(){let[e,r]=(0,t.useState)([]),[o,n]=(0,t.useState)([]),[l,d]=(0,t.useState)(!0),[b,_]=(0,t.useState)(null),[f,v]=(0,t.useState)(!1),[g,p]=(0,t.useState)(""),y=(0,i.useRouter)(),{getToken:j,getApiKey:x}=(0,k.h)();(0,t.useEffect)(()=>{(async()=>{try{let e=j(),r=x();if(!e||!r){console.log("No token or API key found, redirecting to login"),y.push("/login");return}try{console.log("Verifying authentication...");let o=await (0,h.dw)("/auth/check",{headers:{Authorization:"Bearer ".concat(e),"X-API-Key":r}});console.log("Auth response:",o),o&&o.isAuthenticated?(console.log("Authentication verified"),v(!0)):(console.error("Auth validation failed:",o),localStorage.removeItem("token"),_("Authentication failed. Please login again."),setTimeout(()=>y.push("/login"),2e3))}catch(e){console.error("API auth verification error:",e),localStorage.removeItem("token"),_("Authentication verification failed. Please login again."),setTimeout(()=>y.push("/login"),2e3)}}catch(e){console.error("Auth verification error:",e),_("Authentication verification failed. Please login again."),setTimeout(()=>y.push("/login"),2e3)}})()},[y,j,x]),(0,t.useEffect)(()=>{(async()=>{if(!f)return console.log("Auth not verified yet, skipping bookmark fetch");try{let e=j(),o=x();console.log("Fetching bookmarks...");try{let a=await (0,h.dw)("/users/bookmarks",{headers:{Authorization:"Bearer ".concat(e),"X-API-Key":o}});console.log("Bookmark data received:",a),a&&a.books&&Array.isArray(a.books)?(console.log("Found ".concat(a.books.length," bookmarks")),r(a.books)):a&&Array.isArray(a)?(console.log("Found ".concat(a.length," bookmarks (array format)")),r(a)):(console.warn("Unexpected bookmark data format:",a),r([]))}catch(e){console.error("API error fetching bookmarks:",e),_("Failed to load bookmarks. Please try again later.")}d(!1)}catch(e){console.error("Error fetching bookmarks:",e),_("Failed to load bookmarks. Please try again later."),d(!1)}})()},[f,j,x]),(0,t.useEffect)(()=>{n(e)},[e]);let N=async e=>{try{let o=j(),a=x();console.log("Removing bookmark for book ID: ".concat(e));try{await (0,h._5)("/users/bookmarks/".concat(e),{headers:{Authorization:"Bearer ".concat(o),"X-API-Key":a}}),console.log("Bookmark removed successfully"),r(r=>r.filter(r=>r._id!==e))}catch(e){console.error("API error removing bookmark:",e),alert("Failed to remove bookmark. Please try again.")}}catch(e){console.error("Error removing bookmark:",e),alert("An error occurred. Please try again.")}};return l?(0,a.jsx)("div",{className:u().loading,children:"Loading..."}):b?(0,a.jsxs)("div",{className:u().error,children:[(0,a.jsx)("h2",{children:"Error"}),(0,a.jsx)("p",{children:b}),(0,a.jsxs)(c(),{href:"/search",className:u().backButton,children:[(0,a.jsx)(s.QVr,{})," Back to Search"]})]}):(0,a.jsxs)("div",{className:u().container,children:[(0,a.jsxs)("div",{className:u().header,children:[(0,a.jsxs)(c(),{href:"/search",className:u().backButton,children:[(0,a.jsx)(s.QVr,{})," Back to Search"]}),(0,a.jsx)("h1",{children:"My Bookmarks"})]}),0===e.length?(0,a.jsxs)("div",{className:u().emptyState,children:[(0,a.jsx)("p",{children:"You haven't bookmarked any PDFs yet."}),(0,a.jsx)(c(),{href:"/search",className:u().browseButton,children:"Browse PDFs"})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:u().searchContainer,children:(0,a.jsx)(m.A,{placeholder:"Search your bookmarks...",onSearch:r=>{if(p(r),!r.trim())return void n(e);let o=r.toLowerCase().split(" ").filter(e=>e.length>0);n(e.filter(e=>o.some(r=>e.title&&e.title.toLowerCase().includes(r)||e.author&&e.author.toLowerCase().includes(r)||e.category&&e.category.toLowerCase().includes(r)||e.description&&e.description.toLowerCase().includes(r)||e.tags&&Array.isArray(e.tags)&&e.tags.some(e=>e.toLowerCase().includes(r)))))},initialValue:g,debounceTime:500,className:u().bookmarkSearch})}),0===o.length?(0,a.jsxs)("div",{className:u().noResults,children:[(0,a.jsx)("p",{children:"No bookmarks match your search."}),(0,a.jsx)("button",{onClick:()=>{p(""),n(e)},className:u().clearSearchButton,children:"Clear search and show all bookmarks"})]}):(0,a.jsx)("div",{className:u().bookGrid,children:o.map(e=>(0,a.jsxs)("div",{className:u().bookCard,children:[(0,a.jsxs)(c(),{href:"/books/".concat(e._id),className:u().bookLink,children:[(0,a.jsx)("div",{className:u().bookCover,children:e.coverImage?(0,a.jsx)("img",{src:e.coverImage,alt:e.title}):(0,a.jsx)("div",{className:u().placeholderCover,children:(0,a.jsxs)("div",{className:u().defaultCover,children:[(0,a.jsx)("span",{className:u().brandNameEbook,children:"Ebook"}),(0,a.jsx)("span",{className:u().brandNameAura,children:"Aura"})]})})}),(0,a.jsxs)("div",{className:u().bookInfo,children:[(0,a.jsx)("h3",{className:u().bookTitle,children:e.title}),(0,a.jsxs)("p",{className:u().bookAuthor,children:["by ",e.author]}),(0,a.jsx)("p",{className:u().bookCategory,children:e.category}),(0,a.jsxs)("div",{className:u().bookStats,children:[(0,a.jsxs)("span",{className:u().stat,children:[(0,a.jsx)(s.Ny1,{})," ",e.views||0]}),(0,a.jsxs)("span",{className:u().stat,children:[(0,a.jsx)(s.WCW,{})," ",e.downloads||0]}),e.averageRating>0&&(0,a.jsxs)("span",{className:u().stat,children:[(0,a.jsx)(s.gt3,{})," ",e.averageRating.toFixed(1)]})]})]})]}),(0,a.jsx)("button",{className:u().removeBookmarkButton,onClick:()=>N(e._id),title:"Remove from bookmarks",children:(0,a.jsx)(s.U$b,{})})]},e._id))})]})]})}},8476:e=>{e.exports={container:"bookmarks_container__6VD5G",header:"bookmarks_header__PeqUK",backButton:"bookmarks_backButton__MG5QJ",loading:"bookmarks_loading__f9itx",error:"bookmarks_error__bTOXs",emptyState:"bookmarks_emptyState___AGRc",browseButton:"bookmarks_browseButton__cZD0a",bookGrid:"bookmarks_bookGrid__LIEW5",bookCard:"bookmarks_bookCard__6cacV",bookLink:"bookmarks_bookLink__dIfXc",bookCover:"bookmarks_bookCover__Iji74",placeholderCover:"bookmarks_placeholderCover__KD5z9",defaultCover:"bookmarks_defaultCover__G3Y1y",brandNameEbook:"bookmarks_brandNameEbook__gM5TH",brandNameAura:"bookmarks_brandNameAura__04uWh",bookInfo:"bookmarks_bookInfo__wOStl",bookTitle:"bookmarks_bookTitle__O1FNO",bookAuthor:"bookmarks_bookAuthor__uM3hG",bookCategory:"bookmarks_bookCategory__yJrzL",bookStats:"bookmarks_bookStats__ba4bi",stat:"bookmarks_stat__h8uh2",removeBookmarkButton:"bookmarks_removeBookmarkButton__dwbdV",searchContainer:"bookmarks_searchContainer__TD_o1",bookmarkSearch:"bookmarks_bookmarkSearch__5ju33",noResults:"bookmarks_noResults__rhH4a",clearSearchButton:"bookmarks_clearSearchButton__H8cU7"}},35695:(e,r,o)=>{"use strict";var a=o(18999);o.o(a,"useParams")&&o.d(r,{useParams:function(){return a.useParams}}),o.o(a,"usePathname")&&o.d(r,{usePathname:function(){return a.usePathname}}),o.o(a,"useRouter")&&o.d(r,{useRouter:function(){return a.useRouter}}),o.o(a,"useSearchParams")&&o.d(r,{useSearchParams:function(){return a.useSearchParams}})},54544:(e,r,o)=>{"use strict";o.d(r,{A:()=>i});var a=o(95155),t=o(29911),s=o(12115),n=o(678),c=o.n(n);function i(e){let{placeholder:r="Search...",onSearch:o,initialValue:n="",debounceTime:i=300,className:l=""}=e,[u,k]=(0,s.useState)(n);return(0,s.useEffect)(()=>{k(n)},[n]),(0,s.useEffect)(()=>{let e=setTimeout(()=>{o&&o(u)},i);return()=>clearTimeout(e)},[u,o,i]),(0,a.jsxs)("div",{className:"".concat(c().searchContainer," ").concat(l),children:[(0,a.jsx)(t.KSO,{className:c().searchIcon}),(0,a.jsx)("input",{type:"text",placeholder:r,value:u,onChange:e=>k(e.target.value),className:c().searchInput,"aria-label":"Search input"}),u&&(0,a.jsx)("button",{className:c().clearButton,onClick:()=>{k(""),o&&o("")},"aria-label":"Clear search",children:"\xd7"})]})}},65189:(e,r,o)=>{Promise.resolve().then(o.bind(o,2798))},74436:(e,r,o)=>{"use strict";o.d(r,{k5:()=>u});var a=o(12115),t={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},s=a.createContext&&a.createContext(t),n=["attr","size","title"];function c(){return(c=Object.assign?Object.assign.bind():function(e){for(var r=1;r<arguments.length;r++){var o=arguments[r];for(var a in o)Object.prototype.hasOwnProperty.call(o,a)&&(e[a]=o[a])}return e}).apply(this,arguments)}function i(e,r){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);r&&(a=a.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),o.push.apply(o,a)}return o}function l(e){for(var r=1;r<arguments.length;r++){var o=null!=arguments[r]?arguments[r]:{};r%2?i(Object(o),!0).forEach(function(r){var a,t,s;a=e,t=r,s=o[r],(t=function(e){var r=function(e,r){if("object"!=typeof e||!e)return e;var o=e[Symbol.toPrimitive];if(void 0!==o){var a=o.call(e,r||"default");if("object"!=typeof a)return a;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(e)}(e,"string");return"symbol"==typeof r?r:r+""}(t))in a?Object.defineProperty(a,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):a[t]=s}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):i(Object(o)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(o,r))})}return e}function u(e){return r=>a.createElement(k,c({attr:l({},e.attr)},r),function e(r){return r&&r.map((r,o)=>a.createElement(r.tag,l({key:o},r.attr),e(r.child)))}(e.child))}function k(e){var r=r=>{var o,{attr:t,size:s,title:i}=e,u=function(e,r){if(null==e)return{};var o,a,t=function(e,r){if(null==e)return{};var o={};for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){if(r.indexOf(a)>=0)continue;o[a]=e[a]}return o}(e,r);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(a=0;a<s.length;a++)o=s[a],!(r.indexOf(o)>=0)&&Object.prototype.propertyIsEnumerable.call(e,o)&&(t[o]=e[o])}return t}(e,n),k=s||r.size||"1em";return r.className&&(o=r.className),e.className&&(o=(o?o+" ":"")+e.className),a.createElement("svg",c({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},r.attr,t,u,{className:o,style:l(l({color:e.color||r.color},r.style),e.style),height:k,width:k,xmlns:"http://www.w3.org/2000/svg"}),i&&a.createElement("title",null,i),e.children)};return void 0!==s?a.createElement(s.Consumer,null,e=>r(e)):r(t)}}},e=>{var r=r=>e(e.s=r);e.O(0,[7391,2227,6711,6874,6068,8441,1684,7358],()=>r(65189)),_N_E=e.O()}]);