(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8340],{678:e=>{e.exports={searchContainer:"SearchInput_searchContainer___sjMJ",searchIcon:"SearchInput_searchIcon__VZTMd",searchInput:"SearchInput_searchInput__ctvX9",clearButton:"SearchInput_clearButton__Qhd8D"}},2798:(e,o,r)=>{"use strict";r.r(o),r.d(o,{default:()=>d});var t=r(95155),a=r(12115),s=r(29911),n=r(6874),c=r.n(n),i=r(35695),l=r(8476),u=r.n(l),h=r(56068),k=r(72047),m=r(54544);function d(){let[e,o]=(0,a.useState)([]),[r,n]=(0,a.useState)([]),[l,d]=(0,a.useState)(!0),[b,f]=(0,a.useState)(null),[_,g]=(0,a.useState)(!1),[v,p]=(0,a.useState)(""),y=(0,i.useRouter)(),{getToken:j,getApiKey:x}=(0,h.h)();(0,a.useEffect)(()=>{(async()=>{try{let e=j(),o=x();if(!e||!o){console.log("No token or API key found, redirecting to login"),y.push("/login");return}try{console.log("Verifying authentication...");let r=await (0,k.dw)("/auth/check",{headers:{Authorization:"Bearer ".concat(e),"X-API-Key":o}});console.log("Auth response:",r),r&&r.isAuthenticated?(console.log("Authentication verified"),g(!0)):(console.error("Auth validation failed:",r),localStorage.removeItem("token"),f("Authentication failed. Please login again."),setTimeout(()=>y.push("/login"),2e3))}catch(e){console.error("API auth verification error:",e),localStorage.removeItem("token"),f("Authentication verification failed. Please login again."),setTimeout(()=>y.push("/login"),2e3)}}catch(e){console.error("Auth verification error:",e),f("Authentication verification failed. Please login again."),setTimeout(()=>y.push("/login"),2e3)}})()},[y,j,x]),(0,a.useEffect)(()=>{(async()=>{if(!_)return console.log("Auth not verified yet, skipping bookmark fetch");try{let e=j(),r=x();console.log("Fetching bookmarks...");try{let t=await (0,k.dw)("/users/bookmarks",{headers:{Authorization:"Bearer ".concat(e),"X-API-Key":r}});console.log("Bookmark data received:",t),t&&t.books&&Array.isArray(t.books)?(console.log("Found ".concat(t.books.length," bookmarks")),o(t.books)):t&&Array.isArray(t)?(console.log("Found ".concat(t.length," bookmarks (array format)")),o(t)):(console.warn("Unexpected bookmark data format:",t),o([]))}catch(e){console.error("API error fetching bookmarks:",e),f("Failed to load bookmarks. Please try again later.")}d(!1)}catch(e){console.error("Error fetching bookmarks:",e),f("Failed to load bookmarks. Please try again later."),d(!1)}})()},[_,j,x]),(0,a.useEffect)(()=>{n(e)},[e]);let N=async e=>{try{let r=j(),t=x();console.log("Removing bookmark for book ID: ".concat(e));try{await (0,k._5)("/users/bookmarks/".concat(e),{headers:{Authorization:"Bearer ".concat(r),"X-API-Key":t}}),console.log("Bookmark removed successfully"),o(o=>o.filter(o=>o._id!==e))}catch(e){console.error("API error removing bookmark:",e),alert("Failed to remove bookmark. Please try again.")}}catch(e){console.error("Error removing bookmark:",e),alert("An error occurred. Please try again.")}};return l?(0,t.jsx)("div",{className:u().loading,children:"Loading..."}):b?(0,t.jsxs)("div",{className:u().error,children:[(0,t.jsx)("h2",{children:"Error"}),(0,t.jsx)("p",{children:b}),(0,t.jsxs)(c(),{href:"/search",className:u().backButton,children:[(0,t.jsx)(s.QVr,{})," Back to Search"]})]}):(0,t.jsxs)("div",{className:u().container,children:[(0,t.jsxs)("div",{className:u().header,children:[(0,t.jsxs)(c(),{href:"/search",className:u().backButton,children:[(0,t.jsx)(s.QVr,{})," Back to Search"]}),(0,t.jsx)("h1",{children:"My Bookmarks"})]}),0===e.length?(0,t.jsxs)("div",{className:u().emptyState,children:[(0,t.jsx)("p",{children:"You haven't bookmarked any PDFs yet."}),(0,t.jsx)(c(),{href:"/search",className:u().browseButton,children:"Browse PDFs"})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:u().searchContainer,children:(0,t.jsx)(m.A,{placeholder:"Search your bookmarks...",onSearch:o=>{if(p(o),!o.trim())return void n(e);let r=o.toLowerCase().split(" ").filter(e=>e.length>0);n(e.filter(e=>r.some(o=>e.title&&e.title.toLowerCase().includes(o)||e.author&&e.author.toLowerCase().includes(o)||e.category&&e.category.toLowerCase().includes(o)||e.description&&e.description.toLowerCase().includes(o)||e.tags&&Array.isArray(e.tags)&&e.tags.some(e=>e.toLowerCase().includes(o)))))},initialValue:v,debounceTime:500,className:u().bookmarkSearch})}),0===r.length?(0,t.jsxs)("div",{className:u().noResults,children:[(0,t.jsx)("p",{children:"No bookmarks match your search."}),(0,t.jsx)("button",{onClick:()=>{p(""),n(e)},className:u().clearSearchButton,children:"Clear search and show all bookmarks"})]}):(0,t.jsx)("div",{className:u().bookGrid,children:r.map(e=>(0,t.jsxs)("div",{className:u().bookCard,children:[(0,t.jsxs)(c(),{href:"/books/".concat(e._id),className:u().bookLink,children:[(0,t.jsx)("div",{className:u().bookCover,children:e.coverImage?(0,t.jsx)("img",{src:e.coverImage,alt:e.title}):(0,t.jsx)("div",{className:u().placeholderCover,children:(0,t.jsx)(s.vd0,{})})}),(0,t.jsxs)("div",{className:u().bookInfo,children:[(0,t.jsx)("h3",{className:u().bookTitle,children:e.title}),(0,t.jsxs)("p",{className:u().bookAuthor,children:["by ",e.author]}),(0,t.jsx)("p",{className:u().bookCategory,children:e.category}),(0,t.jsxs)("div",{className:u().bookStats,children:[(0,t.jsxs)("span",{className:u().stat,children:[(0,t.jsx)(s.Ny1,{})," ",e.views||0]}),(0,t.jsxs)("span",{className:u().stat,children:[(0,t.jsx)(s.WCW,{})," ",e.downloads||0]}),e.averageRating>0&&(0,t.jsxs)("span",{className:u().stat,children:[(0,t.jsx)(s.gt3,{})," ",e.averageRating.toFixed(1)]})]})]})]}),(0,t.jsx)("button",{className:u().removeBookmarkButton,onClick:()=>N(e._id),title:"Remove from bookmarks",children:(0,t.jsx)(s.U$b,{})})]},e._id))})]})]})}},3494:(e,o,r)=>{Promise.resolve().then(r.bind(r,2798))},8476:e=>{e.exports={container:"bookmarks_container__6VD5G",header:"bookmarks_header__PeqUK",backButton:"bookmarks_backButton__MG5QJ",loading:"bookmarks_loading__f9itx",error:"bookmarks_error__bTOXs",emptyState:"bookmarks_emptyState___AGRc",browseButton:"bookmarks_browseButton__cZD0a",bookGrid:"bookmarks_bookGrid__LIEW5",bookCard:"bookmarks_bookCard__6cacV",bookLink:"bookmarks_bookLink__dIfXc",bookCover:"bookmarks_bookCover__Iji74",placeholderCover:"bookmarks_placeholderCover__KD5z9",bookInfo:"bookmarks_bookInfo__wOStl",bookTitle:"bookmarks_bookTitle__O1FNO",bookAuthor:"bookmarks_bookAuthor__uM3hG",bookCategory:"bookmarks_bookCategory__yJrzL",bookStats:"bookmarks_bookStats__ba4bi",stat:"bookmarks_stat__h8uh2",removeBookmarkButton:"bookmarks_removeBookmarkButton__dwbdV",searchContainer:"bookmarks_searchContainer__TD_o1",bookmarkSearch:"bookmarks_bookmarkSearch__5ju33",noResults:"bookmarks_noResults__rhH4a",clearSearchButton:"bookmarks_clearSearchButton__H8cU7"}},35695:(e,o,r)=>{"use strict";var t=r(18999);r.o(t,"useParams")&&r.d(o,{useParams:function(){return t.useParams}}),r.o(t,"usePathname")&&r.d(o,{usePathname:function(){return t.usePathname}}),r.o(t,"useRouter")&&r.d(o,{useRouter:function(){return t.useRouter}}),r.o(t,"useSearchParams")&&r.d(o,{useSearchParams:function(){return t.useSearchParams}})},54544:(e,o,r)=>{"use strict";r.d(o,{A:()=>i});var t=r(95155),a=r(29911),s=r(12115),n=r(678),c=r.n(n);function i(e){let{placeholder:o="Search...",onSearch:r,initialValue:n="",debounceTime:i=300,className:l=""}=e,[u,h]=(0,s.useState)(n);return(0,s.useEffect)(()=>{h(n)},[n]),(0,s.useEffect)(()=>{let e=setTimeout(()=>{r&&r(u)},i);return()=>clearTimeout(e)},[u,r,i]),(0,t.jsxs)("div",{className:"".concat(c().searchContainer," ").concat(l),children:[(0,t.jsx)(a.KSO,{className:c().searchIcon}),(0,t.jsx)("input",{type:"text",placeholder:o,value:u,onChange:e=>h(e.target.value),className:c().searchInput,"aria-label":"Search input"}),u&&(0,t.jsx)("button",{className:c().clearButton,onClick:()=>{h(""),r&&r("")},"aria-label":"Clear search",children:"\xd7"})]})}},74436:(e,o,r)=>{"use strict";r.d(o,{k5:()=>u});var t=r(12115),a={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},s=t.createContext&&t.createContext(a),n=["attr","size","title"];function c(){return(c=Object.assign?Object.assign.bind():function(e){for(var o=1;o<arguments.length;o++){var r=arguments[o];for(var t in r)Object.prototype.hasOwnProperty.call(r,t)&&(e[t]=r[t])}return e}).apply(this,arguments)}function i(e,o){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);o&&(t=t.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,t)}return r}function l(e){for(var o=1;o<arguments.length;o++){var r=null!=arguments[o]?arguments[o]:{};o%2?i(Object(r),!0).forEach(function(o){var t,a,s;t=e,a=o,s=r[o],(a=function(e){var o=function(e,o){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var t=r.call(e,o||"default");if("object"!=typeof t)return t;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===o?String:Number)(e)}(e,"string");return"symbol"==typeof o?o:o+""}(a))in t?Object.defineProperty(t,a,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[a]=s}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(r,o))})}return e}function u(e){return o=>t.createElement(h,c({attr:l({},e.attr)},o),function e(o){return o&&o.map((o,r)=>t.createElement(o.tag,l({key:r},o.attr),e(o.child)))}(e.child))}function h(e){var o=o=>{var r,{attr:a,size:s,title:i}=e,u=function(e,o){if(null==e)return{};var r,t,a=function(e,o){if(null==e)return{};var r={};for(var t in e)if(Object.prototype.hasOwnProperty.call(e,t)){if(o.indexOf(t)>=0)continue;r[t]=e[t]}return r}(e,o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(t=0;t<s.length;t++)r=s[t],!(o.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}(e,n),h=s||o.size||"1em";return o.className&&(r=o.className),e.className&&(r=(r?r+" ":"")+e.className),t.createElement("svg",c({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},o.attr,a,u,{className:r,style:l(l({color:e.color||o.color},o.style),e.style),height:h,width:h,xmlns:"http://www.w3.org/2000/svg"}),i&&t.createElement("title",null,i),e.children)};return void 0!==s?t.createElement(s.Consumer,null,e=>o(e)):o(a)}}},e=>{var o=o=>e(e.s=o);e.O(0,[7391,2227,6711,6874,6068,8441,1684,7358],()=>o(3494)),_N_E=e.O()}]);