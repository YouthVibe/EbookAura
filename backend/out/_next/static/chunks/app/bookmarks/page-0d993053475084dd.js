(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[340],{2798:(o,e,r)=>{"use strict";r.r(e),r.d(e,{default:()=>b});var a=r(5155),s=r(2115),t=r(9911),c=r(6874),n=r.n(c),i=r(5695),l=r(8476),k=r.n(l),d=r(6068),h=r(2047),m=r(4544);function b(){let[o,e]=(0,s.useState)([]),[r,c]=(0,s.useState)([]),[l,b]=(0,s.useState)(!0),[u,_]=(0,s.useState)(null),[g,v]=(0,s.useState)(!1),f=(0,i.useRouter)(),{getToken:x,getApiKey:y}=(0,d.h)();(0,s.useEffect)(()=>{(async()=>{try{let o=x(),e=y();if(!o||!e){console.log("No token or API key found, redirecting to login"),f.push("/login");return}try{console.log("Verifying authentication...");let r=await (0,h.dw)("/auth/check",{headers:{Authorization:"Bearer ".concat(o),"X-API-Key":e}});console.log("Auth response:",r),r&&r.isAuthenticated?(console.log("Authentication verified"),v(!0)):(console.error("Auth validation failed:",r),localStorage.removeItem("token"),_("Authentication failed. Please login again."),setTimeout(()=>f.push("/login"),2e3))}catch(o){console.error("API auth verification error:",o),localStorage.removeItem("token"),_("Authentication verification failed. Please login again."),setTimeout(()=>f.push("/login"),2e3)}}catch(o){console.error("Auth verification error:",o),_("Authentication verification failed. Please login again."),setTimeout(()=>f.push("/login"),2e3)}})()},[f,x,y]),(0,s.useEffect)(()=>{(async()=>{if(!g)return console.log("Auth not verified yet, skipping bookmark fetch");try{let o=x(),r=y();console.log("Fetching bookmarks...");try{let a=await (0,h.dw)("/users/bookmarks",{headers:{Authorization:"Bearer ".concat(o),"X-API-Key":r}});console.log("Bookmark data received:",a),a&&a.books&&Array.isArray(a.books)?(console.log("Found ".concat(a.books.length," bookmarks")),e(a.books)):a&&Array.isArray(a)?(console.log("Found ".concat(a.length," bookmarks (array format)")),e(a)):(console.warn("Unexpected bookmark data format:",a),e([]))}catch(o){console.error("API error fetching bookmarks:",o),_("Failed to load bookmarks. Please try again later.")}b(!1)}catch(o){console.error("Error fetching bookmarks:",o),_("Failed to load bookmarks. Please try again later."),b(!1)}})()},[g,x,y]),(0,s.useEffect)(()=>{c(o)},[o]);let j=async o=>{try{let r=x(),a=y();console.log("Removing bookmark for book ID: ".concat(o));try{await (0,h._5)("/users/bookmarks/".concat(o),{headers:{Authorization:"Bearer ".concat(r),"X-API-Key":a}}),console.log("Bookmark removed successfully"),e(e=>e.filter(e=>e._id!==o))}catch(o){console.error("API error removing bookmark:",o),alert("Failed to remove bookmark. Please try again.")}}catch(o){console.error("Error removing bookmark:",o),alert("An error occurred. Please try again.")}};return l?(0,a.jsx)("div",{className:k().loading,children:"Loading..."}):u?(0,a.jsxs)("div",{className:k().error,children:[(0,a.jsx)("h2",{children:"Error"}),(0,a.jsx)("p",{children:u}),(0,a.jsxs)(n(),{href:"/search",className:k().backButton,children:[(0,a.jsx)(t.QVr,{})," Back to Search"]})]}):(0,a.jsxs)("div",{className:k().container,children:[(0,a.jsxs)("div",{className:k().header,children:[(0,a.jsxs)(n(),{href:"/search",className:k().backButton,children:[(0,a.jsx)(t.QVr,{})," Back to Search"]}),(0,a.jsx)("h1",{children:"My Bookmarks"})]}),0===o.length?(0,a.jsxs)("div",{className:k().emptyState,children:[(0,a.jsx)("p",{children:"You haven't bookmarked any PDFs yet."}),(0,a.jsx)(n(),{href:"/search",className:k().browseButton,children:"Browse PDFs"})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:k().searchContainer,children:(0,a.jsx)(m.A,{placeholder:"Search your bookmarks...",onSearch:e=>{if(!e.trim())return void c(o);let r=e.toLowerCase();c(o.filter(o=>o.title.toLowerCase().includes(r)||o.author.toLowerCase().includes(r)||o.category&&o.category.toLowerCase().includes(r)||o.description&&o.description.toLowerCase().includes(r)))},initialValue:"",debounceTime:500,className:k().bookmarkSearch})}),0===r.length?(0,a.jsx)("div",{className:k().noResults,children:(0,a.jsx)("p",{children:"No bookmarks match your search."})}):(0,a.jsx)("div",{className:k().bookGrid,children:r.map(o=>(0,a.jsxs)("div",{className:k().bookCard,children:[(0,a.jsxs)(n(),{href:"/books/".concat(o._id),className:k().bookLink,children:[(0,a.jsx)("div",{className:k().bookCover,children:o.coverImage?(0,a.jsx)("img",{src:o.coverImage,alt:o.title}):(0,a.jsx)("div",{className:k().placeholderCover,children:(0,a.jsx)(t.vd0,{})})}),(0,a.jsxs)("div",{className:k().bookInfo,children:[(0,a.jsx)("h3",{className:k().bookTitle,children:o.title}),(0,a.jsxs)("p",{className:k().bookAuthor,children:["by ",o.author]}),(0,a.jsx)("p",{className:k().bookCategory,children:o.category}),(0,a.jsxs)("div",{className:k().bookStats,children:[(0,a.jsxs)("span",{className:k().stat,children:[(0,a.jsx)(t.Ny1,{})," ",o.views||0]}),(0,a.jsxs)("span",{className:k().stat,children:[(0,a.jsx)(t.WCW,{})," ",o.downloads||0]}),o.averageRating>0&&(0,a.jsxs)("span",{className:k().stat,children:[(0,a.jsx)(t.gt3,{})," ",o.averageRating.toFixed(1)]})]})]})]}),(0,a.jsx)("button",{className:k().removeBookmarkButton,onClick:()=>j(o._id),title:"Remove from bookmarks",children:(0,a.jsx)(t.U$b,{})})]},o._id))})]})]})}},3494:(o,e,r)=>{Promise.resolve().then(r.bind(r,2798))},8476:o=>{o.exports={container:"bookmarks_container__6VD5G",header:"bookmarks_header__PeqUK",backButton:"bookmarks_backButton__MG5QJ",loading:"bookmarks_loading__f9itx",error:"bookmarks_error__bTOXs",emptyState:"bookmarks_emptyState___AGRc",browseButton:"bookmarks_browseButton__cZD0a",bookGrid:"bookmarks_bookGrid__LIEW5",bookCard:"bookmarks_bookCard__6cacV",bookLink:"bookmarks_bookLink__dIfXc",bookCover:"bookmarks_bookCover__Iji74",placeholderCover:"bookmarks_placeholderCover__KD5z9",bookInfo:"bookmarks_bookInfo__wOStl",bookTitle:"bookmarks_bookTitle__O1FNO",bookAuthor:"bookmarks_bookAuthor__uM3hG",bookCategory:"bookmarks_bookCategory__yJrzL",bookStats:"bookmarks_bookStats__ba4bi",stat:"bookmarks_stat__h8uh2",removeBookmarkButton:"bookmarks_removeBookmarkButton__dwbdV"}}},o=>{var e=e=>o(o.s=e);o.O(0,[391,227,711,874,912,441,684,358],()=>e(3494)),_N_E=o.O()}]);