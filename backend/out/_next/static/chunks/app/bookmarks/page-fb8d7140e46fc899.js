(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8340],{2798:(o,e,a)=>{"use strict";a.r(e),a.d(e,{default:()=>b});var r=a(95155),s=a(12115),t=a(29911),c=a(6874),n=a.n(c),i=a(35695),l=a(8476),k=a.n(l),h=a(56068),d=a(72047),m=a(54544);function b(){let[o,e]=(0,s.useState)([]),[a,c]=(0,s.useState)([]),[l,b]=(0,s.useState)(!0),[u,_]=(0,s.useState)(null),[g,v]=(0,s.useState)(!1),[f,x]=(0,s.useState)(""),y=(0,i.useRouter)(),{getToken:j,getApiKey:N}=(0,h.h)();(0,s.useEffect)(()=>{(async()=>{try{let o=j(),e=N();if(!o||!e){console.log("No token or API key found, redirecting to login"),y.push("/login");return}try{console.log("Verifying authentication...");let a=await (0,d.dw)("/auth/check",{headers:{Authorization:"Bearer ".concat(o),"X-API-Key":e}});console.log("Auth response:",a),a&&a.isAuthenticated?(console.log("Authentication verified"),v(!0)):(console.error("Auth validation failed:",a),localStorage.removeItem("token"),_("Authentication failed. Please login again."),setTimeout(()=>y.push("/login"),2e3))}catch(o){console.error("API auth verification error:",o),localStorage.removeItem("token"),_("Authentication verification failed. Please login again."),setTimeout(()=>y.push("/login"),2e3)}}catch(o){console.error("Auth verification error:",o),_("Authentication verification failed. Please login again."),setTimeout(()=>y.push("/login"),2e3)}})()},[y,j,N]),(0,s.useEffect)(()=>{(async()=>{if(!g)return console.log("Auth not verified yet, skipping bookmark fetch");try{let o=j(),a=N();console.log("Fetching bookmarks...");try{let r=await (0,d.dw)("/users/bookmarks",{headers:{Authorization:"Bearer ".concat(o),"X-API-Key":a}});console.log("Bookmark data received:",r),r&&r.books&&Array.isArray(r.books)?(console.log("Found ".concat(r.books.length," bookmarks")),e(r.books)):r&&Array.isArray(r)?(console.log("Found ".concat(r.length," bookmarks (array format)")),e(r)):(console.warn("Unexpected bookmark data format:",r),e([]))}catch(o){console.error("API error fetching bookmarks:",o),_("Failed to load bookmarks. Please try again later.")}b(!1)}catch(o){console.error("Error fetching bookmarks:",o),_("Failed to load bookmarks. Please try again later."),b(!1)}})()},[g,j,N]),(0,s.useEffect)(()=>{c(o)},[o]);let p=async o=>{try{let a=j(),r=N();console.log("Removing bookmark for book ID: ".concat(o));try{await (0,d._5)("/users/bookmarks/".concat(o),{headers:{Authorization:"Bearer ".concat(a),"X-API-Key":r}}),console.log("Bookmark removed successfully"),e(e=>e.filter(e=>e._id!==o))}catch(o){console.error("API error removing bookmark:",o),alert("Failed to remove bookmark. Please try again.")}}catch(o){console.error("Error removing bookmark:",o),alert("An error occurred. Please try again.")}};return l?(0,r.jsx)("div",{className:k().loading,children:"Loading..."}):u?(0,r.jsxs)("div",{className:k().error,children:[(0,r.jsx)("h2",{children:"Error"}),(0,r.jsx)("p",{children:u}),(0,r.jsxs)(n(),{href:"/search",className:k().backButton,children:[(0,r.jsx)(t.QVr,{})," Back to Search"]})]}):(0,r.jsxs)("div",{className:k().container,children:[(0,r.jsxs)("div",{className:k().header,children:[(0,r.jsxs)(n(),{href:"/search",className:k().backButton,children:[(0,r.jsx)(t.QVr,{})," Back to Search"]}),(0,r.jsx)("h1",{children:"My Bookmarks"})]}),0===o.length?(0,r.jsxs)("div",{className:k().emptyState,children:[(0,r.jsx)("p",{children:"You haven't bookmarked any PDFs yet."}),(0,r.jsx)(n(),{href:"/search",className:k().browseButton,children:"Browse PDFs"})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:k().searchContainer,children:(0,r.jsx)(m.A,{placeholder:"Search your bookmarks...",onSearch:e=>{if(x(e),!e.trim())return void c(o);let a=e.toLowerCase().split(" ").filter(o=>o.length>0);c(o.filter(o=>a.some(e=>o.title&&o.title.toLowerCase().includes(e)||o.author&&o.author.toLowerCase().includes(e)||o.category&&o.category.toLowerCase().includes(e)||o.description&&o.description.toLowerCase().includes(e)||o.tags&&Array.isArray(o.tags)&&o.tags.some(o=>o.toLowerCase().includes(e)))))},initialValue:f,debounceTime:500,className:k().bookmarkSearch})}),0===a.length?(0,r.jsxs)("div",{className:k().noResults,children:[(0,r.jsx)("p",{children:"No bookmarks match your search."}),(0,r.jsx)("button",{onClick:()=>{x(""),c(o)},className:k().clearSearchButton,children:"Clear search and show all bookmarks"})]}):(0,r.jsx)("div",{className:k().bookGrid,children:a.map(o=>(0,r.jsxs)("div",{className:k().bookCard,children:[(0,r.jsxs)(n(),{href:"/books/".concat(o._id),className:k().bookLink,children:[(0,r.jsx)("div",{className:k().bookCover,children:o.coverImage?(0,r.jsx)("img",{src:o.coverImage,alt:o.title}):(0,r.jsx)("div",{className:k().placeholderCover,children:(0,r.jsx)(t.vd0,{})})}),(0,r.jsxs)("div",{className:k().bookInfo,children:[(0,r.jsx)("h3",{className:k().bookTitle,children:o.title}),(0,r.jsxs)("p",{className:k().bookAuthor,children:["by ",o.author]}),(0,r.jsx)("p",{className:k().bookCategory,children:o.category}),(0,r.jsxs)("div",{className:k().bookStats,children:[(0,r.jsxs)("span",{className:k().stat,children:[(0,r.jsx)(t.Ny1,{})," ",o.views||0]}),(0,r.jsxs)("span",{className:k().stat,children:[(0,r.jsx)(t.WCW,{})," ",o.downloads||0]}),o.averageRating>0&&(0,r.jsxs)("span",{className:k().stat,children:[(0,r.jsx)(t.gt3,{})," ",o.averageRating.toFixed(1)]})]})]})]}),(0,r.jsx)("button",{className:k().removeBookmarkButton,onClick:()=>p(o._id),title:"Remove from bookmarks",children:(0,r.jsx)(t.U$b,{})})]},o._id))})]})]})}},3494:(o,e,a)=>{Promise.resolve().then(a.bind(a,2798))},8476:o=>{o.exports={container:"bookmarks_container__6VD5G",header:"bookmarks_header__PeqUK",backButton:"bookmarks_backButton__MG5QJ",loading:"bookmarks_loading__f9itx",error:"bookmarks_error__bTOXs",emptyState:"bookmarks_emptyState___AGRc",browseButton:"bookmarks_browseButton__cZD0a",bookGrid:"bookmarks_bookGrid__LIEW5",bookCard:"bookmarks_bookCard__6cacV",bookLink:"bookmarks_bookLink__dIfXc",bookCover:"bookmarks_bookCover__Iji74",placeholderCover:"bookmarks_placeholderCover__KD5z9",bookInfo:"bookmarks_bookInfo__wOStl",bookTitle:"bookmarks_bookTitle__O1FNO",bookAuthor:"bookmarks_bookAuthor__uM3hG",bookCategory:"bookmarks_bookCategory__yJrzL",bookStats:"bookmarks_bookStats__ba4bi",stat:"bookmarks_stat__h8uh2",removeBookmarkButton:"bookmarks_removeBookmarkButton__dwbdV",searchContainer:"bookmarks_searchContainer__TD_o1",bookmarkSearch:"bookmarks_bookmarkSearch__5ju33",noResults:"bookmarks_noResults__rhH4a",clearSearchButton:"bookmarks_clearSearchButton__H8cU7"}}},o=>{var e=e=>o(o.s=e);o.O(0,[1521,6711,6874,9912,8441,1684,7358],()=>e(3494)),_N_E=o.O()}]);