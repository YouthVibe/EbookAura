(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[698],{1420:(e,a,t)=>{Promise.resolve().then(t.bind(t,8887))},5163:e=>{e.exports={container:"admin_container__uVSVc",title:"admin_title__cLzhO",tabs:"admin_tabs__7q5Ma",tab:"admin_tab__3pwcu",activeTab:"admin_activeTab__GZaQ8",tabContent:"admin_tabContent__hNXoi",searchContainer:"admin_searchContainer__kL4Hc",search:"admin_search__c4hwg",searchIcon:"admin_searchIcon__HTKcv",searchInput:"admin_searchInput__Ylvz_",loading:"admin_loading__OjQcq",error:"admin_error__Cw8at",noResults:"admin_noResults__T6qDu",tableContainer:"admin_tableContainer__GVxxO",table:"admin_table__Wi_BD",userName:"admin_userName__T5jos",status:"admin_status__QOVm_",active:"admin_active__3D2D6",banned:"admin_banned__btdd7",adminStatus:"admin_adminStatus__3Da9D",isAdmin:"admin_isAdmin__GL8na",actions:"admin_actions__quNLt",actionButton:"admin_actionButton__sA_2Z",banButton:"admin_banButton__q_y5Y",unbanButton:"admin_unbanButton__W_A6t",deleteButton:"admin_deleteButton__CwIux",bookGrid:"admin_bookGrid__3rKuo",bookCard:"admin_bookCard__gV2SK",bookCover:"admin_bookCover__HmZod",placeholderCover:"admin_placeholderCover__SH1F7",bookInfo:"admin_bookInfo__frg_2",bookTitle:"admin_bookTitle__Kx_Oj",bookAuthor:"admin_bookAuthor__lV80i",bookCategory:"admin_bookCategory__uOK05",bookStats:"admin_bookStats__hC9AF",stat:"admin_stat__xyVzX",bookMeta:"admin_bookMeta__8Au3D",bookDate:"admin_bookDate__C2L3U",bookUploader:"admin_bookUploader__6cGyv",bookActions:"admin_bookActions__EE5lT",bookAction:"admin_bookAction__sRlpm",modalOverlay:"admin_modalOverlay___9oQR",fadeIn:"admin_fadeIn__fe57e",modal:"admin_modal__DNvY3",slideUp:"admin_slideUp__iRr3n",modalButtons:"admin_modalButtons__zUpVq",cancelButton:"admin_cancelButton__1fEHQ",confirmButton:"admin_confirmButton__EoHw2"}},8887:(e,a,t)=>{"use strict";t.r(a),t.d(a,{default:()=>k});var n=t(5155),o=t(2115),s=t(5695),i=t(9911),r=t(2047);let c=async()=>{try{let e=localStorage.getItem("token"),a=localStorage.getItem("apiKey");if(!e||!a)throw Error("Authentication required");return await (0,r.dw)("/admin/users",{headers:{Authorization:"Bearer ".concat(e),"X-API-Key":a}})}catch(e){throw console.error("Error fetching users:",e),e}},l=async e=>{try{let a=localStorage.getItem("token"),t=localStorage.getItem("apiKey");if(!a||!t)throw Error("Authentication required");return await (0,r.q1)("/admin/users/".concat(e,"/ban"),{},{headers:{Authorization:"Bearer ".concat(a),"X-API-Key":t}})}catch(e){throw console.error("Error toggling user ban status:",e),e}},d=async e=>{try{let a=localStorage.getItem("token"),t=localStorage.getItem("apiKey");if(!a||!t)throw Error("Authentication required");return await (0,r._5)("/admin/users/".concat(e),{headers:{Authorization:"Bearer ".concat(a),"X-API-Key":t}})}catch(e){throw console.error("Error deleting user:",e),e}},m=async()=>{try{let e=localStorage.getItem("token"),a=localStorage.getItem("apiKey");if(!e||!a)throw Error("Authentication required");return await (0,r.dw)("/admin/books",{headers:{Authorization:"Bearer ".concat(e),"X-API-Key":a}})}catch(e){throw console.error("Error fetching books:",e),e}},_=async e=>{try{let a=localStorage.getItem("token"),t=localStorage.getItem("apiKey");if(!a||!t)throw Error("Authentication required");return await (0,r._5)("/admin/books/".concat(e),{headers:{Authorization:"Bearer ".concat(a),"X-API-Key":t}})}catch(e){throw console.error("Error deleting book:",e),e}};var u=t(6068),h=t(5163),b=t.n(h);t(6874);var x=t(4544);let j=e=>{let{isOpen:a,title:t,message:o,onConfirm:s,onCancel:i,isDeleting:r}=e;return a?(0,n.jsx)("div",{className:b().modalOverlay,children:(0,n.jsxs)("div",{className:b().modal,children:[(0,n.jsx)("h2",{children:t}),(0,n.jsx)("p",{children:o}),(0,n.jsxs)("div",{className:b().modalButtons,children:[(0,n.jsx)("button",{onClick:i,className:b().cancelButton,disabled:r,children:"Cancel"}),(0,n.jsx)("button",{onClick:s,className:b().confirmButton,disabled:r,children:r?"Processing...":"Confirm"})]})]})}):null};function k(){let[e,a]=(0,o.useState)("users"),[t,r]=(0,o.useState)([]),[h,k]=(0,o.useState)([]),[g,y]=(0,o.useState)(!0),[N,v]=(0,o.useState)(null),[p,A]=(0,o.useState)({isOpen:!1,type:"",id:null,title:"",message:""}),[C,B]=(0,o.useState)(!1),[w,f]=(0,o.useState)(""),[S,I]=(0,o.useState)(""),E=(0,s.useRouter)(),{user:D}=(0,u.h)();(0,o.useEffect)(()=>{D&&(D.isAdmin||E.push("/"))},[D,E]),(0,o.useEffect)(()=>{(async()=>{try{if(y(!0),v(null),"users"===e){let e=await c();r(e)}else if("books"===e){let e=await m();k(e)}}catch(a){console.error("Error fetching ".concat(e,":"),a),v("Failed to load ".concat(e,". ").concat(a.message))}finally{y(!1)}})()},[e]);let q=e=>new Date(e).toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"}),O=e=>{a(e)},T=(e,a,t,n)=>{A({isOpen:!0,type:e,id:a,title:t,message:n})},U=()=>{A({isOpen:!1,type:"",id:null,title:"",message:""})},K=async()=>{try{switch(B(!0),p.type){case"ban-user":await l(p.id),r(t.map(e=>e._id===p.id?{...e,isBanned:!e.isBanned}:e));break;case"delete-user":await d(p.id),r(t.filter(e=>e._id!==p.id));break;case"delete-book":await _(p.id),k(h.filter(e=>e._id!==p.id))}U()}catch(e){console.error("Error processing action:",e),v("Action failed: ".concat(e.message))}finally{B(!1)}},L=t.filter(e=>{let a=w.toLowerCase();return e.name.toLowerCase().includes(a)||e.email.toLowerCase().includes(a)}),R=h.filter(e=>{let a=S.toLowerCase();return e.title.toLowerCase().includes(a)||e.author.toLowerCase().includes(a)||e.category.toLowerCase().includes(a)});return D?D&&!D.isAdmin?(0,n.jsx)("div",{className:b().error,children:"Access denied. Admin privileges required."}):(0,n.jsxs)("div",{className:b().container,children:[(0,n.jsx)("h1",{className:b().title,children:"Admin Dashboard"}),(0,n.jsxs)("div",{className:b().tabs,children:[(0,n.jsxs)("button",{className:"".concat(b().tab," ").concat("users"===e?b().activeTab:""),onClick:()=>O("users"),children:[(0,n.jsx)(i.x$1,{})," Manage Users"]}),(0,n.jsxs)("button",{className:"".concat(b().tab," ").concat("books"===e?b().activeTab:""),onClick:()=>O("books"),children:[(0,n.jsx)(i.vd0,{})," Manage Books"]})]}),N&&(0,n.jsx)("div",{className:b().error,children:N}),"users"===e&&(0,n.jsxs)("div",{className:b().tabContent,children:[(0,n.jsx)("div",{className:b().searchContainer,children:(0,n.jsx)(x.A,{placeholder:"Search users by name or email...",onSearch:f,initialValue:w,debounceTime:500,className:b().searchBar})}),g?(0,n.jsx)("div",{className:b().loading,children:"Loading users..."}):L.length>0?(0,n.jsx)("div",{className:b().tableContainer,children:(0,n.jsxs)("table",{className:b().table,children:[(0,n.jsx)("thead",{children:(0,n.jsxs)("tr",{children:[(0,n.jsx)("th",{children:"Name"}),(0,n.jsx)("th",{children:"Email"}),(0,n.jsx)("th",{children:"Joined"}),(0,n.jsx)("th",{children:"Status"}),(0,n.jsx)("th",{children:"Admin"}),(0,n.jsx)("th",{children:"Actions"})]})}),(0,n.jsx)("tbody",{children:L.map(e=>(0,n.jsxs)("tr",{children:[(0,n.jsx)("td",{className:b().userName,children:e.name}),(0,n.jsx)("td",{children:e.email}),(0,n.jsx)("td",{children:q(e.createdAt)}),(0,n.jsx)("td",{children:(0,n.jsx)("span",{className:"".concat(b().status," ").concat(e.isBanned?b().banned:b().active),children:e.isBanned?"Banned":"Active"})}),(0,n.jsx)("td",{children:(0,n.jsx)("span",{className:"".concat(b().adminStatus," ").concat(e.isAdmin?b().isAdmin:""),children:e.isAdmin?"Yes":"No"})}),(0,n.jsx)("td",{className:b().actions,children:!e.isAdmin&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("button",{className:"".concat(b().actionButton," ").concat(e.isBanned?b().unbanButton:b().banButton),onClick:()=>T("ban-user",e._id,e.isBanned?"Unban User":"Ban User",e.isBanned?"Are you sure you want to unban ".concat(e.name,"?"):"Are you sure you want to ban ".concat(e.name,"? They will no longer be able to log in.")),title:e.isBanned?"Unban User":"Ban User",children:e.isBanned?(0,n.jsx)(i.YVu,{}):(0,n.jsx)(i.Rqy,{})}),(0,n.jsx)("button",{className:"".concat(b().actionButton," ").concat(b().deleteButton),onClick:()=>T("delete-user",e._id,"Delete User","Are you sure you want to permanently delete ".concat(e.name,"? This action cannot be undone.")),title:"Delete User",children:(0,n.jsx)(i.qbC,{})})]})})]},e._id))})]})}):(0,n.jsx)("div",{className:b().noResults,children:"No users found"})]}),"books"===e&&(0,n.jsxs)("div",{className:b().tabContent,children:[(0,n.jsx)("div",{className:b().searchContainer,children:(0,n.jsx)(x.A,{placeholder:"Search books by title, author, or category...",onSearch:I,initialValue:S,debounceTime:500,className:b().searchBar})}),g?(0,n.jsx)("div",{className:b().loading,children:"Loading books..."}):R.length>0?(0,n.jsx)("div",{className:b().bookGrid,children:R.map(e=>(0,n.jsxs)("div",{className:b().bookCard,children:[(0,n.jsx)("div",{className:b().bookCover,children:e.coverImage?(0,n.jsx)("img",{src:e.coverImage,alt:e.title}):(0,n.jsx)("div",{className:b().placeholderCover,children:(0,n.jsx)(i.vd0,{})})}),(0,n.jsxs)("div",{className:b().bookInfo,children:[(0,n.jsx)("h3",{className:b().bookTitle,children:e.title}),(0,n.jsxs)("p",{className:b().bookAuthor,children:["by ",e.author]}),(0,n.jsx)("p",{className:b().bookCategory,children:e.category}),(0,n.jsxs)("div",{className:b().bookStats,children:[(0,n.jsxs)("span",{className:b().stat,children:[(0,n.jsx)(i.Ny1,{})," ",e.views||0]}),(0,n.jsxs)("span",{className:b().stat,children:[(0,n.jsx)(i.WCW,{})," ",e.downloads||0]}),(0,n.jsxs)("span",{className:b().stat,children:[(0,n.jsx)(i.gt3,{})," ",e.averageRating?e.averageRating.toFixed(1):"0.0"]})]}),(0,n.jsxs)("div",{className:b().bookMeta,children:[(0,n.jsxs)("span",{className:b().bookDate,children:[(0,n.jsx)(i.bfZ,{})," ",q(e.createdAt)]}),e.uploadedBy&&(0,n.jsxs)("span",{className:b().bookUploader,children:[(0,n.jsx)(i.x$1,{})," ",e.uploadedBy.name]})]}),(0,n.jsx)("div",{className:b().bookActions,children:(0,n.jsxs)("button",{className:"".concat(b().bookAction," ").concat(b().deleteButton),onClick:()=>T("delete-book",e._id,"Delete Book",'Are you sure you want to permanently delete "'.concat(e.title,'"? This action cannot be undone.')),title:"Delete Book",children:[(0,n.jsx)(i.qbC,{})," Delete"]})})]})]},e._id))}):(0,n.jsx)("div",{className:b().noResults,children:"No books found"})]}),(0,n.jsx)(j,{isOpen:p.isOpen,title:p.title,message:p.message,onConfirm:K,onCancel:U,isDeleting:C})]}):(0,n.jsx)("div",{className:b().loading,children:"Checking authentication..."})}}},e=>{var a=a=>e(e.s=a);e.O(0,[227,711,874,912,441,684,358],()=>a(1420)),_N_E=e.O()}]);