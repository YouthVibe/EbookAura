(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3698],{678:e=>{e.exports={searchContainer:"SearchInput_searchContainer___sjMJ",searchIcon:"SearchInput_searchIcon__VZTMd",searchInput:"SearchInput_searchInput__ctvX9",clearButton:"SearchInput_clearButton__Qhd8D"}},35695:(e,t,a)=>{"use strict";var n=a(18999);a.o(n,"useParams")&&a.d(t,{useParams:function(){return n.useParams}}),a.o(n,"usePathname")&&a.d(t,{usePathname:function(){return n.usePathname}}),a.o(n,"useRouter")&&a.d(t,{useRouter:function(){return n.useRouter}}),a.o(n,"useSearchParams")&&a.d(t,{useSearchParams:function(){return n.useSearchParams}})},47544:e=>{e.exports={container:"admin_container__uVSVc",title:"admin_title__cLzhO",tabs:"admin_tabs__7q5Ma",tab:"admin_tab__3pwcu",activeTab:"admin_activeTab__GZaQ8",tabContent:"admin_tabContent__hNXoi",searchContainer:"admin_searchContainer__kL4Hc",search:"admin_search__c4hwg",searchIcon:"admin_searchIcon__HTKcv",searchInput:"admin_searchInput__Ylvz_",loading:"admin_loading__OjQcq",error:"admin_error__Cw8at",noResults:"admin_noResults__T6qDu",tableContainer:"admin_tableContainer__GVxxO",table:"admin_table__Wi_BD",userName:"admin_userName__T5jos",status:"admin_status__QOVm_",active:"admin_active__3D2D6",banned:"admin_banned__btdd7",adminStatus:"admin_adminStatus__3Da9D",isAdmin:"admin_isAdmin__GL8na",actions:"admin_actions__quNLt",actionButton:"admin_actionButton__sA_2Z",banButton:"admin_banButton__q_y5Y",unbanButton:"admin_unbanButton__W_A6t",deleteButton:"admin_deleteButton__CwIux",bookGrid:"admin_bookGrid__3rKuo",bookCard:"admin_bookCard__gV2SK",bookCover:"admin_bookCover__HmZod",placeholderCover:"admin_placeholderCover__SH1F7",bookInfo:"admin_bookInfo__frg_2",bookTitle:"admin_bookTitle__Kx_Oj",bookAuthor:"admin_bookAuthor__lV80i",bookCategory:"admin_bookCategory__uOK05",bookStats:"admin_bookStats__hC9AF",stat:"admin_stat__xyVzX",bookMeta:"admin_bookMeta__8Au3D",bookDate:"admin_bookDate__C2L3U",bookUploader:"admin_bookUploader__6cGyv",bookActions:"admin_bookActions__EE5lT",bookAction:"admin_bookAction__sRlpm",editButton:"admin_editButton__TQW_p",modalOverlay:"admin_modalOverlay___9oQR",fadeIn:"admin_fadeIn__fe57e",modal:"admin_modal__DNvY3",slideIn:"admin_slideIn__i5BOb",modalButtons:"admin_modalButtons__zUpVq",cancelButton:"admin_cancelButton__1fEHQ",disabledButton:"admin_disabledButton__h30Dz",confirmButton:"admin_confirmButton__EoHw2",editBookModal:"admin_editBookModal__BFDuH",modalHeader:"admin_modalHeader__frRax",closeButton:"admin_closeButton__zfJji",editBookForm:"admin_editBookForm__6f4Tn",formSection:"admin_formSection__y3ZQa",sectionTitle:"admin_sectionTitle__1MY2W",formGroup:"admin_formGroup__W0nf_",charCount:"admin_charCount__VKVYx",charCountWarning:"admin_charCountWarning__24y_t",charCountExceeded:"admin_charCountExceeded__VhncN",requiredField:"admin_requiredField__Pqulz",helpText:"admin_helpText__IKevK",inputError:"admin_inputError__k0Wmd",tagInputContainer:"admin_tagInputContainer__1OtFi",addTagButton:"admin_addTagButton__G1xt_",selectedTagsContainer:"admin_selectedTagsContainer__Lj5I0",tagPill:"admin_tagPill__yq1v3",removeTagButton:"admin_removeTagButton__twsAQ",suggestionsList:"admin_suggestionsList__71cZa",suggestionItem:"admin_suggestionItem__M7QUC",fileSwitchContainer:"admin_fileSwitchContainer__tkMfS",fileSwitch:"admin_fileSwitch__ScfUl",activePdfSwitch:"admin_activePdfSwitch__PoOs8",fileInputContainer:"admin_fileInputContainer__CLEPS",fileInput:"admin_fileInput__vM_4F",fileInputLabel:"admin_fileInputLabel__hOhf0",fileIcon:"admin_fileIcon__eaWIQ",fileName:"admin_fileName__DNd71",checkboxGroup:"admin_checkboxGroup__9m3zc",checkboxLabel:"admin_checkboxLabel__B8zp6",formActions:"admin_formActions__OKf6z",saveButton:"admin_saveButton__CPkRZ",uploadProgressContainer:"admin_uploadProgressContainer__UdQt9",uploadStatus:"admin_uploadStatus__tf4E_",progressBarWrapper:"admin_progressBarWrapper__x_Jza",progressBar:"admin_progressBar__Gt27P",adminActions:"admin_adminActions__SHyvh",adminActionButton:"admin_adminActionButton__s6__7",cleanupResults:"admin_cleanupResults__Jmv_L",cleanupSummary:"admin_cleanupSummary__OyN_e",cleanupErrors:"admin_cleanupErrors__GCYMs",cleanupError:"admin_cleanupError__uYCYW"}},54544:(e,t,a)=>{"use strict";a.d(t,{A:()=>l});var n=a(95155),s=a(29911),r=a(12115),i=a(678),o=a.n(i);function l(e){let{placeholder:t="Search...",onSearch:a,initialValue:i="",debounceTime:l=300,className:c=""}=e,[d,u]=(0,r.useState)(i);return(0,r.useEffect)(()=>{u(i)},[i]),(0,r.useEffect)(()=>{let e=setTimeout(()=>{a&&a(d)},l);return()=>clearTimeout(e)},[d,a,l]),(0,n.jsxs)("div",{className:"".concat(o().searchContainer," ").concat(c),children:[(0,n.jsx)(s.KSO,{className:o().searchIcon}),(0,n.jsx)("input",{type:"text",placeholder:t,value:d,onChange:e=>u(e.target.value),className:o().searchInput,"aria-label":"Search input"}),d&&(0,n.jsx)("button",{className:o().clearButton,onClick:()=>{u(""),a&&a("")},"aria-label":"Clear search",children:"\xd7"})]})}},58887:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>y});var n=a(95155),s=a(12115),r=a(35695),i=a(29911),o=a(72047);let l=async()=>{try{let e=localStorage.getItem("token"),t=localStorage.getItem("apiKey");if(!e||!t)throw Error("Authentication required");return await (0,o.dw)("/admin/users",{headers:{Authorization:"Bearer ".concat(e),"X-API-Key":t}})}catch(e){throw console.error("Error fetching users:",e),e}},c=async e=>{try{let t=localStorage.getItem("token"),a=localStorage.getItem("apiKey");if(!t||!a)throw Error("Authentication required");return await (0,o.q1)("/admin/users/".concat(e,"/ban"),{},{headers:{Authorization:"Bearer ".concat(t),"X-API-Key":a}})}catch(e){throw console.error("Error toggling user ban status:",e),e}},d=async e=>{try{let t=localStorage.getItem("token"),a=localStorage.getItem("apiKey");if(!t||!a)throw Error("Authentication required");return await (0,o._5)("/admin/users/".concat(e),{headers:{Authorization:"Bearer ".concat(t),"X-API-Key":a}})}catch(e){throw console.error("Error deleting user:",e),e}},u=async()=>{try{let e=localStorage.getItem("token"),t=localStorage.getItem("apiKey");if(!e||!t)throw Error("Authentication required");return await (0,o.dw)("/admin/books",{headers:{Authorization:"Bearer ".concat(e),"X-API-Key":t}})}catch(e){throw console.error("Error fetching books:",e),e}},m=async e=>{try{let t=localStorage.getItem("token"),a=localStorage.getItem("apiKey");if(!t||!a)throw Error("Authentication required");return await (0,o._5)("/admin/books/".concat(e),{headers:{Authorization:"Bearer ".concat(t),"X-API-Key":a}})}catch(e){throw console.error("Error deleting book:",e),e}},h=async()=>{try{let e=localStorage.getItem("token"),t=localStorage.getItem("apiKey");if(!e||!t)throw Error("Authentication required");return await (0,o.Xj)("/admin/cleanup-cloudinary",{},{headers:{Authorization:"Bearer ".concat(e),"X-API-Key":t}})}catch(e){throw console.error("Error cleaning up Cloudinary resources:",e),e}},p=async function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;try{let n=a||localStorage.getItem("token"),s=localStorage.getItem("apiKey");if(!n||!s)throw Error("Authentication required");return await (0,o.q1)("/admin/books/".concat(e),t,{headers:{Authorization:"Bearer ".concat(n),"X-API-Key":s}})}catch(e){throw console.error("Error updating book:",e),e}};var _=a(56068),g=a(47544),x=a.n(g);a(6874);var b=a(54544),f=a(10351);let j=e=>{let{isOpen:t,title:a,message:s,onConfirm:r,onCancel:i,isDeleting:o}=e;return t?(0,n.jsx)("div",{className:x().modalOverlay,children:(0,n.jsxs)("div",{className:x().modal,children:[(0,n.jsx)("h2",{children:a}),(0,n.jsx)("p",{children:s}),(0,n.jsxs)("div",{className:x().modalButtons,children:[(0,n.jsx)("button",{onClick:i,className:"".concat(x().cancelButton," ").concat(o?x().disabledButton:""),disabled:o,children:"Cancel"}),(0,n.jsx)("button",{onClick:r,className:"".concat(x().confirmButton," ").concat(o?x().disabledButton:""),disabled:o,children:o?"Processing...":"Confirm"})]})]})}):null},v=e=>{let{isOpen:t,book:a,onSave:r,onCancel:o,isSaving:l}=e,[c,d]=(0,s.useState)({title:"",author:"",description:"",category:"",tags:[],pageSize:0,isPremium:!1,price:0}),[u,m]=(0,s.useState)(null),[h,p]=(0,s.useState)(null),[_,g]=(0,s.useState)("No new PDF selected"),[b,j]=(0,s.useState)("No new cover image selected"),[v,y]=(0,s.useState)(""),[N,C]=(0,s.useState)(""),[S,k]=(0,s.useState)(!1),[B,w]=(0,s.useState)(""),[P,A]=(0,s.useState)(0),[F,I]=(0,s.useState)(0),[E,O]=(0,s.useState)(0),[T,D]=(0,s.useState)(""),[L,z]=(0,s.useState)(!1),[M,U]=(0,s.useState)([]),[R,q]=(0,s.useState)(0),[G,K]=(0,s.useState)(!1),[W,H]=(0,s.useState)(""),V=(0,s.useRef)(null),Q=(0,s.useRef)(null),[Y,X]=(0,s.useState)(!1),[Z,J]=(0,s.useState)([]),$=["Contemporary Fiction","Literary Fiction","Historical Fiction","Science Fiction","Fantasy","Mystery","Thriller","Horror","Romance","Western","Crime Fiction","Adventure","Military Fiction","Urban Fiction","Short Stories","Young Adult Fiction","Children's Fiction","Classic Literature","Mythology","Folk Tales","Biography","Autobiography","Memoir","History","Philosophy","Psychology","Self-Help","Business","Economics","Science","Technology","Computer Science","Programming","Art","Music","Sports","Travel","Cooking","Health","Religion"].sort(),ee=["Adventure","Romance","Mystery","Thriller","Fantasy","Science Fiction","Horror","Historical","Contemporary","Literary Fiction","Young Adult","Children","Biography","Self-Help","Business","Psychology","Science","Technology","Programming","Health","Education","Politics","Sports","Art","Music"].sort();if((0,s.useEffect)(()=>{a&&t&&(d({title:a.title||"",author:a.author||"",description:a.description||"",category:a.category||"",tags:a.tags||[],pageSize:a.pageSize||0,isPremium:a.isPremium||!1,price:a.price||0,fileSizeMB:a.fileSizeMB||0}),g("No new PDF selected"),j("No new cover image selected"),m(null),p(null),C(""),w(a.isCustomUrl?a.pdfUrl:""),k(a.isCustomUrl||!1),A(a.title?a.title.length:0),I(a.author?a.author.length:0),O(a.description?a.description.length:0),D(a.category||""))},[a,t]),(0,s.useEffect)(()=>{T?U($.filter(e=>e.toLowerCase().includes(T.toLowerCase())).slice(0,5)):U($.slice(0,5))},[T]),(0,s.useEffect)(()=>{v?J(ee.filter(e=>e.toLowerCase().includes(v.toLowerCase())&&!c.tags.includes(e)).slice(0,5)):J(ee.filter(e=>!c.tags.includes(e)).slice(0,5))},[v,c.tags]),(0,s.useEffect)(()=>{function e(e){V.current&&!V.current.contains(e.target)&&z(!1),Q.current&&!Q.current.contains(e.target)&&X(!1)}return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[]),!t)return null;let et=e=>{k(e),e?(m(null),g("No new PDF selected")):w("")},ea=e=>new Promise((t,a)=>{let n=new Image;n.onload=()=>{URL.revokeObjectURL(n.src);let e=n.width,a=n.height;500===e&&700===a?t({valid:!0,width:e,height:a,message:"Image dimensions are correct: ".concat(e,"x").concat(a," pixels")}):t({valid:!1,width:e,height:a,message:"Image must be exactly 500x700 pixels, but got ".concat(e,"x").concat(a," pixels")})},n.onerror=()=>{URL.revokeObjectURL(n.src),a(Error("Failed to load the image. Please try another file."))},n.src=URL.createObjectURL(e)}),en=async e=>{let t=e.target.files[0];if(t){if(!t.type.startsWith("image/")){C("Please select an image file for the cover"),p(null),j("No new cover image selected");return}if(t.size>5242880){C("Cover image size should be less than 5MB"),p(null),j("No new cover image selected");return}try{let e=await ea(t);if(!e.valid){C(e.message),p(null),j("No new cover image selected");return}p(t),j(t.name),C("")}catch(e){C(e.message),p(null),j("No new cover image selected")}}},es=e=>{let{name:t,value:a,type:n,checked:s}=e.target;"title"===t&&(A(a.length),a.length>100?C("Title must be under 100 characters"):C("")),"author"===t&&(I(a.length),a.length>100?C("Author name must be under 100 characters"):C("")),"description"===t&&(O(a.length),a.length>1e3?C("Description must be under 1000 characters"):C("")),d(e=>({...e,[t]:"checkbox"===n?s:a}))},er=e=>{let t=e.trim();t&&!c.tags.includes(t)&&(d(e=>({...e,tags:[...e.tags,t]})),y(""))},ei=e=>{er(e),X(!1)},eo=e=>{d(t=>({...t,tags:t.tags.filter(t=>t!==e)}))},el=e=>{D(e),d(t=>({...t,category:e})),z(!1)},ec=(e,t)=>e>t?x().charCountExceeded:e>.8*t?x().charCountWarning:x().charCount,ed=()=>c.title.trim()?c.title.length>100?(C("Title must be under 100 characters"),!1):c.author.trim()?c.author.length>100?(C("Author name must be under 100 characters"),!1):c.description.trim()?c.description.length>1e3?(C("Description must be under 1000 characters"),!1):c.category.trim()?0===c.tags.length?(C("Please add at least one tag"),!1):S&&!B.trim()?(C("Please enter a PDF URL"),!1):S&&!B.startsWith("http")?(C("Please enter a valid URL starting with http:// or https://"),!1):!c.isPremium||!!c.price&&!(c.price<=0)||(C("Please enter a valid price for premium content"),!1):(C("Please select or enter a category"),!1):(C("Please provide a book description"),!1):(C("Please enter the author name"),!1):(C("Please enter a book title"),!1);return(0,n.jsx)("div",{className:x().modalOverlay,children:(0,n.jsxs)("div",{className:"".concat(x().modal," ").concat(x().editBookModal),children:[(0,n.jsxs)("div",{className:x().modalHeader,children:[(0,n.jsx)("h2",{children:"Edit Book"}),(0,n.jsx)("button",{onClick:o,className:"".concat(x().closeButton," ").concat(l?x().disabledButton:""),disabled:l,children:(0,n.jsx)(f.yGN,{})})]}),N&&(0,n.jsx)("div",{className:x().error,children:N}),G&&(0,n.jsxs)("div",{className:x().uploadProgressContainer,children:[(0,n.jsx)("p",{className:x().uploadStatus,children:W}),(0,n.jsx)("div",{className:x().progressBarWrapper,children:(0,n.jsx)("div",{className:x().progressBar,style:{width:"".concat(R,"%")}})})]}),(0,n.jsxs)("form",{onSubmit:e=>{if(e.preventDefault(),!ed())return;let t=new FormData;Object.keys(c).forEach(e=>{"tags"===e?t.append(e,JSON.stringify(c[e])):t.append(e,c[e])}),u&&t.append("pdf",u),S&&B&&(t.append("isCustomUrl","true"),t.append("pdfUrl",B.trim()),t.append("fileSizeMB",c.fileSizeMB||0)),h&&t.append("cover",h),K(!0),H("Processing your update..."),r(a._id,t)},className:x().editBookForm,children:[(0,n.jsxs)("div",{className:x().formSection,children:[(0,n.jsx)("h3",{className:x().sectionTitle,children:"Basic Information"}),(0,n.jsxs)("div",{className:x().formGroup,children:[(0,n.jsxs)("label",{htmlFor:"title",children:["Title ",(0,n.jsx)("span",{className:x().requiredField,children:"*"}),(0,n.jsxs)("span",{className:ec(P,100),children:[P,"/100"]})]}),(0,n.jsx)("input",{type:"text",id:"title",name:"title",value:c.title,onChange:es,maxLength:100,className:P>100?x().inputError:""})]}),(0,n.jsxs)("div",{className:x().formGroup,children:[(0,n.jsxs)("label",{htmlFor:"author",children:["Author ",(0,n.jsx)("span",{className:x().requiredField,children:"*"}),(0,n.jsxs)("span",{className:ec(F,100),children:[F,"/100"]})]}),(0,n.jsx)("input",{type:"text",id:"author",name:"author",value:c.author,onChange:es,maxLength:100,className:F>100?x().inputError:""})]}),(0,n.jsxs)("div",{className:x().formGroup,children:[(0,n.jsxs)("label",{htmlFor:"description",children:["Description ",(0,n.jsx)("span",{className:x().requiredField,children:"*"}),(0,n.jsxs)("span",{className:ec(E,1e3),children:[E,"/1000"]})]}),(0,n.jsx)("textarea",{id:"description",name:"description",value:c.description,onChange:es,rows:5,maxLength:1e3,className:E>1e3?x().inputError:""})]}),(0,n.jsxs)("div",{className:x().formGroup,ref:V,children:[(0,n.jsxs)("label",{htmlFor:"category",children:["Category ",(0,n.jsx)("span",{className:x().requiredField,children:"*"})]}),(0,n.jsx)("input",{type:"text",id:"category",name:"category",value:T,onChange:e=>{D(e.target.value),d(t=>({...t,category:e.target.value})),z(!0)},onFocus:()=>z(!0),onKeyDown:e=>{"Enter"===e.key&&e.target.value.trim()&&(e.preventDefault(),z(!1))},placeholder:"Select or type a category"}),L&&(0,n.jsx)("div",{className:x().suggestionsList,children:M.map((e,t)=>(0,n.jsx)("div",{className:x().suggestionItem,onClick:()=>el(e),children:e},t))})]})]}),(0,n.jsxs)("div",{className:x().formSection,children:[(0,n.jsx)("h3",{className:x().sectionTitle,children:"Tags"}),(0,n.jsxs)("div",{className:x().formGroup,ref:Q,children:[(0,n.jsxs)("label",{htmlFor:"tags",children:["Tags ",(0,n.jsx)("span",{className:x().requiredField,children:"*"}),(0,n.jsx)("span",{className:x().helpText,children:"(At least one tag required)"})]}),(0,n.jsxs)("div",{className:x().tagInputContainer,children:[(0,n.jsx)("input",{type:"text",id:"tagInput",value:v,onChange:e=>{y(e.target.value),X(!0)},onFocus:()=>X(!0),onKeyDown:e=>{"Enter"===e.key&&v.trim()&&(e.preventDefault(),er(v.trim()))},placeholder:"Type and press Enter to add a tag"}),(0,n.jsx)("button",{type:"button",onClick:()=>er(v),className:x().addTagButton,disabled:!v.trim(),children:(0,n.jsx)(i.OiG,{})})]}),Y&&(0,n.jsx)("div",{className:x().suggestionsList,children:Z.map((e,t)=>(0,n.jsx)("div",{className:x().suggestionItem,onClick:()=>ei(e),children:e},t))}),(0,n.jsx)("div",{className:x().selectedTagsContainer,children:c.tags.map((e,t)=>(0,n.jsxs)("div",{className:x().tagPill,children:[e,(0,n.jsx)("button",{type:"button",onClick:()=>eo(e),className:x().removeTagButton,children:(0,n.jsx)(i.QCr,{})})]},t))})]})]}),(0,n.jsxs)("div",{className:x().formSection,children:[(0,n.jsx)("h3",{className:x().sectionTitle,children:"Files"}),(0,n.jsxs)("div",{className:x().fileSwitchContainer,children:[(0,n.jsx)("button",{type:"button",className:"".concat(x().fileSwitch," ").concat(S?"":x().activePdfSwitch),onClick:()=>et(!1),children:"Upload PDF"}),(0,n.jsx)("button",{type:"button",className:"".concat(x().fileSwitch," ").concat(S?x().activePdfSwitch:""),onClick:()=>et(!0),children:"PDF URL"})]}),S?(0,n.jsxs)("div",{className:x().formGroup,children:[(0,n.jsxs)("label",{htmlFor:"pdfUrl",children:["PDF URL ",(0,n.jsx)("span",{className:x().helpText,children:"(Enter URL to an existing PDF)"})]}),(0,n.jsx)("input",{type:"url",id:"pdfUrl",name:"pdfUrl",value:B,onChange:e=>{let t=e.target.value;w(t),t&&!t.startsWith("http")?C("Please enter a valid URL starting with http:// or https://"):C("")},placeholder:"https://example.com/your-book.pdf"}),S&&(0,n.jsxs)("div",{className:x().formGroup,style:{marginTop:"10px"},children:[(0,n.jsxs)("label",{htmlFor:"fileSizeMB",children:["File Size (MB) ",(0,n.jsx)("span",{className:x().helpText,children:"(Required for URL PDFs)"})]}),(0,n.jsx)("input",{type:"number",id:"fileSizeMB",name:"fileSizeMB",value:c.fileSizeMB||"",onChange:e=>d({...c,fileSizeMB:parseFloat(e.target.value)||0}),placeholder:"Enter file size in MB",min:"0.1",step:"0.1"})]})]}):(0,n.jsxs)("div",{className:x().formGroup,children:[(0,n.jsxs)("label",{htmlFor:"pdfFile",children:["PDF File ",(0,n.jsx)("span",{className:x().helpText,children:"(Optional - Max 20MB)"})]}),(0,n.jsxs)("div",{className:x().fileInputContainer,children:[(0,n.jsx)("input",{type:"file",id:"pdfFile",accept:".pdf",onChange:e=>{let t=e.target.files[0];if(t){if("application/pdf"!==t.type){C("Please select a PDF file"),m(null),g("No new PDF selected");return}if(t.size>0x1400000){C("PDF file size should be less than 20MB"),m(null),g("No new PDF selected");return}m(t),g(t.name),C("")}},className:x().fileInput}),(0,n.jsxs)("label",{htmlFor:"pdfFile",className:x().fileInputLabel,children:[(0,n.jsx)(i.l1U,{className:x().fileIcon}),"Choose PDF"]}),(0,n.jsx)("div",{className:x().fileName,children:_})]}),(0,n.jsxs)("div",{className:x().helpText,children:["Current PDF: ",a.pdfUrl?"Available":"Not available"]})]}),(0,n.jsxs)("div",{className:x().formGroup,children:[(0,n.jsxs)("label",{htmlFor:"coverFile",children:["Cover Image ",(0,n.jsx)("span",{className:x().helpText,children:"(Optional - Must be 500x700px)"})]}),(0,n.jsxs)("div",{className:x().fileInputContainer,children:[(0,n.jsx)("input",{type:"file",id:"coverFile",accept:"image/*",onChange:en,className:x().fileInput}),(0,n.jsxs)("label",{htmlFor:"coverFile",className:x().fileInputLabel,children:[(0,n.jsx)(i.dkL,{className:x().fileIcon}),"Choose Cover"]}),(0,n.jsx)("div",{className:x().fileName,children:b})]}),(0,n.jsxs)("div",{className:x().helpText,children:["Current Cover: ",a.coverImage?"Available":"Not available"]})]})]}),(0,n.jsxs)("div",{className:x().formSection,children:[(0,n.jsx)("h3",{className:x().sectionTitle,children:"Additional Details"}),(0,n.jsxs)("div",{className:x().formGroup,children:[(0,n.jsxs)("label",{htmlFor:"pageSize",children:["Page Count ",(0,n.jsx)("span",{className:x().helpText,children:"(Optional)"})]}),(0,n.jsx)("input",{type:"number",id:"pageSize",name:"pageSize",value:c.pageSize,onChange:es,min:"0",placeholder:"Number of pages"})]}),(0,n.jsx)("div",{className:x().formGroup,children:(0,n.jsxs)("div",{className:x().checkboxGroup,children:[(0,n.jsx)("input",{type:"checkbox",id:"isPremium",name:"isPremium",checked:c.isPremium,onChange:es}),(0,n.jsx)("label",{htmlFor:"isPremium",className:x().checkboxLabel,children:"Premium Content"})]})}),c.isPremium&&(0,n.jsxs)("div",{className:x().formGroup,children:[(0,n.jsxs)("label",{htmlFor:"price",children:["Price (Coins) ",(0,n.jsx)("span",{className:x().requiredField,children:"*"})]}),(0,n.jsx)("input",{type:"number",id:"price",name:"price",value:c.price,onChange:es,min:"1",placeholder:"Enter price in coins"})]})]}),(0,n.jsxs)("div",{className:x().formActions,children:[(0,n.jsx)("button",{type:"button",onClick:o,className:"".concat(x().cancelButton," ").concat(l?x().disabledButton:""),disabled:l,children:"Cancel"}),(0,n.jsx)("button",{type:"submit",className:"".concat(x().saveButton," ").concat(l?x().disabledButton:""),disabled:l,children:l?"Saving Changes...":"Save Changes"})]})]})]})})};function y(){var e,t,a,o;let[g,y]=(0,s.useState)("users"),[N,C]=(0,s.useState)([]),[S,k]=(0,s.useState)([]),[B,w]=(0,s.useState)(!0),[P,A]=(0,s.useState)(null),[F,I]=(0,s.useState)({isOpen:!1,type:"",id:null,title:"",message:""}),[E,O]=(0,s.useState)(!1),[T,D]=(0,s.useState)(""),[L,z]=(0,s.useState)(""),[M,U]=(0,s.useState)(!1),[R,q]=(0,s.useState)(null),[G,K]=(0,s.useState)(!1),[W,H]=(0,s.useState)(null),[V,Q]=(0,s.useState)(!1),[Y,X]=(0,s.useState)(null),[Z,J]=(0,s.useState)(!1),[$,ee]=(0,s.useState)(""),[et,ea]=(0,s.useState)({type:"",message:""}),en=(0,r.useRouter)(),{user:es,getToken:er,getApiKey:ei}=(0,_.h)();(0,s.useEffect)(()=>{es&&(es.isAdmin||en.push("/"))},[es,en]),(0,s.useEffect)(()=>{(async()=>{try{if(w(!0),A(null),"users"===g){let e=await l();C(e)}else if("books"===g){let e=await u();k(e)}}catch(e){console.error("Error fetching ".concat(g,":"),e),A("Failed to load ".concat(g,". ").concat(e.message))}finally{w(!1)}})()},[g]);let eo=e=>new Date(e).toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"}),el=e=>{y(e)},ec=(e,t,a,n)=>{I({isOpen:!0,type:e,id:t,title:a,message:n})},ed=()=>{I({isOpen:!1,type:"",id:null,title:"",message:""})},eu=async()=>{try{switch(O(!0),F.type){case"ban-user":await c(F.id),C(N.map(e=>e._id===F.id?{...e,isBanned:!e.isBanned}:e));break;case"delete-user":await d(F.id),C(N.filter(e=>e._id!==F.id));break;case"delete-book":await m(F.id),k(S.filter(e=>e._id!==F.id))}ed()}catch(e){console.error("Error processing action:",e),A("Action failed: ".concat(e.message))}finally{O(!1)}},em=N.filter(e=>{let t=T.toLowerCase();return e.name.toLowerCase().includes(t)||e.email.toLowerCase().includes(t)}),eh=S.filter(e=>{let t=L.toLowerCase();return e.title.toLowerCase().includes(t)||e.author.toLowerCase().includes(t)||e.category.toLowerCase().includes(t)}),ep=async()=>{try{K(!0);let e=await h();H(e)}catch(e){console.error("Error cleaning up Cloudinary resources:",e),H({success:!1,error:e.message||"Failed to cleanup Cloudinary resources"})}finally{K(!1)}},e_=e=>{X(e),Q(!0)},eg=async(e,t)=>{J(!0);try{let a=er();if(!a)throw Error("No authentication token found");let n=await p(e,t,a);eb(),ex(),ea({type:"success",message:'Book "'.concat(n.title,'" has been successfully updated.')}),setTimeout(()=>{ea({type:"",message:""})},5e3)}catch(e){console.error("Error updating book:",e),ee(e.message||"An error occurred while updating the book"),ea({type:"error",message:e.message||"Failed to update book. Please try again."}),setTimeout(()=>{ea({type:"",message:""})},5e3)}finally{J(!1)}},ex=async()=>{try{w(!0),A(null);let e=await u();k(e)}catch(e){console.error("Error fetching books:",e),A("Failed to load books. ".concat(e.message))}finally{w(!1)}},eb=()=>{Q(!1),X(null),ee("")};return es?es&&!es.isAdmin?(0,n.jsx)("div",{className:x().error,children:"Access denied. Admin privileges required."}):(0,n.jsxs)("div",{className:x().container,children:[(0,n.jsx)("h1",{className:x().title,children:"Admin Dashboard"}),(0,n.jsxs)("div",{className:x().tabs,children:[(0,n.jsxs)("button",{className:"".concat(x().tab," ").concat("users"===g?x().activeTab:""),onClick:()=>el("users"),children:[(0,n.jsx)(i.x$1,{})," Manage Users"]}),(0,n.jsxs)("button",{className:"".concat(x().tab," ").concat("books"===g?x().activeTab:""),onClick:()=>el("books"),children:[(0,n.jsx)(i.vd0,{})," Manage Books"]})]}),P&&(0,n.jsx)("div",{className:x().error,children:P}),(0,n.jsx)("div",{className:x().adminActions,children:(0,n.jsxs)("button",{className:"".concat(x().adminActionButton," ").concat(G?x().disabledButton:""),onClick:ep,disabled:G,children:[(0,n.jsx)(f.DmM,{}),G?"Cleaning up...":"Cleanup Cloudinary Resources"]})}),W&&(0,n.jsxs)("div",{className:x().cleanupResults,children:[(0,n.jsx)("h3",{children:"Cloudinary Cleanup Results"}),(0,n.jsx)("div",{className:x().cleanupSummary,children:W.error?(0,n.jsxs)("p",{children:[(0,n.jsx)("strong",{children:"Error:"})," ",W.error||"Unknown error occurred"]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("p",{children:[(0,n.jsx)("strong",{children:"Status:"})," Success"]}),(0,n.jsxs)("p",{children:[(0,n.jsx)("strong",{children:"PDFs Cleaned:"})," ",(null==(t=W.deleted)||null==(e=t.pdfs)?void 0:e.length)||0]}),(0,n.jsxs)("p",{children:[(0,n.jsx)("strong",{children:"Covers Cleaned:"})," ",(null==(o=W.deleted)||null==(a=o.covers)?void 0:a.length)||0]}),W.errors&&W.errors.length>0&&(0,n.jsxs)("p",{className:x().cleanupErrors,children:[(0,n.jsx)("strong",{children:"Errors:"}),W.errors.map((e,t)=>(0,n.jsxs)("div",{className:x().cleanupError,children:["pdf"===e.type?"PDF: ":"Cover: ",e.id?"".concat(e.id," - "):"",e.error||e]},t))]})]})})]}),"users"===g&&(0,n.jsxs)("div",{className:x().tabContent,children:[(0,n.jsx)("div",{className:x().searchContainer,children:(0,n.jsx)(b.A,{placeholder:"Search users by name or email...",onSearch:D,initialValue:T,debounceTime:500,className:x().searchBar})}),B?(0,n.jsx)("div",{className:x().loading,children:"Loading users..."}):em.length>0?(0,n.jsx)("div",{className:x().tableContainer,children:(0,n.jsxs)("table",{className:x().table,children:[(0,n.jsx)("thead",{children:(0,n.jsxs)("tr",{children:[(0,n.jsx)("th",{children:"Name"}),(0,n.jsx)("th",{children:"Email"}),(0,n.jsx)("th",{children:"Joined"}),(0,n.jsx)("th",{children:"Status"}),(0,n.jsx)("th",{children:"Admin"}),(0,n.jsx)("th",{children:"Actions"})]})}),(0,n.jsx)("tbody",{children:em.map(e=>(0,n.jsxs)("tr",{children:[(0,n.jsx)("td",{className:x().userName,children:e.name}),(0,n.jsx)("td",{children:e.email}),(0,n.jsx)("td",{children:eo(e.createdAt)}),(0,n.jsx)("td",{children:(0,n.jsx)("span",{className:"".concat(x().status," ").concat(e.isBanned?x().banned:x().active),children:e.isBanned?"Banned":"Active"})}),(0,n.jsx)("td",{children:(0,n.jsx)("span",{className:"".concat(x().adminStatus," ").concat(e.isAdmin?x().isAdmin:""),children:e.isAdmin?"Yes":"No"})}),(0,n.jsx)("td",{className:x().actions,children:!e.isAdmin&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("button",{className:"".concat(x().actionButton," ").concat(e.isBanned?x().unbanButton:x().banButton),onClick:()=>ec("ban-user",e._id,e.isBanned?"Unban User":"Ban User",e.isBanned?"Are you sure you want to unban ".concat(e.name,"?"):"Are you sure you want to ban ".concat(e.name,"? They will no longer be able to log in.")),title:e.isBanned?"Unban User":"Ban User",children:e.isBanned?(0,n.jsx)(i.YVu,{}):(0,n.jsx)(i.Rqy,{})}),(0,n.jsx)("button",{className:"".concat(x().actionButton," ").concat(x().deleteButton),onClick:()=>ec("delete-user",e._id,"Delete User","Are you sure you want to permanently delete ".concat(e.name,"? This action cannot be undone.")),title:"Delete User",children:(0,n.jsx)(i.qbC,{})})]})})]},e._id))})]})}):(0,n.jsx)("div",{className:x().noResults,children:"No users found"})]}),"books"===g&&(0,n.jsxs)("div",{className:x().tabContent,children:[(0,n.jsx)("div",{className:x().searchContainer,children:(0,n.jsx)(b.A,{placeholder:"Search books by title, author, or category...",onSearch:z,initialValue:L,debounceTime:500,className:x().searchBar})}),B?(0,n.jsx)("div",{className:x().loading,children:"Loading books..."}):eh.length>0?(0,n.jsx)("div",{className:x().bookGrid,children:eh.map(e=>(0,n.jsxs)("div",{className:x().bookCard,children:[(0,n.jsx)("div",{className:x().bookCover,children:e.coverImage?(0,n.jsx)("img",{src:e.coverImage,alt:e.title}):(0,n.jsx)("div",{className:x().placeholderCover,children:(0,n.jsx)(i.vd0,{})})}),(0,n.jsxs)("div",{className:x().bookInfo,children:[(0,n.jsx)("h3",{className:x().bookTitle,children:e.title}),(0,n.jsxs)("p",{className:x().bookAuthor,children:["by ",e.author]}),(0,n.jsx)("p",{className:x().bookCategory,children:e.category}),(0,n.jsxs)("div",{className:x().bookStats,children:[(0,n.jsxs)("span",{className:x().stat,children:[(0,n.jsx)(i.Ny1,{})," ",e.views||0]}),(0,n.jsxs)("span",{className:x().stat,children:[(0,n.jsx)(i.WCW,{})," ",e.downloads||0]}),(0,n.jsxs)("span",{className:x().stat,children:[(0,n.jsx)(i.gt3,{})," ",e.averageRating?e.averageRating.toFixed(1):"0.0"]}),e.fileSizeMB>0&&(0,n.jsxs)("span",{className:x().stat,children:[(0,n.jsx)(i.Gp9,{})," ",e.fileSizeMB,"MB"]})]}),(0,n.jsxs)("div",{className:x().bookMeta,children:[(0,n.jsxs)("span",{className:x().bookDate,children:[(0,n.jsx)(i.bfZ,{})," ",eo(e.createdAt)]}),e.uploadedBy&&(0,n.jsxs)("span",{className:x().bookUploader,children:[(0,n.jsx)(i.x$1,{})," ",e.uploadedBy.name]})]}),(0,n.jsxs)("div",{className:x().bookActions,children:[(0,n.jsxs)("button",{className:"".concat(x().bookAction," ").concat(x().editButton),onClick:()=>e_(e),title:"Edit Book",children:[(0,n.jsx)(i.uO9,{})," Edit"]}),(0,n.jsxs)("button",{className:"".concat(x().bookAction," ").concat(x().deleteButton),onClick:()=>ec("delete-book",e._id,"Delete Book",'Are you sure you want to permanently delete "'.concat(e.title,'"? This will delete the book record, PDF file, cover image, and all associated reviews and bookmarks. This action cannot be undone.')),title:"Delete Book",children:[(0,n.jsx)(i.qbC,{})," Delete"]})]})]})]},e._id))}):(0,n.jsx)("div",{className:x().noResults,children:"No books found"})]}),(0,n.jsx)(j,{isOpen:F.isOpen,title:F.title,message:F.message,onConfirm:eu,onCancel:ed,isDeleting:E}),(0,n.jsx)(v,{isOpen:V,book:Y,onSave:eg,onCancel:()=>Q(!1),isSaving:Z})]}):(0,n.jsx)("div",{className:x().loading,children:"Checking authentication..."})}},71420:(e,t,a)=>{Promise.resolve().then(a.bind(a,58887))},74436:(e,t,a)=>{"use strict";a.d(t,{k5:()=>d});var n=a(12115),s={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},r=n.createContext&&n.createContext(s),i=["attr","size","title"];function o(){return(o=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function l(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),a.push.apply(a,n)}return a}function c(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?l(Object(a),!0).forEach(function(t){var n,s,r;n=e,s=t,r=a[t],(s=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var n=a.call(e,t||"default");if("object"!=typeof n)return n;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(s))in n?Object.defineProperty(n,s,{value:r,enumerable:!0,configurable:!0,writable:!0}):n[s]=r}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):l(Object(a)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}return e}function d(e){return t=>n.createElement(u,o({attr:c({},e.attr)},t),function e(t){return t&&t.map((t,a)=>n.createElement(t.tag,c({key:a},t.attr),e(t.child)))}(e.child))}function u(e){var t=t=>{var a,{attr:s,size:r,title:l}=e,d=function(e,t){if(null==e)return{};var a,n,s=function(e,t){if(null==e)return{};var a={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;a[n]=e[n]}return a}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)a=r[n],!(t.indexOf(a)>=0)&&Object.prototype.propertyIsEnumerable.call(e,a)&&(s[a]=e[a])}return s}(e,i),u=r||t.size||"1em";return t.className&&(a=t.className),e.className&&(a=(a?a+" ":"")+e.className),n.createElement("svg",o({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},t.attr,s,d,{className:a,style:c(c({color:e.color||t.color},t.style),e.style),height:u,width:u,xmlns:"http://www.w3.org/2000/svg"}),l&&n.createElement("title",null,l),e.children)};return void 0!==r?n.createElement(r.Consumer,null,e=>t(e)):t(s)}}},e=>{var t=t=>e(e.s=t);e.O(0,[2227,6711,844,6874,6068,8441,1684,7358],()=>t(71420)),_N_E=e.O()}]);