(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3698],{47544:e=>{e.exports={container:"admin_container__uVSVc",title:"admin_title__cLzhO",tabs:"admin_tabs__7q5Ma",tab:"admin_tab__3pwcu",activeTab:"admin_activeTab__GZaQ8",tabContent:"admin_tabContent__hNXoi",searchContainer:"admin_searchContainer__kL4Hc",search:"admin_search__c4hwg",searchIcon:"admin_searchIcon__HTKcv",searchInput:"admin_searchInput__Ylvz_",loading:"admin_loading__OjQcq",error:"admin_error__Cw8at",noResults:"admin_noResults__T6qDu",tableContainer:"admin_tableContainer__GVxxO",table:"admin_table__Wi_BD",userName:"admin_userName__T5jos",status:"admin_status__QOVm_",active:"admin_active__3D2D6",banned:"admin_banned__btdd7",adminStatus:"admin_adminStatus__3Da9D",isAdmin:"admin_isAdmin__GL8na",actions:"admin_actions__quNLt",actionButton:"admin_actionButton__sA_2Z",banButton:"admin_banButton__q_y5Y",unbanButton:"admin_unbanButton__W_A6t",deleteButton:"admin_deleteButton__CwIux",bookGrid:"admin_bookGrid__3rKuo",bookCard:"admin_bookCard__gV2SK",bookCover:"admin_bookCover__HmZod",placeholderCover:"admin_placeholderCover__SH1F7",bookInfo:"admin_bookInfo__frg_2",bookTitle:"admin_bookTitle__Kx_Oj",bookAuthor:"admin_bookAuthor__lV80i",bookCategory:"admin_bookCategory__uOK05",bookStats:"admin_bookStats__hC9AF",stat:"admin_stat__xyVzX",bookMeta:"admin_bookMeta__8Au3D",bookDate:"admin_bookDate__C2L3U",bookUploader:"admin_bookUploader__6cGyv",bookActions:"admin_bookActions__EE5lT",bookAction:"admin_bookAction__sRlpm",modalOverlay:"admin_modalOverlay___9oQR",fadeIn:"admin_fadeIn__fe57e",modal:"admin_modal__DNvY3",slideUp:"admin_slideUp__iRr3n",modalButtons:"admin_modalButtons__zUpVq",cancelButton:"admin_cancelButton__1fEHQ",confirmButton:"admin_confirmButton__EoHw2",adminActions:"admin_adminActions__SHyvh",adminActionButton:"admin_adminActionButton__s6__7",cleanupResults:"admin_cleanupResults__Jmv_L",cleanupSummary:"admin_cleanupSummary__OyN_e",cleanupErrors:"admin_cleanupErrors__GCYMs",cleanupError:"admin_cleanupError__uYCYW"}},58887:(e,a,n)=>{"use strict";n.r(a),n.d(a,{default:()=>p});var t=n(95155),s=n(12115),o=n(35695),r=n(29911),i=n(72047);let c=async()=>{try{let e=localStorage.getItem("token"),a=localStorage.getItem("apiKey");if(!e||!a)throw Error("Authentication required");return await (0,i.dw)("/admin/users",{headers:{Authorization:"Bearer ".concat(e),"X-API-Key":a}})}catch(e){throw console.error("Error fetching users:",e),e}},l=async e=>{try{let a=localStorage.getItem("token"),n=localStorage.getItem("apiKey");if(!a||!n)throw Error("Authentication required");return await (0,i.q1)("/admin/users/".concat(e,"/ban"),{},{headers:{Authorization:"Bearer ".concat(a),"X-API-Key":n}})}catch(e){throw console.error("Error toggling user ban status:",e),e}},d=async e=>{try{let a=localStorage.getItem("token"),n=localStorage.getItem("apiKey");if(!a||!n)throw Error("Authentication required");return await (0,i._5)("/admin/users/".concat(e),{headers:{Authorization:"Bearer ".concat(a),"X-API-Key":n}})}catch(e){throw console.error("Error deleting user:",e),e}},u=async()=>{try{let e=localStorage.getItem("token"),a=localStorage.getItem("apiKey");if(!e||!a)throw Error("Authentication required");return await (0,i.dw)("/admin/books",{headers:{Authorization:"Bearer ".concat(e),"X-API-Key":a}})}catch(e){throw console.error("Error fetching books:",e),e}},m=async e=>{try{let a=localStorage.getItem("token"),n=localStorage.getItem("apiKey");if(!a||!n)throw Error("Authentication required");return await (0,i._5)("/admin/books/".concat(e),{headers:{Authorization:"Bearer ".concat(a),"X-API-Key":n}})}catch(e){throw console.error("Error deleting book:",e),e}},_=async()=>{try{let e=localStorage.getItem("token"),a=localStorage.getItem("apiKey");if(!e||!a)throw Error("Authentication required");return await (0,i.Xj)("/admin/cleanup-cloudinary",{},{headers:{Authorization:"Bearer ".concat(e),"X-API-Key":a}})}catch(e){throw console.error("Error cleaning up Cloudinary resources:",e),e}};var h=n(56068),b=n(47544),x=n.n(b);n(6874);var j=n(54544),g=n(10351);let k=e=>{let{isOpen:a,title:n,message:s,onConfirm:o,onCancel:r,isDeleting:i}=e;return a?(0,t.jsx)("div",{className:x().modalOverlay,children:(0,t.jsxs)("div",{className:x().modal,children:[(0,t.jsx)("h2",{children:n}),(0,t.jsx)("p",{children:s}),(0,t.jsxs)("div",{className:x().modalButtons,children:[(0,t.jsx)("button",{onClick:r,className:x().cancelButton,disabled:i,children:"Cancel"}),(0,t.jsx)("button",{onClick:o,className:x().confirmButton,disabled:i,children:i?"Processing...":"Confirm"})]})]})}):null};function p(){var e,a,n,i;let[b,p]=(0,s.useState)("users"),[y,v]=(0,s.useState)([]),[N,C]=(0,s.useState)([]),[A,w]=(0,s.useState)(!0),[B,f]=(0,s.useState)(null),[S,E]=(0,s.useState)({isOpen:!1,type:"",id:null,title:"",message:""}),[I,D]=(0,s.useState)(!1),[q,K]=(0,s.useState)(""),[O,T]=(0,s.useState)(""),[U,L]=(0,s.useState)(!1),[R,P]=(0,s.useState)(null),[V,z]=(0,s.useState)(!1),[F,X]=(0,s.useState)(null),G=(0,o.useRouter)(),{user:M}=(0,h.h)();(0,s.useEffect)(()=>{M&&(M.isAdmin||G.push("/"))},[M,G]),(0,s.useEffect)(()=>{(async()=>{try{if(w(!0),f(null),"users"===b){let e=await c();v(e)}else if("books"===b){let e=await u();C(e)}}catch(e){console.error("Error fetching ".concat(b,":"),e),f("Failed to load ".concat(b,". ").concat(e.message))}finally{w(!1)}})()},[b]);let Y=e=>new Date(e).toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"}),H=e=>{p(e)},Q=(e,a,n,t)=>{E({isOpen:!0,type:e,id:a,title:n,message:t})},W=()=>{E({isOpen:!1,type:"",id:null,title:"",message:""})},Z=async()=>{try{switch(D(!0),S.type){case"ban-user":await l(S.id),v(y.map(e=>e._id===S.id?{...e,isBanned:!e.isBanned}:e));break;case"delete-user":await d(S.id),v(y.filter(e=>e._id!==S.id));break;case"delete-book":await m(S.id),C(N.filter(e=>e._id!==S.id))}W()}catch(e){console.error("Error processing action:",e),f("Action failed: ".concat(e.message))}finally{D(!1)}},J=y.filter(e=>{let a=q.toLowerCase();return e.name.toLowerCase().includes(a)||e.email.toLowerCase().includes(a)}),$=N.filter(e=>{let a=O.toLowerCase();return e.title.toLowerCase().includes(a)||e.author.toLowerCase().includes(a)||e.category.toLowerCase().includes(a)}),ee=async()=>{try{z(!0);let e=await _();X(e)}catch(e){console.error("Error cleaning up Cloudinary resources:",e),X({success:!1,error:e.message||"Failed to cleanup Cloudinary resources"})}finally{z(!1)}};return M?M&&!M.isAdmin?(0,t.jsx)("div",{className:x().error,children:"Access denied. Admin privileges required."}):(0,t.jsxs)("div",{className:x().container,children:[(0,t.jsx)("h1",{className:x().title,children:"Admin Dashboard"}),(0,t.jsxs)("div",{className:x().tabs,children:[(0,t.jsxs)("button",{className:"".concat(x().tab," ").concat("users"===b?x().activeTab:""),onClick:()=>H("users"),children:[(0,t.jsx)(r.x$1,{})," Manage Users"]}),(0,t.jsxs)("button",{className:"".concat(x().tab," ").concat("books"===b?x().activeTab:""),onClick:()=>H("books"),children:[(0,t.jsx)(r.vd0,{})," Manage Books"]})]}),B&&(0,t.jsx)("div",{className:x().error,children:B}),(0,t.jsx)("div",{className:x().adminActions,children:(0,t.jsxs)("button",{className:x().adminActionButton,onClick:ee,disabled:V,children:[(0,t.jsx)(g.DmM,{}),V?"Cleaning up...":"Cleanup Cloudinary Resources"]})}),F&&(0,t.jsxs)("div",{className:x().cleanupResults,children:[(0,t.jsx)("h3",{children:"Cloudinary Cleanup Results"}),(0,t.jsx)("div",{className:x().cleanupSummary,children:F.error?(0,t.jsxs)("p",{children:[(0,t.jsx)("strong",{children:"Error:"})," ",F.error||"Unknown error occurred"]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("p",{children:[(0,t.jsx)("strong",{children:"Status:"})," Success"]}),(0,t.jsxs)("p",{children:[(0,t.jsx)("strong",{children:"PDFs Cleaned:"})," ",(null==(a=F.deleted)||null==(e=a.pdfs)?void 0:e.length)||0]}),(0,t.jsxs)("p",{children:[(0,t.jsx)("strong",{children:"Covers Cleaned:"})," ",(null==(i=F.deleted)||null==(n=i.covers)?void 0:n.length)||0]}),F.errors&&F.errors.length>0&&(0,t.jsxs)("p",{className:x().cleanupErrors,children:[(0,t.jsx)("strong",{children:"Errors:"}),F.errors.map((e,a)=>(0,t.jsxs)("div",{className:x().cleanupError,children:["pdf"===e.type?"PDF: ":"Cover: ",e.id?"".concat(e.id," - "):"",e.error||e]},a))]})]})})]}),"users"===b&&(0,t.jsxs)("div",{className:x().tabContent,children:[(0,t.jsx)("div",{className:x().searchContainer,children:(0,t.jsx)(j.A,{placeholder:"Search users by name or email...",onSearch:K,initialValue:q,debounceTime:500,className:x().searchBar})}),A?(0,t.jsx)("div",{className:x().loading,children:"Loading users..."}):J.length>0?(0,t.jsx)("div",{className:x().tableContainer,children:(0,t.jsxs)("table",{className:x().table,children:[(0,t.jsx)("thead",{children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{children:"Name"}),(0,t.jsx)("th",{children:"Email"}),(0,t.jsx)("th",{children:"Joined"}),(0,t.jsx)("th",{children:"Status"}),(0,t.jsx)("th",{children:"Admin"}),(0,t.jsx)("th",{children:"Actions"})]})}),(0,t.jsx)("tbody",{children:J.map(e=>(0,t.jsxs)("tr",{children:[(0,t.jsx)("td",{className:x().userName,children:e.name}),(0,t.jsx)("td",{children:e.email}),(0,t.jsx)("td",{children:Y(e.createdAt)}),(0,t.jsx)("td",{children:(0,t.jsx)("span",{className:"".concat(x().status," ").concat(e.isBanned?x().banned:x().active),children:e.isBanned?"Banned":"Active"})}),(0,t.jsx)("td",{children:(0,t.jsx)("span",{className:"".concat(x().adminStatus," ").concat(e.isAdmin?x().isAdmin:""),children:e.isAdmin?"Yes":"No"})}),(0,t.jsx)("td",{className:x().actions,children:!e.isAdmin&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("button",{className:"".concat(x().actionButton," ").concat(e.isBanned?x().unbanButton:x().banButton),onClick:()=>Q("ban-user",e._id,e.isBanned?"Unban User":"Ban User",e.isBanned?"Are you sure you want to unban ".concat(e.name,"?"):"Are you sure you want to ban ".concat(e.name,"? They will no longer be able to log in.")),title:e.isBanned?"Unban User":"Ban User",children:e.isBanned?(0,t.jsx)(r.YVu,{}):(0,t.jsx)(r.Rqy,{})}),(0,t.jsx)("button",{className:"".concat(x().actionButton," ").concat(x().deleteButton),onClick:()=>Q("delete-user",e._id,"Delete User","Are you sure you want to permanently delete ".concat(e.name,"? This action cannot be undone.")),title:"Delete User",children:(0,t.jsx)(r.qbC,{})})]})})]},e._id))})]})}):(0,t.jsx)("div",{className:x().noResults,children:"No users found"})]}),"books"===b&&(0,t.jsxs)("div",{className:x().tabContent,children:[(0,t.jsx)("div",{className:x().searchContainer,children:(0,t.jsx)(j.A,{placeholder:"Search books by title, author, or category...",onSearch:T,initialValue:O,debounceTime:500,className:x().searchBar})}),A?(0,t.jsx)("div",{className:x().loading,children:"Loading books..."}):$.length>0?(0,t.jsx)("div",{className:x().bookGrid,children:$.map(e=>(0,t.jsxs)("div",{className:x().bookCard,children:[(0,t.jsx)("div",{className:x().bookCover,children:e.coverImage?(0,t.jsx)("img",{src:e.coverImage,alt:e.title}):(0,t.jsx)("div",{className:x().placeholderCover,children:(0,t.jsx)(r.vd0,{})})}),(0,t.jsxs)("div",{className:x().bookInfo,children:[(0,t.jsx)("h3",{className:x().bookTitle,children:e.title}),(0,t.jsxs)("p",{className:x().bookAuthor,children:["by ",e.author]}),(0,t.jsx)("p",{className:x().bookCategory,children:e.category}),(0,t.jsxs)("div",{className:x().bookStats,children:[(0,t.jsxs)("span",{className:x().stat,children:[(0,t.jsx)(r.Ny1,{})," ",e.views||0]}),(0,t.jsxs)("span",{className:x().stat,children:[(0,t.jsx)(r.WCW,{})," ",e.downloads||0]}),(0,t.jsxs)("span",{className:x().stat,children:[(0,t.jsx)(r.gt3,{})," ",e.averageRating?e.averageRating.toFixed(1):"0.0"]})]}),(0,t.jsxs)("div",{className:x().bookMeta,children:[(0,t.jsxs)("span",{className:x().bookDate,children:[(0,t.jsx)(r.bfZ,{})," ",Y(e.createdAt)]}),e.uploadedBy&&(0,t.jsxs)("span",{className:x().bookUploader,children:[(0,t.jsx)(r.x$1,{})," ",e.uploadedBy.name]})]}),(0,t.jsx)("div",{className:x().bookActions,children:(0,t.jsxs)("button",{className:"".concat(x().bookAction," ").concat(x().deleteButton),onClick:()=>Q("delete-book",e._id,"Delete Book",'Are you sure you want to permanently delete "'.concat(e.title,'"? This will delete the book record, PDF file, cover image, and all associated reviews and bookmarks. This action cannot be undone.')),title:"Delete Book",children:[(0,t.jsx)(r.qbC,{})," Delete"]})})]})]},e._id))}):(0,t.jsx)("div",{className:x().noResults,children:"No books found"})]}),(0,t.jsx)(k,{isOpen:S.isOpen,title:S.title,message:S.message,onConfirm:Z,onCancel:W,isDeleting:I})]}):(0,t.jsx)("div",{className:x().loading,children:"Checking authentication..."})}},71420:(e,a,n)=>{Promise.resolve().then(n.bind(n,58887))}},e=>{var a=a=>e(e.s=a);e.O(0,[2227,6711,844,6874,9912,8441,1684,7358],()=>a(71420)),_N_E=e.O()}]);