(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[481],{10868:e=>{e.exports={container:"plans_container__wpxuU",header:"plans_header__iQnsV",backButton:"plans_backButton__LftVj",title:"plans_title__TFIWG",loading:"plans_loading__RV3s8",error:"plans_error__n6XE9",success:"plans_success__XtaC3",coinsBalance:"plans_coinsBalance__spZrH",coinIcon:"plans_coinIcon__X3e0Y",coinCount:"plans_coinCount__TqL7H",coinLabel:"plans_coinLabel__BGhR3",getCoinsButton:"plans_getCoinsButton__p79Ku",currentSubscription:"plans_currentSubscription__RBUoe",subscriptionHeader:"plans_subscriptionHeader__SSoM4",crownIcon:"plans_crownIcon__ZcuGw",subscriptionDetails:"plans_subscriptionDetails__mNoZA",subscriptionActions:"plans_subscriptionActions__iJsuB",nonCancelableNotice:"plans_nonCancelableNotice__S8O3G",infoIcon:"plans_infoIcon__w9ZpH",settingsButton:"plans_settingsButton__wMEh_",nonRefundableWarning:"plans_nonRefundableWarning__qL__H",warningIcon:"plans_warningIcon__qgOc_",plansContainer:"plans_plansContainer__CZsXr",planCard:"plans_planCard__fwUHw",popularPlan:"plans_popularPlan__lAzEA",popularBadge:"plans_popularBadge__f2VF4",planName:"plans_planName__Azr3k",planDescription:"plans_planDescription__zqb7Y",planPrice:"plans_planPrice__wGyOe",planCoinIcon:"plans_planCoinIcon__oEoAC",priceValue:"plans_priceValue__tSgSp",pricePeriod:"plans_pricePeriod__GytVi",featuresList:"plans_featuresList__ZaLYY",featureItem:"plans_featureItem__ozpH0",checkIcon:"plans_checkIcon__dBzlI",subscribeButton:"plans_subscribeButton__4o3Ye",disabledButton:"plans_disabledButton__v6DmT",insufficientCoins:"plans_insufficientCoins__K4D7u",noPlans:"plans_noPlans__G4vjo",modalOverlay:"plans_modalOverlay__gXxdL",modalContent:"plans_modalContent___rr_V",balanceInfo:"plans_balanceInfo__DIN_d",modalActions:"plans_modalActions__a1Bbg",cancelButton:"plans_cancelButton__JEz6Y",confirmButton:"plans_confirmButton__HoBWq",modalHeader:"plans_modalHeader__P5bTz",closeModalButton:"plans_closeModalButton__2Q0S3",modalBody:"plans_modalBody__wf7hF",balanceRow:"plans_balanceRow__Z1igP",warningHeader:"plans_warningHeader__hwZuR",activePlan:"plans_activePlan__TThI2",activePlanBadge:"plans_activePlanBadge____r9O",activePlanButton:"plans_activePlanButton__jGiHE",subscriptionNote:"plans_subscriptionNote__sy2My"}},17029:(e,t,o)=>{"use strict";o.r(t),o.d(t,{default:()=>m});var n=o(95155),s=o(12115),r=o(35695),a=o(6874),c=o.n(a),i=o(29911),l=o(56068),u=o(10868),p=o.n(u),d=o(53116),h=o(46264);function m(){var e;let{user:t,updateUserCoins:o,isLoggedIn:a}=(0,l.h)(),u=(0,r.useRouter)(),[m,b]=(0,s.useState)(!0),[g,f]=(0,s.useState)(!1),[y,_]=(0,s.useState)([]),[v,w]=(0,s.useState)(null),[S,j]=(0,s.useState)(""),[k,P]=(0,s.useState)(""),[I,E]=(0,s.useState)(!1),[x,N]=(0,s.useState)(null),[A,C]=(0,s.useState)(!1),O=async()=>{b(!0),j("");try{let e=await (0,h.wQ)();e&&e.plans?(_(e.plans),console.log("Loaded ".concat(e.plans.length," subscription plans"))):e&&e.data&&(_(e.data),console.log("Loaded ".concat(e.data.length," subscription plans (alt format)")));try{console.log("Checking current subscription status...");let e=await (0,h.getCurrentSubscription)();console.log("Subscription check response:",e);let t=e&&!0===e.hasSubscription||e&&!0===e.active;t&&e.subscription?(w(e.subscription),C(!0),console.log("Active subscription found:",e.subscription)):t?(C(!0),console.log("User has an active subscription (basic details only)")):(console.log("No active subscription found"),C(!1),e&&e.wasExpired&&j("Your subscription has expired. Please renew to continue enjoying premium benefits."),w(null))}catch(e){console.error("Error fetching subscription:",e),C(!1)}try{let e=await (0,d.getUserCoins)();e&&"number"==typeof e.coins&&(o(e.coins),console.log("User has ".concat(e.coins," coins")))}catch(e){console.error("Error fetching coin balance:",e)}}catch(e){console.error("Error initializing plans page:",e),j(e.message||"Failed to load subscription plans")}finally{b(!1)}};(0,s.useEffect)(()=>{a?O():u.push("/login?redirect=plans")},[a,u]);let T=async()=>{if(x){f(!0),j(""),P("");try{console.log("Attempting to purchase plan: ".concat(x.name));let e={planId:x._id,paymentMethod:"coins"};console.log("Purchase data:",e);let t=await (0,h.D8)(e);if(console.log("Purchase result:",t),t&&t.success&&t.subscription){w(t.subscription),C(!0),P("Successfully subscribed to ".concat(x.name,"!"));try{let e=await (0,d.getUserCoins)();e&&"number"==typeof e.coins&&(o(e.coins),console.log("Updated user coins to: ".concat(e.coins)))}catch(e){console.error("Error updating coin balance after purchase:",e)}E(!1),document.body.style.overflow="",window.scrollTo(0,0)}else throw Error("Unexpected response format from subscription purchase")}catch(e){console.error("Error purchasing subscription:",e),e.message.includes("enough coins")?j("You don't have enough coins to purchase this plan. Please get more coins and try again."):e.message.includes("already has an active subscription")?(j("You already have an active subscription. Only one subscription can be active at a time."),C(!0)):j(e.message||"Failed to purchase subscription. Please try again later."),E(!1),document.body.style.overflow="",window.scrollTo(0,0)}finally{f(!1)}}},B=e=>{if(!a)return void u.push("/login?redirect=plans");if(A){j("You already have an active subscription. Only one subscription can be active at a time."),window.scrollTo(0,0);return}if((null==t?void 0:t.coins)<e.price){j("You don't have enough coins to purchase this plan. You need ".concat(e.price-t.coins," more coins.")),window.scrollTo(0,0);return}N(e),E(!0),setTimeout(()=>{window.scrollTo(0,0),document.body.style.overflow="hidden"},10)},R=e=>{if(!e.duration)return"";let{value:t,unit:o}=e.duration;return 1===t?"".concat(t," ").concat(o.slice(0,-1)):"".concat(t," ").concat(o)},D=()=>{E(!1),document.body.style.overflow=""},L=e=>{if(!v||!v.plan)return A&&console.log("Using hasActiveSubscription state to determine active plan (no full subscription details available)"),!1;console.log("Checking if plan matches current subscription:",{planId:e._id,subscriptionPlan:v.plan});let t=("object"==typeof v.plan?v.plan._id:v.plan)===e._id;return t&&console.log('Plan "'.concat(e.name,'" is the active subscription')),t};return((0,s.useEffect)(()=>{(async()=>{if(a)try{console.log("Checking subscription status on mount/navigation...");let e=await (0,h.getCurrentSubscription)(),t=!0===e.hasSubscription||!0===e.active;console.log("Subscription status check result:",{isActive:t,response:e}),C(t),t&&e.subscription&&w(e.subscription)}catch(e){console.error("Error checking subscription status on mount:",e)}})()},[a]),m)?(0,n.jsxs)("div",{className:p().container,children:[(0,n.jsxs)("div",{className:p().header,children:[(0,n.jsx)(c(),{href:"/",className:p().backButton,children:(0,n.jsx)(i.QVr,{})}),(0,n.jsx)("h1",{className:p().title,children:"Subscription Plans"})]}),(0,n.jsx)("div",{className:p().loading,children:"Loading plans..."})]}):(0,n.jsxs)("div",{className:p().container,children:[(0,n.jsxs)("div",{className:p().header,children:[(0,n.jsx)(c(),{href:"/",className:p().backButton,children:(0,n.jsx)(i.QVr,{})}),(0,n.jsx)("h1",{className:p().title,children:"Subscription Plans"})]}),S&&(0,n.jsx)("div",{className:p().error,children:S}),k&&(0,n.jsx)("div",{className:p().success,children:k}),v&&(0,n.jsxs)("div",{className:p().currentSubscription,children:[(0,n.jsxs)("div",{className:p().subscriptionHeader,children:[(0,n.jsx)(i.Hu1,{className:p().crownIcon}),(0,n.jsx)("h2",{children:"Your Current Subscription"})]}),(0,n.jsxs)("div",{className:p().subscriptionDetails,children:[(0,n.jsxs)("p",{children:[(0,n.jsx)("strong",{children:"Plan:"})," ",(null==(e=v.plan)?void 0:e.name)||"Premium Plan"]}),(0,n.jsxs)("p",{children:[(0,n.jsx)("strong",{children:"Status:"})," ",v.status]}),(0,n.jsxs)("p",{children:[(0,n.jsx)("strong",{children:"Active Until:"})," ",new Date(v.endDate).toLocaleDateString()]})]}),(0,n.jsx)("div",{className:p().subscriptionActions,children:(0,n.jsxs)("p",{className:p().nonCancelableNotice,children:[(0,n.jsx)(i.__w,{className:p().infoIcon})," Subscriptions are non-refundable and cannot be canceled once purchased."]})})]}),A&&(0,n.jsxs)("div",{className:p().subscriptionNote,children:[(0,n.jsx)(i.__w,{className:p().infoIcon}),(0,n.jsx)("p",{children:"You already have an active subscription. Only one subscription can be active at a time."})]}),(0,n.jsxs)("div",{className:p().coinsBalance,children:[(0,n.jsx)(i.cEG,{className:p().coinIcon}),(0,n.jsx)("span",{className:p().coinCount,children:(null==t?void 0:t.coins)||0}),(0,n.jsx)("span",{className:p().coinLabel,children:"coins"}),(0,n.jsx)(c(),{href:"/coins",className:p().getCoinsButton,children:"Get More Coins"})]}),(0,n.jsx)("div",{className:p().plansContainer,children:y.length>0?y.map(e=>{var o,s,r,a,c,l;return(0,n.jsxs)("div",{className:"".concat(p().planCard," ").concat(e.isPopular?p().popularPlan:""," ").concat(L(e)?p().activePlan:""),children:[e.isPopular&&(0,n.jsx)("div",{className:p().popularBadge,children:"Most Popular"}),L(e)&&(0,n.jsx)("div",{className:p().activePlanBadge,children:"Your Active Plan"}),(0,n.jsx)("h2",{className:p().planName,children:e.name}),(0,n.jsx)("p",{className:p().planDescription,children:e.description}),(0,n.jsxs)("div",{className:p().planPrice,children:[(0,n.jsx)(i.cEG,{className:p().planCoinIcon}),(0,n.jsx)("span",{className:p().priceValue,children:e.price}),(0,n.jsxs)("span",{className:p().pricePeriod,children:["for ",R(e)]})]}),(0,n.jsxs)("ul",{className:p().featuresList,children:[null==(o=e.features)?void 0:o.map((e,t)=>(0,n.jsxs)("li",{className:p().featureItem,children:[(0,n.jsx)(i.CMH,{className:p().checkIcon}),e]},t)),(null==(s=e.benefits)?void 0:s.maxPremiumBooks)>0&&(0,n.jsxs)("li",{className:p().featureItem,children:[(0,n.jsx)(i.CMH,{className:p().checkIcon}),e.benefits.maxPremiumBooks===1/0?"Unlimited premium books":"".concat(e.benefits.maxPremiumBooks," premium books/month")]}),(null==(r=e.benefits)?void 0:r.offlineReading)&&(0,n.jsxs)("li",{className:p().featureItem,children:[(0,n.jsx)(i.CMH,{className:p().checkIcon}),"Offline reading"]}),(null==(a=e.benefits)?void 0:a.adFree)&&(0,n.jsxs)("li",{className:p().featureItem,children:[(0,n.jsx)(i.CMH,{className:p().checkIcon}),"Ad-free experience"]}),(null==(c=e.benefits)?void 0:c.earlyAccess)&&(0,n.jsxs)("li",{className:p().featureItem,children:[(0,n.jsx)(i.CMH,{className:p().checkIcon}),"Early access to new releases"]}),(null==(l=e.benefits)?void 0:l.exclusiveContent)&&(0,n.jsxs)("li",{className:p().featureItem,children:[(0,n.jsx)(i.CMH,{className:p().checkIcon}),"Exclusive content"]})]}),(0,n.jsx)("button",{className:"".concat(p().subscribeButton," ").concat(A?p().disabledButton:""," ").concat(L(e)?p().activePlanButton:""),onClick:()=>B(e),disabled:A,children:L(e)?"Current Plan":A?"Subscription Active":(null==t?void 0:t.coins)<e.price?"Need More Coins":"Subscribe Now"}),!A&&(null==t?void 0:t.coins)<e.price&&(0,n.jsxs)("p",{className:p().insufficientCoins,children:["You need ",e.price-t.coins," more coins"]})]},e._id)}):(0,n.jsxs)("div",{className:p().noPlans,children:[(0,n.jsx)(i.__w,{className:p().infoIcon}),(0,n.jsx)("p",{children:"No subscription plans are currently available."})]})}),I&&x&&(0,n.jsx)("div",{className:p().modalOverlay,children:(0,n.jsxs)("div",{className:p().modalContent,children:[(0,n.jsxs)("div",{className:p().modalHeader,children:[(0,n.jsx)("h2",{children:"Confirm Subscription"}),(0,n.jsx)("button",{className:p().closeModalButton,onClick:D,"aria-label":"Close modal",children:"âœ•"})]}),(0,n.jsxs)("div",{className:p().modalBody,children:[(0,n.jsxs)("p",{children:["You are about to subscribe to ",(0,n.jsx)("strong",{children:x.name}),"."]}),(0,n.jsxs)("p",{children:["This will cost ",(0,n.jsxs)("strong",{children:[x.price," coins"]})," from your balance."]}),(0,n.jsxs)("div",{className:p().balanceInfo,children:[(0,n.jsxs)("div",{className:p().balanceRow,children:[(0,n.jsx)("span",{children:"Current Balance:"}),(0,n.jsxs)("strong",{children:[null==t?void 0:t.coins," coins"]})]}),(0,n.jsxs)("div",{className:p().balanceRow,children:[(0,n.jsx)("span",{children:"Balance After:"}),(0,n.jsxs)("strong",{children:[(null==t?void 0:t.coins)-x.price," coins"]})]})]}),(0,n.jsxs)("div",{className:p().nonRefundableWarning,children:[(0,n.jsxs)("div",{className:p().warningHeader,children:[(0,n.jsx)(i.__w,{className:p().warningIcon}),(0,n.jsx)("p",{children:"Important Information"})]}),(0,n.jsx)("p",{children:"By purchasing this subscription, you acknowledge that:"}),(0,n.jsxs)("ul",{children:[(0,n.jsxs)("li",{children:["Subscriptions are ",(0,n.jsx)("strong",{children:"non-refundable"})]}),(0,n.jsxs)("li",{children:["Subscriptions ",(0,n.jsx)("strong",{children:"cannot be canceled"})," once purchased"]}),(0,n.jsx)("li",{children:"Your subscription will be active until the end date"})]})]})]}),(0,n.jsxs)("div",{className:p().modalActions,children:[(0,n.jsx)("button",{className:p().cancelButton,onClick:D,disabled:g,children:"Cancel"}),(0,n.jsx)("button",{className:p().confirmButton,onClick:T,disabled:g,children:g?"Processing...":"Confirm Purchase"})]})]})})]})}},17203:(e,t,o)=>{"use strict";o.d(t,{JR:()=>n,Sn:()=>s}),o(72047);let n="https://ebookaura.onrender.com/api",s={AUTH:{LOGIN:"".concat(n,"/auth/login"),REGISTER:"".concat(n,"/auth/register"),ME:"".concat(n,"/auth/me"),FORGOT_PASSWORD:"".concat(n,"/auth/forgot-password"),RESET_PASSWORD:e=>"".concat(n,"/auth/reset-password/").concat(e),VERIFY_EMAIL:"".concat(n,"/auth/verify-email")},BOOKS:{ALL:"".concat(n,"/books"),CATEGORIES:"".concat(n,"/books/categories"),TAGS:"".concat(n,"/books/tags"),DETAILS:e=>"".concat(n,"/books/").concat(e),PDF:e=>"".concat(n,"/books/pdf/").concat(e),PDF_CONTENT:e=>"".concat(n,"/books/pdf/").concat(e),DOWNLOAD:e=>"".concat(n,"/books/").concat(e,"/download"),REVIEWS:e=>"".concat(n,"/books/").concat(e,"/reviews"),RATING:e=>"".concat(n,"/books/").concat(e,"/rating"),ADD_REVIEW:e=>"".concat(n,"/books/").concat(e,"/reviews")},UPLOAD:{FILE:"".concat(n,"/upload"),PDF:"".concat(n,"/upload/pdf"),DELETE_FILE:e=>"".concat(n,"/upload/").concat(e),DELETE_BOOK:e=>"".concat(n,"/upload/book/").concat(e)},USER:{PROFILE:"".concat(n,"/users/profile"),UPDATE_PROFILE:"".concat(n,"/users/profile"),UPDATE_IMAGE:"".concat(n,"/users/profile/image"),BOOKMARKS:"".concat(n,"/users/bookmarks")},SUBSCRIPTIONS:{CURRENT:"".concat(n,"/subscriptions/current"),CHECK:"".concat(n,"/subscriptions/check"),CHECK_API:"".concat(n,"/subscriptions/check-api"),ACTIVATE:"".concat(n,"/subscriptions/activate"),DEACTIVATE:"".concat(n,"/subscriptions/deactivate")},API_KEYS:{GENERATE:"".concat(n,"/api-keys/generate"),CURRENT:"".concat(n,"/api-keys/current"),REVOKE:"".concat(n,"/api-keys/revoke"),VERIFY:"".concat(n,"/api-keys/verify")}}},35695:(e,t,o)=>{"use strict";var n=o(18999);o.o(n,"useParams")&&o.d(t,{useParams:function(){return n.useParams}}),o.o(n,"usePathname")&&o.d(t,{usePathname:function(){return n.usePathname}}),o.o(n,"useRouter")&&o.d(t,{useRouter:function(){return n.useRouter}}),o.o(n,"useSearchParams")&&o.d(t,{useSearchParams:function(){return n.useSearchParams}})},46264:(e,t,o)=>{"use strict";o.d(t,{D8:()=>i,_h:()=>c,checkSubscriptionWithApiKey:()=>u,getCurrentSubscription:()=>a,nV:()=>l,wQ:()=>r});var n=o(72047);o(17203);let s={PLANS:36e5,HISTORY:6e5},r=async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];try{let t="subscription_plans",{shouldMakeCall:o,cachedData:r}=(0,n.UB)(t,s.PLANS,e);if(!o&&r)return r;let a=await (0,n.dw)("/subscriptions/plans");if(a){let e=a.plans||a.data||[],o={...a,plans:e};return(0,n.yt)(t,o),o}return a}catch(e){throw console.error("Error fetching subscription plans:",e),e}},a=async()=>{try{let e=localStorage.getItem("token");if(!e)return console.log("No authentication token found for subscription check"),{success:!1,hasSubscription:!1,message:"Not authenticated"};console.log("Checking current subscription status from server...");let t=await fetch("".concat("https://ebookaura.onrender.com/api","/subscriptions/current"),{method:"GET",headers:{Authorization:"Bearer ".concat(e)}});console.log("Subscription status API response status: ".concat(t.status));let o=await t.json();if(console.log("Subscription status API response:",o),t.ok){void 0===o.hasSubscription&&void 0!==o.active?o.hasSubscription=o.active:void 0===o.active&&void 0!==o.hasSubscription&&(o.active=o.hasSubscription);try{localStorage.setItem("subscriptionStatus",JSON.stringify({hasSubscription:o.hasSubscription,active:o.hasSubscription,planType:o.planType,expiresAt:o.expiresAt,timestamp:new Date().toISOString()})),console.log("Subscription status cached successfully")}catch(e){console.warn("Failed to cache subscription status:",e)}return o.success&&o.hasSubscription?console.log("User has an active subscription (".concat(o.planType||"unknown"," plan), expires: ").concat(o.expiresAt||"unknown")):console.log("User does not have an active subscription"),o}throw console.error("Subscription check failed with error:",o.message),Error(o.message||"Failed to check subscription status")}catch(e){console.error("Error checking subscription status:",e);try{let e=localStorage.getItem("subscriptionStatus");if(e){let t=JSON.parse(e),o=new Date(t.timestamp),n=new Date;if(n-o<3e5)return console.log("Using cached subscription status from",new Date(t.timestamp).toLocaleTimeString()),console.log("Cached subscription value:",t.hasSubscription?"Active":"Inactive"),{success:!0,hasSubscription:t.hasSubscription,active:t.hasSubscription,planType:t.planType,expiresAt:t.expiresAt,fromCache:!0};console.log("Cached subscription data is too old:",Math.round((n-o)/6e4),"minutes old")}else console.log("No cached subscription data found")}catch(e){console.error("Error reading cached subscription status:",e)}return{success:!1,hasSubscription:!1,active:!1,error:e.message||"Failed to check subscription status"}}},c=async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];try{let t=localStorage.getItem("token");if(!t)throw Error("Authentication required");let o="subscription_history",{shouldMakeCall:r,cachedData:a}=(0,n.UB)(o,s.HISTORY,e);if(!r&&a)return a;let c=await (0,n.dw)("/subscriptions/history",{headers:{Authorization:"Bearer ".concat(t)}});return(0,n.yt)(o,c),c}catch(e){throw console.error("Error fetching subscription history:",e),e}},i=async e=>{try{let t=localStorage.getItem("token");if(!t)throw Error("Authentication required");if(console.log("Purchasing subscription with data:",e),!e.planId)throw Error("Plan ID is required");e.paymentMethod||(e.paymentMethod="coins");let o=await fetch("".concat("https://ebookaura.onrender.com/api","/subscriptions"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t)},body:JSON.stringify(e)});console.log("Subscription purchase API response status: ".concat(o.status));let n=await o.json();if(console.log("Subscription purchase API response:",n),!o.ok)throw Error(n.message||"Failed to purchase subscription");try{localStorage.removeItem("subscriptionStatus"),console.log("Cleared subscription cache after purchase")}catch(e){console.warn("Failed to clear subscription cache:",e)}return n}catch(e){throw console.error("Error purchasing subscription:",e),e}},l=async(e,t)=>{try{let o=localStorage.getItem("token");if(!o)throw Error("Authentication required");let s=await (0,n.TA)("/subscriptions/".concat(e),t,{headers:{Authorization:"Bearer ".concat(o)}});return(0,n.yt)("current_subscription",null),(0,n.yt)("subscription_history",null),s}catch(e){throw console.error("Error updating subscription:",e),e}},u=async e=>{try{if(!e)throw console.error("checkSubscriptionWithApiKey called without an API key"),Error("API key is required");console.log("Checking subscription status with API key: ".concat(e.substring(0,5),"..."));let t=await fetch("".concat("https://ebookaura.onrender.com/api","/subscriptions/check-api"),{method:"GET",headers:{"X-API-Key":e}});console.log("Subscription check API response status: ".concat(t.status));let o=await t.json();if(console.log("Subscription check API response:",o),t.ok)return void 0===o.hasSubscription&&void 0!==o.active&&(o.hasSubscription=o.active),o.success&&o.hasSubscription?console.log("API key has valid subscription - granting access"):console.log("API key does not have an active subscription"),o;throw console.error("Subscription check failed with error:",o.message),Error(o.message||"Failed to check subscription status")}catch(e){return console.error("Error checking subscription with API key:",e),{success:!1,hasSubscription:!1,active:!1,error:e.message||"Failed to check subscription status"}}}},53116:(e,t,o)=>{"use strict";o.d(t,{$P:()=>r,PZ:()=>u,Yv:()=>l,getUserCoins:()=>s,lD:()=>a,wA:()=>i,z$:()=>c});var n=o(72047);let s=async()=>{try{let e=localStorage.getItem("token");if(!e)throw Error("Authentication required");return await fetch("".concat("https://ebookaura.onrender.com/api","/coins"),{method:"GET",headers:{Authorization:"Bearer ".concat(e)}}).then(e=>{if(!e.ok)throw Error("Failed to get coin balance");return e.json()})}catch(e){throw console.error("Error getting user coins:",e),e}},r=async e=>{try{let t=localStorage.getItem("token");if(!t)throw Error("Authentication required");return await fetch("".concat("https://ebookaura.onrender.com/api","/coins/update-session"),{method:"POST",headers:{Authorization:"Bearer ".concat(t),"Content-Type":"application/json"},body:JSON.stringify({sessionDuration:e})}).then(e=>{if(!e.ok)throw Error("Failed to update session time");return e.json()})}catch(e){throw console.error("Error updating session time:",e),e}},a=async()=>{try{let e=localStorage.getItem("token");if(!e)throw Error("Authentication required");return await fetch("".concat("https://ebookaura.onrender.com/api","/coins/session-status"),{method:"GET",headers:{Authorization:"Bearer ".concat(e)}}).then(e=>{if(!e.ok)throw Error("Failed to get session status");return e.json()})}catch(e){throw console.error("Error getting session status:",e),e}},c=async()=>{try{let e=localStorage.getItem("token");if(!e)throw Error("Authentication required");return await fetch("".concat("https://ebookaura.onrender.com/api","/coins/activity-reward"),{method:"POST",headers:{Authorization:"Bearer ".concat(e)}}).then(e=>e.ok?e.json():e.json().then(e=>{throw Error(e.message||"Failed to claim activity reward")}))}catch(e){throw console.error("Error claiming activity reward coins:",e),e}},i=async()=>{try{let e=localStorage.getItem("token");if(!e)throw Error("Authentication required");return await fetch("".concat("https://ebookaura.onrender.com/api","/coins/daily"),{method:"POST",headers:{Authorization:"Bearer ".concat(e)}}).then(e=>e.ok?e.json():e.json().then(e=>{throw Error(e.message||"Failed to claim daily coins")}))}catch(e){throw console.error("Error claiming daily coins:",e),e}},l=async()=>{try{let e=localStorage.getItem("token");if(!e)throw Error("Authentication required");return await fetch("".concat("https://ebookaura.onrender.com/api","/coins/daily-status"),{method:"GET",headers:{Authorization:"Bearer ".concat(e)}}).then(e=>{if(!e.ok)throw Error("Failed to check daily coins status");return e.json()})}catch(e){throw console.error("Error checking daily coins status:",e),e}},u=async e=>{try{let t=localStorage.getItem("token");if(!t)throw Error("Authentication required");return await (0,n.dw)("/users/check-purchase/".concat(e),{headers:{Authorization:"Bearer ".concat(t)}})}catch(e){throw console.error("Error checking book purchase:",e),e}}},56068:(e,t,o)=>{"use strict";o.d(t,{AuthProvider:()=>l,h:()=>u});var n=o(95155),s=o(12115),r=o(35695),a=o(72047);let c=(0,s.createContext)(),i=()=>"ak_"+Array.from(crypto.getRandomValues(new Uint8Array(24))).map(e=>e.toString(16).padStart(2,"0")).join(""),l=e=>{let{children:t}=e,[o,l]=(0,s.useState)(null),[u,p]=(0,s.useState)(!0),[d,h]=(0,s.useState)(!1),m=(0,r.useRouter)(),b=(0,s.useRef)(!1),g=(0,s.useRef)(!1);(0,s.useEffect)(()=>{h(!0),(async()=>{try{let e=localStorage.getItem("userInfo"),t=localStorage.getItem("token");if(localStorage.getItem("apiKey"),e&&t)try{if(l(JSON.parse(e)),!b.current&&!g.current){b.current=!0;try{await (0,a.dw)("/auth/check",{headers:{Authorization:"Bearer ".concat(t)}}),g.current=!0}catch(e){if(console.error("Token validation failed:",e),"localhost"!==window.location.hostname)try{console.log("Retrying token validation..."),await new Promise(e=>setTimeout(e,1e3)),await (0,a.dw)("/auth/check",{headers:{Authorization:"Bearer ".concat(t)}}),g.current=!0}catch(e){console.error("Token validation retry failed:",e),y()}else y()}finally{b.current=!1}}}catch(e){console.error("Failed to parse user info:",e),localStorage.removeItem("userInfo"),localStorage.removeItem("token"),localStorage.removeItem("apiKey")}}finally{p(!1)}})()},[]);let f=e=>{if(console.log("Processing login data"),!e)return void console.error("No user data received for login");try{if(!e.token)return void console.error("No token in login data");let{token:t,...o}=e;console.log("Setting user data:",o),l(o);{localStorage.setItem("userInfo",JSON.stringify(o)),localStorage.setItem("token",t);let e=localStorage.getItem("apiKey");e||(console.log("Generating new API key"),e=i(),localStorage.setItem("apiKey",e)),console.log("Authentication data stored in localStorage")}}catch(e){console.error("Error processing login:",e)}},y=()=>{l(null),localStorage.removeItem("userInfo"),localStorage.removeItem("token"),m.push("/login")},_=()=>localStorage.getItem("token"),v=()=>localStorage.getItem("apiKey"),w=e=>{if(o){let t={...o,coins:e};l(t),localStorage.setItem("userInfo",JSON.stringify(t))}};return d?(0,n.jsx)(c.Provider,{value:{user:o,isLoggedIn:!!o,loading:u,login:f,logout:y,getToken:_,getApiKey:v,updateUserCoins:w},children:t}):(0,n.jsx)(c.Provider,{value:{user:null,isLoggedIn:!1,loading:!0,login:f,logout:y,getToken:_,getApiKey:v,updateUserCoins:w},children:t})},u=()=>{let e=(0,s.useContext)(c);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},72047:(e,t,o)=>{"use strict";o.d(t,{TA:()=>p,UB:()=>s,Xj:()=>i,_5:()=>u,dw:()=>c,q1:()=>l,yt:()=>r});let n={};function s(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3,o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(o)return{shouldMakeCall:!0,cachedData:null};let s=Date.now(),r=n[e];return!r||s-r.timestamp>t?{shouldMakeCall:!0,cachedData:null}:{shouldMakeCall:!1,cachedData:r.data}}function r(e,t){n[e]={timestamp:Date.now(),data:t}}async function a(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{let o=e.startsWith("http")?e:"".concat("https://ebookaura.onrender.com/api").concat(e);console.log("API Request: ".concat(t.method||"GET"," ").concat(o)),t.headers||(t.headers={}),!t.body||t.headers["Content-Type"]||t.body instanceof FormData||(t.headers["Content-Type"]="application/json");let n=e.startsWith("/books")&&("GET"===t.method||!t.method)&&!e.includes("/reviews")&&!e.includes("/bookmarks"),s=e.match(/^\/books\/[a-z0-9]+$/i);{let e=localStorage.getItem("token"),o=localStorage.getItem("apiKey");e&&(!n||s)&&!t.headers.Authorization&&(t.headers.Authorization="Bearer ".concat(e)),o&&!t.headers["X-API-Key"]&&(t.headers["X-API-Key"]=o)}let r=await fetch(o,t),a=r.headers.get("content-type");if(!r.ok){if(console.error("API Error (".concat(r.status,"): ").concat(r.statusText)),a&&a.includes("application/json")){let e=await r.json();throw Error(e.message||"API request failed with status ".concat(r.status))}{let e=await r.text();console.error("Non-JSON error response:",e.substring(0,150)+"...");let t="API request failed with status ".concat(r.status);if(e.includes("<title>")&&e.includes("</title>")){let o=e.match(/<title>(.*?)<\/title>/i);o&&o[1]&&(t="Server Error: ".concat(o[1]))}throw Error(t)}}if(e.match(/^\/books\/[a-z0-9]+$/i)&&a&&a.includes("application/json"))try{let e=await r.json();return e&&"object"==typeof e&&(console.log("Raw premium data from API:",{isPremium:e.isPremium,isPremiumType:typeof e.isPremium,price:e.price,priceType:typeof e.price}),e.price&&"object"==typeof e.price&&e.price.$numberLong&&(e.price=Number(e.price.$numberLong),console.log("Extracted $numberLong price:",e.price)),"isPremium"in e&&(e.isPremium=!0===e.isPremium||"true"===e.isPremium||1===e.isPremium||"true"===String(e.isPremium).toLowerCase()),"price"in e&&(e.price=Number(e.price||0)),!e.isPremium&&e.price>0&&(e.isPremium=!0,console.log("API Utils: Setting isPremium=true based on price > 0")),console.log("API Utils - Processed book details:",{title:e.title,isPremium:e.isPremium,price:e.price})),e}catch(e){throw console.error("Error parsing book details:",e),e}if(a&&a.includes("application/json"))return await r.json();{console.warn("Response is not JSON. Content-Type:",a);let e=await r.text();try{return JSON.parse(e)}catch(e){throw console.error("Failed to parse response as JSON:",e),Error("API response was not valid JSON")}}}catch(e){throw console.error("API request error:",e),e}}async function c(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return a(e,{method:"GET",...t})}async function i(e,t){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return a(e,{method:"POST",body:t instanceof FormData?t:JSON.stringify(t),...o})}async function l(e,t){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return a(e,{method:"PUT",body:JSON.stringify(t),...o})}async function u(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return a(e,{method:"DELETE",...t})}async function p(e,t){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return a(e,{method:"PATCH",body:JSON.stringify(t),...o})}},74436:(e,t,o)=>{"use strict";o.d(t,{k5:()=>u});var n=o(12115),s={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},r=n.createContext&&n.createContext(s),a=["attr","size","title"];function c(){return(c=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var n in o)Object.prototype.hasOwnProperty.call(o,n)&&(e[n]=o[n])}return e}).apply(this,arguments)}function i(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),o.push.apply(o,n)}return o}function l(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?i(Object(o),!0).forEach(function(t){var n,s,r;n=e,s=t,r=o[t],(s=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var o=e[Symbol.toPrimitive];if(void 0!==o){var n=o.call(e,t||"default");if("object"!=typeof n)return n;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(s))in n?Object.defineProperty(n,s,{value:r,enumerable:!0,configurable:!0,writable:!0}):n[s]=r}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):i(Object(o)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))})}return e}function u(e){return t=>n.createElement(p,c({attr:l({},e.attr)},t),function e(t){return t&&t.map((t,o)=>n.createElement(t.tag,l({key:o},t.attr),e(t.child)))}(e.child))}function p(e){var t=t=>{var o,{attr:s,size:r,title:i}=e,u=function(e,t){if(null==e)return{};var o,n,s=function(e,t){if(null==e)return{};var o={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;o[n]=e[n]}return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)o=r[n],!(t.indexOf(o)>=0)&&Object.prototype.propertyIsEnumerable.call(e,o)&&(s[o]=e[o])}return s}(e,a),p=r||t.size||"1em";return t.className&&(o=t.className),e.className&&(o=(o?o+" ":"")+e.className),n.createElement("svg",c({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},t.attr,s,u,{className:o,style:l(l({color:e.color||t.color},t.style),e.style),height:p,width:p,xmlns:"http://www.w3.org/2000/svg"}),i&&n.createElement("title",null,i),e.children)};return void 0!==r?n.createElement(r.Consumer,null,e=>t(e)):t(s)}},89165:(e,t,o)=>{Promise.resolve().then(o.bind(o,17029))}},e=>{var t=t=>e(e.s=t);e.O(0,[3247,6711,6874,8441,1684,7358],()=>t(89165)),_N_E=e.O()}]);