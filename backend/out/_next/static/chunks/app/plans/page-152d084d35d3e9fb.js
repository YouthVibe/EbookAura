(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[481],{10868:e=>{e.exports={container:"plans_container__wpxuU",header:"plans_header__iQnsV",backButton:"plans_backButton__LftVj",title:"plans_title__TFIWG",loading:"plans_loading__RV3s8",error:"plans_error__n6XE9",success:"plans_success__XtaC3",coinsBalance:"plans_coinsBalance__spZrH",coinIcon:"plans_coinIcon__X3e0Y",coinCount:"plans_coinCount__TqL7H",coinLabel:"plans_coinLabel__BGhR3",getCoinsButton:"plans_getCoinsButton__p79Ku",currentSubscription:"plans_currentSubscription__RBUoe",subscriptionHeader:"plans_subscriptionHeader__SSoM4",crownIcon:"plans_crownIcon__ZcuGw",subscriptionDetails:"plans_subscriptionDetails__mNoZA",subscriptionActions:"plans_subscriptionActions__iJsuB",nonCancelableNotice:"plans_nonCancelableNotice__S8O3G",infoIcon:"plans_infoIcon__w9ZpH",settingsButton:"plans_settingsButton__wMEh_",nonRefundableWarning:"plans_nonRefundableWarning__qL__H",warningIcon:"plans_warningIcon__qgOc_",plansContainer:"plans_plansContainer__CZsXr",planCard:"plans_planCard__fwUHw",popularPlan:"plans_popularPlan__lAzEA",popularBadge:"plans_popularBadge__f2VF4",planName:"plans_planName__Azr3k",planDescription:"plans_planDescription__zqb7Y",planPrice:"plans_planPrice__wGyOe",planCoinIcon:"plans_planCoinIcon__oEoAC",priceValue:"plans_priceValue__tSgSp",pricePeriod:"plans_pricePeriod__GytVi",featuresList:"plans_featuresList__ZaLYY",featureItem:"plans_featureItem__ozpH0",checkIcon:"plans_checkIcon__dBzlI",subscribeButton:"plans_subscribeButton__4o3Ye",disabledButton:"plans_disabledButton__v6DmT",insufficientCoins:"plans_insufficientCoins__K4D7u",noPlans:"plans_noPlans__G4vjo",modalOverlay:"plans_modalOverlay__gXxdL",modalContent:"plans_modalContent___rr_V",balanceInfo:"plans_balanceInfo__DIN_d",modalActions:"plans_modalActions__a1Bbg",cancelButton:"plans_cancelButton__JEz6Y",confirmButton:"plans_confirmButton__HoBWq",modalHeader:"plans_modalHeader__P5bTz",closeModalButton:"plans_closeModalButton__2Q0S3",modalBody:"plans_modalBody__wf7hF",balanceRow:"plans_balanceRow__Z1igP",warningHeader:"plans_warningHeader__hwZuR"}},17029:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>m});var n=r(95155),o=r(12115),a=r(35695),s=r(6874),i=r.n(s),c=r(29911),l=r(56068),u=r(10868),d=r.n(u),h=r(53116),p=r(46264);function m(){var e;let{user:t,updateUserCoins:r,isLoggedIn:s}=(0,l.h)(),u=(0,a.useRouter)(),[m,f]=(0,o.useState)(!0),[g,b]=(0,o.useState)(!1),[_,y]=(0,o.useState)([]),[w,j]=(0,o.useState)(null),[v,x]=(0,o.useState)(""),[N,S]=(0,o.useState)(""),[P,I]=(0,o.useState)(!1),[k,E]=(0,o.useState)(null),C=async()=>{f(!0),x("");try{let e=await (0,p.wQ)();e&&e.plans?y(e.plans):e&&e.data&&y(e.data);try{let e=await (0,p.zN)();e&&e.hasSubscription&&e.subscription?j(e.subscription):(console.log("No active subscription found"),e&&e.wasExpired&&x("Your subscription has expired. Please renew to continue enjoying premium benefits."),j(null))}catch(e){console.error("Error fetching subscription:",e)}let t=await (0,h.getUserCoins)();t&&"number"==typeof t.coins&&r(t.coins)}catch(e){console.error("Error initializing plans page:",e),x(e.message||"Failed to load subscription plans")}finally{f(!1)}};(0,o.useEffect)(()=>{s?C():u.push("/login?redirect=plans")},[s,u]);let A=async()=>{if(k){b(!0),x(""),S("");try{let e=await (0,p.D8)({planId:k._id,paymentMethod:"coins"});if(e&&e.subscription){j(e.subscription),S("Successfully subscribed to ".concat(k.name,"!"));let t=await (0,h.getUserCoins)();t&&"number"==typeof t.coins&&r(t.coins),I(!1),document.body.style.overflow="",window.scrollTo(0,0)}}catch(e){console.error("Error purchasing subscription:",e),x(e.message||"Failed to purchase subscription")}finally{b(!1)}}},B=e=>{if(!s)return void u.push("/login?redirect=plans");if((null==t?void 0:t.coins)<e.price){x("You don't have enough coins to purchase this plan. You need ".concat(e.price-t.coins," more coins.")),window.scrollTo(0,0);return}E(e),I(!0),setTimeout(()=>{window.scrollTo(0,0),document.body.style.overflow="hidden"},10)},O=e=>{if(!e.duration)return"";let{value:t,unit:r}=e.duration;return 1===t?"".concat(t," ").concat(r.slice(0,-1)):"".concat(t," ").concat(r)},T=()=>{I(!1),document.body.style.overflow=""};return m?(0,n.jsxs)("div",{className:d().container,children:[(0,n.jsxs)("div",{className:d().header,children:[(0,n.jsx)(i(),{href:"/",className:d().backButton,children:(0,n.jsx)(c.QVr,{})}),(0,n.jsx)("h1",{className:d().title,children:"Subscription Plans"})]}),(0,n.jsx)("div",{className:d().loading,children:"Loading plans..."})]}):(0,n.jsxs)("div",{className:d().container,children:[(0,n.jsxs)("div",{className:d().header,children:[(0,n.jsx)(i(),{href:"/",className:d().backButton,children:(0,n.jsx)(c.QVr,{})}),(0,n.jsx)("h1",{className:d().title,children:"Subscription Plans"})]}),v&&(0,n.jsx)("div",{className:d().error,children:v}),N&&(0,n.jsx)("div",{className:d().success,children:N}),w&&(0,n.jsxs)("div",{className:d().currentSubscription,children:[(0,n.jsxs)("div",{className:d().subscriptionHeader,children:[(0,n.jsx)(c.Hu1,{className:d().crownIcon}),(0,n.jsx)("h2",{children:"Your Current Subscription"})]}),(0,n.jsxs)("div",{className:d().subscriptionDetails,children:[(0,n.jsxs)("p",{children:[(0,n.jsx)("strong",{children:"Plan:"})," ",(null==(e=w.plan)?void 0:e.name)||"Premium Plan"]}),(0,n.jsxs)("p",{children:[(0,n.jsx)("strong",{children:"Status:"})," ",w.status]}),(0,n.jsxs)("p",{children:[(0,n.jsx)("strong",{children:"Active Until:"})," ",new Date(w.endDate).toLocaleDateString()]})]}),(0,n.jsx)("div",{className:d().subscriptionActions,children:(0,n.jsxs)("p",{className:d().nonCancelableNotice,children:[(0,n.jsx)(c.__w,{className:d().infoIcon})," Subscriptions are non-refundable and cannot be canceled once purchased."]})})]}),(0,n.jsxs)("div",{className:d().coinsBalance,children:[(0,n.jsx)(c.cEG,{className:d().coinIcon}),(0,n.jsx)("span",{className:d().coinCount,children:(null==t?void 0:t.coins)||0}),(0,n.jsx)("span",{className:d().coinLabel,children:"coins"}),(0,n.jsx)(i(),{href:"/coins",className:d().getCoinsButton,children:"Get More Coins"})]}),(0,n.jsx)("div",{className:d().plansContainer,children:_.length>0?_.map(e=>{var r,o,a,s,i,l;return(0,n.jsxs)("div",{className:"".concat(d().planCard," ").concat(e.isPopular?d().popularPlan:""),children:[e.isPopular&&(0,n.jsx)("div",{className:d().popularBadge,children:"Most Popular"}),(0,n.jsx)("h2",{className:d().planName,children:e.name}),(0,n.jsx)("p",{className:d().planDescription,children:e.description}),(0,n.jsxs)("div",{className:d().planPrice,children:[(0,n.jsx)(c.cEG,{className:d().planCoinIcon}),(0,n.jsx)("span",{className:d().priceValue,children:e.price}),(0,n.jsxs)("span",{className:d().pricePeriod,children:["for ",O(e)]})]}),(0,n.jsxs)("ul",{className:d().featuresList,children:[null==(r=e.features)?void 0:r.map((e,t)=>(0,n.jsxs)("li",{className:d().featureItem,children:[(0,n.jsx)(c.CMH,{className:d().checkIcon}),e]},t)),(null==(o=e.benefits)?void 0:o.maxPremiumBooks)>0&&(0,n.jsxs)("li",{className:d().featureItem,children:[(0,n.jsx)(c.CMH,{className:d().checkIcon}),e.benefits.maxPremiumBooks===1/0?"Unlimited premium books":"".concat(e.benefits.maxPremiumBooks," premium books/month")]}),(null==(a=e.benefits)?void 0:a.offlineReading)&&(0,n.jsxs)("li",{className:d().featureItem,children:[(0,n.jsx)(c.CMH,{className:d().checkIcon}),"Offline reading"]}),(null==(s=e.benefits)?void 0:s.adFree)&&(0,n.jsxs)("li",{className:d().featureItem,children:[(0,n.jsx)(c.CMH,{className:d().checkIcon}),"Ad-free experience"]}),(null==(i=e.benefits)?void 0:i.earlyAccess)&&(0,n.jsxs)("li",{className:d().featureItem,children:[(0,n.jsx)(c.CMH,{className:d().checkIcon}),"Early access to new releases"]}),(null==(l=e.benefits)?void 0:l.exclusiveContent)&&(0,n.jsxs)("li",{className:d().featureItem,children:[(0,n.jsx)(c.CMH,{className:d().checkIcon}),"Exclusive content"]})]}),(0,n.jsx)("button",{className:"".concat(d().subscribeButton," ").concat(w?d().disabledButton:""),onClick:()=>B(e),disabled:!!w,children:w?"Already Subscribed":(null==t?void 0:t.coins)<e.price?"Need More Coins":"Subscribe Now"}),(null==t?void 0:t.coins)<e.price&&(0,n.jsxs)("p",{className:d().insufficientCoins,children:["You need ",e.price-t.coins," more coins"]})]},e._id)}):(0,n.jsxs)("div",{className:d().noPlans,children:[(0,n.jsx)(c.__w,{className:d().infoIcon}),(0,n.jsx)("p",{children:"No subscription plans are currently available."})]})}),P&&k&&(0,n.jsx)("div",{className:d().modalOverlay,children:(0,n.jsxs)("div",{className:d().modalContent,children:[(0,n.jsxs)("div",{className:d().modalHeader,children:[(0,n.jsx)("h2",{children:"Confirm Subscription"}),(0,n.jsx)("button",{className:d().closeModalButton,onClick:T,"aria-label":"Close modal",children:"âœ•"})]}),(0,n.jsxs)("div",{className:d().modalBody,children:[(0,n.jsxs)("p",{children:["You are about to subscribe to ",(0,n.jsx)("strong",{children:k.name}),"."]}),(0,n.jsxs)("p",{children:["This will cost ",(0,n.jsxs)("strong",{children:[k.price," coins"]})," from your balance."]}),(0,n.jsxs)("div",{className:d().balanceInfo,children:[(0,n.jsxs)("div",{className:d().balanceRow,children:[(0,n.jsx)("span",{children:"Current Balance:"}),(0,n.jsxs)("strong",{children:[null==t?void 0:t.coins," coins"]})]}),(0,n.jsxs)("div",{className:d().balanceRow,children:[(0,n.jsx)("span",{children:"Balance After:"}),(0,n.jsxs)("strong",{children:[(null==t?void 0:t.coins)-k.price," coins"]})]})]}),(0,n.jsxs)("div",{className:d().nonRefundableWarning,children:[(0,n.jsxs)("div",{className:d().warningHeader,children:[(0,n.jsx)(c.__w,{className:d().warningIcon}),(0,n.jsx)("p",{children:"Important Information"})]}),(0,n.jsx)("p",{children:"By purchasing this subscription, you acknowledge that:"}),(0,n.jsxs)("ul",{children:[(0,n.jsxs)("li",{children:["Subscriptions are ",(0,n.jsx)("strong",{children:"non-refundable"})]}),(0,n.jsxs)("li",{children:["Subscriptions ",(0,n.jsx)("strong",{children:"cannot be canceled"})," once purchased"]}),(0,n.jsx)("li",{children:"Your subscription will be active until the end date"})]})]})]}),(0,n.jsxs)("div",{className:d().modalActions,children:[(0,n.jsx)("button",{className:d().cancelButton,onClick:T,disabled:g,children:"Cancel"}),(0,n.jsx)("button",{className:d().confirmButton,onClick:A,disabled:g,children:g?"Processing...":"Confirm Purchase"})]})]})})]})}},35695:(e,t,r)=>{"use strict";var n=r(18999);r.o(n,"useParams")&&r.d(t,{useParams:function(){return n.useParams}}),r.o(n,"usePathname")&&r.d(t,{usePathname:function(){return n.usePathname}}),r.o(n,"useRouter")&&r.d(t,{useRouter:function(){return n.useRouter}}),r.o(n,"useSearchParams")&&r.d(t,{useSearchParams:function(){return n.useSearchParams}})},46264:(e,t,r)=>{"use strict";r.d(t,{D8:()=>c,_h:()=>i,nV:()=>l,wQ:()=>a,zN:()=>s});var n=r(72047);let o={PLANS:36e5,CURRENT:3e5,HISTORY:6e5},a=async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];try{let t="subscription_plans",{shouldMakeCall:r,cachedData:a}=(0,n.UB)(t,o.PLANS,e);if(!r&&a)return a;let s=await (0,n.dw)("/subscriptions/plans");if(s){let e=s.plans||s.data||[],r={...s,plans:e};return(0,n.yt)(t,r),r}return s}catch(e){throw console.error("Error fetching subscription plans:",e),e}},s=async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];try{let t=localStorage.getItem("token");if(!t)throw Error("Authentication required");let r="current_subscription",{shouldMakeCall:a,cachedData:s}=(0,n.UB)(r,o.CURRENT,e);if(!a&&s)return s;let i=await (0,n.dw)("/subscriptions/current",{headers:{Authorization:"Bearer ".concat(t)}});return(0,n.yt)(r,i),i}catch(e){throw console.error("Error fetching current subscription:",e),e}},i=async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];try{let t=localStorage.getItem("token");if(!t)throw Error("Authentication required");let r="subscription_history",{shouldMakeCall:a,cachedData:s}=(0,n.UB)(r,o.HISTORY,e);if(!a&&s)return s;let i=await (0,n.dw)("/subscriptions/history",{headers:{Authorization:"Bearer ".concat(t)}});return(0,n.yt)(r,i),i}catch(e){throw console.error("Error fetching subscription history:",e),e}},c=async e=>{try{let t=localStorage.getItem("token");if(!t)throw Error("Authentication required");let r=await (0,n.Xj)("/subscriptions",e,{headers:{Authorization:"Bearer ".concat(t)}});return(0,n.yt)("current_subscription",null),(0,n.yt)("subscription_history",null),r}catch(e){throw console.error("Error purchasing subscription:",e),e}},l=async(e,t)=>{try{let r=localStorage.getItem("token");if(!r)throw Error("Authentication required");let o=await (0,n.TA)("/subscriptions/".concat(e),t,{headers:{Authorization:"Bearer ".concat(r)}});return(0,n.yt)("current_subscription",null),(0,n.yt)("subscription_history",null),o}catch(e){throw console.error("Error updating subscription:",e),e}}},53116:(e,t,r)=>{"use strict";r.d(t,{$P:()=>a,PZ:()=>d,Yv:()=>l,getUserCoins:()=>o,lD:()=>s,vW:()=>u,wA:()=>c,z$:()=>i});var n=r(72047);let o=async()=>{try{let e=localStorage.getItem("token");if(!e)throw Error("Authentication required");return await fetch("".concat("https://ebookaura.onrender.com/api","/coins"),{method:"GET",headers:{Authorization:"Bearer ".concat(e)}}).then(e=>{if(!e.ok)throw Error("Failed to get coin balance");return e.json()})}catch(e){throw console.error("Error getting user coins:",e),e}},a=async e=>{try{let t=localStorage.getItem("token");if(!t)throw Error("Authentication required");return await fetch("".concat("https://ebookaura.onrender.com/api","/coins/update-session"),{method:"POST",headers:{Authorization:"Bearer ".concat(t),"Content-Type":"application/json"},body:JSON.stringify({sessionDuration:e})}).then(e=>{if(!e.ok)throw Error("Failed to update session time");return e.json()})}catch(e){throw console.error("Error updating session time:",e),e}},s=async()=>{try{let e=localStorage.getItem("token");if(!e)throw Error("Authentication required");return await fetch("".concat("https://ebookaura.onrender.com/api","/coins/session-status"),{method:"GET",headers:{Authorization:"Bearer ".concat(e)}}).then(e=>{if(!e.ok)throw Error("Failed to get session status");return e.json()})}catch(e){throw console.error("Error getting session status:",e),e}},i=async()=>{try{let e=localStorage.getItem("token");if(!e)throw Error("Authentication required");return await fetch("".concat("https://ebookaura.onrender.com/api","/coins/activity-reward"),{method:"POST",headers:{Authorization:"Bearer ".concat(e)}}).then(e=>e.ok?e.json():e.json().then(e=>{throw Error(e.message||"Failed to claim activity reward")}))}catch(e){throw console.error("Error claiming activity reward coins:",e),e}},c=async()=>{try{let e=localStorage.getItem("token");if(!e)throw Error("Authentication required");return await fetch("".concat("https://ebookaura.onrender.com/api","/coins/daily"),{method:"POST",headers:{Authorization:"Bearer ".concat(e)}}).then(e=>e.ok?e.json():e.json().then(e=>{throw Error(e.message||"Failed to claim daily coins")}))}catch(e){throw console.error("Error claiming daily coins:",e),e}},l=async()=>{try{let e=localStorage.getItem("token");if(!e)throw Error("Authentication required");return await fetch("".concat("https://ebookaura.onrender.com/api","/coins/daily-status"),{method:"GET",headers:{Authorization:"Bearer ".concat(e)}}).then(e=>{if(!e.ok)throw Error("Failed to check daily coins status");return e.json()})}catch(e){throw console.error("Error checking daily coins status:",e),e}},u=async e=>{try{let t=localStorage.getItem("token");if(!t)throw Error("Authentication required");return await (0,n.Xj)("/coins/purchase/".concat(e),{},{headers:{Authorization:"Bearer ".concat(t)}})}catch(e){throw console.error("Error purchasing book:",e),e}},d=async e=>{try{let t=localStorage.getItem("token");if(!t)throw Error("Authentication required");return await (0,n.dw)("/users/check-purchase/".concat(e),{headers:{Authorization:"Bearer ".concat(t)}})}catch(e){throw console.error("Error checking book purchase:",e),e}}},56068:(e,t,r)=>{"use strict";r.d(t,{AuthProvider:()=>l,h:()=>u});var n=r(95155),o=r(12115),a=r(35695),s=r(72047);let i=(0,o.createContext)(),c=()=>"ak_"+Array.from(crypto.getRandomValues(new Uint8Array(24))).map(e=>e.toString(16).padStart(2,"0")).join(""),l=e=>{let{children:t}=e,[r,l]=(0,o.useState)(null),[u,d]=(0,o.useState)(!0),[h,p]=(0,o.useState)(!1),m=(0,a.useRouter)(),f=(0,o.useRef)(!1),g=(0,o.useRef)(!1);(0,o.useEffect)(()=>{p(!0),(async()=>{try{let e=localStorage.getItem("userInfo"),t=localStorage.getItem("token");if(localStorage.getItem("apiKey"),e&&t)try{if(l(JSON.parse(e)),!f.current&&!g.current){f.current=!0;try{await (0,s.dw)("/auth/check",{headers:{Authorization:"Bearer ".concat(t)}}),g.current=!0}catch(e){if(console.error("Token validation failed:",e),"localhost"!==window.location.hostname)try{console.log("Retrying token validation..."),await new Promise(e=>setTimeout(e,1e3)),await (0,s.dw)("/auth/check",{headers:{Authorization:"Bearer ".concat(t)}}),g.current=!0}catch(e){console.error("Token validation retry failed:",e),_()}else _()}finally{f.current=!1}}}catch(e){console.error("Failed to parse user info:",e),localStorage.removeItem("userInfo"),localStorage.removeItem("token"),localStorage.removeItem("apiKey")}}finally{d(!1)}})()},[]);let b=e=>{if(console.log("Processing login data"),!e)return void console.error("No user data received for login");try{if(!e.token)return void console.error("No token in login data");let{token:t,...r}=e;console.log("Setting user data:",r),l(r);{localStorage.setItem("userInfo",JSON.stringify(r)),localStorage.setItem("token",t);let e=localStorage.getItem("apiKey");e||(console.log("Generating new API key"),e=c(),localStorage.setItem("apiKey",e)),console.log("Authentication data stored in localStorage")}}catch(e){console.error("Error processing login:",e)}},_=()=>{l(null),localStorage.removeItem("userInfo"),localStorage.removeItem("token"),m.push("/login")},y=()=>localStorage.getItem("token"),w=()=>localStorage.getItem("apiKey"),j=e=>{if(r){let t={...r,coins:e};l(t),localStorage.setItem("userInfo",JSON.stringify(t))}};return h?(0,n.jsx)(i.Provider,{value:{user:r,isLoggedIn:!!r,loading:u,login:b,logout:_,getToken:y,getApiKey:w,updateUserCoins:j},children:t}):(0,n.jsx)(i.Provider,{value:{user:null,isLoggedIn:!1,loading:!0,login:b,logout:_,getToken:y,getApiKey:w,updateUserCoins:j},children:t})},u=()=>{let e=(0,o.useContext)(i);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},72047:(e,t,r)=>{"use strict";r.d(t,{TA:()=>d,UB:()=>o,Xj:()=>c,_5:()=>u,dw:()=>i,q1:()=>l,yt:()=>a});let n={};function o(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(r)return{shouldMakeCall:!0,cachedData:null};let o=Date.now(),a=n[e];return!a||o-a.timestamp>t?{shouldMakeCall:!0,cachedData:null}:{shouldMakeCall:!1,cachedData:a.data}}function a(e,t){n[e]={timestamp:Date.now(),data:t}}async function s(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{let r=e.startsWith("http")?e:"".concat("https://ebookaura.onrender.com/api").concat(e);console.log("API Request: ".concat(t.method||"GET"," ").concat(r)),t.headers||(t.headers={}),!t.body||t.headers["Content-Type"]||t.body instanceof FormData||(t.headers["Content-Type"]="application/json");let n=e.startsWith("/books")&&("GET"===t.method||!t.method)&&!e.includes("/reviews")&&!e.includes("/bookmarks"),o=e.match(/^\/books\/[a-z0-9]+$/i);{let e=localStorage.getItem("token"),r=localStorage.getItem("apiKey");e&&(!n||o)&&!t.headers.Authorization&&(t.headers.Authorization="Bearer ".concat(e)),r&&!t.headers["X-API-Key"]&&(t.headers["X-API-Key"]=r)}let a=await fetch(r,t),s=a.headers.get("content-type");if(!a.ok){if(console.error("API Error (".concat(a.status,"): ").concat(a.statusText)),s&&s.includes("application/json")){let e=await a.json();throw Error(e.message||"API request failed with status ".concat(a.status))}{let e=await a.text();console.error("Non-JSON error response:",e.substring(0,150)+"...");let t="API request failed with status ".concat(a.status);if(e.includes("<title>")&&e.includes("</title>")){let r=e.match(/<title>(.*?)<\/title>/i);r&&r[1]&&(t="Server Error: ".concat(r[1]))}throw Error(t)}}if(e.match(/^\/books\/[a-z0-9]+$/i)&&s&&s.includes("application/json"))try{let e=await a.json();return e&&"object"==typeof e&&(console.log("Raw premium data from API:",{isPremium:e.isPremium,isPremiumType:typeof e.isPremium,price:e.price,priceType:typeof e.price}),e.price&&"object"==typeof e.price&&e.price.$numberLong&&(e.price=Number(e.price.$numberLong),console.log("Extracted $numberLong price:",e.price)),"isPremium"in e&&(e.isPremium=!0===e.isPremium||"true"===e.isPremium||1===e.isPremium||"true"===String(e.isPremium).toLowerCase()),"price"in e&&(e.price=Number(e.price||0)),!e.isPremium&&e.price>0&&(e.isPremium=!0,console.log("API Utils: Setting isPremium=true based on price > 0")),console.log("API Utils - Processed book details:",{title:e.title,isPremium:e.isPremium,price:e.price})),e}catch(e){throw console.error("Error parsing book details:",e),e}if(s&&s.includes("application/json"))return await a.json();{console.warn("Response is not JSON. Content-Type:",s);let e=await a.text();try{return JSON.parse(e)}catch(e){throw console.error("Failed to parse response as JSON:",e),Error("API response was not valid JSON")}}}catch(e){throw console.error("API request error:",e),e}}async function i(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return s(e,{method:"GET",...t})}async function c(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return s(e,{method:"POST",body:t instanceof FormData?t:JSON.stringify(t),...r})}async function l(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return s(e,{method:"PUT",body:JSON.stringify(t),...r})}async function u(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return s(e,{method:"DELETE",...t})}async function d(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return s(e,{method:"PATCH",body:JSON.stringify(t),...r})}},74436:(e,t,r)=>{"use strict";r.d(t,{k5:()=>u});var n=r(12115),o={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},a=n.createContext&&n.createContext(o),s=["attr","size","title"];function i(){return(i=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function c(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function l(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?c(Object(r),!0).forEach(function(t){var n,o,a;n=e,o=t,a=r[t],(o=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(o))in n?Object.defineProperty(n,o,{value:a,enumerable:!0,configurable:!0,writable:!0}):n[o]=a}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):c(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function u(e){return t=>n.createElement(d,i({attr:l({},e.attr)},t),function e(t){return t&&t.map((t,r)=>n.createElement(t.tag,l({key:r},t.attr),e(t.child)))}(e.child))}function d(e){var t=t=>{var r,{attr:o,size:a,title:c}=e,u=function(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)r=a[n],!(t.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}(e,s),d=a||t.size||"1em";return t.className&&(r=t.className),e.className&&(r=(r?r+" ":"")+e.className),n.createElement("svg",i({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},t.attr,o,u,{className:r,style:l(l({color:e.color||t.color},t.style),e.style),height:d,width:d,xmlns:"http://www.w3.org/2000/svg"}),c&&n.createElement("title",null,c),e.children)};return void 0!==a?n.createElement(a.Consumer,null,e=>t(e)):t(o)}},89165:(e,t,r)=>{Promise.resolve().then(r.bind(r,17029))}},e=>{var t=t=>e(e.s=t);e.O(0,[3247,6711,6874,8441,1684,7358],()=>t(89165)),_N_E=e.O()}]);