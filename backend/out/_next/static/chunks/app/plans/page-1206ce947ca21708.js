(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[481],{10868:e=>{e.exports={container:"plans_container__wpxuU",header:"plans_header__iQnsV",backButton:"plans_backButton__LftVj",title:"plans_title__TFIWG",loading:"plans_loading__RV3s8",error:"plans_error__n6XE9",success:"plans_success__XtaC3",coinsBalance:"plans_coinsBalance__spZrH",coinIcon:"plans_coinIcon__X3e0Y",coinCount:"plans_coinCount__TqL7H",coinLabel:"plans_coinLabel__BGhR3",getCoinsButton:"plans_getCoinsButton__p79Ku",currentSubscription:"plans_currentSubscription__RBUoe",subscriptionHeader:"plans_subscriptionHeader__SSoM4",crownIcon:"plans_crownIcon__ZcuGw",subscriptionDetails:"plans_subscriptionDetails__mNoZA",subscriptionActions:"plans_subscriptionActions__iJsuB",settingsButton:"plans_settingsButton__wMEh_",plansContainer:"plans_plansContainer__CZsXr",planCard:"plans_planCard__fwUHw",popularPlan:"plans_popularPlan__lAzEA",popularBadge:"plans_popularBadge__f2VF4",planName:"plans_planName__Azr3k",planDescription:"plans_planDescription__zqb7Y",planPrice:"plans_planPrice__wGyOe",planCoinIcon:"plans_planCoinIcon__oEoAC",priceValue:"plans_priceValue__tSgSp",pricePeriod:"plans_pricePeriod__GytVi",featuresList:"plans_featuresList__ZaLYY",featureItem:"plans_featureItem__ozpH0",checkIcon:"plans_checkIcon__dBzlI",subscribeButton:"plans_subscribeButton__4o3Ye",disabledButton:"plans_disabledButton__v6DmT",insufficientCoins:"plans_insufficientCoins__K4D7u",noPlans:"plans_noPlans__G4vjo",infoIcon:"plans_infoIcon__w9ZpH",modalOverlay:"plans_modalOverlay__gXxdL",modalContent:"plans_modalContent___rr_V",balanceInfo:"plans_balanceInfo__DIN_d",modalActions:"plans_modalActions__a1Bbg",cancelButton:"plans_cancelButton__JEz6Y",confirmButton:"plans_confirmButton__HoBWq"}},17029:(e,s,n)=>{"use strict";n.r(s),n.d(s,{default:()=>_});var a=n(95155),c=n(12115),i=n(35695),r=n(6874),o=n.n(r),t=n(29911),l=n(56068),u=n(10868),d=n.n(u),p=n(53116),h=n(46264);function _(){var e;let{user:s,updateUserCoins:n,isLoggedIn:r}=(0,l.h)(),u=(0,i.useRouter)(),[_,m]=(0,c.useState)(!0),[b,x]=(0,c.useState)(!1),[j,f]=(0,c.useState)([]),[N,g]=(0,c.useState)(null),[v,w]=(0,c.useState)(""),[B,C]=(0,c.useState)(""),[I,y]=(0,c.useState)(!1),[k,A]=(0,c.useState)(null),S=async()=>{m(!0),w("");try{let e=await (0,h.wQ)();e&&e.plans?f(e.plans):e&&e.data&&f(e.data);try{let e=await (0,h.zN)();e&&e.hasSubscription&&e.subscription?g(e.subscription):(console.log("No active subscription found"),g(null))}catch(e){console.error("Error fetching subscription:",e)}let s=await (0,p.A0)();s&&"number"==typeof s.coins&&n(s.coins)}catch(e){console.error("Error initializing plans page:",e),w(e.message||"Failed to load subscription plans")}finally{m(!1)}};(0,c.useEffect)(()=>{r?S():u.push("/login?redirect=plans")},[r,u]);let E=async()=>{if(k){x(!0),w(""),C("");try{let e=await (0,h.D8)({planId:k._id,paymentMethod:"coins"});if(e&&e.subscription){g(e.subscription),C("Successfully subscribed to ".concat(k.name,"!"));let s=await (0,p.A0)();s&&"number"==typeof s.coins&&n(s.coins),y(!1),window.scrollTo(0,0)}}catch(e){console.error("Error purchasing subscription:",e),w(e.message||"Failed to purchase subscription")}finally{x(!1)}}},P=e=>{if(!r)return void u.push("/login?redirect=plans");if((null==s?void 0:s.coins)<e.price){w("You don't have enough coins to purchase this plan. You need ".concat(e.price-s.coins," more coins.")),window.scrollTo(0,0);return}A(e),y(!0)},H=e=>{if(!e.duration)return"";let{value:s,unit:n}=e.duration;return 1===s?"".concat(s," ").concat(n.slice(0,-1)):"".concat(s," ").concat(n)};return _?(0,a.jsxs)("div",{className:d().container,children:[(0,a.jsxs)("div",{className:d().header,children:[(0,a.jsx)(o(),{href:"/",className:d().backButton,children:(0,a.jsx)(t.QVr,{})}),(0,a.jsx)("h1",{className:d().title,children:"Subscription Plans"})]}),(0,a.jsx)("div",{className:d().loading,children:"Loading plans..."})]}):(0,a.jsxs)("div",{className:d().container,children:[(0,a.jsxs)("div",{className:d().header,children:[(0,a.jsx)(o(),{href:"/",className:d().backButton,children:(0,a.jsx)(t.QVr,{})}),(0,a.jsx)("h1",{className:d().title,children:"Subscription Plans"})]}),v&&(0,a.jsx)("div",{className:d().error,children:v}),B&&(0,a.jsx)("div",{className:d().success,children:B}),N&&(0,a.jsxs)("div",{className:d().currentSubscription,children:[(0,a.jsxs)("div",{className:d().subscriptionHeader,children:[(0,a.jsx)(t.Hu1,{className:d().crownIcon}),(0,a.jsx)("h2",{children:"Your Current Subscription"})]}),(0,a.jsxs)("div",{className:d().subscriptionDetails,children:[(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Plan:"})," ",(null==(e=N.plan)?void 0:e.name)||"Premium Plan"]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Status:"})," ",N.status]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Active Until:"})," ",new Date(N.endDate).toLocaleDateString()]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Auto-Renew:"})," ",N.autoRenew?"Enabled":"Disabled"]})]}),(0,a.jsx)("div",{className:d().subscriptionActions,children:(0,a.jsx)(o(),{href:"/settings",className:d().settingsButton,children:"Manage Subscription"})})]}),(0,a.jsxs)("div",{className:d().coinsBalance,children:[(0,a.jsx)(t.cEG,{className:d().coinIcon}),(0,a.jsx)("span",{className:d().coinCount,children:(null==s?void 0:s.coins)||0}),(0,a.jsx)("span",{className:d().coinLabel,children:"coins"}),(0,a.jsx)(o(),{href:"/coins",className:d().getCoinsButton,children:"Get More Coins"})]}),(0,a.jsx)("div",{className:d().plansContainer,children:j.length>0?j.map(e=>{var n,c,i,r,o,l;return(0,a.jsxs)("div",{className:"".concat(d().planCard," ").concat(e.isPopular?d().popularPlan:""),children:[e.isPopular&&(0,a.jsx)("div",{className:d().popularBadge,children:"Most Popular"}),(0,a.jsx)("h2",{className:d().planName,children:e.name}),(0,a.jsx)("p",{className:d().planDescription,children:e.description}),(0,a.jsxs)("div",{className:d().planPrice,children:[(0,a.jsx)(t.cEG,{className:d().planCoinIcon}),(0,a.jsx)("span",{className:d().priceValue,children:e.price}),(0,a.jsxs)("span",{className:d().pricePeriod,children:["for ",H(e)]})]}),(0,a.jsxs)("ul",{className:d().featuresList,children:[null==(n=e.features)?void 0:n.map((e,s)=>(0,a.jsxs)("li",{className:d().featureItem,children:[(0,a.jsx)(t.CMH,{className:d().checkIcon}),e]},s)),(null==(c=e.benefits)?void 0:c.maxPremiumBooks)>0&&(0,a.jsxs)("li",{className:d().featureItem,children:[(0,a.jsx)(t.CMH,{className:d().checkIcon}),e.benefits.maxPremiumBooks===1/0?"Unlimited premium books":"".concat(e.benefits.maxPremiumBooks," premium books/month")]}),(null==(i=e.benefits)?void 0:i.offlineReading)&&(0,a.jsxs)("li",{className:d().featureItem,children:[(0,a.jsx)(t.CMH,{className:d().checkIcon}),"Offline reading"]}),(null==(r=e.benefits)?void 0:r.adFree)&&(0,a.jsxs)("li",{className:d().featureItem,children:[(0,a.jsx)(t.CMH,{className:d().checkIcon}),"Ad-free experience"]}),(null==(o=e.benefits)?void 0:o.earlyAccess)&&(0,a.jsxs)("li",{className:d().featureItem,children:[(0,a.jsx)(t.CMH,{className:d().checkIcon}),"Early access to new releases"]}),(null==(l=e.benefits)?void 0:l.exclusiveContent)&&(0,a.jsxs)("li",{className:d().featureItem,children:[(0,a.jsx)(t.CMH,{className:d().checkIcon}),"Exclusive content"]})]}),(0,a.jsx)("button",{className:"".concat(d().subscribeButton," ").concat(N?d().disabledButton:""),onClick:()=>P(e),disabled:!!N,children:N?"Already Subscribed":(null==s?void 0:s.coins)<e.price?"Need More Coins":"Subscribe Now"}),(null==s?void 0:s.coins)<e.price&&(0,a.jsxs)("p",{className:d().insufficientCoins,children:["You need ",e.price-s.coins," more coins"]})]},e._id)}):(0,a.jsxs)("div",{className:d().noPlans,children:[(0,a.jsx)(t.__w,{className:d().infoIcon}),(0,a.jsx)("p",{children:"No subscription plans are currently available."})]})}),I&&k&&(0,a.jsx)("div",{className:d().modalOverlay,children:(0,a.jsxs)("div",{className:d().modalContent,children:[(0,a.jsx)("h2",{children:"Confirm Subscription"}),(0,a.jsxs)("p",{children:["You are about to subscribe to ",(0,a.jsx)("strong",{children:k.name}),"."]}),(0,a.jsxs)("p",{children:["This will cost ",(0,a.jsxs)("strong",{children:[k.price," coins"]})," from your balance."]}),(0,a.jsxs)("div",{className:d().balanceInfo,children:[(0,a.jsxs)("p",{children:["Current Balance: ",null==s?void 0:s.coins," coins"]}),(0,a.jsxs)("p",{children:["Balance After: ",(null==s?void 0:s.coins)-k.price," coins"]})]}),(0,a.jsxs)("div",{className:d().modalActions,children:[(0,a.jsx)("button",{className:d().cancelButton,onClick:()=>y(!1),disabled:b,children:"Cancel"}),(0,a.jsx)("button",{className:d().confirmButton,onClick:E,disabled:b,children:b?"Processing...":"Confirm Purchase"})]})]})})]})}},53116:(e,s,n)=>{"use strict";n.d(s,{A0:()=>c,PZ:()=>l,Yv:()=>i,jv:()=>o,vW:()=>t,wA:()=>r});var a=n(72047);let c=async()=>{try{let e=localStorage.getItem("token");if(!e)throw Error("Authentication required");return await (0,a.dw)("/coins",{headers:{Authorization:"Bearer ".concat(e)}})}catch(e){throw console.error("Error fetching coins:",e),e}},i=async()=>{try{let e=localStorage.getItem("token");if(!e)throw Error("Authentication required");return await (0,a.dw)("/coins/daily-status",{headers:{Authorization:"Bearer ".concat(e)}})}catch(e){throw console.error("Error checking daily coins status:",e),e}},r=async()=>{try{let e=localStorage.getItem("token");if(!e)throw Error("Authentication required");return await (0,a.Xj)("/coins/daily",{},{headers:{Authorization:"Bearer ".concat(e)}})}catch(e){throw console.error("Error claiming daily coins:",e),e}},o=async()=>{try{let e=localStorage.getItem("token");if(!e)throw Error("Authentication required");return await (0,a.Xj)("/coins/ad-reward",{},{headers:{Authorization:"Bearer ".concat(e)}})}catch(e){throw console.error("Error claiming ad reward coins:",e),e}},t=async e=>{try{let s=localStorage.getItem("token");if(!s)throw Error("Authentication required");return await (0,a.Xj)("/coins/purchase/".concat(e),{},{headers:{Authorization:"Bearer ".concat(s)}})}catch(e){throw console.error("Error purchasing book:",e),e}},l=async e=>{try{let s=localStorage.getItem("token");if(!s)throw Error("Authentication required");return await (0,a.dw)("/users/check-purchase/".concat(e),{headers:{Authorization:"Bearer ".concat(s)}})}catch(e){throw console.error("Error checking book purchase:",e),e}}},89165:(e,s,n)=>{Promise.resolve().then(n.bind(n,17029))}},e=>{var s=s=>e(e.s=s);e.O(0,[3247,6711,6874,6944,8441,1684,7358],()=>s(89165)),_N_E=e.O()}]);