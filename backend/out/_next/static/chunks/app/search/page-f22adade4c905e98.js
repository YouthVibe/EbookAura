(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2959],{10841:(e,s,o)=>{Promise.resolve().then(o.bind(o,83819))},83819:(e,s,o)=>{"use strict";o.r(s),o.d(s,{default:()=>k});var a=o(95155),r=o(12115),t=o(29911),c=o(6874),n=o.n(c),l=o(89570),i=o.n(l),h=o(35695),m=o(56068),u=o(54544),_=o(72047);let d=e=>{let{message:s,type:o,onClose:t}=e;return(0,r.useEffect)(()=>{let e=setTimeout(()=>{t()},3e3);return()=>clearTimeout(e)},[t]),(0,a.jsxs)("div",{className:"".concat(i().toast," ").concat("success"===o?i().toastSuccess:i().toastError),children:[(0,a.jsx)("span",{children:s}),(0,a.jsx)("button",{onClick:t,className:i().toastClose,children:"\xd7"})]})},g=[{value:"newest",label:"Newest First"},{value:"oldest",label:"Oldest First"},{value:"title",label:"Title A-Z"},{value:"popular",label:"Most Popular"},{value:"rating",label:"Highest Rated"}];function k(){let[e,s]=(0,r.useState)(""),[o,c]=(0,r.useState)(""),[l,k]=(0,r.useState)("newest"),[p,b]=(0,r.useState)([]),[x,f]=(0,r.useState)([]),[j,y]=(0,r.useState)(!0),[v,N]=(0,r.useState)(!1),[S,A]=(0,r.useState)(null),[I,P]=(0,r.useState)(!1),[w,C]=(0,r.useState)(new Set),[B,E]=(0,r.useState)({show:!1,message:"",type:"success"}),[F,H]=(0,r.useState)(!1),T=(0,h.useRouter)(),{getToken:O,getApiKey:R}=(0,m.h)(),[M,L]=(0,r.useState)(1),[U,G]=(0,r.useState)(!0),[V,z]=(0,r.useState)(0),X=(0,r.useRef)();(0,r.useRef)(null);let Z=function(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"success";E({show:!0,message:e,type:s})};(0,r.useEffect)(()=>{(async()=>{try{let e=await (0,_.dw)("/books/categories");if(e&&e.categories&&Array.isArray(e.categories))f(["All",...e.categories]);else if(e&&Array.isArray(e))f(["All",...e]);else if(e&&"object"==typeof e){let s=[];Object.keys(e).length>0&&Object.keys(e).forEach(o=>{Array.isArray(e[o])?s.push(...e[o]):"string"==typeof e[o]&&s.push(e[o])}),s.length>0?f(["All",...s]):f(["All","Fiction","Non-Fiction","Science","History","Biography","Technology"])}else f(["All","Fiction","Non-Fiction","Science","History","Biography","Technology"])}catch(e){A("Failed to load categories"),console.error("Error fetching categories:",e),f(["All","Fiction","Non-Fiction","Science","History","Biography","Technology"])}})()},[]),(0,r.useEffect)(()=>{(async()=>{try{let e=O();if(!e){console.log("No authentication token found, user is not logged in"),P(!1);return}try{let s=await (0,_.dw)("/auth/check",{headers:{Authorization:"Bearer ".concat(e)}});s&&"boolean"==typeof s.isAuthenticated?(P(s.isAuthenticated),console.log("Auth check successful, user is",s.isAuthenticated?"authenticated":"not authenticated"),s.isAuthenticated&&J()):(console.warn("Unexpected auth check response format:",s),P(!1))}catch(e){console.error("Auth check API error:",e.message),P(!1),localStorage.removeItem("token")}}catch(e){console.error("Auth check error:",e),P(!1),localStorage.removeItem("token")}})()},[O]);let J=async()=>{try{let e=O();if(!e)return void console.log("No token available for fetching bookmarks");console.log("Fetching user bookmarks...");let s=await (0,_.dw)("/users/bookmarks",{headers:{Authorization:"Bearer ".concat(e),"X-API-Key":R()}}),o=[];s&&s.bookmarks&&Array.isArray(s.bookmarks)?(console.log("Received bookmarks array from API"),o=s.bookmarks):s&&s.books&&Array.isArray(s.books)?(console.log("Received books array from API"),o=s.books.map(e=>e._id)):s&&Array.isArray(s)?(console.log("Received direct array from API"),o=s.map(e=>e._id||e)):console.warn("Unexpected bookmark data format:",s),console.log("Found ".concat(o.length," bookmarks")),C(new Set(o))}catch(e){console.error("Error fetching bookmarks:",e.message)}},W=async e=>{if(!I)return void T.push("/login");let s=p.find(s=>s._id===e),o=s?s.title:"Book",a=new Set(w),r=w.has(e);r?a.delete(e):a.add(e),C(a);try{let s=O();if(!s)throw Error("Authentication token not found");await (0,_.Xj)("/users/bookmarks",{bookId:e},{headers:{Authorization:"Bearer ".concat(s),"X-API-Key":R()}}),Z(r?'Removed "'.concat(o,'" from bookmarks'):'Added "'.concat(o,'" to bookmarks'),"success")}catch(o){r?a.add(e):a.delete(e),C(a);let s="Error updating bookmark";o.message&&(console.error("Bookmark error details:",o.message),(o.message.includes("Authentication")||o.message.includes("token"))&&(s="Authentication error. Please log in again.",setTimeout(()=>T.push("/login"),2e3))),console.error("Error toggling bookmark:",o),Z(s,"error")}},D=async function(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=!(arguments.length>1)||void 0===arguments[1]||arguments[1];try{console.log("Fetching books: page ".concat(s,', category: "').concat(o,'", sort: ').concat(l,', query: "').concat(e,'", premium: ').concat(F)),N(s>1),1===s&&y(!0);let t=new URLSearchParams;t.append("page",s),t.append("limit",12),t.append("sort",l),e&&t.append("search",e),o&&"All"!==o&&t.append("category",o),F&&t.append("premium","true");let c=t.toString(),n=await (0,_.dw)("/books?".concat(c)),i=[],h=0;if(Array.isArray(n))i=n,h=n.length;else if(n&&n.books&&Array.isArray(n.books)){var r;i=n.books,h=n.totalCount||(null==(r=n.pagination)?void 0:r.totalBooks)||n.books.length}else throw Error("Unexpected response format from API");let m=(i=i.map(e=>{let s=!0===e.isPremium;return console.log("Processing book: ".concat(e.title,", isPremium before: ").concat(e.isPremium,", after: ").concat(s)),{...e,isPremium:s}})).filter(e=>!0===e.isPremium).length;if(console.log("Fetched ".concat(i.length," books (total: ").concat(h,"), ").concat(m," premium books")),F&&0===m&&console.warn("Premium filter is on but no premium books were found"),z(h),G(i.length>0&&i.length>=12),a)b(i);else{let e=new Set(p.map(e=>e._id)),s=i.filter(s=>!e.has(s._id));b(e=>[...e,...s])}}catch(e){console.error("Error fetching books:",e),A("Failed to load books. Please try again.")}finally{y(!1),N(!1)}},Y=(0,r.useCallback)(e=>{j||v||(X.current&&X.current.disconnect(),X.current=new IntersectionObserver(e=>{e[0].isIntersecting&&U&&L(e=>e+1)},{root:null,rootMargin:"0px",threshold:.1}),e&&X.current.observe(e))},[j,v,U]);(0,r.useEffect)(()=>{L(1),b([]),G(!0),D(1,!0)},[e,o,l]),(0,r.useEffect)(()=>{M>1&&D(M,!1)},[M]),(0,r.useEffect)(()=>{j||(L(1),D(1,!0))},[F]);let Q=e=>{if(!e||e<=0)return(0,a.jsxs)("div",{className:i().ratingStars,children:[[1,2,3,4,5].map(e=>(0,a.jsx)(t.wei,{className:i().emptyStar},e)),(0,a.jsx)("span",{className:i().ratingValue,children:"(0.0)"})]});let s=[],o=Math.round(2*e)/2;for(let e=1;e<=5;e++)e<=Math.floor(o)?s.push((0,a.jsx)(t.gt3,{className:i().star},e)):e-.5===o?s.push((0,a.jsx)(t.gVl,{className:i().star},e)):s.push((0,a.jsx)(t.wei,{className:i().emptyStar},e));return(0,a.jsxs)("div",{className:i().ratingStars,children:[s,(0,a.jsxs)("span",{className:i().ratingValue,children:["(",e.toFixed(1),")"]})]})};return(0,a.jsxs)("div",{className:i().container,children:[B.show&&(0,a.jsx)(d,{message:B.message,type:B.type,onClose:()=>{E({show:!1,message:"",type:"success"})}}),(0,a.jsxs)("div",{className:i().searchSection,children:[(0,a.jsx)(u.A,{placeholder:"Search for books by title, author or description...",onSearch:s,initialValue:e,debounceTime:500,className:i().searchBar}),(0,a.jsxs)("div",{className:i().categories,children:[(0,a.jsx)("button",{className:"".concat(i().categoryButton," ").concat(""===o?i().active:""),onClick:()=>c(""),children:"All"}),x.map(e=>(0,a.jsx)("button",{className:"".concat(i().categoryButton," ").concat(o===e?i().active:""),onClick:()=>c(e),children:e},e))]}),(0,a.jsxs)("div",{className:i().filterOptions,children:[(0,a.jsx)("div",{className:i().premiumFilter,children:(0,a.jsxs)("label",{className:i().toggleLabel,children:[(0,a.jsx)("input",{type:"checkbox",checked:F,onChange:()=>H(!F),className:i().toggleCheckbox}),(0,a.jsx)("span",{className:i().toggleSwitch}),(0,a.jsxs)("span",{className:i().toggleText,children:["Premium Books",F?"":" Only"]})]})}),(0,a.jsxs)("div",{className:i().sortSection,children:[(0,a.jsx)(t.MjW,{className:i().sortIcon}),(0,a.jsx)("select",{value:l,onChange:e=>k(e.target.value),className:i().sortSelect,children:g.map(e=>(0,a.jsx)("option",{value:e.value,children:e.label},e.value))})]})]})]}),j?(0,a.jsx)("div",{className:i().loading,children:"Loading..."}):S&&0===p.length?(0,a.jsx)("div",{className:i().error,children:S}):(0,a.jsxs)(a.Fragment,{children:[F&&(0,a.jsxs)("div",{className:i().premiumSectionHeader,children:[(0,a.jsx)(t.Hu1,{className:i().premiumHeaderIcon}),(0,a.jsx)("h2",{children:"Premium Collection"}),(0,a.jsx)("p",{children:"Exclusive content for our authenticated members"})]}),(0,a.jsxs)("div",{className:i().resultsCount,children:["Found ",V>0?V:p.length," ",1===V?"book":"books",F&&" (Premium Only)"]}),(0,a.jsx)("div",{className:i().bookGrid,children:p.map((e,s)=>(console.log("Book: ".concat(e.title,", isPremium: ").concat(e.isPremium),e),(0,a.jsxs)("div",{className:"".concat(i().bookCard," ").concat(e.isPremium?i().premiumBook:""),ref:s===p.length-1?Y:null,children:[e.isPremium&&(0,a.jsxs)("span",{className:i().premiumBadge,children:[(0,a.jsx)(t.Hu1,{className:i().crownIcon})," Premium"]}),(0,a.jsx)("button",{className:i().bookmarkButton,onClick:()=>W(e._id),title:w.has(e._id)?"Remove from bookmarks":"Add to bookmarks",children:w.has(e._id)?(0,a.jsx)(t.U$b,{}):(0,a.jsx)(t.gGX,{})}),(0,a.jsxs)(n(),{href:"/books/".concat(e._id),className:i().bookLink,children:[(0,a.jsx)("div",{className:i().bookCover,children:e.coverImage?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("img",{src:e.coverImage,alt:e.title}),e.isPremium&&(0,a.jsxs)("div",{className:i().premiumOverlay,children:[(0,a.jsx)(t.JhU,{className:i().lockIcon}),(0,a.jsx)("div",{className:i().premiumLabel,children:"Premium Only"})]})]}):(0,a.jsxs)("div",{className:i().placeholderCover,children:[(0,a.jsx)(t.vd0,{}),e.isPremium&&(0,a.jsx)(t.JhU,{className:i().lockIconPlaceholder})]})}),(0,a.jsxs)("div",{className:i().bookInfo,children:[(0,a.jsx)("h3",{className:i().bookTitle,children:e.title}),(0,a.jsxs)("p",{className:i().bookAuthor,children:["by ",e.author]}),Q(e.averageRating),(0,a.jsxs)("div",{className:i().categoryInfo,children:[(0,a.jsx)("p",{className:i().bookCategory,children:e.category}),e.isPremium&&(0,a.jsxs)("span",{className:i().bookPremiumTag,children:[(0,a.jsx)(t.Hu1,{className:i().premiumIcon})," Premium"]})]}),(0,a.jsxs)("div",{className:i().bookStats,children:[(0,a.jsxs)("span",{className:i().stat,children:[(0,a.jsx)(t.Ny1,{})," ",e.views||0]}),(0,a.jsxs)("span",{className:i().stat,children:[(0,a.jsx)(t.WCW,{})," ",e.downloads||0]}),e.pageSize>0&&(0,a.jsxs)("span",{className:i().stat,children:[(0,a.jsx)(t.t69,{})," ",e.pageSize,"p"]}),e.fileSizeMB>0&&(0,a.jsxs)("span",{className:i().stat,children:[(0,a.jsx)(t.Gp9,{})," ",e.fileSizeMB,"MB"]})]})]})]})]},e._id)))}),0===p.length&&(0,a.jsx)("div",{className:i().noResults,children:"No books found. Try adjusting your search criteria."}),v&&(0,a.jsxs)("div",{className:i().loadingMore,children:[(0,a.jsx)("div",{className:i().loadingSpinner}),(0,a.jsx)("p",{children:"Loading more books..."})]}),!U&&p.length>0&&(0,a.jsx)("div",{className:i().endOfResults,children:"You've reached the end of the results."})]})]})}},89570:e=>{e.exports={container:"search_container__iBLRa",searchSection:"search_searchSection___GBPX",searchBar:"search_searchBar__UwPdN",searchIcon:"search_searchIcon__AFk5b",searchInput:"search_searchInput__LH4xM",categories:"search_categories__H1pEX",categoryButton:"search_categoryButton__9eElQ",active:"search_active___7ISV",sortSection:"search_sortSection__LCADM",sortIcon:"search_sortIcon__onWpZ",sortSelect:"search_sortSelect__l_Gth",resultsCount:"search_resultsCount__7QZ1I",bookGrid:"search_bookGrid__oZdJd",bookCard:"search_bookCard__a2Dl_",fadeIn:"search_fadeIn__5flyY",bookLink:"search_bookLink__A2NmA",bookCover:"search_bookCover__HAfP5",premiumOverlay:"search_premiumOverlay__Zro0o",lockIcon:"search_lockIcon__baPtV",pulse:"search_pulse__HF903",premiumLabel:"search_premiumLabel__ZD8oT",bookPremiumTag:"search_bookPremiumTag__jknZp",shimmer:"search_shimmer__a0HH7",premiumIcon:"search_premiumIcon__YtUDc",bookDescription:"search_bookDescription__TT6B5",bookStats:"search_bookStats__kpHh8",stat:"search_stat__88uAs",loading:"search_loading__mWmfI",loadingMore:"search_loadingMore__dGCEA",loadingSpinner:"search_loadingSpinner__prn7o",spin:"search_spin__3tXM5",endOfResults:"search_endOfResults__JRuAY",error:"search_error__PiUvM",noResults:"search_noResults__sOYXB",bookmarkButton:"search_bookmarkButton__AB_pG",ratingStars:"search_ratingStars__qW3BG",star:"search_star__C9Hxn",emptyStar:"search_emptyStar__HBUQP",ratingValue:"search_ratingValue__Z_nIU",toast:"search_toast__hCkOh",slideIn:"search_slideIn__TzJ_x",toastSuccess:"search_toastSuccess__0746A",toastError:"search_toastError__V3j0j",toastClose:"search_toastClose__e6hE_",filterOptions:"search_filterOptions__NRnFg",premiumFilter:"search_premiumFilter__MNLmG",toggleLabel:"search_toggleLabel__tEvyH",toggleCheckbox:"search_toggleCheckbox__jIWIU",toggleSwitch:"search_toggleSwitch__tibuI",toggleText:"search_toggleText__HjQ32",bounce:"search_bounce__zBOkE",premiumBadge:"search_premiumBadge__ibJmi",crownIcon:"search_crownIcon__m3Zbg",premiumBook:"search_premiumBook__FewjB",premiumSectionHeader:"search_premiumSectionHeader__kbVu6",premiumHeaderIcon:"search_premiumHeaderIcon__s9rmo",categoryInfo:"search_categoryInfo__Cg_2o",bookCategory:"search_bookCategory__fquxM",placeholderCover:"search_placeholderCover__RftGL",lockIconPlaceholder:"search_lockIconPlaceholder__Ctbl6",bookInfo:"search_bookInfo__IPXH4",bookTitle:"search_bookTitle__ggMuJ",bookAuthor:"search_bookAuthor__U5T3c"}}},e=>{var s=s=>e(e.s=s);e.O(0,[4389,2227,6711,6874,9912,8441,1684,7358],()=>s(10841)),_N_E=e.O()}]);