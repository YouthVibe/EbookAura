(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2959],{10841:(e,o,s)=>{Promise.resolve().then(s.bind(s,83819))},18810:e=>{e.exports={adContainer:"AdComponent_adContainer__MrvOz",adLabel:"AdComponent_adLabel__hbjki"}},60848:e=>{e.exports={footerAdContainer:"FooterAd_footerAdContainer__uDMwp"}},73356:(e,o,s)=>{"use strict";s.d(o,{A:()=>n});var a=s(95155),r=s(12115),t=s(18810),c=s.n(t);function n(e){let{format:o="auto",slot:s,style:t={}}=e,n=(0,r.useRef)(null);(0,r.useEffect)(()=>{if(n.current&&""===n.current.innerHTML)try{window.adsbygoogle&&(window.adsbygoogle=window.adsbygoogle||[]).push({})}catch(e){console.error("Error loading Google AdSense:",e)}},[]);let i={display:"block",textAlign:"center",...t};return(0,a.jsxs)("div",{className:c().adContainer,children:[(0,a.jsx)("ins",{ref:n,className:"adsbygoogle",style:i,"data-ad-client":"ca-pub-2456537810743091","data-ad-slot":s||"","data-ad-format":o,"data-full-width-responsive":"true"}),(0,a.jsx)("div",{className:c().adLabel,children:"Advertisement"})]})}},83819:(e,o,s)=>{"use strict";s.r(o),s.d(o,{default:()=>b});var a=s(95155),r=s(12115),t=s(29911),c=s(6874),n=s.n(c),i=s(89570),l=s.n(i),d=s(35695),h=s(56068),m=s(54544),u=s(72047),_=s(73356),g=s(85822);let k=e=>{let{message:o,type:s,onClose:t}=e;return(0,r.useEffect)(()=>{let e=setTimeout(()=>{t()},3e3);return()=>clearTimeout(e)},[t]),(0,a.jsxs)("div",{className:"".concat(l().toast," ").concat("success"===s?l().toastSuccess:l().toastError),children:[(0,a.jsx)("span",{children:o}),(0,a.jsx)("button",{onClick:t,className:l().toastClose,children:"\xd7"})]})},p=[{value:"newest",label:"Newest First"},{value:"oldest",label:"Oldest First"},{value:"title",label:"Title A-Z"},{value:"popular",label:"Most Popular"},{value:"rating",label:"Highest Rated"}];function b(){let[e,o]=(0,r.useState)(""),[s,c]=(0,r.useState)(""),[i,b]=(0,r.useState)("newest"),[x,f]=(0,r.useState)([]),[j,v]=(0,r.useState)([]),[y,N]=(0,r.useState)(!0),[A,S]=(0,r.useState)(!1),[I,C]=(0,r.useState)(null),[w,B]=(0,r.useState)(!1),[P,E]=(0,r.useState)(new Set),[F,T]=(0,r.useState)({show:!1,message:"",type:"success"}),[H,R]=(0,r.useState)(!1),M=(0,d.useRouter)(),{getToken:L,getApiKey:O}=(0,h.h)(),[G,z]=(0,r.useState)(1),[V,U]=(0,r.useState)(!0),[X,Z]=(0,r.useState)(0),W=(0,r.useRef)();(0,r.useRef)(null);let D=function(e){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"success";T({show:!0,message:e,type:o})};(0,r.useEffect)(()=>{(async()=>{try{let e=await (0,u.dw)("/books/categories");if(e&&e.categories&&Array.isArray(e.categories))v(["All",...e.categories]);else if(e&&Array.isArray(e))v(["All",...e]);else if(e&&"object"==typeof e){let o=[];Object.keys(e).length>0&&Object.keys(e).forEach(s=>{Array.isArray(e[s])?o.push(...e[s]):"string"==typeof e[s]&&o.push(e[s])}),o.length>0?v(["All",...o]):v(["All","Fiction","Non-Fiction","Science","History","Biography","Technology"])}else v(["All","Fiction","Non-Fiction","Science","History","Biography","Technology"])}catch(e){C("Failed to load categories"),console.error("Error fetching categories:",e),v(["All","Fiction","Non-Fiction","Science","History","Biography","Technology"])}})()},[]),(0,r.useEffect)(()=>{(async()=>{try{let e=L();if(!e){console.log("No authentication token found, user is not logged in"),B(!1);return}try{let o=await (0,u.dw)("/auth/check",{headers:{Authorization:"Bearer ".concat(e)}});o&&"boolean"==typeof o.isAuthenticated?(B(o.isAuthenticated),console.log("Auth check successful, user is",o.isAuthenticated?"authenticated":"not authenticated"),o.isAuthenticated&&J()):(console.warn("Unexpected auth check response format:",o),B(!1))}catch(e){console.error("Auth check API error:",e.message),B(!1),localStorage.removeItem("token")}}catch(e){console.error("Auth check error:",e),B(!1),localStorage.removeItem("token")}})()},[L]);let J=async()=>{try{let e=L();if(!e)return void console.log("No token available for fetching bookmarks");console.log("Fetching user bookmarks...");let o=await (0,u.dw)("/users/bookmarks",{headers:{Authorization:"Bearer ".concat(e),"X-API-Key":O()}}),s=[];o&&o.bookmarks&&Array.isArray(o.bookmarks)?(console.log("Received bookmarks array from API"),s=o.bookmarks):o&&o.books&&Array.isArray(o.books)?(console.log("Received books array from API"),s=o.books.map(e=>e._id)):o&&Array.isArray(o)?(console.log("Received direct array from API"),s=o.map(e=>e._id||e)):console.warn("Unexpected bookmark data format:",o),console.log("Found ".concat(s.length," bookmarks")),E(new Set(s))}catch(e){console.error("Error fetching bookmarks:",e.message)}},Q=async e=>{if(!w)return void M.push("/login");let o=x.find(o=>o._id===e),s=o?o.title:"Book",a=new Set(P),r=P.has(e);r?a.delete(e):a.add(e),E(a);try{let o=L();if(!o)throw Error("Authentication token not found");await (0,u.Xj)("/users/bookmarks",{bookId:e},{headers:{Authorization:"Bearer ".concat(o),"X-API-Key":O()}}),D(r?'Removed "'.concat(s,'" from bookmarks'):'Added "'.concat(s,'" to bookmarks'),"success")}catch(s){r?a.add(e):a.delete(e),E(a);let o="Error updating bookmark";s.message&&(console.error("Bookmark error details:",s.message),(s.message.includes("Authentication")||s.message.includes("token"))&&(o="Authentication error. Please log in again.",setTimeout(()=>M.push("/login"),2e3))),console.error("Error toggling bookmark:",s),D(o,"error")}},q=async function(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=!(arguments.length>1)||void 0===arguments[1]||arguments[1];try{console.log("Fetching books: page ".concat(o,', category: "').concat(s,'", sort: ').concat(i,', query: "').concat(e,'", premium: ').concat(H)),S(o>1),1===o&&N(!0);let t=new URLSearchParams;t.append("page",o),t.append("limit",12),t.append("sort",i),e&&t.append("search",e),s&&"All"!==s&&t.append("category",s),H&&t.append("premium","true");let c=t.toString(),n=await (0,u.dw)("/books?".concat(c)),l=[],d=0;if(Array.isArray(n))l=n,d=n.length;else if(n&&n.books&&Array.isArray(n.books)){var r;l=n.books,d=n.totalCount||(null==(r=n.pagination)?void 0:r.totalBooks)||n.books.length}else throw Error("Unexpected response format from API");let h=(l=l.map(e=>{let o=!0===e.isPremium,s=void 0!==e.price?Number(e.price):0;return(o!==e.isPremium||s!==e.price)&&console.log("Normalizing book: ".concat(e.title," - isPremium: ").concat(e.isPremium,"=>").concat(o,", price: ").concat(e.price,"=>").concat(s)),{...e,isPremium:o,price:s}})).filter(e=>!0===e.isPremium).length;if(console.log("Fetched ".concat(l.length," books (total: ").concat(d,"), ").concat(h," premium books")),H&&0===h&&console.warn("Premium filter is on but no premium books were found"),Z(d),U(l.length>0&&l.length>=12),a)f(l);else{let e=new Set(x.map(e=>e._id)),o=l.filter(o=>!e.has(o._id));f(e=>[...e,...o])}}catch(e){console.error("Error fetching books:",e),C("Failed to load books. Please try again.")}finally{N(!1),S(!1)}},Y=(0,r.useCallback)(e=>{y||A||(W.current&&W.current.disconnect(),W.current=new IntersectionObserver(e=>{e[0].isIntersecting&&V&&z(e=>e+1)},{root:null,rootMargin:"0px",threshold:.1}),e&&W.current.observe(e))},[y,A,V]);(0,r.useEffect)(()=>{z(1),f([]),U(!0),q(1,!0)},[e,s,i]),(0,r.useEffect)(()=>{G>1&&q(G,!1)},[G]),(0,r.useEffect)(()=>{y||(z(1),q(1,!0))},[H]);let K=e=>{if(!e||e<=0)return(0,a.jsxs)("div",{className:l().ratingStars,children:[[1,2,3,4,5].map(e=>(0,a.jsx)(t.wei,{className:l().emptyStar},e)),(0,a.jsx)("span",{className:l().ratingValue,children:"(0.0)"})]});let o=[],s=Math.round(2*e)/2;for(let e=1;e<=5;e++)e<=Math.floor(s)?o.push((0,a.jsx)(t.gt3,{className:l().star},e)):e-.5===s?o.push((0,a.jsx)(t.gVl,{className:l().star},e)):o.push((0,a.jsx)(t.wei,{className:l().emptyStar},e));return(0,a.jsxs)("div",{className:l().ratingStars,children:[o,(0,a.jsxs)("span",{className:l().ratingValue,children:["(",e.toFixed(1),")"]})]})};return(0,a.jsxs)("div",{className:l().container,children:[F.show&&(0,a.jsx)(k,{message:F.message,type:F.type,onClose:()=>{T({show:!1,message:"",type:"success"})}}),(0,a.jsxs)("div",{className:l().searchSection,children:[(0,a.jsx)(m.A,{placeholder:"Search for books by title, author or description...",onSearch:o,initialValue:e,debounceTime:500,className:l().searchBar}),(0,a.jsxs)("div",{className:l().categories,children:[(0,a.jsx)("button",{className:"".concat(l().categoryButton," ").concat(""===s?l().active:""),onClick:()=>c(""),children:"All"}),j.map(e=>(0,a.jsx)("button",{className:"".concat(l().categoryButton," ").concat(s===e?l().active:""),onClick:()=>c(e),children:e},e))]}),(0,a.jsxs)("div",{className:l().filterOptions,children:[(0,a.jsx)("div",{className:l().premiumFilter,children:(0,a.jsxs)("label",{className:l().toggleLabel,children:[(0,a.jsx)("input",{type:"checkbox",checked:H,onChange:()=>R(!H),className:l().toggleCheckbox}),(0,a.jsx)("span",{className:l().toggleSwitch}),(0,a.jsxs)("span",{className:l().toggleText,children:["Premium Books",H?"":" Only"]})]})}),(0,a.jsxs)("div",{className:l().sortSection,children:[(0,a.jsx)(t.MjW,{className:l().sortIcon}),(0,a.jsx)("select",{value:i,onChange:e=>b(e.target.value),className:l().sortSelect,children:p.map(e=>(0,a.jsx)("option",{value:e.value,children:e.label},e.value))})]})]})]}),y?(0,a.jsx)("div",{className:l().loading,children:"Loading..."}):I&&0===x.length?(0,a.jsx)("div",{className:l().error,children:I}):(0,a.jsxs)(a.Fragment,{children:[H&&(0,a.jsxs)("div",{className:l().premiumSectionHeader,children:[(0,a.jsx)(t.Hu1,{className:l().premiumHeaderIcon}),(0,a.jsx)("h2",{children:"Premium Collection"}),(0,a.jsx)("p",{children:"Exclusive content for our authenticated members"})]}),(0,a.jsx)("div",{className:l().adSection,children:(0,a.jsx)(_.A,{slot:"1849217326",format:"auto",style:{display:"block",width:"100%"}})}),(0,a.jsxs)("div",{className:l().resultsCount,children:["Found ",X>0?X:x.length," ",1===X?"book":"books",H&&" (Premium Only)"]}),(0,a.jsx)("div",{className:l().bookGrid,children:x.map((e,o)=>{let s=!0===e.isPremium,r=Number(e.price||0);return(0,a.jsxs)("div",{className:"".concat(l().bookCard," ").concat(s?l().premiumBook:""),ref:o===x.length-1?Y:null,children:[(0,a.jsxs)(n(),{href:"/books/".concat(e._id),className:l().bookLink,children:[(0,a.jsx)("div",{className:l().bookCover,children:e.coverImage?(0,a.jsxs)("div",{className:l().coverImageContainer,children:[(0,a.jsx)("img",{src:e.coverImage,alt:"".concat(e.title," by ").concat(e.author),className:l().coverImage,loading:"lazy"}),s&&r>0&&(0,a.jsxs)("div",{className:l().premiumPrice,children:[r," ",(0,a.jsx)(t.cEG,{className:l().miniCoin})]}),s&&(0,a.jsxs)("div",{className:l().premiumBadge,children:[(0,a.jsx)(t.Hu1,{className:l().premiumIcon})," Premium"]})]}):(0,a.jsxs)("div",{className:l().placeholderCover,children:[(0,a.jsx)(t.vd0,{className:l().bookIcon}),s&&r>0&&(0,a.jsxs)("div",{className:l().premiumPrice,children:[r," ",(0,a.jsx)(t.cEG,{className:l().miniCoin})]}),s&&(0,a.jsxs)("div",{className:l().premiumBadge,children:[(0,a.jsx)(t.Hu1,{className:l().premiumIcon})," Premium"]})]})}),(0,a.jsxs)("div",{className:l().bookInfo,children:[(0,a.jsx)("h3",{className:l().bookTitle,children:e.title}),(0,a.jsxs)("p",{className:l().bookAuthor,children:["by ",e.author]}),K(e.averageRating),(0,a.jsx)("div",{className:l().categoryInfo,children:(0,a.jsx)("p",{className:l().bookCategory,children:e.category})}),(0,a.jsxs)("div",{className:l().bookStats,children:[(0,a.jsxs)("span",{className:l().stat,children:[(0,a.jsx)(t.Ny1,{})," ",e.views||0]}),(0,a.jsxs)("span",{className:l().stat,children:[(0,a.jsx)(t.WCW,{})," ",e.downloads||0]}),e.pageSize>0&&(0,a.jsxs)("span",{className:l().stat,children:[(0,a.jsx)(t.t69,{})," ",e.pageSize,"p"]}),e.fileSizeMB>0&&(0,a.jsxs)("span",{className:l().stat,children:[(0,a.jsx)(t.Gp9,{})," ",e.fileSizeMB,"MB"]})]})]})]}),(0,a.jsx)("button",{className:l().inlineBookmarkButton,onClick:o=>{o.preventDefault(),Q(e._id)},title:P.has(e._id)?"Remove from bookmarks":"Add to bookmarks",children:P.has(e._id)?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(t.U$b,{})," Bookmarked"]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(t.gGX,{})," Bookmark"]})})]},e._id)})}),0===x.length&&(0,a.jsx)("div",{className:l().noResults,children:"No books found. Try adjusting your search criteria."}),A&&(0,a.jsxs)("div",{className:l().loadingMore,children:[(0,a.jsx)("div",{className:l().loadingSpinner}),(0,a.jsx)("p",{children:"Loading more books..."})]}),!V&&x.length>0&&(0,a.jsx)("div",{className:l().endOfResults,children:"You've reached the end of the results."})]}),(0,a.jsx)(g.A,{})]})}},85822:(e,o,s)=>{"use strict";s.d(o,{A:()=>n});var a=s(95155),r=s(73356),t=s(60848),c=s.n(t);function n(){return(0,a.jsx)("div",{className:c().footerAdContainer,children:(0,a.jsx)(r.A,{slot:"7493061234",format:"horizontal",style:{display:"block",maxWidth:"100%",margin:"0 auto"}})})}},89570:e=>{e.exports={container:"search_container__iBLRa",searchSection:"search_searchSection___GBPX",searchBar:"search_searchBar__UwPdN",searchIcon:"search_searchIcon__AFk5b",searchInput:"search_searchInput__LH4xM",categories:"search_categories__H1pEX",categoryButton:"search_categoryButton__9eElQ",active:"search_active___7ISV",sortSection:"search_sortSection__LCADM",sortIcon:"search_sortIcon__onWpZ",sortSelect:"search_sortSelect__l_Gth",resultsCount:"search_resultsCount__7QZ1I",bookGrid:"search_bookGrid__oZdJd",bookCard:"search_bookCard__a2Dl_",coverImageContainer:"search_coverImageContainer__qnKqp",coverImage:"search_coverImage__ERtuV",bookLink:"search_bookLink__A2NmA",premiumBadge:"search_premiumBadge__ibJmi",premiumIcon:"search_premiumIcon__YtUDc",premiumPrice:"search_premiumPrice__AGzwr",miniCoin:"search_miniCoin__VClP7",premiumBadgeSmall:"search_premiumBadgeSmall__QKdTc",premiumIconSmall:"search_premiumIconSmall__JnNo_",premiumTag:"search_premiumTag__ZeE8g",crownIcon:"search_crownIcon__m3Zbg",bookDescription:"search_bookDescription__TT6B5",bookStats:"search_bookStats__kpHh8",stat:"search_stat__88uAs",loading:"search_loading__mWmfI",loadingMore:"search_loadingMore__dGCEA",loadingSpinner:"search_loadingSpinner__prn7o",spin:"search_spin__3tXM5",endOfResults:"search_endOfResults__JRuAY",error:"search_error__PiUvM",noResults:"search_noResults__sOYXB",bookmarkButton:"search_bookmarkButton__AB_pG",ratingStars:"search_ratingStars__qW3BG",star:"search_star__C9Hxn",emptyStar:"search_emptyStar__HBUQP",ratingValue:"search_ratingValue__Z_nIU",toast:"search_toast__hCkOh",slideIn:"search_slideIn__TzJ_x",toastSuccess:"search_toastSuccess__0746A",toastError:"search_toastError__V3j0j",toastClose:"search_toastClose__e6hE_",placeholderCover:"search_placeholderCover__RftGL",filterOptions:"search_filterOptions__NRnFg",premiumFilter:"search_premiumFilter__MNLmG",toggleLabel:"search_toggleLabel__tEvyH",toggleCheckbox:"search_toggleCheckbox__jIWIU",toggleSwitch:"search_toggleSwitch__tibuI",toggleText:"search_toggleText__HjQ32",bounce:"search_bounce__zBOkE",premiumBook:"search_premiumBook__FewjB",bookPremiumTag:"search_bookPremiumTag__jknZp",premiumSectionHeader:"search_premiumSectionHeader__kbVu6",premiumHeaderIcon:"search_premiumHeaderIcon__s9rmo",categoryInfo:"search_categoryInfo__Cg_2o",bookCategory:"search_bookCategory__fquxM",lockIconPlaceholder:"search_lockIconPlaceholder__Ctbl6",bookInfo:"search_bookInfo__IPXH4",bookTitle:"search_bookTitle__ggMuJ",bookAuthor:"search_bookAuthor__U5T3c",bookIcon:"search_bookIcon__JjVQ8",bookCover:"search_bookCover__HAfP5",inlineBookmarkButton:"search_inlineBookmarkButton__iB_Vd",adSection:"search_adSection__ZhoV8",fadeIn:"search_fadeIn__5flyY"}}},e=>{var o=o=>e(e.s=o);e.O(0,[4389,1521,6711,6874,9912,8441,1684,7358],()=>o(10841)),_N_E=e.O()}]);