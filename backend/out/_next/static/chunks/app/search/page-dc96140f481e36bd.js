(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[959],{841:(e,o,s)=>{Promise.resolve().then(s.bind(s,3819))},3819:(e,o,s)=>{"use strict";s.r(o),s.d(o,{default:()=>g});var a=s(5155),t=s(2115),r=s(9911),c=s(6874),l=s.n(c),n=s(9570),i=s.n(n),h=s(5695),d=s(6068),u=s(4544),_=s(2047);let k=e=>{let{message:o,type:s,onClose:r}=e;return(0,t.useEffect)(()=>{let e=setTimeout(()=>{r()},3e3);return()=>clearTimeout(e)},[r]),(0,a.jsxs)("div",{className:"".concat(i().toast," ").concat("success"===s?i().toastSuccess:i().toastError),children:[(0,a.jsx)("span",{children:o}),(0,a.jsx)("button",{onClick:r,className:i().toastClose,children:"\xd7"})]})},m=[{value:"newest",label:"Newest First"},{value:"oldest",label:"Oldest First"},{value:"title",label:"Title A-Z"},{value:"popular",label:"Most Popular"},{value:"rating",label:"Highest Rated"}];function g(){let[e,o]=(0,t.useState)(""),[s,c]=(0,t.useState)(""),[n,g]=(0,t.useState)("newest"),[b,y]=(0,t.useState)([]),[p,f]=(0,t.useState)([]),[A,v]=(0,t.useState)(!0),[j,x]=(0,t.useState)(null),[N,S]=(0,t.useState)(!1),[w,C]=(0,t.useState)(new Set),[I,B]=(0,t.useState)({show:!1,message:"",type:"success"}),E=(0,h.useRouter)(),{getToken:T,getApiKey:F}=(0,d.h)(),P=function(e){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"success";B({show:!0,message:e,type:o})};(0,t.useEffect)(()=>{(async()=>{try{let e=await (0,_.dw)("/books/categories");if(e&&e.categories&&Array.isArray(e.categories))f(["All",...e.categories]);else if(e&&Array.isArray(e))f(["All",...e]);else if(e&&"object"==typeof e){let o=[];Object.keys(e).length>0&&Object.keys(e).forEach(s=>{Array.isArray(e[s])?o.push(...e[s]):"string"==typeof e[s]&&o.push(e[s])}),o.length>0?f(["All",...o]):f(["All","Fiction","Non-Fiction","Science","History","Biography","Technology"])}else f(["All","Fiction","Non-Fiction","Science","History","Biography","Technology"])}catch(e){x("Failed to load categories"),console.error("Error fetching categories:",e),f(["All","Fiction","Non-Fiction","Science","History","Biography","Technology"])}})()},[]),(0,t.useEffect)(()=>{(async()=>{try{let e=T();if(!e){console.log("No authentication token found, user is not logged in"),S(!1);return}try{let o=await (0,_.dw)("/auth/check",{headers:{Authorization:"Bearer ".concat(e)}});o&&"boolean"==typeof o.isAuthenticated?(S(o.isAuthenticated),console.log("Auth check successful, user is",o.isAuthenticated?"authenticated":"not authenticated"),o.isAuthenticated&&R()):(console.warn("Unexpected auth check response format:",o),S(!1))}catch(e){console.error("Auth check API error:",e.message),S(!1),localStorage.removeItem("token")}}catch(e){console.error("Auth check error:",e),S(!1),localStorage.removeItem("token")}})()},[T]);let R=async()=>{try{let e=T();if(!e)return void console.log("No token available for fetching bookmarks");console.log("Fetching user bookmarks...");let o=await (0,_.dw)("/users/bookmarks",{headers:{Authorization:"Bearer ".concat(e),"X-API-Key":F()}}),s=[];o&&o.bookmarks&&Array.isArray(o.bookmarks)?(console.log("Received bookmarks array from API"),s=o.bookmarks):o&&o.books&&Array.isArray(o.books)?(console.log("Received books array from API"),s=o.books.map(e=>e._id)):o&&Array.isArray(o)?(console.log("Received direct array from API"),s=o.map(e=>e._id||e)):console.warn("Unexpected bookmark data format:",o),console.log("Found ".concat(s.length," bookmarks")),C(new Set(s))}catch(e){console.error("Error fetching bookmarks:",e.message)}},H=async e=>{if(!N)return void E.push("/login");let o=b.find(o=>o._id===e),s=o?o.title:"Book",a=new Set(w),t=w.has(e);t?a.delete(e):a.add(e),C(a);try{let o=T();if(!o)throw Error("Authentication token not found");await (0,_.Xj)("/users/bookmarks",{bookId:e},{headers:{Authorization:"Bearer ".concat(o),"X-API-Key":F()}}),P(t?'Removed "'.concat(s,'" from bookmarks'):'Added "'.concat(s,'" to bookmarks'),"success")}catch(s){t?a.add(e):a.delete(e),C(a);let o="Error updating bookmark";s.message&&(console.error("Bookmark error details:",s.message),(s.message.includes("Authentication")||s.message.includes("token"))&&(o="Authentication error. Please log in again.",setTimeout(()=>E.push("/login"),2e3))),console.error("Error toggling bookmark:",s),P(o,"error")}};(0,t.useEffect)(()=>{let o=setTimeout(async()=>{v(!0);try{let o=new URLSearchParams({search:e,category:"All"===s?"":s,sort:n}).toString(),a=await (0,_.dw)("/books?".concat(o));if(a&&Array.isArray(a))y(a);else if(a&&a.books&&Array.isArray(a.books))y(a.books);else if(a&&"object"==typeof a){let e=[];Object.keys(a).forEach(o=>{Array.isArray(a[o])&&e.push(...a[o])}),e.length>0?y(e):(y([]),console.warn("Received unexpected data format for books:",a))}else y([]),console.warn("Received unexpected data type for books:",typeof a)}catch(e){x("Failed to load books"),console.error("Error fetching books:",e),y([])}finally{v(!1)}},500);return()=>clearTimeout(o)},[e,s,n]);let G=e=>{if(!e||e<=0)return(0,a.jsxs)("div",{className:i().ratingStars,children:[[1,2,3,4,5].map(e=>(0,a.jsx)(r.wei,{className:i().emptyStar},e)),(0,a.jsx)("span",{className:i().ratingValue,children:"(0.0)"})]});let o=[],s=Math.round(2*e)/2;for(let e=1;e<=5;e++)e<=Math.floor(s)?o.push((0,a.jsx)(r.gt3,{className:i().star},e)):e-.5===s?o.push((0,a.jsx)(r.gVl,{className:i().star},e)):o.push((0,a.jsx)(r.wei,{className:i().emptyStar},e));return(0,a.jsxs)("div",{className:i().ratingStars,children:[o,(0,a.jsxs)("span",{className:i().ratingValue,children:["(",e.toFixed(1),")"]})]})};return(0,a.jsxs)("div",{className:i().container,children:[I.show&&(0,a.jsx)(k,{message:I.message,type:I.type,onClose:()=>{B({show:!1,message:"",type:"success"})}}),(0,a.jsxs)("div",{className:i().searchSection,children:[(0,a.jsx)(u.A,{placeholder:"Search for books by title, author or description...",onSearch:o,initialValue:e,debounceTime:500,className:i().searchBar}),(0,a.jsxs)("div",{className:i().categories,children:[(0,a.jsx)("button",{className:"".concat(i().categoryButton," ").concat(""===s?i().active:""),onClick:()=>c(""),children:"All"}),p.map(e=>(0,a.jsx)("button",{className:"".concat(i().categoryButton," ").concat(s===e?i().active:""),onClick:()=>c(e),children:e},e))]}),(0,a.jsxs)("div",{className:i().sortSection,children:[(0,a.jsx)(r.MjW,{className:i().sortIcon}),(0,a.jsx)("select",{value:n,onChange:e=>g(e.target.value),className:i().sortSelect,children:m.map(e=>(0,a.jsx)("option",{value:e.value,children:e.label},e.value))})]})]}),A?(0,a.jsx)("div",{className:i().loading,children:"Loading..."}):j?(0,a.jsx)("div",{className:i().error,children:j}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:i().resultsCount,children:["Found ",b.length," ",1===b.length?"book":"books"]}),(0,a.jsx)("div",{className:i().bookGrid,children:b.map(e=>(0,a.jsxs)("div",{className:i().bookCard,children:[(0,a.jsx)("button",{className:i().bookmarkButton,onClick:()=>H(e._id),title:w.has(e._id)?"Remove from bookmarks":"Add to bookmarks",children:w.has(e._id)?(0,a.jsx)(r.U$b,{}):(0,a.jsx)(r.gGX,{})}),(0,a.jsxs)(l(),{href:"/books/".concat(e._id),className:i().bookLink,children:[(0,a.jsx)("div",{className:i().bookCover,children:e.coverImage?(0,a.jsx)("img",{src:e.coverImage,alt:e.title}):(0,a.jsx)("div",{className:i().placeholderCover,children:(0,a.jsx)(r.vd0,{})})}),(0,a.jsxs)("div",{className:i().bookInfo,children:[(0,a.jsx)("h3",{className:i().bookTitle,children:e.title}),(0,a.jsxs)("p",{className:i().bookAuthor,children:["by ",e.author]}),G(e.averageRating),(0,a.jsx)("p",{className:i().bookCategory,children:e.category}),(0,a.jsxs)("div",{className:i().bookStats,children:[(0,a.jsxs)("span",{className:i().stat,children:[(0,a.jsx)(r.Ny1,{})," ",e.views||0]}),(0,a.jsxs)("span",{className:i().stat,children:[(0,a.jsx)(r.WCW,{})," ",e.downloads||0]})]})]})]})]},e._id))}),0===b.length&&(0,a.jsx)("div",{className:i().noResults,children:"No books found. Try adjusting your search criteria."})]})]})}},9570:e=>{e.exports={container:"search_container__iBLRa",searchSection:"search_searchSection___GBPX",searchBar:"search_searchBar__UwPdN",searchIcon:"search_searchIcon__AFk5b",searchInput:"search_searchInput__LH4xM",categories:"search_categories__H1pEX",categoryButton:"search_categoryButton__9eElQ",active:"search_active___7ISV",sortSection:"search_sortSection__LCADM",sortIcon:"search_sortIcon__onWpZ",sortSelect:"search_sortSelect__l_Gth",resultsCount:"search_resultsCount__7QZ1I",bookGrid:"search_bookGrid__oZdJd",bookCard:"search_bookCard__a2Dl_",bookLink:"search_bookLink__A2NmA",bookCover:"search_bookCover__HAfP5",placeholderCover:"search_placeholderCover__RftGL",bookInfo:"search_bookInfo__IPXH4",bookTitle:"search_bookTitle__ggMuJ",bookAuthor:"search_bookAuthor__U5T3c",bookCategory:"search_bookCategory__fquxM",bookDescription:"search_bookDescription__TT6B5",bookStats:"search_bookStats__kpHh8",stat:"search_stat__88uAs",loading:"search_loading__mWmfI",error:"search_error__PiUvM",noResults:"search_noResults__sOYXB",bookmarkButton:"search_bookmarkButton__AB_pG",ratingStars:"search_ratingStars__qW3BG",star:"search_star__C9Hxn",emptyStar:"search_emptyStar__HBUQP",ratingValue:"search_ratingValue__Z_nIU",toast:"search_toast__hCkOh",slideIn:"search_slideIn__TzJ_x",toastSuccess:"search_toastSuccess__0746A",toastError:"search_toastError__V3j0j",toastClose:"search_toastClose__e6hE_"}}},e=>{var o=o=>e(e.s=o);e.O(0,[389,227,711,874,912,441,684,358],()=>o(841)),_N_E=e.O()}]);