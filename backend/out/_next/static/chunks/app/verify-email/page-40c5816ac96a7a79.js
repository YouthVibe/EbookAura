(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7839],{35695:(e,t,a)=>{"use strict";var r=a(18999);a.o(r,"useParams")&&a.d(t,{useParams:function(){return r.useParams}}),a.o(r,"usePathname")&&a.d(t,{usePathname:function(){return r.usePathname}}),a.o(r,"useRouter")&&a.d(t,{useRouter:function(){return r.useRouter}}),a.o(r,"useSearchParams")&&a.d(t,{useSearchParams:function(){return r.useSearchParams}})},56068:(e,t,a)=>{"use strict";a.d(t,{AuthProvider:()=>c,h:()=>u});var r=a(95155),s=a(12115),i=a(35695),o=a(72047);let l=(0,s.createContext)(),n=()=>"ak_"+Array.from(crypto.getRandomValues(new Uint8Array(24))).map(e=>e.toString(16).padStart(2,"0")).join(""),c=e=>{let{children:t}=e,[a,c]=(0,s.useState)(null),[u,d]=(0,s.useState)(!0),[m,h]=(0,s.useState)(!1),f=(0,i.useRouter)(),g=(0,s.useRef)(!1),v=(0,s.useRef)(!1);(0,s.useEffect)(()=>{h(!0),(async()=>{try{let e=localStorage.getItem("userInfo"),t=localStorage.getItem("token");if(localStorage.getItem("apiKey"),e&&t)try{if(c(JSON.parse(e)),!g.current&&!v.current){g.current=!0;try{await (0,o.dw)("/auth/check",{headers:{Authorization:"Bearer ".concat(t)}}),v.current=!0}catch(e){if(console.error("Token validation failed:",e),"localhost"!==window.location.hostname)try{console.log("Retrying token validation..."),await new Promise(e=>setTimeout(e,1e3)),await (0,o.dw)("/auth/check",{headers:{Authorization:"Bearer ".concat(t)}}),v.current=!0}catch(e){console.error("Token validation retry failed:",e),p()}else p()}finally{g.current=!1}}}catch(e){console.error("Failed to parse user info:",e),localStorage.removeItem("userInfo"),localStorage.removeItem("token"),localStorage.removeItem("apiKey")}}finally{d(!1)}})()},[]);let y=e=>{if(console.log("Processing login data"),!e)return void console.error("No user data received for login");try{if(!e.token)return void console.error("No token in login data");let{token:t,...a}=e;console.log("Setting user data:",a),c(a);{localStorage.setItem("userInfo",JSON.stringify(a)),localStorage.setItem("token",t);let e=localStorage.getItem("apiKey");e||(console.log("Generating new API key"),e=n(),localStorage.setItem("apiKey",e)),console.log("Authentication data stored in localStorage")}}catch(e){console.error("Error processing login:",e)}},p=()=>{c(null),localStorage.removeItem("userInfo"),localStorage.removeItem("token"),f.push("/login")},_=()=>localStorage.getItem("token"),x=()=>localStorage.getItem("apiKey"),j=e=>{if(a){let t={...a,coins:e};c(t),localStorage.setItem("userInfo",JSON.stringify(t))}};return m?(0,r.jsx)(l.Provider,{value:{user:a,isLoggedIn:!!a,loading:u,login:y,logout:p,getToken:_,getApiKey:x,updateUserCoins:j},children:t}):(0,r.jsx)(l.Provider,{value:{user:null,isLoggedIn:!1,loading:!0,login:y,logout:p,getToken:_,getApiKey:x,updateUserCoins:j},children:t})},u=()=>{let e=(0,s.useContext)(l);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},72047:(e,t,a)=>{"use strict";async function r(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{let a=e.startsWith("http")?e:"".concat("https://ebookaura.onrender.com/api").concat(e);console.log("API Request: ".concat(t.method||"GET"," ").concat(a)),t.headers||(t.headers={}),!t.body||t.headers["Content-Type"]||t.body instanceof FormData||(t.headers["Content-Type"]="application/json");let r=e.startsWith("/books")&&("GET"===t.method||!t.method)&&!e.includes("/reviews")&&!e.includes("/bookmarks"),s=e.match(/^\/books\/[a-z0-9]+$/i);{let e=localStorage.getItem("token"),a=localStorage.getItem("apiKey");e&&(!r||s)&&!t.headers.Authorization&&(t.headers.Authorization="Bearer ".concat(e)),a&&!t.headers["X-API-Key"]&&(t.headers["X-API-Key"]=a)}let i=await fetch(a,t),o=i.headers.get("content-type");if(!i.ok){if(console.error("API Error (".concat(i.status,"): ").concat(i.statusText)),o&&o.includes("application/json")){let e=await i.json();throw Error(e.message||"API request failed with status ".concat(i.status))}{let e=await i.text();console.error("Non-JSON error response:",e.substring(0,150)+"...");let t="API request failed with status ".concat(i.status);if(e.includes("<title>")&&e.includes("</title>")){let a=e.match(/<title>(.*?)<\/title>/i);a&&a[1]&&(t="Server Error: ".concat(a[1]))}throw Error(t)}}if(o&&o.includes("application/json"))return await i.json();{console.warn("Response is not JSON. Content-Type:",o);let e=await i.text();try{return JSON.parse(e)}catch(e){throw console.error("Failed to parse response as JSON:",e),Error("API response was not valid JSON")}}}catch(e){throw console.error("API request error:",e),e}}async function s(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return r(e,{method:"GET",...t})}async function i(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return r(e,{method:"POST",body:t instanceof FormData?t:JSON.stringify(t),...a})}async function o(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return r(e,{method:"PUT",body:JSON.stringify(t),...a})}async function l(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return r(e,{method:"DELETE",...t})}a.d(t,{Xj:()=>i,_5:()=>l,dw:()=>s,q1:()=>o})},81638:e=>{e.exports={container:"verify-email_container__zVpAv",verifyBox:"verify-email_verifyBox__F7G_7",fadeIn:"verify-email_fadeIn__rE06L",header:"verify-email_header__JBB_3",title:"verify-email_title__BGXl6",titleEbook:"verify-email_titleEbook__jDHI5",titleAura:"verify-email_titleAura__dNFbX",subtitle:"verify-email_subtitle__I66wK",form:"verify-email_form__erwCx",formGroup:"verify-email_formGroup__aosRf",label:"verify-email_label__FOAz_",input:"verify-email_input__8LKNb",submitButton:"verify-email_submitButton___p4m8",resendCode:"verify-email_resendCode__c86iw",resendButton:"verify-email_resendButton__hfUZg",backToLogin:"verify-email_backToLogin__y1l1H",errorMessage:"verify-email_errorMessage__pBcgX",shake:"verify-email_shake__wCtOA",successMessage:"verify-email_successMessage__ONWxL",loading:"verify-email_loading__g6Op4",pulse:"verify-email_pulse__r9uf0"}},82235:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>f});var r=a(95155),s=a(12115),i=a(35695),o=a(6874),l=a.n(o),n=a(81638),c=a.n(n),u=a(56068),d=a(72047);function m(){let e=(0,i.useRouter)(),t=(0,i.useSearchParams)(),[a,o]=(0,s.useState)(""),[n,m]=(0,s.useState)(""),[h,f]=(0,s.useState)(!1),[g,v]=(0,s.useState)(""),[y,p]=(0,s.useState)(!1),{login:_}=(0,u.h)();(0,s.useEffect)(()=>{let e=t.get("email");e&&o(e)},[t]);let x=async t=>{if(t.preventDefault(),v(""),!a)return void v("Email is required");if(!n||6!==n.length)return void v("Please enter a valid 6-digit verification code");f(!0);try{let t=await (0,d.Xj)("/users/verify-email",{email:a,code:n});p(!0),_(t),setTimeout(()=>{e.push("/")},2e3)}catch(e){v(e.message)}finally{f(!1)}},j=async()=>{if(!a)return void v("Email is required");f(!0),v("");try{await (0,d.Xj)("/users/resend-verification",{email:a}),v(""),alert("A new verification code has been sent to your email")}catch(e){v(e.message)}finally{f(!1)}};return y?(0,r.jsx)("div",{className:c().container,children:(0,r.jsxs)("div",{className:c().verifyBox,children:[(0,r.jsxs)("div",{className:c().header,children:[(0,r.jsxs)("h1",{className:c().title,children:[(0,r.jsx)("span",{className:c().titleEbook,children:"Ebook"}),(0,r.jsx)("span",{className:c().titleAura,children:"Aura"})]}),(0,r.jsx)("p",{className:c().subtitle,children:"Email Verification Successful!"})]}),(0,r.jsxs)("div",{className:c().successMessage,children:[(0,r.jsx)("p",{children:"Your email has been verified successfully."}),(0,r.jsx)("p",{children:"You will be redirected to the homepage in a moment..."})]})]})}):(0,r.jsx)("div",{className:c().container,children:(0,r.jsxs)("div",{className:c().verifyBox,children:[(0,r.jsxs)("div",{className:c().header,children:[(0,r.jsxs)("h1",{className:c().title,children:[(0,r.jsx)("span",{className:c().titleEbook,children:"Ebook"}),(0,r.jsx)("span",{className:c().titleAura,children:"Aura"})]}),(0,r.jsx)("p",{className:c().subtitle,children:"Verify Your Email"})]}),g&&(0,r.jsx)("div",{className:c().errorMessage,children:g}),(0,r.jsxs)("form",{onSubmit:x,className:c().form,children:[(0,r.jsxs)("div",{className:c().formGroup,children:[(0,r.jsx)("label",{htmlFor:"email",className:c().label,children:"Email Address"}),(0,r.jsx)("input",{type:"email",id:"email",className:c().input,placeholder:"Enter your email",value:a,onChange:e=>o(e.target.value),required:!0,disabled:!!t.get("email")})]}),(0,r.jsxs)("div",{className:c().formGroup,children:[(0,r.jsx)("label",{htmlFor:"code",className:c().label,children:"Verification Code"}),(0,r.jsx)("input",{type:"text",id:"code",className:c().input,placeholder:"Enter 6-digit code",value:n,onChange:e=>m(e.target.value.replace(/[^0-9]/g,"").slice(0,6)),required:!0,pattern:"[0-9]{6}",maxLength:"6"})]}),(0,r.jsx)("button",{type:"submit",className:c().submitButton,disabled:h,children:h?"Verifying...":"Verify Email"})]}),(0,r.jsx)("div",{className:c().resendCode,children:(0,r.jsxs)("p",{children:["Didn't receive the code? ",(0,r.jsx)("button",{type:"button",className:c().resendButton,onClick:j,disabled:h,children:"Resend Code"})]})}),(0,r.jsx)("div",{className:c().backToLogin,children:(0,r.jsx)(l(),{href:"/login",children:"Back to Login"})})]})})}function h(){return(0,r.jsx)("div",{className:c().container,children:(0,r.jsxs)("div",{className:c().verifyBox,children:[(0,r.jsxs)("div",{className:c().header,children:[(0,r.jsxs)("h1",{className:c().title,children:[(0,r.jsx)("span",{className:c().titleEbook,children:"Ebook"}),(0,r.jsx)("span",{className:c().titleAura,children:"Aura"})]}),(0,r.jsx)("p",{className:c().subtitle,children:"Verify Your Email"})]}),(0,r.jsx)("div",{className:c().loading,children:"Loading verification form..."})]})})}function f(){return(0,r.jsx)(s.Suspense,{fallback:(0,r.jsx)(h,{}),children:(0,r.jsx)(m,{})})}},97133:(e,t,a)=>{Promise.resolve().then(a.bind(a,82235))}},e=>{var t=t=>e(e.s=t);e.O(0,[1945,6874,8441,1684,7358],()=>t(97133)),_N_E=e.O()}]);