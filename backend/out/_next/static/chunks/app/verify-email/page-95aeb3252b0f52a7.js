(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7839],{35695:(e,t,r)=>{"use strict";var a=r(18999);r.o(a,"useParams")&&r.d(t,{useParams:function(){return a.useParams}}),r.o(a,"usePathname")&&r.d(t,{usePathname:function(){return a.usePathname}}),r.o(a,"useRouter")&&r.d(t,{useRouter:function(){return a.useRouter}}),r.o(a,"useSearchParams")&&r.d(t,{useSearchParams:function(){return a.useSearchParams}})},56068:(e,t,r)=>{"use strict";r.d(t,{AuthProvider:()=>c,h:()=>u});var a=r(95155),i=r(12115),s=r(35695),o=r(72047);let n=(0,i.createContext)(),l=()=>"ak_"+Array.from(crypto.getRandomValues(new Uint8Array(24))).map(e=>e.toString(16).padStart(2,"0")).join(""),c=e=>{let{children:t}=e,[r,c]=(0,i.useState)(null),[u,d]=(0,i.useState)(!0),[m,h]=(0,i.useState)(!1),f=(0,s.useRouter)(),g=(0,i.useRef)(!1),p=(0,i.useRef)(!1);(0,i.useEffect)(()=>{h(!0),(async()=>{try{let e=localStorage.getItem("userInfo"),t=localStorage.getItem("token");if(localStorage.getItem("apiKey"),e&&t)try{if(c(JSON.parse(e)),!g.current&&!p.current){g.current=!0;try{await (0,o.dw)("/auth/check",{headers:{Authorization:"Bearer ".concat(t)}}),p.current=!0}catch(e){if(console.error("Token validation failed:",e),"localhost"!==window.location.hostname)try{console.log("Retrying token validation..."),await new Promise(e=>setTimeout(e,1e3)),await (0,o.dw)("/auth/check",{headers:{Authorization:"Bearer ".concat(t)}}),p.current=!0}catch(e){console.error("Token validation retry failed:",e),v()}else v()}finally{g.current=!1}}}catch(e){console.error("Failed to parse user info:",e),localStorage.removeItem("userInfo"),localStorage.removeItem("token"),localStorage.removeItem("apiKey")}}finally{d(!1)}})()},[]);let y=e=>{if(console.log("Processing login data"),!e)return void console.error("No user data received for login");try{if(!e.token)return void console.error("No token in login data");let{token:t,...r}=e;console.log("Setting user data:",r),c(r);{localStorage.setItem("userInfo",JSON.stringify(r)),localStorage.setItem("token",t);let e=localStorage.getItem("apiKey");e||(console.log("Generating new API key"),e=l(),localStorage.setItem("apiKey",e)),console.log("Authentication data stored in localStorage")}}catch(e){console.error("Error processing login:",e)}},v=()=>{c(null),localStorage.removeItem("userInfo"),localStorage.removeItem("token"),f.push("/login")},_=()=>localStorage.getItem("token"),b=()=>localStorage.getItem("apiKey"),x=e=>{if(r){let t={...r,coins:e};c(t),localStorage.setItem("userInfo",JSON.stringify(t))}};return m?(0,a.jsx)(n.Provider,{value:{user:r,isLoggedIn:!!r,loading:u,login:y,logout:v,getToken:_,getApiKey:b,updateUserCoins:x},children:t}):(0,a.jsx)(n.Provider,{value:{user:null,isLoggedIn:!1,loading:!0,login:y,logout:v,getToken:_,getApiKey:b,updateUserCoins:x},children:t})},u=()=>{let e=(0,i.useContext)(n);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},72047:(e,t,r)=>{"use strict";r.d(t,{TA:()=>d,UB:()=>i,Xj:()=>l,_5:()=>u,dw:()=>n,q1:()=>c,yt:()=>s});let a={};function i(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(r)return{shouldMakeCall:!0,cachedData:null};let i=Date.now(),s=a[e];return!s||i-s.timestamp>t?{shouldMakeCall:!0,cachedData:null}:{shouldMakeCall:!1,cachedData:s.data}}function s(e,t){a[e]={timestamp:Date.now(),data:t}}async function o(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{let r=e.startsWith("http")?e:"".concat("https://ebookaura.onrender.com/api").concat(e);console.log("API Request: ".concat(t.method||"GET"," ").concat(r)),t.headers||(t.headers={}),!t.body||t.headers["Content-Type"]||t.body instanceof FormData||(t.headers["Content-Type"]="application/json");let a=e.startsWith("/books")&&("GET"===t.method||!t.method)&&!e.includes("/reviews")&&!e.includes("/bookmarks"),i=e.match(/^\/books\/[a-z0-9]+$/i);{let e=localStorage.getItem("token"),r=localStorage.getItem("apiKey");e&&(!a||i)&&!t.headers.Authorization&&(t.headers.Authorization="Bearer ".concat(e)),r&&!t.headers["X-API-Key"]&&(t.headers["X-API-Key"]=r)}let s=await fetch(r,t),o=s.headers.get("content-type");if(!s.ok){if(console.error("API Error (".concat(s.status,"): ").concat(s.statusText)),o&&o.includes("application/json")){let e=await s.json();throw Error(e.message||"API request failed with status ".concat(s.status))}{let e=await s.text();console.error("Non-JSON error response:",e.substring(0,150)+"...");let t="API request failed with status ".concat(s.status);if(e.includes("<title>")&&e.includes("</title>")){let r=e.match(/<title>(.*?)<\/title>/i);r&&r[1]&&(t="Server Error: ".concat(r[1]))}throw Error(t)}}if(e.match(/^\/books\/[a-z0-9]+$/i)&&o&&o.includes("application/json"))try{let e=await s.json();return e&&"object"==typeof e&&(console.log("Raw premium data from API:",{isPremium:e.isPremium,isPremiumType:typeof e.isPremium,price:e.price,priceType:typeof e.price}),e.price&&"object"==typeof e.price&&e.price.$numberLong&&(e.price=Number(e.price.$numberLong),console.log("Extracted $numberLong price:",e.price)),"isPremium"in e&&(e.isPremium=!0===e.isPremium||"true"===e.isPremium||1===e.isPremium||"true"===String(e.isPremium).toLowerCase()),"price"in e&&(e.price=Number(e.price||0)),!e.isPremium&&e.price>0&&(e.isPremium=!0,console.log("API Utils: Setting isPremium=true based on price > 0")),console.log("API Utils - Processed book details:",{title:e.title,isPremium:e.isPremium,price:e.price})),e}catch(e){throw console.error("Error parsing book details:",e),e}if(o&&o.includes("application/json"))return await s.json();{console.warn("Response is not JSON. Content-Type:",o);let e=await s.text();try{return JSON.parse(e)}catch(e){throw console.error("Failed to parse response as JSON:",e),Error("API response was not valid JSON")}}}catch(e){throw console.error("API request error:",e),e}}async function n(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return o(e,{method:"GET",...t})}async function l(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return o(e,{method:"POST",body:t instanceof FormData?t:JSON.stringify(t),...r})}async function c(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return o(e,{method:"PUT",body:JSON.stringify(t),...r})}async function u(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return o(e,{method:"DELETE",...t})}async function d(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return o(e,{method:"PATCH",body:JSON.stringify(t),...r})}},81638:e=>{e.exports={container:"verify-email_container__zVpAv",verifyBox:"verify-email_verifyBox__F7G_7",fadeIn:"verify-email_fadeIn__rE06L",header:"verify-email_header__JBB_3",title:"verify-email_title__BGXl6",titleEbook:"verify-email_titleEbook__jDHI5",titleAura:"verify-email_titleAura__dNFbX",subtitle:"verify-email_subtitle__I66wK",form:"verify-email_form__erwCx",formGroup:"verify-email_formGroup__aosRf",label:"verify-email_label__FOAz_",input:"verify-email_input__8LKNb",submitButton:"verify-email_submitButton___p4m8",resendCode:"verify-email_resendCode__c86iw",resendButton:"verify-email_resendButton__hfUZg",backToLogin:"verify-email_backToLogin__y1l1H",errorMessage:"verify-email_errorMessage__pBcgX",shake:"verify-email_shake__wCtOA",successMessage:"verify-email_successMessage__ONWxL",loading:"verify-email_loading__g6Op4",pulse:"verify-email_pulse__r9uf0"}},82235:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>f});var a=r(95155),i=r(12115),s=r(35695),o=r(6874),n=r.n(o),l=r(81638),c=r.n(l),u=r(56068),d=r(72047);function m(){let e=(0,s.useRouter)(),t=(0,s.useSearchParams)(),[r,o]=(0,i.useState)(""),[l,m]=(0,i.useState)(""),[h,f]=(0,i.useState)(!1),[g,p]=(0,i.useState)(""),[y,v]=(0,i.useState)(!1),{login:_}=(0,u.h)();(0,i.useEffect)(()=>{let e=t.get("email");e&&o(e)},[t]);let b=async t=>{if(t.preventDefault(),p(""),!r)return void p("Email is required");if(!l||6!==l.length)return void p("Please enter a valid 6-digit verification code");f(!0);try{let t=await (0,d.Xj)("/users/verify-email",{email:r,code:l});v(!0),_(t),setTimeout(()=>{e.push("/")},2e3)}catch(e){p(e.message)}finally{f(!1)}},x=async()=>{if(!r)return void p("Email is required");f(!0),p("");try{await (0,d.Xj)("/users/resend-verification",{email:r}),p(""),alert("A new verification code has been sent to your email")}catch(e){p(e.message)}finally{f(!1)}};return y?(0,a.jsx)("div",{className:c().container,children:(0,a.jsxs)("div",{className:c().verifyBox,children:[(0,a.jsxs)("div",{className:c().header,children:[(0,a.jsxs)("h1",{className:c().title,children:[(0,a.jsx)("span",{className:c().titleEbook,children:"Ebook"}),(0,a.jsx)("span",{className:c().titleAura,children:"Aura"})]}),(0,a.jsx)("p",{className:c().subtitle,children:"Email Verification Successful!"})]}),(0,a.jsxs)("div",{className:c().successMessage,children:[(0,a.jsx)("p",{children:"Your email has been verified successfully."}),(0,a.jsx)("p",{children:"You will be redirected to the homepage in a moment..."})]})]})}):(0,a.jsx)("div",{className:c().container,children:(0,a.jsxs)("div",{className:c().verifyBox,children:[(0,a.jsxs)("div",{className:c().header,children:[(0,a.jsxs)("h1",{className:c().title,children:[(0,a.jsx)("span",{className:c().titleEbook,children:"Ebook"}),(0,a.jsx)("span",{className:c().titleAura,children:"Aura"})]}),(0,a.jsx)("p",{className:c().subtitle,children:"Verify Your Email"})]}),g&&(0,a.jsx)("div",{className:c().errorMessage,children:g}),(0,a.jsxs)("form",{onSubmit:b,className:c().form,children:[(0,a.jsxs)("div",{className:c().formGroup,children:[(0,a.jsx)("label",{htmlFor:"email",className:c().label,children:"Email Address"}),(0,a.jsx)("input",{type:"email",id:"email",className:c().input,placeholder:"Enter your email",value:r,onChange:e=>o(e.target.value),required:!0,disabled:!!t.get("email")})]}),(0,a.jsxs)("div",{className:c().formGroup,children:[(0,a.jsx)("label",{htmlFor:"code",className:c().label,children:"Verification Code"}),(0,a.jsx)("input",{type:"text",id:"code",className:c().input,placeholder:"Enter 6-digit code",value:l,onChange:e=>m(e.target.value.replace(/[^0-9]/g,"").slice(0,6)),required:!0,pattern:"[0-9]{6}",maxLength:"6"})]}),(0,a.jsx)("button",{type:"submit",className:c().submitButton,disabled:h,children:h?"Verifying...":"Verify Email"})]}),(0,a.jsx)("div",{className:c().resendCode,children:(0,a.jsxs)("p",{children:["Didn't receive the code? ",(0,a.jsx)("button",{type:"button",className:c().resendButton,onClick:x,disabled:h,children:"Resend Code"})]})}),(0,a.jsx)("div",{className:c().backToLogin,children:(0,a.jsx)(n(),{href:"/login",children:"Back to Login"})})]})})}function h(){return(0,a.jsx)("div",{className:c().container,children:(0,a.jsxs)("div",{className:c().verifyBox,children:[(0,a.jsxs)("div",{className:c().header,children:[(0,a.jsxs)("h1",{className:c().title,children:[(0,a.jsx)("span",{className:c().titleEbook,children:"Ebook"}),(0,a.jsx)("span",{className:c().titleAura,children:"Aura"})]}),(0,a.jsx)("p",{className:c().subtitle,children:"Verify Your Email"})]}),(0,a.jsx)("div",{className:c().loading,children:"Loading verification form..."})]})})}function f(){return(0,a.jsx)(i.Suspense,{fallback:(0,a.jsx)(h,{}),children:(0,a.jsx)(m,{})})}},97133:(e,t,r)=>{Promise.resolve().then(r.bind(r,82235))}},e=>{var t=t=>e(e.s=t);e.O(0,[1945,6874,8441,1684,7358],()=>t(97133)),_N_E=e.O()}]);