(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4662],{2882:(e,t,s)=>{Promise.resolve().then(s.bind(s,72207))},17203:(e,t,s)=>{"use strict";s.d(t,{JR:()=>n,Sn:()=>o}),s(72047);let n="https://ebookaura.onrender.com/api",o={AUTH:{LOGIN:"".concat(n,"/auth/login"),REGISTER:"".concat(n,"/auth/register"),ME:"".concat(n,"/auth/me"),FORGOT_PASSWORD:"".concat(n,"/auth/forgot-password"),RESET_PASSWORD:e=>"".concat(n,"/auth/reset-password/").concat(e),VERIFY_EMAIL:"".concat(n,"/auth/verify-email")},BOOKS:{ALL:"".concat(n,"/books"),CATEGORIES:"".concat(n,"/books/categories"),TAGS:"".concat(n,"/books/tags"),DETAILS:e=>"".concat(n,"/books/").concat(e),PDF:e=>"".concat(n,"/books/pdf/").concat(e),PDF_CONTENT:e=>"".concat(n,"/books/pdf/").concat(e),DOWNLOAD:e=>"".concat(n,"/books/").concat(e,"/download"),REVIEWS:e=>"".concat(n,"/books/").concat(e,"/reviews"),RATING:e=>"".concat(n,"/books/").concat(e,"/rating"),ADD_REVIEW:e=>"".concat(n,"/books/").concat(e,"/reviews")},UPLOAD:{FILE:"".concat(n,"/upload"),PDF:"".concat(n,"/upload/pdf"),DELETE_FILE:e=>"".concat(n,"/upload/").concat(e),DELETE_BOOK:e=>"".concat(n,"/upload/book/").concat(e)},USER:{PROFILE:"".concat(n,"/users/profile"),UPDATE_PROFILE:"".concat(n,"/users/profile"),UPDATE_IMAGE:"".concat(n,"/users/profile/image"),BOOKMARKS:"".concat(n,"/users/bookmarks")},SUBSCRIPTIONS:{CURRENT:"".concat(n,"/subscriptions/current"),CHECK:"".concat(n,"/subscriptions/check"),CHECK_API:"".concat(n,"/subscriptions/check-api"),ACTIVATE:"".concat(n,"/subscriptions/activate"),DEACTIVATE:"".concat(n,"/subscriptions/deactivate")},API_KEYS:{GENERATE:"".concat(n,"/api-keys/generate"),CURRENT:"".concat(n,"/api-keys/current"),REVOKE:"".concat(n,"/api-keys/revoke"),VERIFY:"".concat(n,"/api-keys/verify")}}},46264:(e,t,s)=>{"use strict";s.d(t,{D8:()=>c,_h:()=>a,checkSubscriptionWithApiKey:()=>d,getCurrentSubscription:()=>r,nV:()=>l,wQ:()=>i});var n=s(72047);s(17203);let o={PLANS:36e5,HISTORY:6e5},i=async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];try{let t="subscription_plans",{shouldMakeCall:s,cachedData:i}=(0,n.UB)(t,o.PLANS,e);if(!s&&i)return i;let r=await (0,n.dw)("/subscriptions/plans");if(r){let e=r.plans||r.data||[],s={...r,plans:e};return(0,n.yt)(t,s),s}return r}catch(e){throw console.error("Error fetching subscription plans:",e),e}},r=async()=>{try{let e=localStorage.getItem("token");if(!e)return console.log("No authentication token found for subscription check"),{success:!1,hasSubscription:!1,message:"Not authenticated"};console.log("Checking current subscription status from server...");let t=await fetch("".concat("https://ebookaura.onrender.com/api","/subscriptions/current"),{method:"GET",headers:{Authorization:"Bearer ".concat(e)}});console.log("Subscription status API response status: ".concat(t.status));let s=await t.json();if(console.log("Subscription status API response:",s),t.ok){void 0===s.hasSubscription&&void 0!==s.active?s.hasSubscription=s.active:void 0===s.active&&void 0!==s.hasSubscription&&(s.active=s.hasSubscription);try{localStorage.setItem("subscriptionStatus",JSON.stringify({hasSubscription:s.hasSubscription,active:s.hasSubscription,planType:s.planType,expiresAt:s.expiresAt,timestamp:new Date().toISOString()})),console.log("Subscription status cached successfully")}catch(e){console.warn("Failed to cache subscription status:",e)}return s.success&&s.hasSubscription?console.log("User has an active subscription (".concat(s.planType||"unknown"," plan), expires: ").concat(s.expiresAt||"unknown")):console.log("User does not have an active subscription"),s}throw console.error("Subscription check failed with error:",s.message),Error(s.message||"Failed to check subscription status")}catch(e){console.error("Error checking subscription status:",e);try{let e=localStorage.getItem("subscriptionStatus");if(e){let t=JSON.parse(e),s=new Date(t.timestamp),n=new Date;if(n-s<3e5)return console.log("Using cached subscription status from",new Date(t.timestamp).toLocaleTimeString()),console.log("Cached subscription value:",t.hasSubscription?"Active":"Inactive"),{success:!0,hasSubscription:t.hasSubscription,active:t.hasSubscription,planType:t.planType,expiresAt:t.expiresAt,fromCache:!0};console.log("Cached subscription data is too old:",Math.round((n-s)/6e4),"minutes old")}else console.log("No cached subscription data found")}catch(e){console.error("Error reading cached subscription status:",e)}return{success:!1,hasSubscription:!1,active:!1,error:e.message||"Failed to check subscription status"}}},a=async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];try{let t=localStorage.getItem("token");if(!t)throw Error("Authentication required");let s="subscription_history",{shouldMakeCall:i,cachedData:r}=(0,n.UB)(s,o.HISTORY,e);if(!i&&r)return r;let a=await (0,n.dw)("/subscriptions/history",{headers:{Authorization:"Bearer ".concat(t)}});return(0,n.yt)(s,a),a}catch(e){throw console.error("Error fetching subscription history:",e),e}},c=async e=>{try{let t=localStorage.getItem("token");if(!t)throw Error("Authentication required");if(console.log("Purchasing subscription with data:",e),!e.planId)throw Error("Plan ID is required");e.paymentMethod||(e.paymentMethod="coins");let s=await fetch("".concat("https://ebookaura.onrender.com/api","/subscriptions"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t)},body:JSON.stringify(e)});console.log("Subscription purchase API response status: ".concat(s.status));let n=await s.json();if(console.log("Subscription purchase API response:",n),!s.ok)throw Error(n.message||"Failed to purchase subscription");try{localStorage.removeItem("subscriptionStatus"),console.log("Cleared subscription cache after purchase")}catch(e){console.warn("Failed to clear subscription cache:",e)}return n}catch(e){throw console.error("Error purchasing subscription:",e),e}},l=async(e,t)=>{try{let s=localStorage.getItem("token");if(!s)throw Error("Authentication required");let o=await (0,n.TA)("/subscriptions/".concat(e),t,{headers:{Authorization:"Bearer ".concat(s)}});return(0,n.yt)("current_subscription",null),(0,n.yt)("subscription_history",null),o}catch(e){throw console.error("Error updating subscription:",e),e}},d=async e=>{try{if(!e)throw console.error("checkSubscriptionWithApiKey called without an API key"),Error("API key is required");console.log("Checking subscription status with API key: ".concat(e.substring(0,5),"..."));let t=await fetch("".concat("https://ebookaura.onrender.com/api","/subscriptions/check-api"),{method:"GET",headers:{"X-API-Key":e}});console.log("Subscription check API response status: ".concat(t.status));let s=await t.json();if(console.log("Subscription check API response:",s),t.ok)return void 0===s.hasSubscription&&void 0!==s.active&&(s.hasSubscription=s.active),s.success&&s.hasSubscription?console.log("API key has valid subscription - granting access"):console.log("API key does not have an active subscription"),s;throw console.error("Subscription check failed with error:",s.message),Error(s.message||"Failed to check subscription status")}catch(e){return console.error("Error checking subscription with API key:",e),{success:!1,hasSubscription:!1,active:!1,error:e.message||"Failed to check subscription status"}}}},48432:e=>{e.exports={container:"settings_container__2ie5P",settingsContainer:"settings_settingsContainer__OiAFk",settingsHeader:"settings_settingsHeader__pxI5K",settingsSection:"settings_settingsSection__i2OtM",settingsForm:"settings_settingsForm__QFBN5",formGroup:"settings_formGroup___ZcmN",button:"settings_button__4aUGd",primaryButton:"settings_primaryButton__r0y9U",secondaryButton:"settings_secondaryButton__YzKrA",dangerButton:"settings_dangerButton__XNJJQ",message:"settings_message__U_WnO",successMessage:"settings_successMessage__nvFhf",errorMessage:"settings_errorMessage__YJSxc",warningMessage:"settings_warningMessage__jmRQI",backLink:"settings_backLink__3JJTg",backIcon:"settings_backIcon__E6WHq",headerTitle:"settings_headerTitle__pykIb",headerSubtitle:"settings_headerSubtitle__GyGtZ",sectionTitle:"settings_sectionTitle__yFwCw",settingItem:"settings_settingItem__qqkai",settingInfo:"settings_settingInfo__jxpWV",settingTitle:"settings_settingTitle__IOOWP",settingDescription:"settings_settingDescription__1xJyu",deleteButton:"settings_deleteButton__9fZZ7",deleteIcon:"settings_deleteIcon__tGVGU",reviewsList:"settings_reviewsList___u4RK",bookmarksList:"settings_bookmarksList__nlMIQ",subsectionTitle:"settings_subsectionTitle__D_Xig",reviewItem:"settings_reviewItem__52dUc",bookmarkItem:"settings_bookmarkItem__mEyHR",reviewInfo:"settings_reviewInfo__krb9U",bookmarkInfo:"settings_bookmarkInfo__8ew8H",bookTitle:"settings_bookTitle__rMtHL",rating:"settings_rating__kjcCJ",starIcon:"settings_starIcon__2r7HL",filled:"settings_filled__LaxsW",reviewText:"settings_reviewText__KTEim",reviewDate:"settings_reviewDate__OpLag",bookmarkDate:"settings_bookmarkDate__tU6uH",deleteReviewButton:"settings_deleteReviewButton__EyRh2",deleteBookmarkButton:"settings_deleteBookmarkButton__2IdN6",loading:"settings_loading__xABMV",loadingAnimation:"settings_loadingAnimation__3ISGg",spin:"settings_spin__w0HRh",modalOverlay:"settings_modalOverlay__SuNGX",modal:"settings_modal__YzoDu",modalHeader:"settings_modalHeader__LErpR",warningIcon:"settings_warningIcon__F6lGo",modalTitle:"settings_modalTitle__slN_P",modalContent:"settings_modalContent__yG9LW",modalActions:"settings_modalActions__wzsXm",cancelButton:"settings_cancelButton__4TiaH",confirmDeleteButton:"settings_confirmDeleteButton__0gYCm",passwordConfirmation:"settings_passwordConfirmation__UoWdJ",passwordInput:"settings_passwordInput__LN6rE",passwordError:"settings_passwordError__cOSLt",deletionList:"settings_deletionList__7B8Jk",sectionIcon:"settings_sectionIcon__0JlWS",sectionHeader:"settings_sectionHeader__6RgME",subscriptionCard:"settings_subscriptionCard__bQvwV",subscriptionHeader:"settings_subscriptionHeader__aGrSu",subscriptionName:"settings_subscriptionName__Y2y2D",subscriptionStatus:"settings_subscriptionStatus__V_V_G",active:"settings_active__rKjmW",canceled:"settings_canceled__LHeM4",expired:"settings_expired__mIj8X",pending:"settings_pending__mEJuO",subscriptionDetails:"settings_subscriptionDetails__6AobI",subscriptionActions:"settings_subscriptionActions__OYan8",actionButton:"settings_actionButton__ttyeg",noSubscription:"settings_noSubscription__OkTFQ",planButton:"settings_planButton__xaUOu",subscriptionHistory:"settings_subscriptionHistory__Zax_I",historyList:"settings_historyList__1DJTb",historyItem:"settings_historyItem__12Hce",historyHeader:"settings_historyHeader__EDk2Y",historyPlan:"settings_historyPlan__o3cEk",historyStatus:"settings_historyStatus__mrotM",historyPeriod:"settings_historyPeriod__GZVUF",selectInput:"settings_selectInput__ECENu",coinsBalance:"settings_coinsBalance__wCOmf",coinIcon:"settings_coinIcon__qzqg8",confirmButton:"settings_confirmButton__4PUKs",nonCancelableNotice:"settings_nonCancelableNotice__v1XwI",infoIcon:"settings_infoIcon__R1him",expiredSubscriptionMessage:"settings_expiredSubscriptionMessage___N6hw"}},72207:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>U});var n=s(95155),o=s(12115),i=s(35695),r=s(6874),a=s.n(r),c=s(29911),l=s(56068),d=s(48432),u=s.n(d),h=s(17203),p=s(72047),m=s(46264),g=s(54581),_=s(92302),b=s(3127),y=s(71116),x=s(41101),k=s(68534),j=s(72390),v=s(31960),A=s(57515);let f=(0,A.A)((0,n.jsx)("path",{d:"M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2m0 16H8V7h11z"}),"ContentCopy");var w=s(37857),I=s(19505),S=s(78173);let N=(0,A.A)((0,n.jsx)("path",{d:"M19 19H5V5h7V3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2v-7h-2zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3z"}),"OpenInNew");var E=s(38543);let C=()=>{try{return localStorage.getItem("token")}catch(e){return console.error("Error accessing token from localStorage:",e),null}},T=async()=>{try{let e=C();if(!e)throw Error("Authentication required to access API keys");return await (0,p.dw)(h.Sn.API_KEYS.CURRENT,{headers:{Authorization:"Bearer ".concat(e)}})}catch(e){throw console.error("Error fetching current API key:",e),e}},P=async()=>{try{let e=C();if(!e)throw Error("Authentication required to generate API key");return await (0,p.Xj)(h.Sn.API_KEYS.GENERATE,{},{headers:{Authorization:"Bearer ".concat(e)}})}catch(e){throw console.error("Error generating API key:",e),e}},B=async()=>{try{let e=C();if(!e)throw Error("Authentication required to revoke API key");return await (0,p._5)(h.Sn.API_KEYS.REVOKE,{headers:{Authorization:"Bearer ".concat(e)}})}catch(e){throw console.error("Error revoking API key:",e),e}},D=()=>{let[e,t]=(0,o.useState)(!0),[s,i]=(0,o.useState)(null),[r,c]=(0,o.useState)(!1),[l,d]=(0,o.useState)(""),[u,h]=(0,o.useState)(null);(0,o.useEffect)(()=>{p()},[]);let p=async()=>{try{t(!0),h(null);let e=await T();e.success&&e.apiKey?i(e.apiKey):i(null)}catch(e){console.error("Error fetching API key:",e),h("Unable to fetch API key"),i(null)}finally{t(!1)}},m=async()=>{try{t(!0),h(null),c(!1);let e=await P();e.success&&e.apiKey?(d(e.apiKey),c(!0),p(),E.oR.success("New API key generated successfully!")):h("Failed to generate API key")}catch(e){console.error("Error generating API key:",e),h("Unable to generate API key")}finally{t(!1)}},A=async()=>{if(window.confirm("Are you sure you want to revoke this API key? This action cannot be undone."))try{t(!0),h(null),(await B()).success?(i(null),d(""),c(!1),E.oR.success("API key revoked successfully!")):h("Failed to revoke API key")}catch(e){console.error("Error revoking API key:",e),h("Unable to revoke API key")}finally{t(!1)}},C=e=>{navigator.clipboard.writeText(e).then(()=>{E.oR.success("API key copied to clipboard!")},e=>{console.error("Could not copy text: ",e),E.oR.error("Failed to copy to clipboard")})};return(0,n.jsxs)(g.A,{mb:3,children:[u&&(0,n.jsx)(_.A,{severity:"error",sx:{mb:2},children:u}),r&&(0,n.jsxs)(_.A,{severity:"info",sx:{mb:2},action:(0,n.jsx)(b.A,{color:"inherit",size:"small",onClick:()=>C(l),children:(0,n.jsx)(f,{fontSize:"small"})}),children:[(0,n.jsx)(y.A,{variant:"subtitle2",gutterBottom:!0,fontWeight:"bold",children:"Your new API key (only shown once):"}),(0,n.jsx)(g.A,{sx:{fontFamily:"monospace",p:1,bgcolor:"background.paper",borderRadius:1,border:"1px dashed rgba(0, 0, 0, 0.2)",wordBreak:"break-all"},children:l}),(0,n.jsx)(y.A,{variant:"caption",sx:{display:"block",mt:1,color:"error.main"},children:"Make sure to copy this key now. You won't be able to see it again!"})]}),(0,n.jsxs)(g.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:2},children:[(0,n.jsx)(g.A,{children:s?(0,n.jsxs)(g.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,n.jsx)(S.A,{color:"primary",fontSize:"small"}),(0,n.jsx)(x.A,{label:"API Key Active",color:"success",size:"small"})]}):(0,n.jsxs)(g.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,n.jsx)(S.A,{color:"disabled",fontSize:"small"}),(0,n.jsx)(y.A,{variant:"body2",color:"text.secondary",children:"No API key generated"})]})}),(0,n.jsx)(g.A,{children:s?(0,n.jsxs)(g.A,{sx:{display:"flex",gap:1},children:[(0,n.jsx)(k.A,{variant:"outlined",size:"small",startIcon:(0,n.jsx)(w.A,{}),onClick:m,disabled:e,children:"Regenerate"}),(0,n.jsx)(k.A,{variant:"outlined",size:"small",color:"error",startIcon:(0,n.jsx)(I.A,{}),onClick:A,disabled:e,children:"Revoke"})]}):(0,n.jsx)(k.A,{variant:"contained",size:"small",startIcon:(0,n.jsx)(S.A,{}),onClick:m,disabled:e,children:"Generate API Key"})})]}),(0,n.jsx)(j.A,{sx:{my:2}}),(0,n.jsxs)(g.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,n.jsx)(y.A,{variant:"body2",color:"text.secondary",children:"Use your API key to access EbookAura services programmatically"}),(0,n.jsx)(a(),{href:"/profile/api-keys",passHref:!0,children:(0,n.jsxs)(v.A,{sx:{display:"flex",alignItems:"center",gap:.5},children:[(0,n.jsx)(y.A,{variant:"body2",children:"Manage API Keys"}),(0,n.jsx)(N,{fontSize:"small"})]})})]})]})};var R=s(14426);let L=(0,A.A)((0,n.jsx)("path",{d:"M1 21h22L12 2zm12-3h-2v-2h2zm0-4h-2v-4h2z"}),"Warning"),O=(0,A.A)((0,n.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m-2 15-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8z"}),"CheckCircle"),H=(0,A.A)((0,n.jsx)("path",{d:"M12 17c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2m6-9h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6h1.9c0-1.71 1.39-3.1 3.1-3.1s3.1 1.39 3.1 3.1v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2m0 12H6V10h12z"}),"LockOpen"),z=(0,A.A)([(0,n.jsx)("path",{d:"M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2M12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8"},"0"),(0,n.jsx)("path",{d:"M12.5 7H11v6l5.25 3.15.75-1.23-4.5-2.67z"},"1")],"AccessTime"),M=(0,A.A)((0,n.jsx)("path",{d:"M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2m4.24 16L12 15.45 7.77 18l1.12-4.81-3.73-3.23 4.92-.42L12 5l1.92 4.53 4.92.42-3.73 3.23z"}),"Stars"),F=()=>{var e;let[t,s]=(0,o.useState)(!0),[i,r]=(0,o.useState)(null),[c,l]=(0,o.useState)(null);(0,o.useEffect)(()=>{d()},[]);let d=async()=>{try{s(!0),l(null);let e=await (0,m.getCurrentSubscription)();e.success?r(e):l("Could not retrieve subscription status")}catch(e){console.error("Error fetching subscription status:",e),l("Unable to check subscription status")}finally{s(!1)}},u=i?i.active?{color:"success",icon:(0,n.jsx)(O,{}),label:i.planType?"".concat(i.planType.toUpperCase()," Plan"):"Active"}:{color:"default",icon:(0,n.jsx)(H,{}),label:"Free Plan"}:{color:"default",icon:(0,n.jsx)(L,{}),label:"Unknown"},h=(null==i?void 0:i.expiresAt)?(e=>{if(!e)return null;let t=new Date(e),s=Math.ceil((t-new Date)/864e5);return s>0?s:0})(i.expiresAt):null;return t?(0,n.jsx)(g.A,{sx:{display:"flex",justifyContent:"center",my:2},children:(0,n.jsx)(R.A,{size:24})}):(0,n.jsxs)(g.A,{mb:3,children:[c&&(0,n.jsx)(_.A,{severity:"error",sx:{mb:2},children:c}),(0,n.jsxs)(g.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:2},children:[(0,n.jsxs)(g.A,{children:[(0,n.jsx)(y.A,{variant:"subtitle2",gutterBottom:!0,children:"Subscription Status"}),(0,n.jsx)(x.A,{icon:u.icon,label:u.label,color:u.color,size:"medium"})]}),(null==i?void 0:i.active)&&(null==i?void 0:i.expiresAt)&&(0,n.jsxs)(g.A,{sx:{textAlign:"right"},children:[(0,n.jsxs)(y.A,{variant:"body2",color:"text.secondary",children:["Expires: ",(e=>e?new Date(e).toLocaleDateString(void 0,{year:"numeric",month:"long",day:"numeric"}):"Not available")(i.expiresAt)]}),null!==h&&(0,n.jsxs)(g.A,{sx:{display:"flex",alignItems:"center",justifyContent:"flex-end",mt:.5},children:[(0,n.jsx)(z,{fontSize:"small",sx:{mr:.5,color:h<7?"warning.main":"text.secondary"}}),(0,n.jsxs)(y.A,{variant:"body2",color:h<7?"warning.main":"text.secondary",fontWeight:h<7?"bold":"regular",children:[h," days remaining"]})]})]})]}),(null==i?void 0:i.active)?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(g.A,{sx:{mt:2,mb:1},children:(0,n.jsx)(_.A,{severity:"success",icon:(0,n.jsx)(M,{}),children:(0,n.jsxs)(y.A,{variant:"body2",children:["You have full access to all premium content with your ",(null==(e=i.planType)?void 0:e.toUpperCase())||"PRO"," subscription."]})})}),(0,n.jsx)(g.A,{sx:{display:"flex",justifyContent:"flex-end",mt:2},children:(0,n.jsx)(a(),{href:"/plans",passHref:!0,children:(0,n.jsxs)(v.A,{sx:{display:"flex",alignItems:"center"},children:[(0,n.jsx)(y.A,{variant:"body2",children:"Manage Subscription"}),(0,n.jsx)(N,{fontSize:"small",sx:{ml:.5}})]})})})]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(g.A,{sx:{mt:2,mb:1},children:(0,n.jsx)(_.A,{severity:"info",children:(0,n.jsx)(y.A,{variant:"body2",children:"Upgrade to a premium plan to access all content and features."})})}),(0,n.jsx)(g.A,{sx:{display:"flex",justifyContent:"flex-end",mt:2},children:(0,n.jsx)(a(),{href:"/plans",passHref:!0,children:(0,n.jsx)(k.A,{variant:"contained",color:"primary",size:"small",endIcon:(0,n.jsx)(N,{}),children:"View Plans"})})})]}),(0,n.jsx)(j.A,{sx:{mt:2}})]})};function U(){let{user:e,logout:t,getToken:s,updateUserCoins:r}=(0,l.h)(),d=(0,i.useRouter)(),[g,_]=(0,o.useState)(!0),[b,y]=(0,o.useState)(""),[x,k]=(0,o.useState)(""),[j,v]=(0,o.useState)(""),[A,f]=(0,o.useState)([]),[w,I]=(0,o.useState)([]),[S,N]=(0,o.useState)(!1),[E,C]=(0,o.useState)(!1),[T,P]=(0,o.useState)(!1),[B,R]=(0,o.useState)(""),[L,O]=(0,o.useState)(""),[H,z]=(0,o.useState)(null),[M,U]=(0,o.useState)([]),[K,G]=(0,o.useState)(!1),[V,Y]=(0,o.useState)(!1),[J,W]=(0,o.useState)("");(0,o.useEffect)(()=>{if(!e)return void d.push("/login");q(),X()},[e,d]);let q=async()=>{_(!0),y("");try{let e=s();if(!e)throw Error("No authentication token found");let t=await fetch("".concat(h.JR,"/reviews/user"),{method:"GET",headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"}});if(!t.ok)throw Error("Failed to fetch reviews");let n=await t.json();f(n);let o=await fetch("".concat(h.JR,"/bookmarks"),{method:"GET",headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"}});if(!o.ok)throw Error("Failed to fetch bookmarks");let i=await o.json();I(i)}catch(e){console.error("Error fetching user data:",e),y(e.message||"An error occurred while fetching your data")}finally{_(!1)}},X=async()=>{G(!0);try{try{let e=await (0,m.getCurrentSubscription)();e&&e.hasSubscription&&e.subscription?z(e.subscription):(console.log("No active subscription found"),e&&e.wasExpired&&(y("Your subscription has expired. Please renew to continue enjoying premium benefits."),e.subscription&&U(t=>[e.subscription,...t])),z(null))}catch(e){console.error("Error fetching subscription:",e),z(null)}try{let e=await (0,m._h)();e&&e.subscriptions?U(e.subscriptions):e&&e.data?U(e.data):U([])}catch(e){console.error("Error fetching subscription history:",e),U([])}}catch(e){console.error("Error fetching subscription data:",e),y(e.message||"Failed to load subscription data")}finally{G(!1)}},Q=async e=>{v("Are you sure you want to delete this review?"),k(""),y("");try{let t=s();if(!t)throw Error("No authentication token found");let n=await fetch("".concat(h.JR,"/reviews/").concat(e),{method:"DELETE",headers:{Authorization:"Bearer ".concat(t),"Content-Type":"application/json"}});if(!n.ok){let e=await n.json();throw Error(e.message||"Failed to delete review")}k("Review deleted successfully"),f(A.filter(t=>t._id!==e))}catch(e){console.error("Error deleting review:",e),y(e.message||"An error occurred while deleting the review")}},Z=async()=>{C(!0)},$=async()=>{C(!1),_(!0),y(""),k("");try{let e=s();if(!e)throw Error("No authentication token found");let t=await fetch("".concat(h.JR,"/reviews/user/all"),{method:"DELETE",headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"}});if(!t.ok){let e=await t.json();throw Error(e.message||"Failed to delete all reviews")}k("All reviews deleted successfully"),f([])}catch(e){console.error("Error deleting all reviews:",e),y(e.message||"An error occurred while deleting all reviews")}finally{_(!1)}},ee=async e=>{v("Are you sure you want to delete this bookmark?"),k(""),y("");try{let t=s();if(!t)throw Error("No authentication token found");let n=await fetch("".concat(h.JR,"/bookmarks/").concat(e),{method:"DELETE",headers:{Authorization:"Bearer ".concat(t),"Content-Type":"application/json"}});if(!n.ok){let e=await n.json();throw Error(e.message||"Failed to delete bookmark")}k("Bookmark deleted successfully"),I(w.filter(t=>t._id!==e))}catch(e){console.error("Error deleting bookmark:",e),y(e.message||"An error occurred while deleting the bookmark")}},et=async()=>{P(!0)},es=async()=>{P(!1),_(!0),y(""),k("");try{let e=s();if(!e)throw Error("No authentication token found");let t=await fetch("".concat(h.JR,"/bookmarks/all"),{method:"DELETE",headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"}});if(!t.ok){let e=await t.json();throw Error(e.message||"Failed to delete all bookmarks")}k("All bookmarks deleted successfully"),I([])}catch(e){console.error("Error deleting all bookmarks:",e),y(e.message||"An error occurred while deleting all bookmarks")}finally{_(!1)}},en=async()=>{if(!B)return void O("Please enter your password to confirm account deletion");N(!1),_(!0),y(""),k("");try{let e=s();if(!e)throw Error("No authentication token found");try{await (0,p.Xj)("/users/verify-password",{password:B},{headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"}})}catch(e){_(!1),y("Password verification failed. Account deletion aborted.");return}await (0,p._5)("/users/profile",{headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"}}),k("Account deleted successfully"),t(),setTimeout(()=>{d.push("/")},1500)}catch(e){console.error("Error deleting account:",e),y(e.message||"An error occurred while deleting your account"),_(!1)}},eo=e=>e?new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}):"N/A";return g?(0,n.jsx)("div",{className:u().container,children:(0,n.jsx)("div",{className:u().settingsContainer,children:(0,n.jsx)("div",{className:u().loading,children:(0,n.jsx)("div",{className:u().loadingAnimation})})})}):(0,n.jsxs)("div",{className:u().container,children:[(0,n.jsxs)("div",{className:u().settingsContainer,children:[(0,n.jsxs)("div",{className:u().header,children:[(0,n.jsxs)(a(),{href:"/profile",className:u().backLink,children:[(0,n.jsx)(c.QVr,{className:u().backIcon}),"Back to Profile"]}),(0,n.jsx)("h1",{className:u().headerTitle,children:"Settings"}),(0,n.jsx)("p",{className:u().headerSubtitle,children:"Manage your account settings"})]}),b&&(0,n.jsx)("div",{className:u().errorMessage,children:b}),x&&(0,n.jsx)("div",{className:u().successMessage,children:x}),(0,n.jsxs)("div",{className:u().settingsSection,children:[(0,n.jsxs)("h2",{className:u().sectionTitle,children:[(0,n.jsx)(c.Hu1,{className:u().sectionIcon}),"Subscription"]}),(0,n.jsx)("p",{className:u().sectionDescription,children:"Manage your subscription plan and access to premium content"}),(0,n.jsx)(F,{})]}),(0,n.jsxs)("div",{className:u().settingsSection,children:[(0,n.jsxs)("h2",{className:u().sectionTitle,children:[(0,n.jsx)(c.pXu,{className:u().sectionIcon}),"API Key"]}),(0,n.jsx)("p",{className:u().sectionDescription,children:"Manage your API key for external applications and services"}),(0,n.jsx)(D,{})]}),(0,n.jsxs)("div",{className:u().settingsSection,children:[(0,n.jsx)("h2",{className:u().sectionTitle,children:"Account Settings"}),(0,n.jsxs)("div",{className:u().settingItem,children:[(0,n.jsxs)("div",{className:u().settingInfo,children:[(0,n.jsx)("h3",{className:u().settingTitle,children:"Delete Account"}),(0,n.jsx)("p",{className:u().settingDescription,children:"Permanently delete your account and all associated data"})]}),(0,n.jsxs)("button",{className:u().deleteButton,onClick:()=>{R(""),O(""),N(!0)},children:[(0,n.jsx)(c.qbC,{className:u().deleteIcon}),"Delete Account"]})]})]}),(0,n.jsxs)("div",{className:u().settingsSection,children:[(0,n.jsx)("h2",{className:u().sectionTitle,children:"Reviews & Ratings"}),(0,n.jsxs)("div",{className:u().settingItem,children:[(0,n.jsxs)("div",{className:u().settingInfo,children:[(0,n.jsx)("h3",{className:u().settingTitle,children:"Delete All Reviews"}),(0,n.jsx)("p",{className:u().settingDescription,children:"Remove all your reviews and ratings from books"})]}),(0,n.jsxs)("button",{className:u().deleteButton,onClick:Z,children:[(0,n.jsx)(c.qbC,{className:u().deleteIcon}),"Delete All Reviews"]})]}),A.length>0&&(0,n.jsxs)("div",{className:u().reviewsList,children:[(0,n.jsx)("h3",{className:u().subsectionTitle,children:"Your Reviews"}),A.map(e=>(0,n.jsxs)("div",{className:u().reviewItem,children:[(0,n.jsxs)("div",{className:u().reviewInfo,children:[(0,n.jsx)("h4",{className:u().bookTitle,children:e.book.title}),(0,n.jsx)("div",{className:u().rating,children:[void 0,void 0,void 0,void 0,void 0].map((t,s)=>(0,n.jsx)(c.gt3,{className:"".concat(u().starIcon," ").concat(s<e.rating?u().filled:"")},s))}),(0,n.jsx)("p",{className:u().reviewText,children:e.text}),(0,n.jsx)("p",{className:u().reviewDate,children:new Date(e.createdAt).toLocaleDateString()})]}),(0,n.jsx)("button",{className:u().deleteReviewButton,onClick:()=>Q(e._id),children:(0,n.jsx)(c.qbC,{className:u().deleteIcon})})]},e._id))]})]}),(0,n.jsxs)("div",{className:u().settingsSection,children:[(0,n.jsx)("h2",{className:u().sectionTitle,children:"Bookmarks"}),(0,n.jsxs)("div",{className:u().settingItem,children:[(0,n.jsxs)("div",{className:u().settingInfo,children:[(0,n.jsx)("h3",{className:u().settingTitle,children:"Delete All Bookmarks"}),(0,n.jsx)("p",{className:u().settingDescription,children:"Remove all your bookmarked books"})]}),(0,n.jsxs)("button",{className:u().deleteButton,onClick:et,children:[(0,n.jsx)(c.qbC,{className:u().deleteIcon}),"Delete All Bookmarks"]})]}),w.length>0&&(0,n.jsxs)("div",{className:u().bookmarksList,children:[(0,n.jsx)("h3",{className:u().subsectionTitle,children:"Your Bookmarks"}),w.map(e=>(0,n.jsxs)("div",{className:u().bookmarkItem,children:[(0,n.jsxs)("div",{className:u().bookmarkInfo,children:[(0,n.jsx)("h4",{className:u().bookTitle,children:e.book.title}),(0,n.jsxs)("p",{className:u().bookmarkDate,children:["Added on ",new Date(e.createdAt).toLocaleDateString()]})]}),(0,n.jsx)("button",{className:u().deleteBookmarkButton,onClick:()=>ee(e._id),children:(0,n.jsx)(c.qbC,{className:u().deleteIcon})})]},e._id))]})]}),M.length>0&&(0,n.jsxs)("div",{className:u().subscriptionHistory,children:[(0,n.jsx)("h3",{children:"Subscription History"}),(0,n.jsx)("div",{className:u().historyList,children:M.map(e=>{var t;return(0,n.jsxs)("div",{className:u().historyItem,children:[(0,n.jsxs)("div",{className:u().historyHeader,children:[(0,n.jsx)("span",{className:u().historyPlan,children:(null==(t=e.plan)?void 0:t.name)||"Premium Plan"}),(0,n.jsx)("span",{className:"".concat(u().historyStatus," ").concat(u()[e.status]),children:e.status})]}),(0,n.jsxs)("div",{className:u().historyPeriod,children:[eo(e.startDate)," - ",eo(e.endDate)]})]},e._id)})})]})]}),S&&(0,n.jsx)("div",{className:u().modalOverlay,children:(0,n.jsxs)("div",{className:u().modal,children:[(0,n.jsxs)("div",{className:u().modalHeader,children:[(0,n.jsx)(c.BS8,{className:u().warningIcon}),(0,n.jsx)("h3",{className:u().modalTitle,children:"Delete Account"})]}),(0,n.jsxs)("div",{className:u().modalContent,children:[(0,n.jsx)("p",{children:"Are you sure you want to delete your account? This action cannot be undone."}),(0,n.jsx)("p",{children:"The following will be permanently deleted:"}),(0,n.jsxs)("ul",{className:u().deletionList,children:[(0,n.jsx)("li",{children:"Your user profile and personal information"}),(0,n.jsx)("li",{children:"All your reviews and ratings"}),(0,n.jsx)("li",{children:"All your bookmarks"}),(0,n.jsx)("li",{children:"Your profile picture"})]}),(0,n.jsxs)("div",{className:u().passwordConfirmation,children:[(0,n.jsx)("label",{htmlFor:"confirmPassword",children:"Enter your password to confirm deletion:"}),(0,n.jsx)("input",{type:"password",id:"confirmPassword",value:B,onChange:e=>R(e.target.value),className:u().passwordInput,placeholder:"Your current password"}),L&&(0,n.jsx)("p",{className:u().passwordError,children:L})]})]}),(0,n.jsxs)("div",{className:u().modalActions,children:[(0,n.jsx)("button",{className:u().cancelButton,onClick:()=>N(!1),children:"Cancel"}),(0,n.jsx)("button",{className:u().confirmDeleteButton,onClick:en,children:"Delete My Account"})]})]})}),E&&(0,n.jsx)("div",{className:u().modalOverlay,children:(0,n.jsxs)("div",{className:u().modal,children:[(0,n.jsxs)("div",{className:u().modalHeader,children:[(0,n.jsx)(c.BS8,{className:u().warningIcon}),(0,n.jsx)("h3",{className:u().modalTitle,children:"Delete All Reviews"})]}),(0,n.jsxs)("div",{className:u().modalContent,children:[(0,n.jsx)("p",{children:"Are you sure you want to delete all your reviews? This action cannot be undone."}),(0,n.jsx)("p",{children:"All your reviews and ratings will be permanently removed from the platform."})]}),(0,n.jsxs)("div",{className:u().modalActions,children:[(0,n.jsx)("button",{className:u().cancelButton,onClick:()=>C(!1),children:"Cancel"}),(0,n.jsx)("button",{className:u().confirmDeleteButton,onClick:$,children:"Delete All Reviews"})]})]})}),T&&(0,n.jsx)("div",{className:u().modalOverlay,children:(0,n.jsxs)("div",{className:u().modal,children:[(0,n.jsxs)("div",{className:u().modalHeader,children:[(0,n.jsx)(c.BS8,{className:u().warningIcon}),(0,n.jsx)("h3",{className:u().modalTitle,children:"Delete All Bookmarks"})]}),(0,n.jsxs)("div",{className:u().modalContent,children:[(0,n.jsx)("p",{children:"Are you sure you want to delete all your bookmarks? This action cannot be undone."}),(0,n.jsx)("p",{children:"All your bookmarked books will be permanently removed from your account."})]}),(0,n.jsxs)("div",{className:u().modalActions,children:[(0,n.jsx)("button",{className:u().cancelButton,onClick:()=>P(!1),children:"Cancel"}),(0,n.jsx)("button",{className:u().confirmDeleteButton,onClick:es,children:"Delete All Bookmarks"})]})]})}),V&&(0,n.jsx)("div",{className:u().modalOverlay,children:(0,n.jsxs)("div",{className:u().modalContent,children:[(0,n.jsx)("h2",{children:"Subscription Cancellation"}),(0,n.jsx)("p",{children:"Subscriptions are non-refundable and cannot be canceled once purchased."}),(0,n.jsxs)("p",{children:["You will continue to have access until ",eo(null==H?void 0:H.endDate),"."]}),(0,n.jsx)("div",{className:u().modalActions,children:(0,n.jsx)("button",{className:u().confirmButton,onClick:()=>Y(!1),children:"I Understand"})})]})})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[2619,6711,6874,9719,7628,980,6068,8441,1684,7358],()=>t(2882)),_N_E=e.O()}]);