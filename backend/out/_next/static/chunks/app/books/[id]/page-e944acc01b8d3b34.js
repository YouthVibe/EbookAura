(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[511],{1759:e=>{e.exports={container:"book_container__t7HpC",backButton:"book_backButton__vDnG6",bookDetailContainer:"book_bookDetailContainer__v_R0K",bookInformation:"book_bookInformation__StZ6g",bookCover:"book_bookCover__wj7vL",placeholderCover:"book_placeholderCover__5P_sO",title:"book_title__xHEy4",author:"book_author__FsqOe",category:"book_category__zzF9H",stats:"book_stats__wU7Ul",stat:"book_stat__mAw2q",description:"book_description__T_l8Y",tags:"book_tags__gKDwb",tagList:"book_tagList__Gixb3",tag:"book_tag__Kk0Gj",noTags:"book_noTags__Qq9um",buttonGroup:"book_buttonGroup__1dUE_",viewButton:"book_viewButton__yhdR4",downloadButton:"book_downloadButton__xSZiq",loading:"book_loading__jGrZj",error:"book_error__olOYE"}},2695:e=>{e.exports={reviewContainer:"BookReview_reviewContainer__PXZXE",reviewHeader:"BookReview_reviewHeader__exUT_",reviewSummary:"BookReview_reviewSummary__m9pQe",averageRating:"BookReview_averageRating__GLivu",ratingNumber:"BookReview_ratingNumber__2uD8e",ratingStars:"BookReview_ratingStars__TajM3",reviewCount:"BookReview_reviewCount__gFeSv",displayStar:"BookReview_displayStar__Fz3J4",reviewForm:"BookReview_reviewForm__KzYxy",success:"BookReview_success__phiTs",submitError:"BookReview_submitError__GK4zL",ratingSelector:"BookReview_ratingSelector__Y8L9Q",stars:"BookReview_stars__vHpqj",ratingStar:"BookReview_ratingStar__7YZu8",commentField:"BookReview_commentField__HbZ9h",optional:"BookReview_optional__5fC_J",textarea:"BookReview_textarea__uqAZb",characterCount:"BookReview_characterCount__avyYp",submitButton:"BookReview_submitButton__uifGG",loginPrompt:"BookReview_loginPrompt__nl1B6",reviewsList:"BookReview_reviewsList__36HJ_",noReviews:"BookReview_noReviews__EL0Br",reviewItem:"BookReview_reviewItem__wF7Ok",reviewerInfo:"BookReview_reviewerInfo__yDoe0",reviewerImage:"BookReview_reviewerImage__T3neO",reviewerPlaceholder:"BookReview_reviewerPlaceholder__VLVSv",reviewerName:"BookReview_reviewerName___r0hh",reviewDate:"BookReview_reviewDate__fxaMW",reviewMetadata:"BookReview_reviewMetadata__cvN1d",deleteButton:"BookReview_deleteButton__sF4DA",reviewRating:"BookReview_reviewRating__TTay3",reviewText:"BookReview_reviewText__OjgJ1",confirmOverlay:"BookReview_confirmOverlay__3SoDg",fadeIn:"BookReview_fadeIn__ejiO2",confirmDialog:"BookReview_confirmDialog__rHKbe",slideUp:"BookReview_slideUp__26h3O",confirmHeader:"BookReview_confirmHeader__9ZJSd",closeButton:"BookReview_closeButton__ABCqQ",confirmButtons:"BookReview_confirmButtons__fnWlf",cancelButton:"BookReview_cancelButton__FmPbe",deleteConfirmButton:"BookReview_deleteConfirmButton__bWD9h",loading:"BookReview_loading__xP9sm",error:"BookReview_error__dxxxC"}},3779:(e,o,t)=>{"use strict";t.d(o,{default:()=>j});var a=t(5155),r=t(2115),i=t(5695),s=t(9911),n=t(6874),l=t.n(n),c=t(7203);let d=async e=>{try{if(!e)throw Error("Book ID is required");let o=localStorage.getItem("token"),t=localStorage.getItem("apiKey"),a=await fetch(c.Sn.BOOKS.REVIEWS(e),{method:"GET",headers:{"Content-Type":"application/json",...o&&{Authorization:"Bearer ".concat(o)},...t&&{"X-API-Key":t}}});if(!a.ok){let e=await a.json();throw Error(e.message||"Failed to fetch reviews")}return await a.json()}catch(e){throw console.error("Error fetching book reviews:",e),e}},v=async e=>{try{if(!e)throw Error("Book ID is required");let o=await fetch(c.Sn.BOOKS.RATING(e));if(!o.ok){let e=await o.json();throw Error(e.message||"Failed to fetch book rating")}return await o.json()}catch(e){throw console.error("Error fetching book rating:",e),e}},w=async function(e,o){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";try{if(!e)throw Error("Book ID is required");if(!o||o<1||o>5)throw Error("Rating must be between 1 and 5");if(t&&t.length>200)throw Error("Review text must be under 200 characters");let a=localStorage.getItem("token"),r=localStorage.getItem("apiKey");if(!a||!r)throw Error("You must be logged in to submit a review");let i=await fetch(c.Sn.BOOKS.REVIEWS(e),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(a),"X-API-Key":r},body:JSON.stringify({rating:o,comment:t.trim()})});if(!i.ok){let e=await i.json();throw Error(e.message||"Failed to submit review")}return await i.json()}catch(e){throw console.error("Error submitting book review:",e),e}},m=async e=>{try{let o=localStorage.getItem("token"),t=localStorage.getItem("apiKey");if(!o||!t)throw Error("You must be logged in to delete a review");let a=await fetch("".concat(c.JR,"/reviews/").concat(e),{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(o),"X-API-Key":t}});if(!a.ok){let e=await a.json();throw Error(e.message||"Failed to delete review")}return await a.json()}catch(e){throw console.error("Error deleting review:",e),e}};var _=t(6068),h=t(2695),u=t.n(h);function g(e){let{bookId:o}=e,[t,i]=(0,r.useState)([]),[n,l]=(0,r.useState)(0),[c,h]=(0,r.useState)(""),[g,k]=(0,r.useState)(0),[x,b]=(0,r.useState)(0),[j,f]=(0,r.useState)(0),[B,p]=(0,r.useState)(!0),[N,y]=(0,r.useState)(null),[R,S]=(0,r.useState)(null),[D,C]=(0,r.useState)(!1),[E,I]=(0,r.useState)(!1),[F,O]=(0,r.useState)(!1),[P,T]=(0,r.useState)(!1),[L,K]=(0,r.useState)(0),[U,A]=(0,r.useState)(!1),[H,G]=(0,r.useState)(null),{user:W}=(0,_.h)();(0,r.useEffect)(()=>{(async()=>{try{if(!o){y("Book ID is missing. Cannot load reviews."),p(!1);return}console.log("BookReview: Fetching data for bookId:",o),p(!0);let[e,t]=await Promise.all([d(o),v(o)]);i(e),b(t.averageRating),f(t.reviewCount),y(null)}catch(e){y("Failed to load reviews. Please try again later."),console.error("Error loading review data:",e)}finally{p(!1)}})()},[o]);let Y=e=>new Date(e).toLocaleDateString(void 0,{year:"numeric",month:"long",day:"numeric"}),q=async e=>{if(e.preventDefault(),!o)return void S("Book ID is missing. Cannot submit review.");if(0===n)return void S("Please select a rating");try{C(!0),S(null),console.log("Submitting review for bookId:",o);let e=await w(o,n,c);i([e,...t]);let a=x*j+n,r=j+1;b(a/r),f(r),l(0),h(""),K(0),O(!0),setTimeout(()=>{O(!1)},3e3)}catch(e){S(e.message||"Failed to submit review. Please try again later.")}finally{C(!1)}},Z=e=>{G(e),A(!0)},z=()=>{G(null),A(!1)},V=async()=>{if(H)try{if(I(!0),console.log("Deleting review with ID:",H._id),await m(H._id),i(t.filter(e=>e._id!==H._id)),j>1){let e=x*j-H.rating,o=j-1;b(e/o),f(o)}else b(0),f(0);T(!0),setTimeout(()=>{T(!1)},3e3)}catch(e){console.error("Error deleting review:",e),S(e.message||"Failed to delete review. Please try again later.")}finally{I(!1),A(!1),G(null)}},J=e=>W&&(W.name&&e.userName===W.name||W.username&&e.userName===W.username),M=e=>Array.from({length:5},(e,o)=>o+1).map(o=>(0,a.jsx)("span",{className:u().displayStar,children:e>=o?(0,a.jsx)(s.gt3,{}):(0,a.jsx)(s.wei,{})},o));return B?(0,a.jsx)("div",{className:u().loading,children:"Loading reviews..."}):N?(0,a.jsx)("div",{className:u().error,children:N}):(0,a.jsxs)("div",{className:u().reviewContainer,children:[U&&H&&(0,a.jsx)("div",{className:u().confirmOverlay,children:(0,a.jsxs)("div",{className:u().confirmDialog,children:[(0,a.jsxs)("div",{className:u().confirmHeader,children:[(0,a.jsx)("h4",{children:"Delete Review"}),(0,a.jsx)("button",{onClick:z,className:u().closeButton,"aria-label":"Close",children:(0,a.jsx)(s.QCr,{})})]}),(0,a.jsx)("p",{children:"Are you sure you want to delete your review? This action cannot be undone."}),(0,a.jsxs)("div",{className:u().confirmButtons,children:[(0,a.jsx)("button",{onClick:z,className:u().cancelButton,disabled:E,children:"Cancel"}),(0,a.jsx)("button",{onClick:V,className:u().deleteConfirmButton,disabled:E,children:E?"Deleting...":"Delete"})]})]})}),(0,a.jsx)("h2",{className:u().reviewHeader,children:"Customer Reviews"}),(0,a.jsx)("div",{className:u().reviewSummary,children:(0,a.jsxs)("div",{className:u().averageRating,children:[(0,a.jsx)("span",{className:u().ratingNumber,children:x.toFixed(1)}),(0,a.jsx)("div",{className:u().ratingStars,children:M(x)}),(0,a.jsxs)("span",{className:u().reviewCount,children:["Based on ",j," ",1===j?"review":"reviews"]})]})}),W?(0,a.jsxs)("div",{className:u().reviewForm,children:[(0,a.jsx)("h3",{children:"Write a Review"}),F&&(0,a.jsx)("div",{className:u().success,children:"Your review has been submitted successfully!"}),P&&(0,a.jsx)("div",{className:u().success,children:"Your review has been deleted successfully!"}),R&&(0,a.jsx)("div",{className:u().submitError,children:R}),(0,a.jsxs)("form",{onSubmit:q,children:[(0,a.jsxs)("div",{className:u().ratingSelector,children:[(0,a.jsx)("label",{children:"Your Rating:"}),(0,a.jsx)("div",{className:u().stars,children:Array.from({length:5},(e,o)=>o+1).map(e=>(0,a.jsx)("span",{className:u().ratingStar,onClick:()=>l(e),onMouseEnter:()=>k(e),onMouseLeave:()=>k(0),children:(g||n)>=e?(0,a.jsx)(s.gt3,{}):(0,a.jsx)(s.wei,{})},e))})]}),(0,a.jsxs)("div",{className:u().commentField,children:[(0,a.jsxs)("label",{children:["Your Review: ",(0,a.jsx)("span",{className:u().optional,children:"(optional, max 200 characters)"})]}),(0,a.jsx)("textarea",{value:c,onChange:e=>{let o=e.target.value;o.length<=200&&(h(o),K(o.length))},placeholder:"Share your thoughts about this book (optional)",rows:4,className:u().textarea}),(0,a.jsxs)("div",{className:u().characterCount,children:[L,"/200 characters"]})]}),(0,a.jsx)("button",{type:"submit",className:u().submitButton,disabled:D,children:D?"Submitting...":"Submit Review"})]})]}):(0,a.jsx)("div",{className:u().loginPrompt,children:"Please log in to leave a review."}),(0,a.jsxs)("div",{className:u().reviewsList,children:[(0,a.jsx)("h3",{children:"Recent Reviews"}),0===t.length?(0,a.jsx)("div",{className:u().noReviews,children:"Be the first to review this book!"}):t.map(e=>(0,a.jsxs)("div",{className:u().reviewItem,children:[(0,a.jsxs)("div",{className:u().reviewHeader,children:[(0,a.jsxs)("div",{className:u().reviewerInfo,children:[e.userImage?(0,a.jsx)("img",{src:e.userImage,alt:e.userName,className:u().reviewerImage}):(0,a.jsx)("div",{className:u().reviewerPlaceholder,children:(0,a.jsx)(s.x$1,{})}),(0,a.jsx)("span",{className:u().reviewerName,children:e.userName})]}),(0,a.jsxs)("div",{className:u().reviewMetadata,children:[(0,a.jsxs)("div",{className:u().reviewDate,children:[(0,a.jsx)(s.bfZ,{}),(0,a.jsx)("span",{children:Y(e.createdAt)})]}),J(e)&&(0,a.jsx)("button",{onClick:()=>Z(e),className:u().deleteButton,disabled:E,title:"Delete your review",children:(0,a.jsx)(s.qbC,{})})]})]}),(0,a.jsx)("div",{className:u().reviewRating,children:M(e.rating)}),e.comment&&(0,a.jsx)("div",{className:u().reviewText,children:e.comment})]},e._id))]})]})}var k=t(1759),x=t.n(k);function b(e){let{id:o}=e,[t,n]=(0,r.useState)(null),[d,v]=(0,r.useState)(!0),[w,m]=(0,r.useState)(null),[_,h]=(0,r.useState)(!1),[u,k]=(0,r.useState)(!1);(0,i.useRouter)(),(0,r.useEffect)(()=>{if(o)o?b(o):(m("Book ID is missing"),v(!1));else{let e=window.location.pathname.split("/"),o=e[e.length-1];o?(console.log("Using ID from URL path:",o),b(o)):(m("Book ID is missing"),v(!1))}},[o]);let b=async e=>{try{console.log("BookPage: Fetching details for book ID:",e),v(!0);let o=await fetch(c.Sn.BOOKS.DETAILS(e));if(!o.ok)throw console.error("Book fetch failed with status: ".concat(o.status)),Error("Book not found");let t=await o.json();console.log("Book data received:",t),n(t),m(null)}catch(e){console.error("Error in fetchBook:",e),m("Error loading book details. Please try again later.")}finally{v(!1)}},j=async()=>{let e=o||window.location.pathname.split("/").pop();try{if(!e)return void console.error("Cannot download: Book ID is missing");h(!0),console.log("Downloading book with ID:",e),await fetch(c.Sn.BOOKS.DOWNLOAD(e),{method:"POST"});let o="".concat(t.title.replace(/[^a-zA-Z0-9]/g,"_"),".pdf");try{console.log("Fetching PDF content via backend proxy for book: ".concat(t.title));let a="".concat(c.Sn.BOOKS.PDF_CONTENT(e),"?download=true&counted=true"),r=await fetch(a);if(!r.ok)throw Error("Failed to fetch PDF: ".concat(r.status," ").concat(r.statusText));let i=await r.blob(),s=URL.createObjectURL(i),n=document.createElement("a");n.href=s,n.download=o,n.style.display="none",document.body.appendChild(n),n.click(),document.body.removeChild(n),setTimeout(()=>URL.revokeObjectURL(s),100),console.log("PDF downloaded as: ".concat(o))}catch(t){console.warn("Direct download failed, using fallback:",t);let o="".concat(c.Sn.BOOKS.PDF(e),"?download=true&counted=true");window.open(o,"_blank")}n({...t,downloads:t.downloads+1})}catch(e){console.error("Error downloading book:",e)}finally{h(!1)}},f=async()=>{let e=o||window.location.pathname.split("/").pop();try{if(!e)return void console.error("Cannot view PDF: Book ID is missing");k(!0),console.log("Viewing PDF for book ID:",e);try{let o="".concat(c.Sn.BOOKS.PDF(e),"?counted=true");console.log("Opening PDF for viewing at: ".concat(o)),window.open(o,"_blank")}catch(e){if(console.warn("Error viewing PDF:",e),t.pdfUrl){let e=t.pdfUrl.endsWith(".pdf")?t.pdfUrl:"".concat(t.pdfUrl,".pdf");console.log("Fallback: Opening PDF directly at: ".concat(e)),window.open(e,"_blank")}else throw Error("No PDF URL available for viewing")}}catch(e){console.error("Error viewing PDF:",e)}finally{k(!1)}};return d?(0,a.jsx)("div",{className:x().loading,children:"Loading..."}):w?(0,a.jsxs)("div",{className:x().error,children:[(0,a.jsx)("h2",{children:"Error"}),(0,a.jsx)("p",{children:w}),(0,a.jsxs)(l(),{href:"/search",className:x().backButton,children:[(0,a.jsx)(s.QVr,{})," Back to Search"]})]}):t?(0,a.jsxs)("div",{className:x().container,children:[(0,a.jsxs)(l(),{href:"/search",className:x().backButton,children:[(0,a.jsx)(s.QVr,{})," Back to Search"]}),(0,a.jsxs)("div",{className:x().bookDetailContainer,children:[(0,a.jsxs)("div",{className:x().bookInformation,children:[(0,a.jsx)("div",{className:x().bookCover,children:t.coverImage?(0,a.jsx)("img",{src:t.coverImage,alt:t.title}):(0,a.jsx)("div",{className:x().placeholderCover,children:(0,a.jsx)(s.vd0,{})})}),(0,a.jsxs)("div",{className:x().bookInfo,children:[(0,a.jsx)("h1",{className:x().title,children:t.title}),(0,a.jsxs)("p",{className:x().author,children:["by ",t.author]}),(0,a.jsx)("p",{className:x().category,children:t.category}),(0,a.jsxs)("div",{className:x().stats,children:[(0,a.jsxs)("span",{className:x().stat,children:[(0,a.jsx)(s.Ny1,{})," ",t.views," views"]}),(0,a.jsxs)("span",{className:x().stat,children:[(0,a.jsx)(s.WCW,{})," ",t.downloads," downloads"]}),t.averageRating>0&&(0,a.jsxs)("span",{className:x().stat,children:[(0,a.jsx)(s.gt3,{})," ",t.averageRating.toFixed(1)]})]}),(0,a.jsxs)("div",{className:x().description,children:[(0,a.jsx)("h2",{children:"Description"}),(0,a.jsx)("p",{children:t.description})]}),(0,a.jsxs)("div",{className:x().tags,children:[(0,a.jsx)("h2",{children:"Tags"}),(0,a.jsxs)("div",{className:x().tagList,children:[t.tags&&t.tags.map((e,o)=>(0,a.jsx)("span",{className:x().tag,children:e},o)),(!t.tags||0===t.tags.length)&&(0,a.jsx)("span",{className:x().noTags,children:"No tags"})]})]}),(0,a.jsxs)("div",{className:x().buttonGroup,children:[(0,a.jsxs)("button",{onClick:f,className:x().viewButton,disabled:u,children:[(0,a.jsx)(s.t69,{})," ",u?"Opening...":"View PDF"]}),(0,a.jsxs)("button",{onClick:j,className:x().downloadButton,disabled:_,children:[(0,a.jsx)(s.WCW,{})," ",_?"Downloading...":"Download PDF"]})]})]})]}),(0,a.jsx)(g,{bookId:o})]})]}):(0,a.jsx)("div",{className:x().error,children:"Book not found"})}function j(e){let{id:o}=e,t=(0,i.useParams)(),[s,n]=(0,r.useState)(o);return(0,r.useEffect)(()=>{if(!s&&(null==t?void 0:t.id))console.log("Using ID from client params:",t.id),n(t.id);else if(!s){let e=window.location.pathname.split("/"),o=e[e.length-1];o&&(console.log("Using ID from URL path:",o),n(o))}},[s,t]),(0,a.jsx)(b,{id:s})}},7805:(e,o,t)=>{Promise.resolve().then(t.bind(t,3779))}},e=>{var o=o=>e(e.s=o);e.O(0,[215,711,874,469,441,684,358],()=>o(7805)),_N_E=e.O()}]);