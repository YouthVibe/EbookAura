(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[511],{10255:(e,t,o)=>{"use strict";function r(e){let{moduleIds:t}=e;return null}Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"PreloadChunks",{enumerable:!0,get:function(){return r}}),o(95155),o(47650),o(85744),o(20589)},17828:(e,t,o)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"workAsyncStorageInstance",{enumerable:!0,get:function(){return r}});let r=(0,o(64054).createAsyncLocalStorage)()},28756:(e,t,o)=>{Promise.resolve().then(o.bind(o,62146)),Promise.resolve().then(o.bind(o,10255)),Promise.resolve().then(o.bind(o,89777))},35695:(e,t,o)=>{"use strict";var r=o(18999);o.o(r,"useParams")&&o.d(t,{useParams:function(){return r.useParams}}),o.o(r,"usePathname")&&o.d(t,{usePathname:function(){return r.usePathname}}),o.o(r,"useRouter")&&o.d(t,{useRouter:function(){return r.useRouter}}),o.o(r,"useSearchParams")&&o.d(t,{useSearchParams:function(){return r.useSearchParams}})},36645:(e,t,o)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return n}});let r=o(88229)._(o(67357));function n(e,t){var o;let n={};"function"==typeof e&&(n.loader=e);let a={...n,...t};return(0,r.default)({...a,modules:null==(o=a.loadableGenerated)?void 0:o.modules})}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},55028:(e,t,o)=>{"use strict";o.d(t,{default:()=>n.a});var r=o(36645),n=o.n(r)},56068:(e,t,o)=>{"use strict";o.d(t,{AuthProvider:()=>c,h:()=>u});var r=o(95155),n=o(12115),a=o(35695),s=o(72047);let l=(0,n.createContext)(),i=()=>"ak_"+Array.from(crypto.getRandomValues(new Uint8Array(24))).map(e=>e.toString(16).padStart(2,"0")).join(""),c=e=>{let{children:t}=e,[o,c]=(0,n.useState)(null),[u,d]=(0,n.useState)(!0),[f,h]=(0,n.useState)(!1),g=(0,a.useRouter)(),m=(0,n.useRef)(!1),p=(0,n.useRef)(!1);(0,n.useEffect)(()=>{h(!0),(async()=>{try{let e=localStorage.getItem("userInfo"),t=localStorage.getItem("token");if(localStorage.getItem("apiKey"),e&&t)try{if(c(JSON.parse(e)),!m.current&&!p.current){m.current=!0;try{await (0,s.dw)("/auth/check",{headers:{Authorization:"Bearer ".concat(t)}}),p.current=!0}catch(e){if(console.error("Token validation failed:",e),"localhost"!==window.location.hostname)try{console.log("Retrying token validation..."),await new Promise(e=>setTimeout(e,1e3)),await (0,s.dw)("/auth/check",{headers:{Authorization:"Bearer ".concat(t)}}),p.current=!0}catch(e){console.error("Token validation retry failed:",e),b()}else b()}finally{m.current=!1}}}catch(e){console.error("Failed to parse user info:",e),localStorage.removeItem("userInfo"),localStorage.removeItem("token"),localStorage.removeItem("apiKey")}}finally{d(!1)}})()},[]);let y=e=>{if(console.log("Processing login data"),!e)return void console.error("No user data received for login");try{if(!e.token)return void console.error("No token in login data");let{token:t,...o}=e;console.log("Setting user data:",o),c(o);{localStorage.setItem("userInfo",JSON.stringify(o)),localStorage.setItem("token",t);let e=localStorage.getItem("apiKey");e||(console.log("Generating new API key"),e=i(),localStorage.setItem("apiKey",e)),console.log("Authentication data stored in localStorage")}}catch(e){console.error("Error processing login:",e)}},b=()=>{c(null),localStorage.removeItem("userInfo"),localStorage.removeItem("token"),g.push("/login")},v=()=>localStorage.getItem("token"),S=()=>localStorage.getItem("apiKey"),P=e=>{if(o){let t={...o,coins:e};c(t),localStorage.setItem("userInfo",JSON.stringify(t))}};return f?(0,r.jsx)(l.Provider,{value:{user:o,isLoggedIn:!!o,loading:u,login:y,logout:b,getToken:v,getApiKey:S,updateUserCoins:P},children:t}):(0,r.jsx)(l.Provider,{value:{user:null,isLoggedIn:!1,loading:!0,login:y,logout:b,getToken:v,getApiKey:S,updateUserCoins:P},children:t})},u=()=>{let e=(0,n.useContext)(l);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},62146:(e,t,o)=>{"use strict";function r(e){let{reason:t,children:o}=e;return o}Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"BailoutToCSR",{enumerable:!0,get:function(){return r}}),o(45262)},64054:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),!function(e,t){for(var o in t)Object.defineProperty(e,o,{enumerable:!0,get:t[o]})}(t,{bindSnapshot:function(){return s},createAsyncLocalStorage:function(){return a},createSnapshot:function(){return l}});let o=Object.defineProperty(Error("Invariant: AsyncLocalStorage accessed in runtime where it is not available"),"__NEXT_ERROR_CODE",{value:"E504",enumerable:!1,configurable:!0});class r{disable(){throw o}getStore(){}run(){throw o}exit(){throw o}enterWith(){throw o}static bind(e){return e}}let n="undefined"!=typeof globalThis&&globalThis.AsyncLocalStorage;function a(){return n?new n:new r}function s(e){return n?n.bind(e):r.bind(e)}function l(){return n?n.snapshot():function(e,...t){return e(...t)}}},67357:(e,t,o)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return i}});let r=o(95155),n=o(12115),a=o(62146);function s(e){return{default:e&&"default"in e?e.default:e}}o(10255);let l={loader:()=>Promise.resolve(s(()=>null)),loading:null,ssr:!0},i=function(e){let t={...l,...e},o=(0,n.lazy)(()=>t.loader().then(s)),i=t.loading;function c(e){let s=i?(0,r.jsx)(i,{isLoading:!0,pastDelay:!0,error:null}):null,l=!t.ssr||!!t.loading,c=l?n.Suspense:n.Fragment,u=t.ssr?(0,r.jsxs)(r.Fragment,{children:[null,(0,r.jsx)(o,{...e})]}):(0,r.jsx)(a.BailoutToCSR,{reason:"next/dynamic",children:(0,r.jsx)(o,{...e})});return(0,r.jsx)(c,{...l?{fallback:s}:{},children:u})}return c.displayName="LoadableComponent",c}},72047:(e,t,o)=>{"use strict";async function r(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{let o=e.startsWith("http")?e:"".concat("https://ebookaura.onrender.com/api").concat(e);console.log("API Request: ".concat(t.method||"GET"," ").concat(o)),t.headers||(t.headers={}),!t.body||t.headers["Content-Type"]||t.body instanceof FormData||(t.headers["Content-Type"]="application/json");let r=e.startsWith("/books")&&("GET"===t.method||!t.method)&&!e.includes("/reviews")&&!e.includes("/bookmarks"),n=e.match(/^\/books\/[a-z0-9]+$/i);{let e=localStorage.getItem("token"),o=localStorage.getItem("apiKey");e&&(!r||n)&&!t.headers.Authorization&&(t.headers.Authorization="Bearer ".concat(e)),o&&!t.headers["X-API-Key"]&&(t.headers["X-API-Key"]=o)}let a=await fetch(o,t),s=a.headers.get("content-type");if(!a.ok){if(console.error("API Error (".concat(a.status,"): ").concat(a.statusText)),s&&s.includes("application/json")){let e=await a.json();throw Error(e.message||"API request failed with status ".concat(a.status))}{let e=await a.text();console.error("Non-JSON error response:",e.substring(0,150)+"...");let t="API request failed with status ".concat(a.status);if(e.includes("<title>")&&e.includes("</title>")){let o=e.match(/<title>(.*?)<\/title>/i);o&&o[1]&&(t="Server Error: ".concat(o[1]))}throw Error(t)}}if(s&&s.includes("application/json"))return await a.json();{console.warn("Response is not JSON. Content-Type:",s);let e=await a.text();try{return JSON.parse(e)}catch(e){throw console.error("Failed to parse response as JSON:",e),Error("API response was not valid JSON")}}}catch(e){throw console.error("API request error:",e),e}}async function n(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return r(e,{method:"GET",...t})}async function a(e,t){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return r(e,{method:"POST",body:t instanceof FormData?t:JSON.stringify(t),...o})}async function s(e,t){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return r(e,{method:"PUT",body:JSON.stringify(t),...o})}async function l(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return r(e,{method:"DELETE",...t})}o.d(t,{Xj:()=>a,_5:()=>l,dw:()=>n,q1:()=>s})},85744:(e,t,o)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"workAsyncStorage",{enumerable:!0,get:function(){return r.workAsyncStorageInstance}});let r=o(17828)},89777:(e,t,o)=>{"use strict";o.d(t,{default:()=>c});var r=o(95155),n=o(12115),a=o(35695),s=o(55028),l=o(56068);let i=(0,s.default)(()=>Promise.all([o.e(6215),o.e(6711),o.e(5479),o.e(8087),o.e(6874),o.e(7628),o.e(4677)]).then(o.bind(o,54677)),{loadableGenerated:{webpack:()=>[54677]},ssr:!1,loading:()=>(0,r.jsxs)("div",{className:"loading-container",children:[(0,r.jsx)("div",{className:"loading-spinner"}),(0,r.jsx)("p",{children:"Loading book information..."})]})});function c(e){let{params:t}=e,[o,s]=(0,n.useState)((null==t?void 0:t.id)||""),[c,u]=(0,n.useState)(!0),[d,f]=(0,n.useState)(""),h=(0,a.useParams)(),g=(0,a.usePathname)(),m=(0,a.useRouter)(),{user:p,isLoggedIn:y}=(0,l.h)();return((0,n.useEffect)(()=>{console.log("BookClientWrapper - Auth State:",{isLoggedIn:y,user:p?"exists":"null",userId:null==p?void 0:p.id,coins:null==p?void 0:p.coins})},[p,y]),(0,n.useEffect)(()=>{(()=>{if(null==t?void 0:t.id){if("not-found"===t.id){console.error("Not-found ID detected, showing error UI"),f("Book not found. Please try searching for another book."),u(!1);return}console.log("Using server-provided ID:",t.id),s(t.id),u(!1);return}if(null==h?void 0:h.id){if("not-found"===h.id){console.error("Not-found ID detected, showing error UI"),f("Book not found. Please try searching for another book."),u(!1);return}console.log("Using client params ID:",h.id),s(h.id),u(!1);return}try{let e=g.split("/"),t=e[e.length-1],o=t.endsWith("/")?t.substring(0,t.length-1):t;if(o&&""!==o&&"not-found"!==o)console.log("Using ID extracted from path:",o),s(o);else throw Error("Could not extract valid book ID from path")}catch(e){console.error("Error determining book ID:",e),f("Could not determine which book to display")}finally{u(!1)}})()},[t,h,g,m]),c)?(0,r.jsxs)("div",{className:"loading-container",children:[(0,r.jsx)("div",{className:"loading-spinner"}),(0,r.jsx)("p",{children:"Loading book information..."})]}):d?(0,r.jsxs)("div",{className:"error-container",children:[(0,r.jsx)("h2",{children:"Error"}),(0,r.jsx)("p",{children:d}),(0,r.jsx)("button",{onClick:()=>m.back(),className:"back-button",children:"Go Back"})]}):o&&"not-found"!==o?(0,r.jsx)(i,{id:o}):(0,r.jsxs)("div",{className:"error-container",children:[(0,r.jsx)("h2",{children:"Book Not Found"}),(0,r.jsx)("p",{children:"The requested book could not be found."}),(0,r.jsx)("button",{onClick:()=>m.push("/search"),className:"back-button",children:"Browse Books"})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[8441,1684,7358],()=>t(28756)),_N_E=e.O()}]);