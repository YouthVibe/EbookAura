(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[511],{4299:(o,e,r)=>{Promise.resolve().then(r.t.bind(r,69243,23)),Promise.resolve().then(r.bind(r,62146)),Promise.resolve().then(r.bind(r,10255)),Promise.resolve().then(r.bind(r,89777))},89777:(o,e,r)=>{"use strict";r.d(e,{default:()=>c});var n=r(95155),s=r(12115),i=r(35695),t=r(55028),d=r(56068),l=r(87358);let a=(0,t.default)(()=>Promise.all([r.e(6215),r.e(6711),r.e(5479),r.e(8087),r.e(6874),r.e(7628),r.e(8190)]).then(r.bind(r,13275)),{loadableGenerated:{webpack:()=>[13275]},ssr:!1,loading:()=>(0,n.jsxs)("div",{className:"loading-container",children:[(0,n.jsx)("div",{className:"loading-spinner"}),(0,n.jsx)("p",{children:"Loading book information..."})]})});function c(o){let{params:e}=o,[r,t]=(0,s.useState)((null==e?void 0:e.id)||""),[c,p]=(0,s.useState)(!0),[h,x]=(0,s.useState)(""),[u,g]=(0,s.useState)(""),[b,f]=(0,s.useState)({}),j=(0,i.useParams)(),k=(0,i.usePathname)(),m=(0,i.useRouter)(),{user:v,isLoggedIn:I}=(0,d.h)();return((0,s.useEffect)(()=>{console.log("BookClientWrapper - Auth State:",{isLoggedIn:I,user:v?"exists":"null",userId:null==v?void 0:v.id,coins:null==v?void 0:v.coins}),g("https://ebookaura.onrender.com/api"),console.log("API URL from env:","https://ebookaura.onrender.com/api"),console.log("Static export:",l.env.STATIC_EXPORT),f(o=>({...o,apiUrl:"https://ebookaura.onrender.com/api",staticExport:l.env.STATIC_EXPORT,isServerSide:!1}))},[v,I]),(0,s.useEffect)(()=>{(()=>{if(null==e?void 0:e.id){if("not-found"===e.id){console.error("Not-found ID detected, showing error UI"),x("Book not found. Please try searching for another book."),p(!1);return}console.log("Using server-provided ID:",e.id),t(e.id),p(!1),f(o=>({...o,idSource:"server",id:e.id}));return}if(null==j?void 0:j.id){if("not-found"===j.id){console.error("Not-found ID detected, showing error UI"),x("Book not found. Please try searching for another book."),p(!1);return}console.log("Using client params ID:",j.id),t(j.id),p(!1),f(o=>({...o,idSource:"client",id:j.id}));return}try{let o=k.split("/"),e="";for(let r=0;r<o.length;r++)if("books"===o[r]&&r+1<o.length){e=o[r+1];break}console.log("Path parts:",o),console.log("Raw ID from path:",e);let r=(null==e?void 0:e.endsWith("/"))?e.substring(0,e.length-1):e,n=null==r?void 0:r.split("?")[0];if(console.log("Clean ID after processing:",n),n&&""!==n&&"not-found"!==n&&"undefined"!==n)console.log("Using ID extracted from path:",n),t(n),f(o=>({...o,idSource:"path",id:n}));else throw Error("Could not extract valid book ID from path")}catch(o){console.error("Error determining book ID:",o),x("Could not determine which book to display"),f(e=>({...e,error:o.message}))}finally{p(!1)}})()},[e,j,k,m]),(0,s.useEffect)(()=>{r&&(async()=>{try{let o="/books/".concat(r),e="https://ebookaura.onrender.com/api"+o;console.log("Testing API connectivity to: ".concat(e));let n=await fetch(e),s=n.status;console.log("API connectivity test result: ".concat(s," (").concat(n.statusText,")")),f(o=>({...o,apiTest:{endpoint:e,status:s,timestamp:new Date().toISOString()}})),n.ok||f(o=>({...o,apiError:"API returned status ".concat(s," - ").concat(n.statusText)}))}catch(o){console.error("API connectivity test failed:",o),f(e=>({...e,apiError:o.message}))}})()},[r]),c)?(0,n.jsxs)("div",{className:"loading-container",children:[(0,n.jsx)("div",{className:"loading-spinner"}),(0,n.jsx)("p",{children:"Loading book information..."})]}):h?(0,n.jsxs)("div",{className:"error-container",style:{padding:"20px",maxWidth:"800px",margin:"0 auto",backgroundColor:"#f8f9fa",borderRadius:"8px",boxShadow:"0 2px 4px rgba(0,0,0,0.1)"},children:[(0,n.jsx)("h2",{style:{color:"#dc3545"},children:"Error"}),(0,n.jsx)("p",{children:h}),(0,n.jsxs)("div",{style:{margin:"20px 0",padding:"10px",backgroundColor:"#e9ecef",borderRadius:"4px",fontSize:"14px",display:"block"},children:[(0,n.jsx)("h3",{children:"Debug Information"}),(0,n.jsxs)("p",{children:[(0,n.jsx)("strong",{children:"Current Path:"})," ",k]}),(0,n.jsxs)("p",{children:[(0,n.jsx)("strong",{children:"Server Params ID:"})," ",(null==e?void 0:e.id)||"none"]}),(0,n.jsxs)("p",{children:[(0,n.jsx)("strong",{children:"Client Params ID:"})," ",(null==j?void 0:j.id)||"none"]}),(0,n.jsxs)("p",{children:[(0,n.jsx)("strong",{children:"Extracted Book ID:"})," ",r||"none"]}),(0,n.jsxs)("p",{children:[(0,n.jsx)("strong",{children:"API URL:"})," ",u]}),(0,n.jsxs)("p",{children:[(0,n.jsx)("strong",{children:"Environment:"})," ","production"]}),(0,n.jsxs)("p",{children:[(0,n.jsx)("strong",{children:"Static Export:"})," ",l.env.STATIC_EXPORT||"not set"]}),(0,n.jsxs)("p",{children:[(0,n.jsx)("strong",{children:"API Test:"})," ",JSON.stringify(b.apiTest||{})]}),(0,n.jsxs)("p",{children:[(0,n.jsx)("strong",{children:"API Error:"})," ",b.apiError||"none"]})]}),(0,n.jsxs)("div",{style:{display:"flex",gap:"10px",marginTop:"20px"},children:[(0,n.jsx)("button",{onClick:()=>m.back(),style:{padding:"8px 16px",backgroundColor:"#6c757d",color:"white",border:"none",borderRadius:"4px",cursor:"pointer"},children:"Go Back"}),(0,n.jsx)("button",{onClick:()=>m.push("/search"),style:{padding:"8px 16px",backgroundColor:"#007bff",color:"white",border:"none",borderRadius:"4px",cursor:"pointer"},children:"Browse Books"}),(0,n.jsx)("button",{onClick:()=>window.location.reload(),style:{padding:"8px 16px",backgroundColor:"#28a745",color:"white",border:"none",borderRadius:"4px",cursor:"pointer"},children:"Reload Page"})]})]}):r&&"not-found"!==r?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(a,{id:r}),!1]}):(0,n.jsxs)("div",{className:"error-container",style:{padding:"20px",maxWidth:"800px",margin:"0 auto",backgroundColor:"#f8f9fa",borderRadius:"8px",boxShadow:"0 2px 4px rgba(0,0,0,0.1)"},children:[(0,n.jsx)("h2",{style:{color:"#dc3545"},children:"Book Not Found"}),(0,n.jsx)("p",{children:"The requested book could not be found or the ID is invalid."}),(0,n.jsxs)("div",{style:{margin:"20px 0",padding:"10px",backgroundColor:"#e9ecef",borderRadius:"4px",fontSize:"14px",display:"block"},children:[(0,n.jsx)("h3",{children:"Debug Information"}),(0,n.jsxs)("p",{children:[(0,n.jsx)("strong",{children:"Current Path:"})," ",k]}),(0,n.jsxs)("p",{children:[(0,n.jsx)("strong",{children:"Server Params ID:"})," ",(null==e?void 0:e.id)||"none"]}),(0,n.jsxs)("p",{children:[(0,n.jsx)("strong",{children:"Client Params ID:"})," ",(null==j?void 0:j.id)||"none"]}),(0,n.jsxs)("p",{children:[(0,n.jsx)("strong",{children:"Extracted Book ID:"})," ",r||"none"]}),(0,n.jsxs)("p",{children:[(0,n.jsx)("strong",{children:"API URL:"})," ",u]})]}),(0,n.jsxs)("div",{style:{display:"flex",gap:"10px",marginTop:"20px"},children:[(0,n.jsx)("button",{onClick:()=>m.back(),style:{padding:"8px 16px",backgroundColor:"#6c757d",color:"white",border:"none",borderRadius:"4px",cursor:"pointer"},children:"Go Back"}),(0,n.jsx)("button",{onClick:()=>m.push("/search"),style:{padding:"8px 16px",backgroundColor:"#007bff",color:"white",border:"none",borderRadius:"4px",cursor:"pointer"},children:"Browse Books"})]})]})}}},o=>{var e=e=>o(o.s=e);o.O(0,[7250,6068,8441,1684,7358],()=>e(4299)),_N_E=o.O()}]);