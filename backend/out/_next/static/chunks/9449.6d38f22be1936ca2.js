(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9449],{922:(e,o,t)=>{"use strict";t.d(o,{dC:()=>s,oc:()=>r});let s=()=>{Promise.all([t.e(3309),t.e(6327),t.e(1588)]).then(t.bind(t,91588)).then(e=>{let{pdfjs:o}=e;o.GlobalWorkerOptions.workerSrc="https://unpkg.com/pdfjs-dist@4.8.69/build/pdf.worker.min.mjs",console.log("PDF.js worker initialized with custom version")}).catch(e=>{console.error("Failed to initialize PDF worker:",e)})},r=!0;(()=>{let e=null;return async()=>e||(r?e="https://unpkg.com/pdfjs-dist@4.8.69/build/pdf.worker.min.mjs":null)})()},11228:(e,o,t)=>{"use strict";t.r(o),t.d(o,{default:()=>A});var s=t(95155),r=t(12115),i=t(29911),a=t(6874),n=t.n(a),c=t(35695),l=t(55028),d=t(15305),u=t(12515),h=t(17203);let g=async function(e){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"newest",t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4;try{if(!e)throw Error("Book ID is required");let i=localStorage.getItem("token"),a=localStorage.getItem("apiKey"),n=new URLSearchParams;o&&"my-reviews"!==o?n.append("sort",o):"my-reviews"===o&&n.append("sort","newest"),t&&n.append("rating",t),n.append("page",s.toString()),n.append("limit",r.toString());let c="".concat(h.Sn.BOOKS.REVIEWS(e)).concat(n.toString()?"?"+n.toString():""),l=await fetch(c,{method:"GET",headers:{"Content-Type":"application/json",...i&&{Authorization:"Bearer ".concat(i)},...a&&{"X-API-Key":a}}});if(!l.ok){let e=await l.json();throw Error(e.message||"Failed to fetch reviews")}return await l.json()}catch(e){throw console.error("Error fetching book reviews:",e),e}},p=async e=>{try{if(!e)throw Error("Book ID is required");let o=await fetch(h.Sn.BOOKS.RATING(e));if(!o.ok){let e=await o.json();throw Error(e.message||"Failed to fetch book rating")}return await o.json()}catch(e){throw console.error("Error fetching book rating:",e),e}},m=async function(e,o){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";try{if(!e)throw Error("Book ID is required");if(!o||o<1||o>5)throw Error("Rating must be between 1 and 5");if(t&&t.length>200)throw Error("Review text must be under 200 characters");let s=localStorage.getItem("token");if(!s)throw Error("You must be logged in to submit a review");let r=await fetch(h.Sn.BOOKS.REVIEWS(e),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(s)},body:JSON.stringify({rating:o,comment:t.trim()})});if(!r.ok){let e=await r.json();throw Error(e.message||"Failed to submit review")}return await r.json()}catch(e){throw console.error("Error submitting book review:",e),e}},b=async e=>{try{let o=localStorage.getItem("token");if(!o)throw Error("You must be logged in to delete a review");let t=await fetch("".concat(h.JR,"/reviews/").concat(e),{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(o)}});if(!t.ok){let e=await t.json();throw Error(e.message||"Failed to delete review")}return await t.json()}catch(e){throw console.error("Error deleting review:",e),e}};var v=t(56068),w=t(32695),_=t.n(w);function k(e){let{bookId:o}=e,[t,a]=(0,r.useState)([]),[n,c]=(0,r.useState)(0),[l,h]=(0,r.useState)(""),[w,k]=(0,r.useState)(0),[f,x]=(0,r.useState)(0),[j,y]=(0,r.useState)(0),[S,B]=(0,r.useState)(!0),[N,R]=(0,r.useState)(null),[I,P]=(0,r.useState)(null),[C,E]=(0,r.useState)(!1),[A,D]=(0,r.useState)(!1),[T,F]=(0,r.useState)(!1),[O,L]=(0,r.useState)(!1),[H,U]=(0,r.useState)(0),[z,q]=(0,r.useState)(!1),[Y,M]=(0,r.useState)(null),[K,G]=(0,r.useState)("newest"),[V,W]=(0,r.useState)(null),[J,$]=(0,r.useState)({}),[Z,X]=(0,r.useState)(1),[Q,ee]=(0,r.useState)({page:1,limit:4,totalReviews:0,totalPages:0,hasNextPage:!1,hasPrevPage:!1}),[eo,et]=(0,r.useState)(!1),[es,er]=(0,r.useState)(null),{user:ei}=(0,v.h)();(0,r.useEffect)(()=>{ea()},[o,K,V,Z]);let ea=async()=>{try{if(!o){R("Book ID is missing. Cannot load reviews."),B(!1);return}console.log("BookReview: Fetching data for bookId:",o),B(!0);let[e,t]=await Promise.all([g(o,K,V,Z,4),p(o)]),s=e.reviews||[];if("my-reviews"===K&&ei&&(s=s.filter(e=>ei.name&&e.userName===ei.name||ei.username&&e.userName===ei.username)),a(s),x(t.averageRating),y(t.reviewCount),$(t.ratingDistribution||{}),ei){let e=s.some(e=>ei.name&&e.userName===ei.name||ei.username&&e.userName===ei.username);if(et(e),e){let e=s.find(e=>ei.name&&e.userName===ei.name||ei.username&&e.userName===ei.username);er(e)}}e.pagination&&ee(e.pagination),R(null)}catch(e){R("Failed to load reviews. Please try again later."),console.error("Error loading review data:",e)}finally{B(!1)}},en=e=>new Date(e).toLocaleDateString(void 0,{year:"numeric",month:"long",day:"numeric"}),ec=e=>{G(e),X(1)},el=e=>{V===e?W(null):W(e),X(1)},ed=e=>{e>=1&&e<=Q.totalPages&&X(e)},eu=async e=>{if(e.preventDefault(),!o)return void P("Book ID is missing. Cannot submit review.");if(0===n)return void P("Please select a rating");try{E(!0),P(null),console.log("Submitting review for bookId:",o),await m(o,n,l),X(1),ea(),c(0),h(""),U(0),F(!0),setTimeout(()=>{F(!1)},3e3)}catch(e){P(e.message||"Failed to submit review. Please try again later.")}finally{E(!1)}},eh=e=>{M(e),q(!0)},eg=()=>{M(null),q(!1)},ep=async()=>{if(Y)try{D(!0),console.log("Deleting review with ID:",Y._id),await b(Y._id),ea(),L(!0),setTimeout(()=>{L(!1)},3e3)}catch(e){console.error("Error deleting review:",e),P(e.message||"Failed to delete review. Please try again later.")}finally{D(!1),q(!1),M(null)}},em=e=>ei&&(ei.name&&e.userName===ei.name||ei.username&&e.userName===ei.username),eb=e=>Array.from({length:5},(e,o)=>o+1).map(o=>(0,s.jsx)("span",{className:_().displayStar,children:e>=o?(0,s.jsx)(i.gt3,{}):(0,s.jsx)(i.wei,{})},o));return S?(0,s.jsx)("div",{className:_().loading,children:"Loading reviews..."}):N?(0,s.jsx)("div",{className:_().error,children:N}):(0,s.jsxs)("div",{className:_().reviewContainer,children:[z&&Y&&(0,s.jsx)("div",{className:_().confirmOverlay,children:(0,s.jsxs)("div",{className:_().confirmDialog,children:[(0,s.jsxs)("div",{className:_().confirmHeader,children:[(0,s.jsx)("h4",{children:"Delete Review"}),(0,s.jsx)("button",{onClick:eg,className:_().closeButton,"aria-label":"Close",children:(0,s.jsx)(i.QCr,{})})]}),(0,s.jsx)("p",{children:"Are you sure you want to delete your review? This action cannot be undone."}),(0,s.jsxs)("div",{className:_().confirmButtons,children:[(0,s.jsx)("button",{onClick:eg,className:_().cancelButton,disabled:A,children:"Cancel"}),(0,s.jsx)("button",{onClick:ep,className:_().deleteConfirmButton,disabled:A,children:A?"Deleting...":"Delete"})]})]})}),(0,s.jsx)("div",{className:_().reviewHeader,children:(0,s.jsxs)("div",{className:_().reviewSummary,children:[(0,s.jsxs)("h2",{children:[j," Reviews"]}),(0,s.jsxs)("div",{className:_().totalRating,children:[(0,s.jsxs)("div",{className:_().overallRating,children:[(0,s.jsx)("div",{className:_().ratingValue,children:f.toFixed(1)}),(0,s.jsx)("div",{className:_().ratingStars,children:eb(f)})]}),(0,s.jsx)("div",{className:_().totalBadge,children:(0,s.jsxs)("span",{children:[j," ratings"]})})]})]})}),(0,s.jsxs)("div",{className:_().reviewContent,children:[ei?eo?(0,s.jsxs)("div",{className:_().alreadyReviewed,children:[(0,s.jsx)("h3",{children:"Your Review"}),(0,s.jsxs)("div",{className:_().userReviewBox,children:[(0,s.jsxs)("div",{className:_().userReviewHeader,children:[(0,s.jsxs)("div",{className:_().userReviewRating,children:[eb((null==es?void 0:es.rating)||0),(0,s.jsxs)("span",{className:_().ratingText,children:[(null==es?void 0:es.rating)||0,"/5 stars"]})]}),(0,s.jsxs)("button",{onClick:()=>eh(es),className:_().deleteUserReviewButton,title:"Delete your review",children:[(0,s.jsx)(i.qbC,{})," Delete Review"]})]}),(null==es?void 0:es.comment)&&(0,s.jsxs)("div",{className:_().userReviewComment,children:['"',es.comment,'"']}),(0,s.jsxs)("div",{className:_().userReviewDate,children:["Reviewed on ",en(null==es?void 0:es.createdAt)]})]})]}):(0,s.jsxs)("div",{className:_().reviewForm,children:[(0,s.jsx)("h3",{children:"Write a Review"}),T&&(0,s.jsxs)("div",{className:_().success,children:[(0,s.jsx)(i.A7C,{style:{marginRight:"8px"}}),"Your review has been submitted successfully!"]}),O&&(0,s.jsxs)("div",{className:_().success,children:[(0,s.jsx)(i.A7C,{style:{marginRight:"8px"}}),"Your review has been deleted successfully!"]}),I&&(0,s.jsxs)("div",{className:_().submitError,children:[(0,s.jsx)(i.BS8,{style:{marginRight:"8px"}}),I]}),(0,s.jsxs)("form",{onSubmit:eu,children:[(0,s.jsxs)("div",{className:_().ratingSelector,children:[(0,s.jsx)("label",{htmlFor:"rating-stars",children:"Your Rating:"}),(0,s.jsx)("div",{className:_().stars,id:"rating-stars",role:"group","aria-label":"Select a rating from 1 to 5 stars",children:Array.from({length:5},(e,o)=>o+1).map(e=>(0,s.jsx)("span",{className:_().ratingStar,onClick:()=>c(e),onMouseEnter:()=>k(e),onMouseLeave:()=>k(0),children:(w||n)>=e?(0,s.jsx)(i.gt3,{}):(0,s.jsx)(i.wei,{})},e))}),n>0&&(0,s.jsxs)("div",{className:_().selectedRating,children:["You selected: ",(0,s.jsxs)("strong",{children:[n," ",1===n?"star":"stars"]})]})]}),(0,s.jsxs)("div",{className:_().commentField,children:[(0,s.jsxs)("label",{htmlFor:"review-comment",children:["Your Review: ",(0,s.jsx)("span",{className:_().optional,children:"(optional, max 200 characters)"})]}),(0,s.jsx)("textarea",{id:"review-comment",value:l,onChange:e=>{let o=e.target.value;o.length<=200&&(h(o),U(o.length))},placeholder:"Share your thoughts about this book (optional)",rows:4,className:_().textarea,maxLength:200}),(0,s.jsxs)("div",{className:_().characterCount,children:[H,"/200 characters"]})]}),(0,s.jsx)("button",{type:"submit",className:_().submitButton,disabled:C||0===n,children:C?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:_().spinner}),"Submitting..."]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(i.Cer,{style:{marginRight:"8px"}}),"Submit Review"]})})]})]}):(0,s.jsxs)("div",{className:_().loginPrompt,children:[(0,s.jsx)(i.JhU,{style:{marginRight:"8px",fontSize:"1.2rem"}}),"Please log in to leave a review."]}),(0,s.jsxs)("div",{className:_().reviewsList,children:[(0,s.jsx)("div",{className:_().reviewsHeader,children:(0,s.jsxs)("h3",{children:["Reviews (",j,")"]})}),(0,s.jsx)("div",{className:_().filterSortContainer,children:(0,s.jsxs)("div",{className:_().ratingFilters,children:[(0,s.jsx)("div",{className:_().filtersHeader,children:(0,s.jsxs)("h3",{children:[(0,s.jsx)(u.npS,{style:{color:"#ef4444"}})," ",(0,s.jsx)("span",{children:"Filter & Sort Reviews"})]})}),(V||"newest"!==K)&&(0,s.jsxs)("div",{className:_().activeFilterIndicator,children:[V&&(0,s.jsxs)("div",{className:_().filterBadge,children:[(0,s.jsxs)("div",{className:_().filterBadgeContent,children:[(0,s.jsxs)("strong",{children:[V,"-star"]})," reviews only"]}),(0,s.jsx)("button",{className:_().clearFilterButton,onClick:()=>el(null),"aria-label":"Clear rating filter",title:"Clear rating filter",children:(0,s.jsx)(i.QCr,{})})]}),"newest"!==K&&(0,s.jsx)("div",{className:_().sortBadge,children:(0,s.jsxs)("span",{children:["Sorted by: ",(0,s.jsx)("strong",{children:"highest"===K?"Highest Rated":"lowest"===K?"Lowest Rated":"oldest"===K?"Oldest First":"my-reviews"===K?"My Reviews":"Newest First"})]})})]}),(0,s.jsxs)("div",{className:_().filterOptions,children:[(0,s.jsx)("div",{className:_().filterLabel,children:"Filter by Rating:"}),(0,s.jsxs)("div",{className:_().ratingFilterButtons,children:[(0,s.jsx)("button",{className:"".concat(_().ratingFilterButton," ").concat(null===V?_().activeFilter:""),onClick:()=>el(null),"aria-label":"Show all reviews",title:"Show all reviews",children:"All Ratings"}),[5,4,3,2,1].map(e=>(0,s.jsxs)("button",{className:"".concat(_().ratingFilterButton," ").concat(V===e?_().activeFilter:""),onClick:()=>el(e),"aria-label":"Show only ".concat(e," star reviews"),title:"Show only ".concat(e," star reviews"),children:[(0,s.jsxs)("span",{className:_().filterStars,children:[e," ",(0,s.jsx)(i.gt3,{className:_().filterStar})]}),J&&J[e]>0&&(0,s.jsxs)("span",{className:_().filterCount,children:["(",J[e],")"]})]},e))]})]}),(0,s.jsxs)("div",{className:_().sortOptions,children:[(0,s.jsx)("div",{className:_().filterLabel,children:"Sort Reviews By:"}),(0,s.jsxs)("div",{className:_().sortButtons,children:[(0,s.jsxs)("button",{className:"".concat(_().sortButton," ").concat("newest"===K?_().activeSort:""),onClick:()=>ec("newest"),"aria-label":"Sort by newest reviews first",title:"Sort by newest reviews first",children:[(0,s.jsx)(u.SEk,{})," Newest First"]}),(0,s.jsxs)("button",{className:"".concat(_().sortButton," ").concat("oldest"===K?_().activeSort:""),onClick:()=>ec("oldest"),"aria-label":"Sort by oldest reviews first",title:"Sort by oldest reviews first",children:[(0,s.jsx)(d.NXG,{})," Oldest First"]}),(0,s.jsxs)("button",{className:"".concat(_().sortButton," ").concat("highest"===K?_().activeSort:""),onClick:()=>ec("highest"),"aria-label":"Sort by highest rating first",title:"Sort by highest rating first",children:[(0,s.jsx)(d.sIf,{})," Highest Rated"]}),(0,s.jsxs)("button",{className:"".concat(_().sortButton," ").concat("lowest"===K?_().activeSort:""),onClick:()=>ec("lowest"),"aria-label":"Sort by lowest rating first",title:"Sort by lowest rating first",children:[(0,s.jsx)(d.NXG,{})," Lowest Rated"]}),ei&&(0,s.jsxs)("button",{className:"".concat(_().sortButton," ").concat("my-reviews"===K?_().activeSort:""),onClick:()=>ec("my-reviews"),"aria-label":"Show only my reviews",title:"Show only my reviews",children:[(0,s.jsx)(i.x$1,{})," My Reviews"]})]})]})]})}),0===t.length?(0,s.jsx)("div",{className:_().noReviews,children:V?"No ".concat(V,"-star reviews found. ").concat(j>0?"Try a different filter.":"This book has no reviews yet."):"my-reviews"===K?"You have not reviewed this book yet.":j>0?"No reviews match the current filters.":"Be the first to review this book!"}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:_().activeFilterIndicator,children:[(0,s.jsx)("div",{className:_().reviewCount,children:(0,s.jsx)("span",{children:"my-reviews"===K?"Showing your ".concat(t.length," ").concat(1===t.length?"review":"reviews"):(0,s.jsxs)(s.Fragment,{children:["Showing ",(0,s.jsx)("strong",{children:t.length})," of ",(0,s.jsx)("strong",{children:j})," reviews"]})})}),t.map(e=>(0,s.jsxs)("div",{className:_().reviewItem,children:[(0,s.jsxs)("div",{className:_().reviewHeader,children:[(0,s.jsxs)("div",{className:_().reviewerInfo,children:[e.userImage?(0,s.jsx)("img",{src:e.userImage,alt:e.userName,className:_().reviewerImage}):(0,s.jsx)("div",{className:_().reviewerPlaceholder,children:(0,s.jsx)(i.x$1,{})}),(0,s.jsx)("span",{className:_().reviewerName,children:e.userName})]}),(0,s.jsxs)("div",{className:_().reviewMetadata,children:[(0,s.jsxs)("div",{className:_().reviewDate,children:[(0,s.jsx)(i.bfZ,{}),(0,s.jsx)("span",{children:en(e.createdAt)})]}),em(e)&&(0,s.jsx)("button",{onClick:()=>eh(e),className:_().deleteButton,disabled:A,title:"Delete your review",children:(0,s.jsx)(i.qbC,{})})]})]}),(0,s.jsx)("div",{className:_().reviewRating,children:eb(e.rating)}),e.comment&&(0,s.jsx)("div",{className:_().reviewText,children:e.comment})]},e._id))]}),Q.totalPages<=1?null:(0,s.jsxs)("div",{className:_().pagination,children:[(0,s.jsx)("button",{className:"".concat(_().pageButton," ").concat(Q.hasPrevPage?"":_().disabled),onClick:()=>ed(Z-1),disabled:!Q.hasPrevPage,"aria-label":"Previous page",children:(0,s.jsx)(i._Jj,{})}),(0,s.jsxs)("div",{className:_().pageInfo,children:["Page ",Q.page," of ",Q.totalPages]}),(0,s.jsx)("button",{className:"".concat(_().pageButton," ").concat(Q.hasNextPage?"":_().disabled),onClick:()=>ed(Z+1),disabled:!Q.hasNextPage,"aria-label":"Next page",children:(0,s.jsx)(i.X6T,{})})]})]})]})]})]})}var f=t(71759),x=t.n(f);t(922);var j=t(53116);t(46264);var y=t(38543);function S(e){if(!e||"object"!=typeof e)return e;let o={...e};return o._id&&"object"==typeof o._id&&o._id.$oid&&(o._id=o._id.$oid),"isPremium"in o&&(o.isPremium=!0===o.isPremium||"true"===o.isPremium||1===o.isPremium||"true"===String(o.isPremium).toLowerCase()),"price"in o&&(o.price&&"object"==typeof o.price?o.price.$numberLong?o.price=Number(o.price.$numberLong):o.price.$numberInt&&(o.price=Number(o.price.$numberInt)):o.price=Number(o.price||0)),["createdAt","updatedAt","lastSignInDate","lastCoinReward"].forEach(e=>{o[e]&&("object"==typeof o[e]&&o[e].$date?"object"==typeof o[e].$date&&o[e].$date.$numberLong?o[e]=new Date(Number(o[e].$date.$numberLong)):o[e]=new Date(o[e].$date):"string"==typeof o[e]&&(o[e]=new Date(o[e])))}),["views","downloads","averageRating","pageSize","fileSizeMB","coins"].forEach(e=>{e in o&&("object"==typeof o[e]?o[e].$numberInt?o[e]=Number(o[e].$numberInt):o[e].$numberLong&&(o[e]=Number(o[e].$numberLong)):o[e]=Number(o[e]||0))}),"userHasAccess"in o&&(o.userHasAccess=!0===o.userHasAccess||"true"===o.userHasAccess||1===o.userHasAccess||"true"===String(o.userHasAccess).toLowerCase()),o}t(72047);var B=t(51879);t(78876);var N=t(63554),R=t(87358);let I=(0,l.default)(()=>Promise.all([t.e(5129),t.e(510)]).then(t.bind(t,510)),{loadableGenerated:{webpack:()=>[510]},ssr:!1,loading:()=>(0,s.jsxs)("div",{className:x().loadingContainer,children:[(0,s.jsx)("div",{className:x().loadingSpinner}),(0,s.jsx)("p",{children:"Loading PDF viewer..."})]})}),P={},C=function(e){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3e5,t=Date.now(),s=P[e]||0;return t-s<o?(console.log("Skipping ".concat(e," API call, last call was ").concat((t-s)/1e3,"s ago (min interval: ").concat(o/1e3,"s)")),!1):(P[e]=t,!0)},E=e=>{if(!e)return null;try{let o="string"==typeof e?JSON.parse(e):e,t=S(o);return console.log("Normalized book data:",{title:t.title,author:t.author,id:t._id,isPremium:t.isPremium,price:t.price}),t}catch(o){return console.error("Error parsing MongoDB book data:",o),console.error("Original data:",e),null}};function A(e){let{id:o}=e,[a,l]=(0,r.useState)(null),[d,u]=(0,r.useState)(!0),[g,p]=(0,r.useState)(null),[m,b]=(0,r.useState)(!1),[w,_]=(0,r.useState)(!1),[f,P]=(0,r.useState)(null),[A,D]=(0,r.useState)(!1),[T,F]=(0,r.useState)(!1),[O,L]=(0,r.useState)(!1),[H,U]=(0,r.useState)(!1),[z,q]=(0,r.useState)(null),[Y,M]=(0,r.useState)(null),K=(0,c.useRouter)(),{user:G,isLoggedIn:V,getToken:W,getApiKey:J,updateUserCoins:$}=(0,v.h)(),Z=(0,r.useRef)(!1),X=(0,r.useRef)(!1),Q=(0,r.useRef)(0),ee=(0,r.useRef)(null);(0,r.useEffect)(()=>{if(o&&"string"==typeof o&&o.includes("$oid")){console.log("Detected MongoDB extended JSON format in ID, attempting to parse");try{let e=E(o);if(e&&e._id){console.log("Successfully parsed book data from ID parameter:",e.title),l(e),u(!1);return}}catch(e){console.error("Error parsing book data from ID:",e)}}},[o]);let eo=(0,r.useCallback)(async()=>{if(!o){console.error("Cannot fetch book: ID is missing"),p("Cannot fetch book details: ID is missing"),u(!1);return}if(a&&!d)return void console.log("Book already loaded from parameter data, skipping fetch");if(X.current)return void console.log("Already fetching book data, skipping duplicate request");try{if(console.log("Fetching book with ID: ".concat(o)),u(!0),X.current=!0,"string"==typeof o&&(o.includes("$oid")||o.includes("$numberInt")||o.includes("$date"))){console.log("Potential MongoDB document detected in ID parameter");try{let e=JSON.parse(o);if(e&&e._id){let o=S(e);console.log("Successfully parsed book data:"),console.log("- Title:",o.title),console.log("- Author:",o.author),console.log("- ID:",o._id),l(o),u(!1),X.current=!1;return}}catch(e){console.log("Not a valid JSON document, proceeding with normal fetch")}}let e=o.replace(/['"{}]/g,""),t=h.Sn.BOOKS.DETAILS(e);console.log("Fetching from API endpoint: ".concat(t));let s={};if(V){let e=await W();e&&(s.Authorization="Bearer ".concat(e));let o=await J();o&&(s["X-API-Key"]=o)}let r=await fetch(t,{headers:s});if(!r.ok){let o="API Error ".concat(r.status," (").concat(r.statusText,")");console.error(o);let t="";try{t=(await r.json()).message||""}catch(e){t=await r.text()}404===r.status?p("Book not found (ID: ".concat(e,")")):p("Error loading book: ".concat(o,". ").concat(t)),u(!1),X.current=!1;return}let i=await r.json();M(JSON.stringify(i,null,2)),console.log("API Response:",i);let a=S(i);console.log("Normalized book data:",{title:a.title,author:a.author,isPremium:a.isPremium,price:a.price}),l(a),p(null)}catch(e){console.error("Error fetching book:",e),p("Failed to load book details: ".concat(e.message))}finally{u(!1),X.current=!1}},[o,V,W,J,a,d]);(0,r.useEffect)(()=>{eo()},[eo]),(0,r.useEffect)(()=>{{new URLSearchParams(window.location.search).has("debug")&&(F(!0),console.log("DEBUG MODE ENABLED VIA URL"));let e=[],o=[17,16,80,17,16,80],t=t=>{e.push(t.keyCode),e.length>o.length&&e.shift(),e.join("")===o.join("")&&(F(e=>!e),console.log("DEBUG MODE TOGGLED VIA KEY SEQUENCE"),e=[])};return window.addEventListener("keydown",t),()=>{window.removeEventListener("keydown",t)}}},[]);let et=!!a&&(!0===a.isPremium||"true"===a.isPremium||1===a.isPremium||"true"===String(a.isPremium).toLowerCase()||a.price&&Number(a.price)>0),es=!!a&&(!0===a.userHasAccess||"true"===a.userHasAccess||1===a.userHasAccess||"true"===String(a.userHasAccess).toLowerCase()),er=es||A,ei=!et||A;G&&a&&(G.coins,a.price);let ea=a?a.price?Number(a.price):25*!!et:0,en=(0,r.useCallback)(async()=>{if(!o)return void console.log("Cannot check purchase status: Book ID is missing");if(!et)return void console.log("Skipping purchase check for non-premium book");if(!V)return void console.log("Skipping purchase check - user not logged in");if(A)return void console.log("User already has access through subscription, skipping purchase check");if(X.current)return void console.log("Already fetching data, skipping duplicate purchase check");if(C("checkPurchase_"+o,3e5)){try{let e=localStorage.getItem("purchaseCheckData_"+o);if(e){let o=JSON.parse(e),t=new Date(o.timestamp),s=new Date,r=new Date(s.getTime()-3e5);if(t>r&&(console.log("Using cached purchase data from",t),o.hasPurchased)){console.log("Cached data indicates user has purchased this book"),l(e=>({...e,userHasAccess:!0}));return}}}catch(e){console.error("Error checking cached purchase data:",e)}console.log("Checking purchase status for book ID: ".concat(o));try{if(X.current=!0,a&&!0===a.userHasAccess){console.log("Book already marked as purchased in local state"),l(e=>({...e,userHasAccess:!0}));return}console.log("Calling API to verify purchase status...");let e=await (0,j.PZ)(o);try{localStorage.setItem("purchaseCheckData_"+o,JSON.stringify({hasPurchased:(null==e?void 0:e.success)&&(null==e?void 0:e.hasPurchased)===!0,timestamp:new Date().toISOString()}))}catch(e){console.error("Error caching purchase data:",e)}if(console.log("Purchase check API response:",e),e&&e.success){let o=e.hasPurchased;console.log("API confirms user ".concat(o?"has":"has not"," purchased this book")),l(e=>({...e,userHasAccess:o})),o&&l(e=>({...e,userHasAccess:!0}))}else console.warn("Purchase check API returned success:false or invalid response")}catch(e){console.error("Error checking book purchase status:",e);try{let e=localStorage.getItem("userInfo");if(e){let t=JSON.parse(e);if(t.purchasedBooks&&Array.isArray(t.purchasedBooks)){let e=t.purchasedBooks.includes(o);console.log("Fallback: Local storage indicates user ".concat(e?"has":"has not"," purchased this book")),e&&l(e=>({...e,userHasAccess:!0}))}}}catch(e){console.error("Error checking local storage for purchase status:",e)}}finally{X.current=!1}}},[V,o,et,a,A,l]),ec=(0,r.useCallback)(async()=>{if(!V)return console.log("Skipping subscription check - user not logged in"),D(!1),!1;try{if(console.log("Checking subscription status for premium book access"),L(!0),X.current)return console.log("Already fetching data, skipping duplicate subscription check"),A;if(!C("checkSubscription",6e4))return A;markApiCallTime("checkSubscription"),X.current=!0;let{getCurrentSubscription:e}=await Promise.resolve().then(t.bind(t,46264)),s=await e();console.log("Subscription check response:",s);let r=!!(s&&s.success&&s.active);return D(r),r?(console.log("User has active subscription with access to premium books"),l(e=>({...e,userHasAccess:!0})),localStorage.setItem("subscription_".concat(o),JSON.stringify({hasSubscription:!0,timestamp:new Date().getTime()}))):(console.log("User does not have an active subscription with premium access"),es||l(e=>({...e,userHasAccess:!1})),localStorage.setItem("subscription_".concat(o),JSON.stringify({hasSubscription:!1,timestamp:new Date().getTime()}))),r}catch(e){return console.error("Error checking subscription status:",e),D(!1),!1}finally{L(!1),X.current=!1}},[V,o,es]),el=(0,r.useCallback)(async e=>{if(!e)return console.error("No API key provided for subscription check"),!1;try{if(console.log("Checking subscription status using API key"),L(!0),X.current)return console.log("Already fetching data, skipping duplicate API key subscription check"),A;X.current=!0;let{checkSubscriptionWithApiKey:o}=await Promise.resolve().then(t.bind(t,46264)),s=await o(e);if(console.log("API key subscription check response:",s),s&&s.success&&s.active)return console.log("API key has access to premium content through active subscription"),D(!0),l(e=>({...e,userHasAccess:!0})),!0;return console.log("API key does not have an active subscription with premium access"),!1}catch(e){return console.error("Error checking subscription status with API key:",e),!1}finally{L(!1),X.current=!1}},[o]);(0,r.useEffect)(()=>{if(V&&et&&!H){if(es)return void console.log("User already has access through purchase, not setting up subscription checker");console.log("Starting subscription checker...");let e=!1;try{let o=localStorage.getItem("subscriptionCheckData");if(o){let t=JSON.parse(o),s=new Date(t.timestamp),r=new Date,i=new Date(r.getTime()-3e5);s>i&&(console.log("Using cached subscription data for initial check"),e=!0,t.hasSubscription&&(D(!0),l(e=>({...e,userHasAccess:!0}))))}}catch(e){console.error("Error checking cached subscription data:",e)}e||ec(),U(!0)}return()=>{ee.current&&(console.log("Clearing subscription checker..."),clearInterval(ee.current),ee.current=null,U(!1))}},[V,et,ec,H,es]),(0,r.useEffect)(()=>{V&&o&&et&&en()},[V,o,et,en]),(0,r.useEffect)(()=>{V&&!Z.current&&(console.log("User just logged in - checking subscription status"),ec()),Z.current=V},[V,ec]),(0,r.useEffect)(()=>{V&&ec()},[V,ec]);let ed=async()=>{if(!a||!o)return void console.error("Cannot download: Book data or ID is missing");if(et){let e=new URLSearchParams(window.location.search).get("apiKey"),o=!1;if((A||er)&&(o=!0,console.log("User has subscription or has purchased the book, allowing download")),!o&&e)try{await el(e)&&(o=!0,console.log("API key has valid subscription, allowing download"))}catch(e){console.error("Error verifying subscription with API key:",e)}if(!o)if(V){q("You need an active subscription to download this premium book."),y.oR.error("Subscription required to download premium books",{position:"top-center",autoClose:3e3});return}else{q("You need to log in and subscribe to download this premium book."),K.push("/login");return}}try{b(!0),console.log("Downloading book with ID:",o);let e={"Content-Type":"application/json"},t=new URLSearchParams(window.location.search).get("apiKey");if(a.isPremium)if(t)e["X-API-Key"]=t,console.log("Using API key from URL parameter for download");else{let o=W(),t=J();o&&(e.Authorization="Bearer ".concat(o),console.log("Using auth token for PDF download")),t&&(e["X-API-Key"]=t,console.log("Using stored API key for download"))}try{await fetch(h.Sn.BOOKS.DOWNLOAD(o),{method:"POST",headers:e})}catch(e){console.warn("Failed to record download count, but continuing download:",e)}let s=a.pdfUrl&&a.pdfUrl.toLowerCase().endsWith(".zip"),r="".concat(a.title.replace(/[^a-zA-Z0-9]/g,"_")).concat(s?".zip":".pdf");try{console.log("Fetching ".concat(s?"ZIP":"PDF"," content via backend proxy for book: ").concat(a.title));let t="".concat(h.Sn.BOOKS.PDF_CONTENT(o),"?download=true&counted=true"),i=await fetch(t,{headers:e});if(!i.ok){if(401===i.status||403===i.status){let e;try{e=await i.json()}catch(o){e={message:"Authentication error",isPremium:et,requiresSubscription:!0}}if(console.error("Error response from server:",e),e.isPremium&&e.requiresSubscription)throw q(e.message||"You need an active subscription to download this premium book."),y.oR.error("Subscription required for download",{position:"top-center",autoClose:3e3}),V||setTimeout(()=>K.push("/login"),1500),Error("Premium content requires subscription for downloads");if(e.isPremium)throw q(e.message||"This is premium content. Please log in to access it."),Error("Premium content requires authentication")}throw Error("Failed to fetch PDF: ".concat(i.status," ").concat(i.statusText))}let n=await i.blob(),c=URL.createObjectURL(n),l=document.createElement("a");l.href=c,l.download=r,document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(c);let d={success:!0};if(!d.success)throw Error(d.error||"Download failed");console.log("PDF downloaded as: ".concat(r)),y.oR.success("Download successful!",{position:"top-center",autoClose:2e3})}catch(e){if(console.warn("Direct download failed, using fallback:",e),y.oR.info("Trying alternative download method...",{position:"top-center",autoClose:2e3}),e.message.includes("subscription"))return;try{let e="".concat(h.Sn.BOOKS.PDF(o),"?download=true&counted=true");window.open(e,"_blank")}catch(e){console.error("Fallback download also failed:",e),y.oR.error("Download failed. Please try again later.",{position:"top-center",autoClose:3e3})}}l(e=>({...e,downloads:(e.downloads||0)+1}))}catch(e){console.error("Error downloading book:",e),e.message.includes("subscription")||e.message.includes("Premium content")||y.oR.error("Download failed. Please try again later.",{position:"top-center",autoClose:3e3})}finally{b(!1)}},eu=(0,r.useCallback)(async()=>{if(!V||!G)return void console.log("Cannot refresh coins: User not logged in");let e=Date.now(),o=e-Q.current;if(o<5e3)return void console.log("Skipping coin refresh - last refresh was ".concat(o,"ms ago (< 5000ms)"));Q.current=e,console.log("Refreshing user coin balance...");try{let{getUserCoins:e}=await Promise.resolve().then(t.bind(t,53116)),o=await e();o&&"number"==typeof o.coins&&(console.log("Updating user coins from ".concat(G.coins," to ").concat(o.coins)),$(o.coins))}catch(e){console.error("Error refreshing coin balance:",e)}},[V,G,$]);return((0,r.useEffect)(()=>{V&&et&&(console.log("Component mounted or premium status changed - refreshing coin balance"),eu())},[V,et,eu]),(0,r.useEffect)(()=>{if(!o){console.error("BookPageClient: Book ID is missing or undefined"),p("Book ID is missing. Please go back and try again."),u(!1);return}let e=!0;!1===d&&(e=V&&!Z.current||!a,V&&!Z.current&&(console.log("User just logged in - refreshing coin balance"),eu())),Z.current=V,e&&setTimeout(()=>eo(),50)},[o,V,G,eu]),(0,r.useEffect)(()=>()=>{f&&"string"==typeof f&&f.startsWith("blob:")&&(URL.revokeObjectURL(f),console.log("Cleaned up blob URL:",f))},[f]),(0,r.useEffect)(()=>{if(V&&et){console.log("Component mounted - checking cached data and auth state");try{let e=localStorage.getItem("subscriptionCheckData");if(e)try{let o=JSON.parse(e),t=new Date(o.timestamp),s=new Date,r=new Date(s.getTime()-6e4);t>r&&o.hasSubscription?(console.log("Using fresh cached subscription data on initial mount"),D(!0),l(e=>({...e,userHasAccess:!0}))):console.log("Cached subscription data is not fresh enough or inactive")}catch(e){console.error("Error parsing cached subscription data:",e)}let t=localStorage.getItem("purchaseCheckData_"+o);if(t)try{JSON.parse(t).hasPurchased&&(console.log("Using cached purchase data on initial mount"),l(e=>({...e,userHasAccess:!0})))}catch(e){console.error("Error parsing cached purchase data:",e)}}catch(e){console.error("Error checking cached data on mount:",e)}setTimeout(()=>{ec()},300)}},[V,et,o,ec]),d)?(0,s.jsxs)("div",{className:x().loadingContainer,children:[(0,s.jsx)("div",{className:x().loadingSpinner}),(0,s.jsx)("p",{children:"Loading book details..."})]}):g?(0,s.jsxs)("div",{className:x().errorContainer,children:[(0,s.jsx)("h2",{children:"Error Loading Book"}),(0,s.jsx)("p",{children:g}),(0,s.jsxs)("div",{className:x().buttonRow,children:[(0,s.jsxs)("button",{onClick:()=>K.back(),className:x().backButton,children:[(0,s.jsx)(i.QVr,{className:x().buttonIcon})," Go Back"]}),(0,s.jsx)("button",{onClick:()=>{p(null),u(!0),eo()},className:x().retryButton,children:"Try Again"})]}),T&&(0,s.jsxs)("div",{className:x().debugPanel,children:[(0,s.jsx)("h3",{children:"Debug Information"}),(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{children:"Book ID:"})," ",o]}),(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{children:"API URL:"})," ","https://ebookaura.onrender.com/api"]}),(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{children:"Static Export:"})," ",R.env.STATIC_EXPORT||"not set"]}),Y&&(0,s.jsxs)("details",{children:[(0,s.jsx)("summary",{children:"Raw API Response"}),(0,s.jsx)("pre",{style:{maxHeight:"200px",overflow:"auto",background:"#f8f9fa",padding:"10px",borderRadius:"4px",fontSize:"12px"},children:Y})]})]})]}):a?(0,s.jsxs)("div",{className:x().bookContainer,children:[(0,s.jsx)(B.A,{}),(0,s.jsx)(N.default,{src:"https://pl27076804.profitableratecpm.com/3c/da/7a/3cda7a41ea4dd11feec8917043373eb3.js",strategy:"afterInteractive"}),(0,s.jsxs)("div",{className:x().header,children:[(0,s.jsxs)(n(),{href:"/search",className:x().backButton,children:[(0,s.jsx)(i.QVr,{})," Back to Search"]}),(0,s.jsx)("button",{onClick:()=>F(!0),style:{display:"none",marginLeft:"10px",padding:"8px 15px",background:"#5b89ff",color:"white",border:"none",borderRadius:"4px",cursor:"pointer"},className:x().debugButton,children:et?"✓ Premium Book":"Debug Premium"})]}),(0,s.jsxs)("div",{className:x().bookDetailContainer,children:[(0,s.jsxs)("div",{className:x().bookInformation,children:[(0,s.jsxs)("div",{className:x().bookCover,children:[a.coverImage?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("img",{src:a.coverImage,alt:a.title}),(et||(null==a?void 0:a.price)>0)&&(0,s.jsx)("div",{className:x().premiumOverlay,children:(0,s.jsx)(i.JhU,{className:x().lockIcon})})]}):(0,s.jsxs)("div",{className:x().placeholderCover,children:[(0,s.jsx)(i.vd0,{}),(et||(null==a?void 0:a.price)>0)&&(0,s.jsx)(i.JhU,{className:x().lockIconPlaceholder})]}),(et||(null==a?void 0:a.price)>0)&&(0,s.jsxs)("div",{className:x().premiumBadge,children:[(0,s.jsx)(i.Hu1,{className:x().crownIcon})," Premium"]})]}),(0,s.jsxs)("div",{className:x().bookInfo,children:[(0,s.jsx)("h1",{className:x().title,children:a.title}),(0,s.jsxs)("p",{className:x().author,children:["by ",a.author]}),(0,s.jsxs)("div",{className:x().categoryInfo,children:[(0,s.jsx)("p",{className:x().category,children:a.category}),(et||(null==a?void 0:a.price)>0)&&(0,s.jsxs)("span",{className:x().premiumTag,children:[(0,s.jsx)(i.Hu1,{className:x().premiumIcon})," Premium"]})]}),(0,s.jsxs)("div",{className:x().stats,children:[(0,s.jsxs)("span",{className:x().stat,children:[(0,s.jsx)(i.Ny1,{})," ",a.views," views"]}),(0,s.jsxs)("span",{className:x().stat,children:[(0,s.jsx)(i.WCW,{})," ",a.downloads," downloads"]}),a.averageRating>0&&(0,s.jsxs)("span",{className:x().stat,children:[(0,s.jsx)(i.gt3,{})," ",a.averageRating.toFixed(1)]}),a.pageSize>0&&(0,s.jsxs)("span",{className:x().stat,children:[(0,s.jsx)(i.t69,{})," ",a.pageSize," pages"]}),a.fileSizeMB>0&&(0,s.jsxs)("span",{className:x().stat,children:[(0,s.jsx)(i.t69,{})," ",a.fileSizeMB," MB"]})]}),(0,s.jsxs)("div",{className:x().description,children:[(0,s.jsx)("h2",{children:"Description"}),(0,s.jsx)("p",{children:a.description})]}),(0,s.jsxs)("div",{className:x().tags,children:[(0,s.jsx)("h2",{children:"Tags"}),(0,s.jsxs)("div",{className:x().tagList,children:[a.tags&&a.tags.map((e,o)=>(0,s.jsx)("span",{className:x().tag,children:e},o)),(!a.tags||0===a.tags.length)&&(0,s.jsx)("span",{className:x().noTags,children:"No tags"})]})]}),(et||(null==a?void 0:a.price)>0)&&(0,s.jsxs)("div",{className:x().premiumPurchaseContainer,children:[T&&(0,s.jsxs)("div",{style:{display:T?"block":"none",marginTop:"20px",padding:"15px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:"5px",fontSize:"0.85rem"},children:[(0,s.jsx)("h3",{children:"Book Status Debug Information"}),(0,s.jsxs)("ul",{style:{listStyleType:"none",padding:0},children:[(0,s.jsxs)("li",{children:[(0,s.jsx)("strong",{children:"Book ID:"})," ",o]}),(0,s.jsxs)("li",{children:[(0,s.jsx)("strong",{children:"Title:"})," ",null==a?void 0:a.title]}),(0,s.jsxs)("li",{children:[(0,s.jsx)("strong",{children:"Raw isPremium:"})," ",String(null==a?void 0:a.isPremium)]}),(0,s.jsxs)("li",{children:[(0,s.jsx)("strong",{children:"Raw price:"})," ",String(null==a?void 0:a.price)]}),(0,s.jsxs)("li",{children:[(0,s.jsx)("strong",{children:"isPremium type:"})," ",typeof(null==a?void 0:a.isPremium)]}),(0,s.jsxs)("li",{children:[(0,s.jsx)("strong",{children:"price type:"})," ",typeof(null==a?void 0:a.price)]}),(0,s.jsxs)("li",{children:[(0,s.jsx)("strong",{children:"Computed isPremiumBook:"})," ",String(et)]}),(0,s.jsxs)("li",{children:[(0,s.jsx)("strong",{children:"Premium Status:"})," ",et?"Premium Book":"Free Book"]}),(0,s.jsxs)("li",{children:[(0,s.jsx)("strong",{children:"Has Subscription:"})," ",A?"Yes":"No"]}),(0,s.jsxs)("li",{children:[(0,s.jsx)("strong",{children:"Is Logged In:"})," ",V?"Yes":"No"]})]}),(0,s.jsxs)("div",{style:{marginTop:"15px",display:"flex",gap:"10px"},children:[(0,s.jsx)("button",{onClick:()=>F(!1),style:{background:"#dc3545",color:"white",border:"none",padding:"5px 10px",borderRadius:"4px",cursor:"pointer"},children:"Hide Debug Info"}),(0,s.jsx)("button",{onClick:()=>{eo()},style:{background:"#28a745",color:"white",border:"none",padding:"5px 10px",borderRadius:"4px",cursor:"pointer"},children:"Refresh Book Data"})]})]}),!T&&(0,s.jsx)("button",{onClick:()=>F(!0),style:{display:"none",background:"#007bff",color:"white",border:"none",padding:"5px 10px",borderRadius:"4px",cursor:"pointer",fontSize:"0.75rem",marginBottom:"10px"},children:"Show Debug Info"}),(0,s.jsxs)("div",{className:x().premiumLabel,children:[(0,s.jsx)(i.Hu1,{className:x().crownIcon})," Premium Book"]}),V&&A&&(0,s.jsxs)("div",{className:x().subscriptionAccess,children:[(0,s.jsx)(i.A7C,{className:x().checkIcon}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:x().accessTitle,children:"Premium Access"}),(0,s.jsx)("div",{className:x().accessText,children:"You have access to this book through your active subscription."})]})]}),console.log("hasSubscription",A),V&&!A&&(0,s.jsxs)("div",{className:x().subscriptionRequired,children:[(0,s.jsxs)("div",{className:x().subscriptionMessage,children:[(0,s.jsx)(i.Hu1,{className:x().crownIcon}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:x().subscriptionTitle,children:"Subscription Required"}),(0,s.jsx)("div",{className:x().subscriptionText,children:"This premium book is only available to subscribers. Subscribe to access all premium books."})]})]}),(0,s.jsxs)(n(),{href:"/plans",className:x().subscribeButton,children:[(0,s.jsx)(i.Hu1,{className:x().buttonCrownIcon}),"Subscribe Now"]})]}),!V&&(0,s.jsxs)("div",{className:x().loginRequired,children:[(0,s.jsx)("div",{className:x().loginMessage,children:"This premium book requires a subscription. Please log in to access with your subscription or to subscribe."}),(0,s.jsxs)("div",{className:x().loginButtons,children:[(0,s.jsxs)(n(),{href:"/login",className:x().loginButton,children:[(0,s.jsx)(i.x$1,{className:x().userIcon})," Log In"]}),(0,s.jsxs)(n(),{href:"/signup",className:x().signupButton,children:[(0,s.jsx)(i.NPy,{className:x().userPlusIcon})," Sign Up"]})]})]})]}),(0,s.jsx)("div",{className:x().actions,children:(0,s.jsxs)("button",{onClick:()=>{window.open("https://www.profitableratecpm.com/tv0ps1rfet?key=a753be44cf1e6c5a853397fa67fe886c","_blank"),setTimeout(()=>{ed()},1e3)},className:"".concat(x().downloadButton," ").concat(ei?"":x().disabledButton),disabled:m||!ei,children:[(0,s.jsx)(i.WCW,{})," ",m?"Downloading...":"Download PDF"]})})]})]}),(0,s.jsx)(k,{bookId:o})]}),w&&f&&(0,s.jsx)(I,{pdfUrl:f,onClose:()=>{f&&"string"==typeof f&&f.startsWith("blob:")&&URL.revokeObjectURL(f),_(!1),P(null),console.log("PDF viewer closed and resources cleaned up")},title:a.title,allowDownload:!0,onDownload:ed}),V&&T&&(0,s.jsxs)("div",{className:x().debugSection,style:{margin:"10px 0",padding:"10px",background:"#f8f9fa",borderRadius:"4px"},children:[(0,s.jsx)("strong",{children:"Debug Info:"}),(0,s.jsxs)("div",{children:["Premium Book: ",et?"Yes":"No"]}),(0,s.jsxs)("div",{children:["Price: ",ea," coins"]}),(0,s.jsxs)("div",{children:["User Purchased: ",er?"Yes":"No"]}),(0,s.jsxs)("div",{children:["Has Subscription: ",A?"Yes":"No"]}),(0,s.jsxs)("div",{children:["Has Access: ",er?"Yes":"No"]})]}),V&&et&&A&&(0,s.jsxs)("div",{className:"".concat(x().subscriptionNotice," ").concat(x().accessNotice),style:{margin:"10px 0",padding:"15px",background:"#e9f7ff",borderRadius:"8px",border:"1px solid #4c9aff",display:"flex",alignItems:"center",gap:"10px",boxShadow:"0 2px 4px rgba(0,0,0,0.05)",fontWeight:"500"},children:[(0,s.jsx)(i.Hu1,{style:{color:"#ffd700",fontSize:"24px"}}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{style:{fontWeight:"bold",marginBottom:"4px"},children:"Premium Access"}),(0,s.jsx)("span",{children:"You have access to this book through your active subscription. Enjoy reading!"})]})]}),T&&(0,s.jsxs)("div",{style:{position:"fixed",bottom:"10px",right:"10px",background:"rgba(0,0,0,0.7)",color:"white",padding:"8px 12px",borderRadius:"4px",fontSize:"12px",zIndex:9999,maxWidth:"300px"},children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("strong",{children:"API Status:"})," ",X.current?"\uD83D\uDD04 Fetching...":"✅ Idle"]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("strong",{children:"Book Premium:"})," ",et?"✅ Yes":"❌ No"]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("strong",{children:"Access:"})," ",er?"✅ Yes":"❌ No"]}),er&&(0,s.jsxs)("div",{children:[(0,s.jsx)("strong",{children:"Access Type:"})," ",A?"\uD83D\uDD11 Subscription":"\uD83D\uDCB0 Purchased"]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("strong",{children:"Subscription Check:"})," ",O?"\uD83D\uDD04 Active":"⏹️ Inactive"]})]}),et&&!A&&(0,s.jsxs)("div",{className:x().subscriptionNotice,style:{margin:"10px 0",padding:"15px",background:"#fff6e6",borderRadius:"8px",border:"1px solid #ffe0b2",display:"flex",alignItems:"center",gap:"10px",boxShadow:"0 2px 4px rgba(0,0,0,0.05)",fontWeight:"500"},children:[(0,s.jsx)(i.WCW,{style:{color:"#e65100",fontSize:"24px"}}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{style:{fontWeight:"bold",marginBottom:"4px"},children:"Download Requires Subscription"}),(0,s.jsxs)("span",{children:["You can view this premium PDF, but you need an active subscription to download it. ",!V&&"Please log in and subscribe to download.",V&&(0,s.jsx)(n(),{href:"/plans",style:{color:"#0070f3",fontWeight:"bold",marginLeft:"6px"},children:"Subscribe Now"})]})]})]}),T?(0,s.jsx)("div",{style:{position:"fixed",bottom:"10px",right:"10px",zIndex:1e3,backgroundColor:"#f8f9fa",padding:"5px 10px",borderRadius:"4px",boxShadow:"0 2px 4px rgba(0,0,0,0.1)",fontSize:"12px"},children:(0,s.jsxs)("details",{children:[(0,s.jsx)("summary",{style:{cursor:"pointer",fontWeight:"bold"},children:"Book Data Debug"}),(0,s.jsxs)("div",{style:{maxWidth:"400px",maxHeight:"500px",overflowX:"auto",overflowY:"auto"},children:[(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{children:"Title:"})," ",(null==a?void 0:a.title)||"N/A"]}),(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{children:"Author:"})," ",(null==a?void 0:a.author)||"N/A"]}),(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{children:"ID:"})," ",(null==a?void 0:a._id)||"N/A"]}),(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{children:"Is Premium:"})," ",String(et)]}),(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{children:"Price:"})," ",(null==a?void 0:a.price)||0," coins"]}),(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{children:"Cover Image:"})," ",(null==a?void 0:a.coverImage)?"Yes":"No"]}),(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{children:"PDF URL:"})," ",(null==a?void 0:a.pdfUrl)?"Yes":"No"]}),(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{children:"Has Access:"})," ",String(er)]}),(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{children:"Has Subscription:"})," ",String(A)]}),(0,s.jsxs)("div",{style:{marginTop:"10px"},children:[(0,s.jsx)("button",{onClick:()=>{console.log("Full book data:",a),alert("Book data logged to console")},style:{padding:"5px 10px",background:"#007bff",color:"white",border:"none",borderRadius:"4px",cursor:"pointer",fontSize:"12px",marginRight:"5px"},children:"Log Book Data"}),(0,s.jsx)("button",{onClick:()=>{u(!0),eo()},style:{padding:"5px 10px",background:"#28a745",color:"white",border:"none",borderRadius:"4px",cursor:"pointer",fontSize:"12px"},children:"Refresh Data"})]})]})]})}):null]}):(0,s.jsxs)("div",{className:x().errorContainer,children:[(0,s.jsx)("h2",{children:"Book Not Found"}),(0,s.jsx)("p",{children:"The requested book information could not be loaded."}),(0,s.jsxs)("div",{className:x().buttonRow,children:[(0,s.jsxs)("button",{onClick:()=>K.back(),className:x().backButton,children:[(0,s.jsx)(i.QVr,{className:x().buttonIcon})," Go Back"]}),(0,s.jsx)("button",{onClick:()=>{u(!0),eo()},className:x().retryButton,children:"Try Again"})]}),o&&"string"==typeof o&&(o.includes("$oid")||o.includes("_id"))&&(0,s.jsxs)("div",{className:x().debugPanel,children:[(0,s.jsx)("h3",{children:"Direct Document Data"}),(0,s.jsx)("p",{children:"It appears you're trying to view a book by passing the entire MongoDB document."}),(0,s.jsx)("p",{children:"Try visiting a URL with just the book ID instead."}),(0,s.jsxs)("div",{style:{marginTop:"20px"},children:[(0,s.jsx)("h4",{children:"Try to parse and display book:"}),(0,s.jsx)("button",{onClick:()=>{try{let e=E(o);e?(l(e),p(null)):p("Failed to parse book data from the provided document")}catch(e){p("Error parsing document: ".concat(e.message))}},className:x().actionButton,children:"Parse Document Data"})]})]})]})}},17203:(e,o,t)=>{"use strict";t.d(o,{JR:()=>s,Sn:()=>r}),t(72047);let s="https://ebookaura.onrender.com/api",r={AUTH:{LOGIN:"".concat(s,"/auth/login"),REGISTER:"".concat(s,"/auth/register"),ME:"".concat(s,"/auth/me"),FORGOT_PASSWORD:"".concat(s,"/auth/forgot-password"),RESET_PASSWORD:e=>"".concat(s,"/auth/reset-password/").concat(e),VERIFY_EMAIL:"".concat(s,"/auth/verify-email")},BOOKS:{ALL:"".concat(s,"/books"),CATEGORIES:"".concat(s,"/books/categories"),TAGS:"".concat(s,"/books/tags"),DETAILS:e=>"".concat(s,"/books/").concat(e),PDF:e=>"".concat(s,"/books/pdf/").concat(e),PDF_CONTENT:e=>"".concat(s,"/books/pdf/").concat(e),DOWNLOAD:e=>"".concat(s,"/books/").concat(e,"/download"),REVIEWS:e=>"".concat(s,"/books/").concat(e,"/reviews"),RATING:e=>"".concat(s,"/books/").concat(e,"/rating"),ADD_REVIEW:e=>"".concat(s,"/books/").concat(e,"/reviews")},UPLOAD:{FILE:"".concat(s,"/upload"),PDF:"".concat(s,"/upload/pdf"),DELETE_FILE:e=>"".concat(s,"/upload/").concat(e),DELETE_BOOK:e=>"".concat(s,"/upload/book/").concat(e)},USER:{PROFILE:"".concat(s,"/users/profile"),UPDATE_PROFILE:"".concat(s,"/users/profile"),UPDATE_IMAGE:"".concat(s,"/users/profile/image"),BOOKMARKS:"".concat(s,"/users/bookmarks")},SUBSCRIPTIONS:{CURRENT:"".concat(s,"/subscriptions/current"),CHECK:"".concat(s,"/subscriptions/check"),CHECK_API:"".concat(s,"/subscriptions/check-api"),ACTIVATE:"".concat(s,"/subscriptions/activate"),DEACTIVATE:"".concat(s,"/subscriptions/deactivate")},API_KEYS:{GENERATE:"".concat(s,"/api-keys/generate"),CURRENT:"".concat(s,"/api-keys/current"),REVOKE:"".concat(s,"/api-keys/revoke"),VERIFY:"".concat(s,"/api-keys/verify")}}},32695:e=>{e.exports={reviewContainer:"BookReview_reviewContainer__PXZXE",reviewHeader:"BookReview_reviewHeader__exUT_",reviewSummary:"BookReview_reviewSummary__m9pQe",totalRating:"BookReview_totalRating__pWZXj",overallRating:"BookReview_overallRating__ZqhqM",ratingValue:"BookReview_ratingValue__Ek1q_",ratingStars:"BookReview_ratingStars__TajM3",totalBadge:"BookReview_totalBadge__XRXmr",filterSortContainer:"BookReview_filterSortContainer__VbWZM",ratingFilters:"BookReview_ratingFilters__2sfGt",highlightFilters:"BookReview_highlightFilters__e7dxy",filtersHeader:"BookReview_filtersHeader__Bj9bO",pulseHeader:"BookReview_pulseHeader__10fad",activeFilterIndicator:"BookReview_activeFilterIndicator__0KGTt",filterBadge:"BookReview_filterBadge___lSTT",pulseBorder:"BookReview_pulseBorder__WH3PL",sortBadge:"BookReview_sortBadge__CS43D",fadeIn:"BookReview_fadeIn__ejiO2",clearFilterButton:"BookReview_clearFilterButton__DFeGj",filterOptions:"BookReview_filterOptions__Lr7_r",filterLabel:"BookReview_filterLabel__BUgIR",ratingFilterButtons:"BookReview_ratingFilterButtons__SNy3w",ratingFilterButton:"BookReview_ratingFilterButton__zBp4l",activeFilter:"BookReview_activeFilter__7fooV",filterStar:"BookReview_filterStar__D4fwS",sortOptions:"BookReview_sortOptions__isXrS",sortButtons:"BookReview_sortButtons__m0mZx",sortButton:"BookReview_sortButton__48q83",activeSort:"BookReview_activeSort__vJjfY",pulseDot:"BookReview_pulseDot__dlqnC",reviewContent:"BookReview_reviewContent__cNFFI",averageRating:"BookReview_averageRating__GLivu",ratingNumber:"BookReview_ratingNumber__2uD8e",reviewCount:"BookReview_reviewCount__gFeSv",displayStar:"BookReview_displayStar__Fz3J4",reviewForm:"BookReview_reviewForm__KzYxy",success:"BookReview_success__phiTs",submitError:"BookReview_submitError__GK4zL",ratingSelector:"BookReview_ratingSelector__Y8L9Q",stars:"BookReview_stars__vHpqj",ratingStar:"BookReview_ratingStar__7YZu8",commentField:"BookReview_commentField__HbZ9h",optional:"BookReview_optional__5fC_J",textarea:"BookReview_textarea__uqAZb",characterCount:"BookReview_characterCount__avyYp",submitButton:"BookReview_submitButton__uifGG",loginPrompt:"BookReview_loginPrompt__nl1B6",reviewsList:"BookReview_reviewsList__36HJ_",reviewsHeader:"BookReview_reviewsHeader__VE_c3",noReviews:"BookReview_noReviews__EL0Br",reviewItem:"BookReview_reviewItem__wF7Ok",reviewerInfo:"BookReview_reviewerInfo__yDoe0",reviewerImage:"BookReview_reviewerImage__T3neO",reviewerPlaceholder:"BookReview_reviewerPlaceholder__VLVSv",reviewerName:"BookReview_reviewerName___r0hh",reviewDate:"BookReview_reviewDate__fxaMW",reviewMetadata:"BookReview_reviewMetadata__cvN1d",deleteButton:"BookReview_deleteButton__sF4DA",reviewRating:"BookReview_reviewRating__TTay3",reviewText:"BookReview_reviewText__OjgJ1",confirmOverlay:"BookReview_confirmOverlay__3SoDg",confirmDialog:"BookReview_confirmDialog__rHKbe",slideUp:"BookReview_slideUp__26h3O",confirmHeader:"BookReview_confirmHeader__9ZJSd",closeButton:"BookReview_closeButton__ABCqQ",confirmButtons:"BookReview_confirmButtons__fnWlf",cancelButton:"BookReview_cancelButton__FmPbe",deleteConfirmButton:"BookReview_deleteConfirmButton__bWD9h",loading:"BookReview_loading__xP9sm",error:"BookReview_error__dxxxC",pulse:"BookReview_pulse__kJ1qE",filterButtons:"BookReview_filterButtons__HLVmO",filterStars:"BookReview_filterStars__VTPC6",filterCount:"BookReview_filterCount__bXmzR",filterBadgeContent:"BookReview_filterBadgeContent__IES9e",clearFilterBadge:"BookReview_clearFilterBadge__Kxty7",spinner:"BookReview_spinner__T90VY",spin:"BookReview_spin___BTC6",selectedRating:"BookReview_selectedRating__1uk3e",sortSelect:"BookReview_sortSelect__tzzV_",pagination:"BookReview_pagination__e2wwO",pageButton:"BookReview_pageButton__vOxgM",disabled:"BookReview_disabled__fnx_G",pageInfo:"BookReview_pageInfo__YqhK4",alreadyReviewed:"BookReview_alreadyReviewed__chKxo",userReviewBox:"BookReview_userReviewBox__RSQZF",userReviewHeader:"BookReview_userReviewHeader__fX13K",userReviewRating:"BookReview_userReviewRating__391lE",ratingText:"BookReview_ratingText__GR4Xk",deleteUserReviewButton:"BookReview_deleteUserReviewButton__kZBBT",userReviewComment:"BookReview_userReviewComment__O91VY",userReviewDate:"BookReview_userReviewDate__kM04j",slideDown:"BookReview_slideDown__twYYN"}},46264:(e,o,t)=>{"use strict";t.d(o,{D8:()=>c,_h:()=>n,checkSubscriptionWithApiKey:()=>d,getCurrentSubscription:()=>a,nV:()=>l,wQ:()=>i});var s=t(72047);t(17203);let r={PLANS:36e5,HISTORY:6e5},i=async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];try{let o="subscription_plans",{shouldMakeCall:t,cachedData:i}=(0,s.UB)(o,r.PLANS,e);if(!t&&i)return i;let a=await (0,s.dw)("/subscriptions/plans");if(a){let e=a.plans||a.data||[],t={...a,plans:e};return(0,s.yt)(o,t),t}return a}catch(e){throw console.error("Error fetching subscription plans:",e),e}},a=async()=>{try{let e=localStorage.getItem("token");if(!e)return console.log("No authentication token found for subscription check"),{success:!1,hasSubscription:!1,message:"Not authenticated"};console.log("Checking current subscription status from server...");let o=await fetch("".concat("https://ebookaura.onrender.com/api","/subscriptions/current"),{method:"GET",headers:{Authorization:"Bearer ".concat(e)}});console.log("Subscription status API response status: ".concat(o.status));let t=await o.json();if(console.log("Subscription status API response:",t),o.ok){void 0===t.hasSubscription&&void 0!==t.active?t.hasSubscription=t.active:void 0===t.active&&void 0!==t.hasSubscription&&(t.active=t.hasSubscription);try{localStorage.setItem("subscriptionStatus",JSON.stringify({hasSubscription:t.hasSubscription,active:t.hasSubscription,planType:t.planType,expiresAt:t.expiresAt,timestamp:new Date().toISOString()})),console.log("Subscription status cached successfully")}catch(e){console.warn("Failed to cache subscription status:",e)}return t.success&&t.hasSubscription?console.log("User has an active subscription (".concat(t.planType||"unknown"," plan), expires: ").concat(t.expiresAt||"unknown")):console.log("User does not have an active subscription"),t}throw console.error("Subscription check failed with error:",t.message),Error(t.message||"Failed to check subscription status")}catch(e){console.error("Error checking subscription status:",e);try{let e=localStorage.getItem("subscriptionStatus");if(e){let o=JSON.parse(e),t=new Date(o.timestamp),s=new Date;if(s-t<3e5)return console.log("Using cached subscription status from",new Date(o.timestamp).toLocaleTimeString()),console.log("Cached subscription value:",o.hasSubscription?"Active":"Inactive"),{success:!0,hasSubscription:o.hasSubscription,active:o.hasSubscription,planType:o.planType,expiresAt:o.expiresAt,fromCache:!0};console.log("Cached subscription data is too old:",Math.round((s-t)/6e4),"minutes old")}else console.log("No cached subscription data found")}catch(e){console.error("Error reading cached subscription status:",e)}return{success:!1,hasSubscription:!1,active:!1,error:e.message||"Failed to check subscription status"}}},n=async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];try{let o=localStorage.getItem("token");if(!o)throw Error("Authentication required");let t="subscription_history",{shouldMakeCall:i,cachedData:a}=(0,s.UB)(t,r.HISTORY,e);if(!i&&a)return a;let n=await (0,s.dw)("/subscriptions/history",{headers:{Authorization:"Bearer ".concat(o)}});return(0,s.yt)(t,n),n}catch(e){throw console.error("Error fetching subscription history:",e),e}},c=async e=>{try{let o=localStorage.getItem("token");if(!o)throw Error("Authentication required");if(console.log("Purchasing subscription with data:",e),!e.planId)throw Error("Plan ID is required");e.paymentMethod||(e.paymentMethod="coins");let t=await fetch("".concat("https://ebookaura.onrender.com/api","/subscriptions"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(o)},body:JSON.stringify(e)});console.log("Subscription purchase API response status: ".concat(t.status));let s=await t.json();if(console.log("Subscription purchase API response:",s),!t.ok)throw Error(s.message||"Failed to purchase subscription");try{localStorage.removeItem("subscriptionStatus"),console.log("Cleared subscription cache after purchase")}catch(e){console.warn("Failed to clear subscription cache:",e)}return s}catch(e){throw console.error("Error purchasing subscription:",e),e}},l=async(e,o)=>{try{let t=localStorage.getItem("token");if(!t)throw Error("Authentication required");let r=await (0,s.TA)("/subscriptions/".concat(e),o,{headers:{Authorization:"Bearer ".concat(t)}});return(0,s.yt)("current_subscription",null),(0,s.yt)("subscription_history",null),r}catch(e){throw console.error("Error updating subscription:",e),e}},d=async e=>{try{if(!e)throw console.error("checkSubscriptionWithApiKey called without an API key"),Error("API key is required");console.log("Checking subscription status with API key: ".concat(e.substring(0,5),"..."));let o=await fetch("".concat("https://ebookaura.onrender.com/api","/subscriptions/check-api"),{method:"GET",headers:{"X-API-Key":e}});console.log("Subscription check API response status: ".concat(o.status));let t=await o.json();if(console.log("Subscription check API response:",t),o.ok)return void 0===t.hasSubscription&&void 0!==t.active&&(t.hasSubscription=t.active),t.success&&t.hasSubscription?console.log("API key has valid subscription - granting access"):console.log("API key does not have an active subscription"),t;throw console.error("Subscription check failed with error:",t.message),Error(t.message||"Failed to check subscription status")}catch(e){return console.error("Error checking subscription with API key:",e),{success:!1,hasSubscription:!1,active:!1,error:e.message||"Failed to check subscription status"}}}},51879:(e,o,t)=>{"use strict";t.d(o,{A:()=>i});var s=t(95155),r=t(12115);let i=()=>((0,r.useEffect)(()=>{let e=document.createElement("script");e.type="text/javascript",e.src="https://highperformanceformat.com/7e8ec1de91b1d000fc448ad0674d6d34/invoke.js";let o=document.createElement("script");o.type="text/javascript",o.innerHTML="\n      atOptions = {\n        'key' : '7e8ec1de91b1d000fc448ad0674d6d34',\n        'format' : 'iframe',\n        'height' : 90,\n        'width' : 728,\n        'params' : {}\n      };\n    ";let t=document.getElementById("ad-container");t.appendChild(o),t.appendChild(e)},[]),(0,s.jsx)("div",{id:"ad-container",style:{textAlign:"center",margin:"20px 0"}}))},52596:(e,o,t)=>{"use strict";t.d(o,{A:()=>s});let s=function(){for(var e,o,t=0,s="",r=arguments.length;t<r;t++)(e=arguments[t])&&(o=function e(o){var t,s,r="";if("string"==typeof o||"number"==typeof o)r+=o;else if("object"==typeof o)if(Array.isArray(o)){var i=o.length;for(t=0;t<i;t++)o[t]&&(s=e(o[t]))&&(r&&(r+=" "),r+=s)}else for(s in o)o[s]&&(r&&(r+=" "),r+=s);return r}(e))&&(s&&(s+=" "),s+=o);return s}},53116:(e,o,t)=>{"use strict";t.d(o,{$P:()=>i,PZ:()=>u,Yv:()=>l,getUserCoins:()=>r,jv:()=>d,lD:()=>a,wA:()=>c,z$:()=>n});var s=t(72047);let r=async()=>{try{let e=localStorage.getItem("token");if(!e)throw Error("Authentication required");return await fetch("".concat("https://ebookaura.onrender.com/api","/coins"),{method:"GET",headers:{Authorization:"Bearer ".concat(e)}}).then(e=>{if(!e.ok)throw Error("Failed to get coin balance");return e.json()})}catch(e){throw console.error("Error getting user coins:",e),e}},i=async e=>{try{let o=localStorage.getItem("token");if(!o)throw Error("Authentication required");return await fetch("".concat("https://ebookaura.onrender.com/api","/coins/update-session"),{method:"POST",headers:{Authorization:"Bearer ".concat(o),"Content-Type":"application/json"},body:JSON.stringify({sessionDuration:e})}).then(e=>{if(!e.ok)throw Error("Failed to update session time");return e.json()})}catch(e){throw console.error("Error updating session time:",e),e}},a=async()=>{try{let e=localStorage.getItem("token");if(!e)throw Error("Authentication required");return await fetch("".concat("https://ebookaura.onrender.com/api","/coins/session-status"),{method:"GET",headers:{Authorization:"Bearer ".concat(e)}}).then(e=>{if(!e.ok)throw Error("Failed to get session status");return e.json()})}catch(e){throw console.error("Error getting session status:",e),e}},n=async()=>{try{let e=localStorage.getItem("token");if(!e)throw Error("Authentication required");return await fetch("".concat("https://ebookaura.onrender.com/api","/coins/activity-reward"),{method:"POST",headers:{Authorization:"Bearer ".concat(e)}}).then(e=>e.ok?e.json():e.json().then(e=>{throw Error(e.message||"Failed to claim activity reward")}))}catch(e){throw console.error("Error claiming activity reward coins:",e),e}},c=async()=>{try{let e=localStorage.getItem("token");if(!e)throw Error("Authentication required");return await fetch("".concat("https://ebookaura.onrender.com/api","/coins/daily"),{method:"POST",headers:{Authorization:"Bearer ".concat(e)}}).then(e=>e.ok?e.json():e.json().then(e=>{throw Error(e.message||"Failed to claim daily coins")}))}catch(e){throw console.error("Error claiming daily coins:",e),e}},l=async()=>{try{let e=localStorage.getItem("token");if(!e)throw Error("Authentication required");return await fetch("".concat("https://ebookaura.onrender.com/api","/coins/daily-status"),{method:"GET",headers:{Authorization:"Bearer ".concat(e)}}).then(e=>{if(!e.ok)throw Error("Failed to check daily coins status");return e.json()})}catch(e){throw console.error("Error checking daily coins status:",e),e}},d=async()=>{try{let e=localStorage.getItem("token");if(!e)throw Error("Authentication required");return await fetch("".concat("https://ebookaura.onrender.com/api","/coins/ad-reward"),{method:"POST",headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"},body:JSON.stringify({adUrl:"https://www.profitableratecpm.com/tv0ps1rfet?key=a753be44cf1e6c5a853397fa67fe886c"})}).then(e=>{if(!e.ok)throw Error("Failed to claim ad reward coins");return e.json()})}catch(e){throw console.error("Error claiming ad reward coins:",e),e}},u=async e=>{try{let o=localStorage.getItem("token");if(!o)throw Error("Authentication required");return await (0,s.dw)("/users/check-purchase/".concat(e),{headers:{Authorization:"Bearer ".concat(o)}})}catch(e){throw console.error("Error checking book purchase:",e),e}}},63554:(e,o,t)=>{"use strict";t.d(o,{default:()=>r.a});var s=t(69243),r=t.n(s)},71759:e=>{e.exports={container:"book_container__t7HpC",bookContainer:"book_bookContainer__LlohC",errorContainer:"book_errorContainer__YaCbj",debugPanel:"book_debugPanel__oka9O",buttonRow:"book_buttonRow__KAPP4",retryButton:"book_retryButton___vBiw",actionButton:"book_actionButton__41ZPr",buttonIcon:"book_buttonIcon__H5VkG",header:"book_header__KPynt",backButton:"book_backButton__vDnG6",bookDetailContainer:"book_bookDetailContainer__v_R0K",bookInformation:"book_bookInformation__StZ6g",bookCover:"book_bookCover__wj7vL",premiumOverlay:"book_premiumOverlay__U1vfK",lockIcon:"book_lockIcon__F6QwL",lockIconPlaceholder:"book_lockIconPlaceholder__moAc7",premiumBadge:"book_premiumBadge__MoqZw",crownIcon:"book_crownIcon__tVYMH",categoryInfo:"book_categoryInfo__Bu7tP",premiumTag:"book_premiumTag__EMpPl",premiumIcon:"book_premiumIcon__3M5jJ",premiumMessage:"book_premiumMessage__XV4N8",lockIconMessage:"book_lockIconMessage__46A1_",loginLink:"book_loginLink__vAMwB",disabledButton:"book_disabledButton__TW6dJ",placeholderCover:"book_placeholderCover__5P_sO",title:"book_title__xHEy4",author:"book_author__FsqOe",category:"book_category__zzF9H",stats:"book_stats__wU7Ul",stat:"book_stat__mAw2q",description:"book_description__T_l8Y",tags:"book_tags__gKDwb",tagList:"book_tagList__Gixb3",tag:"book_tag__Kk0Gj",noTags:"book_noTags__Qq9um",actions:"book_actions__zgoNS",viewButton:"book_viewButton__yhdR4",downloadButton:"book_downloadButton__xSZiq",openUrlButton:"book_openUrlButton__rZVel",loading:"book_loading__jGrZj",error:"book_error__olOYE",buttonGroup:"book_buttonGroup__1dUE_",loadingContainer:"book_loadingContainer__IEHKf",loadingSpinner:"book_loadingSpinner__PQ2dU",spin:"book_spin__v3jCK",actionButtons:"book_actionButtons__4FEwM",searchButton:"book_searchButton__YOZRF",errorDetails:"book_errorDetails__zCEXA",premiumPurchaseContainer:"book_premiumPurchaseContainer__nB9yX",premiumPrice:"book_premiumPrice__wmzKZ",coinIcon:"book_coinIcon__5w8cr",priceValue:"book_priceValue__xy2Zn",purchaseButton:"book_purchaseButton__HQhwt",purchaseError:"book_purchaseError___ubRi",purchaseSuccess:"book_purchaseSuccess__ekger",insufficientCoins:"book_insufficientCoins__gGYYV",getCoinsLink:"book_getCoinsLink__nvlTT",confirmationOverlay:"book_confirmationOverlay__Yc4oV",confirmationDialog:"book_confirmationDialog__Qnw0H",fadeIn:"book_fadeIn__B4bvh",confirmationButtons:"book_confirmationButtons__C0Pf2",cancelButton:"book_cancelButton__pmZIc",confirmButton:"book_confirmButton__51wVy",subscriptionAccess:"book_subscriptionAccess__Nklgl",checkIcon:"book_checkIcon__E60cw",accessTitle:"book_accessTitle__IKMB9",accessText:"book_accessText__zkInu",subscriptionRequired:"book_subscriptionRequired__excAU",subscriptionMessage:"book_subscriptionMessage__N2Ss_",subscriptionTitle:"book_subscriptionTitle__NtnNf",subscriptionText:"book_subscriptionText__N_v__",subscribeButton:"book_subscribeButton__0HqOY",buttonCrownIcon:"book_buttonCrownIcon__A_8bS",loginRequired:"book_loginRequired__xdOuk",loginMessage:"book_loginMessage__wVBO8",loginButtons:"book_loginButtons__obmAL",loginButton:"book_loginButton__NF5h2",signupButton:"book_signupButton__kSD2R",userIcon:"book_userIcon__xrNmi",userPlusIcon:"book_userPlusIcon__3GqrI"}},78876:(e,o,t)=>{"use strict";t(95155),t(12115)}}]);